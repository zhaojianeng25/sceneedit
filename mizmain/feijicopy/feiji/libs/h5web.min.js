
function float2int(a){return 0|a}function radian2angle(a){return a/Math.PI*180}function angle2radian(a){return a/180*Math.PI}function makeImage(){var a=new Image;return a.setAttribute("crossOrigin","anonymous"),a}function getChiNum(a){return keyChi[a]}function hexToArgb(a,b,c){return void 0===b&&(b=!0),void 0===c&&(c=null),c||(c=new Pan3d.Vector3D),c.w=b?a>>24&255:0,c.x=a>>16&255,c.y=a>>8&255,c.z=255&a,c}function hexToArgbNum(a,b,c){return void 0===b&&(b=!0),void 0===c&&(c=null),c=hexToArgb(a,b,c),c.scaleBy(1/255),c}function getBaseUrl(){return Pan3d.Scene_data.supportBlob?"":"_base"}function strokeFilter(a,b,c,d){function e(a,c){return 4*(c*b+a)}function f(a,b){var c;return c=e(a-1,b),i[c+3]>0?!0:(c=e(a+1,b),i[c+3]>0?!0:(c=e(a,b+1),i[c+3]>0?!0:(c=e(a,b-1),i[c+3]>0?!0:!1)))}for(var g=hexToArgb(d),h=a.getImageData(0,0,b,c),i=h.data,j=new Array,k=1;b-1>k;k++)for(var l=0;c-1>l;l++){var m=e(k,l);0==i[m+3]&&f(k,l)&&j.push(m)}for(var k=0;k<j.length;k++)i[j[k]]=g.x,i[j[k]+1]=g.y,i[j[k]+2]=g.z,i[j[k]+3]=g.w;a.putImageData(h,0,0)}function trim(a){return trimRight(trimLeft(a))}function trimLeft(a){if(null==a)return"";var b=new String(" 	\n\r"),c=new String(a);if(-1!=b.indexOf(c.charAt(0))){for(var d=0,e=c.length;e>d&&-1!=b.indexOf(c.charAt(d));)d++;c=c.substring(d,e)}return c}function trimRight(a){if(null==a)return"";var b=new String(" 	\n\r"),c=new String(a);if(-1!=b.indexOf(c.charAt(c.length-1))){for(var d=c.length-1;d>=0&&-1!=b.indexOf(c.charAt(d));)d--;c=c.substring(0,d+1)}return c}function TweenMoveTo(a,b,c){}function getScencdStr(a){var b=Math.floor(a/60%60),c=Math.floor(a%60);return String(10>b?"0":"")+String(b)+":"+String(10>c?"0":"")+String(c)}function random(a){return Math.floor(Math.random()*a)}function randomByItem(a){return a[random(a.length)]}function makeArray(a,b){for(var c=0;c<a.length;c++)b.push(a[c])}function unZip(a){var b=new Uint8Array(a),c=new Zlib.Inflate(b),d=c.decompress();return d.buffer}function getZipByte(a){var b=a.readInt(),c=a.buffer.slice(a.position,a.position+b);a.position+=b;var d=unZip(c);return new Pan3d.Pan3dByteArray(d)}function getUrlParam(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return null!=c?decodeURI(c[2]):null}function copy2clipboard(a){var b=document.createElement("textarea");b.style.fontSize="12pt",b.style.position="absolute",b.style["z-index"]=-1,b.style.background="transparent",b.style.border="transparent",b.style.color="white",b.setAttribute("readonly",""),document.body.appendChild(b),b.value=a,b.select(),b.setSelectionRange(0,b.value.length);try{document.execCommand("copy")}catch(c){alert("不支持复制")}setTimeout(function(){document.body.removeChild(b)},1e3)}function getBit(a,b){return Boolean(a>>(31&b)&1)}function getUItittleUrl(a){return"ui/load/tittle/"+a+".png"}function getSkillUrl(a){!a||0==a.length;var b="skill/"+a+getBaseUrl()+".txt";return b.replace(".txt","_byte.txt")}function getModelUrl(a){return"model/"+a+getBaseUrl()+".txt"}function getModelUIUrl(a){return"model/"+a+getBaseUrl()+".txt"}function getMapUrl(a){return"map/"+a+".txt"}function getRoleUrl(a){return"role/"+a+getBaseUrl()+".txt"}function getZipMapUrl(a){return"map/"+a+"/"}function Snum(a){return"123"}function getEffectUIUrl(a){return"ui/load/effect/"+a+".png"}function getKeyProById(a){return"cc"}var Pan3d;!function(a){var b=function(){function a(a){this.type=a}return a.COMPLETE="complete",a}();a.BaseEvent=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this._eventsMap=null}return a.prototype.addEventListener=function(a,b,c){this._eventsMap||(this._eventsMap=new Object);var d=this._eventsMap[a];d||(d=this._eventsMap[a]=[]);for(var e={listener:b,thisObject:c},f=0;f<d.length;f++){var g=d[f];if(g.listener==b&&g.thisObject==c)return}d.push(e)},a.prototype.removeEventListener=function(a,b,c){if(null!=this._eventsMap)for(var d=this._eventsMap[a],e=0;d&&e<d.length;e++){var f=d[e];if(f.listener==b&&f.thisObject==c)return void d.splice(e,1)}},a.prototype.dispatchEvent=function(a){var b=this._eventsMap;if(!b)return!0;var c=b[a.type];if(!c)return!0;var d=c.length;if(0==d)return!0;a.target=this;for(var e=0;d>e;e++){var f=c[e];f.listener.call(f.thisObject,a)}},a}();a.EventDispatcher=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.prototype.destory=function(){},a}();a.GC=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._useNum=0,b.idleTime=0,b}return __extends(b,a),Object.defineProperty(b.prototype,"useNum",{get:function(){return this._useNum},set:function(a){this._useNum=a,0==this._useNum&&(this.idleTime=0)},enumerable:!0,configurable:!0}),b.prototype.clearUseNum=function(){this._useNum--,this._useNum<=0&&(this.idleTime=b.GCTime)},b.GCTime=4,b}(a.GC);a.ResCount=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){var b=this;this._dic=new Object,a.TimeUtil.addTimeTick(6e4,function(){b.gc()})}return b.prototype.gc=function(){for(var b in this._dic){var c=this._dic[b];c.useNum<=0&&(c.idleTime++,c.idleTime>=a.ResCount.GCTime&&(c.destory(),delete this._dic[b]))}},b}();a.ResGC=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(c,d,e){void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0);var f=b.call(this)||this;return f._x=c,f._y=d,f._z=e,f._scaleX=1,f._scaleY=1,f._scaleZ=1,f._rotationX=0,f._rotationY=0,f._rotationZ=0,f.posMatrix=new a.Matrix3D,f}return __extends(c,b),c.prototype.toStringout=function(){return"Object3D("+String(this._x)+","+String(this._y)+","+String(this._z)+")"},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"z",{get:function(){return this._z},set:function(a){this._z=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{set:function(a){this._scaleX=this._scaleY=this._scaleZ=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleX",{get:function(){return this._scaleX},set:function(a){this._scaleX=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleY",{get:function(){return this._scaleY},set:function(a){this._scaleY=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleZ",{get:function(){return this._scaleZ},set:function(a){this._scaleZ=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationX",{get:function(){return this._rotationX},set:function(a){this._rotationX=a,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationY",{get:function(){return this._rotationY},set:function(a){isNaN(a)&&console.log("有错"),this._rotationY=a,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationZ",{get:function(){return this._rotationZ},set:function(a){this._rotationZ=a,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"px",{get:function(){return 0},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"py",{get:function(){return 0},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pz",{get:function(){return 0},set:function(a){},enumerable:!0,configurable:!0}),c.prototype.updateMatrix=function(){this.posMatrix.identity(),this.posMatrix.appendScale(this._scaleX,this._scaleY,this._scaleZ),this.posMatrix.appendRotation(this._rotationX,a.Vector3D.X_AXIS),this.posMatrix.appendRotation(this._rotationY,a.Vector3D.Y_AXIS),this.posMatrix.appendRotation(this._rotationZ,a.Vector3D.Z_AXIS),this.posMatrix.appendTranslation(this._x,this._y,this._z)},c.prototype.updateRotationMatrix=function(){},c}(a.EventDispatcher);a.Object3D=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._distance=500,c.offset=new a.Vector3D,c.lastFoucs3D=new a.Vector3D,c.needChange=!0,c.cavanRect=new a.Rectangle(0,0,512,512),c.cameraMatrix=new a.Matrix3D,c.scene2dScale=1,c}return __extends(c,b),Object.defineProperty(c.prototype,"distance",{get:function(){return this._distance},set:function(a){this._distance=a},enumerable:!0,configurable:!0}),c.prototype.lookAt=function(a){this.lookAtTarget=a},Object.defineProperty(c.prototype,"astarRect",{set:function(b){this._astarRect=new a.Rectangle,this._astarRect.x=b.x,this._astarRect.y=b.y,this._astarRect.width=b.width,this._astarRect.height=b.height,this._midPos=new a.Vector3D,this._midPos.x=this._astarRect.x+this._astarRect.width/2,this._midPos.z=this._astarRect.y+this._astarRect.height/2,this._scaleVec=new a.Vector3D,this._scaleVec.x=(this._astarRect.width-100)/this._astarRect.width,this._scaleVec.z=(this._astarRect.height-100)/this._astarRect.height},enumerable:!0,configurable:!0}),c.prototype.update=function(){if(this.lookAtTarget){var b=28;if(this._astarRect&&this._astarRect.width<600){var c=new a.Vector3D;c.x=(this.lookAtTarget.px-this._midPos.x)*this._scaleVec.x+this._midPos.x,c.z=(this.lookAtTarget.pz-this._midPos.z)*this._scaleVec.z+this._midPos.z,c.y=this.lookAtTarget.py,a.Scene_data.focus3D.x=c.x,a.Scene_data.focus3D.y=c.y+b,a.Scene_data.focus3D.z=c.z}else a.Scene_data.focus3D.x=this.lookAtTarget.px,a.Scene_data.focus3D.y=this.lookAtTarget.py+b,a.Scene_data.focus3D.z=this.lookAtTarget.pz;this.lastFoucs3D.x!=a.Scene_data.focus3D.x||this.lastFoucs3D.y!=a.Scene_data.focus3D.y||this.lastFoucs3D.z!=a.Scene_data.focus3D.z?(this.lastFoucs3D.x=a.Scene_data.focus3D.x,this.lastFoucs3D.y=a.Scene_data.focus3D.y,this.lastFoucs3D.z=a.Scene_data.focus3D.z,this.needChange=!0):this.needChange=!1}},Object.defineProperty(c.prototype,"postion",{get:function(){return new a.Vector3D(this.x,this.y,this.z)},enumerable:!0,configurable:!0}),c}(a.Object3D);a.Camera3D=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.vertices=new Array,a.uvs=new Array,a.indexs=new Array,a.lightuvs=new Array,a.normals=new Array,a.tangents=new Array,a.bitangents=new Array,a._treNum=0,a.compressBuffer=!1,a.hasdispose=!1,a}return __extends(c,b),Object.defineProperty(c.prototype,"treNum",{get:function(){return this._treNum},set:function(a){this._treNum=a},enumerable:!0,configurable:!0}),c.prototype.destory=function(){this.vertices.length=0,this.vertices=null,this.uvs.length=0,this.uvs=null,this.indexs.length=0,this.indexs=null,this.lightuvs.length=0,this.lightuvs=null,this.normals.length=0,this.normals=null,this.tangents.length=0,this.tangents=null,this.bitangents.length=0,this.bitangents=null,this.vertexBuffer&&(a.Scene_data.context3D.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null),this.uvBuffer&&(a.Scene_data.context3D.deleteBuffer(this.uvBuffer),this.uvBuffer=null),this.indexBuffer&&(a.Scene_data.context3D.deleteBuffer(this.indexBuffer),this.indexBuffer=null),this.lightUvBuffer&&(a.Scene_data.context3D.deleteBuffer(this.lightUvBuffer),this.lightUvBuffer=null),this.normalsBuffer&&(a.Scene_data.context3D.deleteBuffer(this.normalsBuffer),this.normalsBuffer=null),this.tangentBuffer&&(a.Scene_data.context3D.deleteBuffer(this.tangentBuffer),this.tangentBuffer=null),this.bitangentBuffer&&(a.Scene_data.context3D.deleteBuffer(this.bitangentBuffer),this.bitangentBuffer=null),this.hasdispose=!0},c}(a.ResCount);a.ObjData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.boneIDAry=new Array,a.boneWeightAry=new Array,a.boneNewIDAry=new Array,a.particleAry=new Array,a}return __extends(c,b),c.prototype.getBindPosMatrix=function(){for(var b=new Array,c=new Array,d=0;d<this.bindPosAry.length;d++){var e=this.bindPosAry[d],f=new a.Quaternion(e[0],e[1],e[2]);f.setMd5W();var g=f.toMatrix3D();g.appendTranslation(e[3],e[4],e[5]),c.push(g.clone()),g.invert(),b.push(g)}this.bindPosMatrixAry=b,this.bindPosInvertMatrixAry=c},c.prototype.clone=function(){var a=new c;for(var b in this)a[b]=this[b];return a},c.prototype.destory=function(){b.prototype.destory.call(this),this.materialParam&&(this.materialParam.destory(),this.materialParam=null,this.materialParamData=null),this.boneIDAry.length=0,this.boneWeightAry.length=0,this.boneNewIDAry.length=0,this.boneIDAry=null,this.boneWeightAry=null,this.boneNewIDAry=null,this.boneWeightBuffer&&(a.Scene_data.context3D.deleteBuffer(this.boneWeightBuffer),this.boneWeightBuffer=null),this.boneIdBuffer&&(a.Scene_data.context3D.deleteBuffer(this.boneIdBuffer),this.boneIdBuffer=null),this.material&&this.material.clearUseNum(),this.particleAry.length=0,this.particleAry=null},c}(a.ObjData);a.MeshData=b;var c=function(){function a(a,b){this.url=a,this.socketName=b}return a}();a.BindParticle=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(a){this._keys=new Array,this._values=new Array;for(var b=0;a&&b<a.length;b++)this[a[b].key]=a[b].value,this._keys.push(a[b].key),this._values.push(a[b].value)}return a.prototype.add=function(a,b){this[a]=b,this._keys.push(a),this._values.push(b)},a.prototype.has=function(a){return this[a]?!0:!1},a.prototype.remove=function(a){var b=this._keys.indexOf(a,0);this._keys.splice(b,1),this._values.splice(b,1),delete this[a]},a.prototype.keys=function(){return this._keys},a.prototype.values=function(){return this._values},a.prototype.containsKey=function(a){return"undefined"==typeof this[a]?!1:!0},a.prototype.toLookup=function(){return this},a}();a.Dictionary=b;(function(){function a(){this._item=new Array}return a.prototype.add=function(a){this._item.push(a)},a.prototype.has=function(a){for(var b=0;b<this._item.length;b++)if(this._item[b]==a)return!0;return!1},a})()}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.Orange7a2f21="[7a2f21]",a.Orange9a683f="[9a683f]",a.Orange853d07="[853d07]",a.Brown6a4936="[6a4936]",a.Brown623424="[623424]",a.Brownac8965="[ac8965]",a.Reddb4051="[db4051]",a.Redd92200="[d92200]",a.Redff0000="[ff0000]",a.Brownd8d49c="[d8d49c]",a.color843b11="[843b11]",a.colorb96d49="[b96d49]",a.colorcd2000="[cd2000]",a.colorfef3d7="[fef3d7]",a.color9a683f="[9a683f]",a.Brown7a2f21="[7a2f21]",a.Brown40120a="[40120a]",a.Brown491207="[491207]",a.Brown541616="[541616]",a.Brown5a2610="[5a2610]",a.Browndf9a68="[df9a68]",a.Browndb39264="[b39264]",a.Brownd662c0d="[662c0d]",a.colorefe4c4="[efe4c4]",a.color802626="[802626]",a.color9f7b4d="[9f7b4d]",a.color4b0808="[4b0808]",a.color5f5c59="[5f5c59]",a.color903713="[903713]",a.colorfdf6da="[fdf6da]",a.color73301c="[73301c]",a.colorffeeb5="[ffeeb5]",a.Green98ec2c="   ",a.Green56da35="[56da35]",a.Green20a200="[20a200]",a.Greenadff00="[adff00]",a.Green2ca937="[2ca937]",a.Green464b11="[464b11]",a.Green54db36="[54db36]",a.Yellowf7d253="[f7d253]",a.Yellowffecc6="[ffecc6]",a.Yellowffd500="[ffd500]",a.Yellowffe9b4="[ffe9b4]",a.Yellowedce7e="[edce7e]",a.color4c1c07="[4c1c07]",a.Whiteffffff="[ffffff]",a.Whitefffce6="[fffce6]",a.Whitefff7db="[fff7db]",a.White9A683F="[9A683F]",a.Black000000="[000000]",a.Whitefff4d6="[fff4d6]",a.Whiteffeed0="[ffeed0]",a.Whiteffeec9="[ffeec9]",a.Whiteffe9b4="[ffe9b4]",a.Whitefff0b4="[fff0b4]",a.Coffeeff9200="[ff9200]",a.Coffeefee87b="[fee87b]",a.color2daa35="[2daa35]",a.color4392ff="[4392ff]",a.colorb759ff="[b759ff]",a.colorff7200="[ff7200]",a.colorce0a00="[ce0a00]",a.coloraa874a="[aa874a]",a.colorffecc6="[ffecc6]",a.colorfde87e="[fde87e]",a.colord6e7ff="[d6e7ff]",a.colord27262e="[27262e]",a.colorffe9b4="[ffe9b4]",a.color9c9b9b="[9c9b9b]",a.colorfff2d3="[fff2d3]",a.color451800="[451800]",a}();a.ColorType=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(b,c){this.width=b,this.height=c;var d=a.UIManager.getInstance().getContext2D(this.width,this.height,!1);this.imgData=d.getImageData(0,0,this.width,this.height);for(var e=0;e<this.imgData.data.length;e+=4)this.imgData.data[e+0]=255,this.imgData.data[e+1]=255,this.imgData.data[e+2]=255,this.imgData.data[e+3]=255}return b.prototype.getIndexByPos=function(a,b){var c=b*this.width+a;return 4*c},b.prototype.setRgb=function(a,b,c){a=Math.round(a),b=Math.round(b);var d=this.getIndexByPos(a,b);this.imgData.data[d+0]=255*c.x,this.imgData.data[d+1]=255*c.y,this.imgData.data[d+2]=255*c.z,this.imgData.data[d+3]=255},b.prototype.getRgb=function(b,c){b=Math.round(b),c=Math.round(c);var d=new a.Vector3D,e=this.getIndexByPos(b,c);return d.x=this.imgData.data[e+0]/255,d.y=this.imgData.data[e+1]/255,d.z=this.imgData.data[e+2]/255,d.w=1,d},b}();a.BitMapData=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.saveBasePrarame=function(a){this.GlarrayBuffer=a.getParameter(a.ARRAY_BUFFER_BINDING),this.GlelementArrayBuffer=a.getParameter(a.ELEMENT_ARRAY_BUFFER_BINDING),this.Glprogram=a.getParameter(a.CURRENT_PROGRAM),this.GlsFactor=a.getParameter(a.BLEND_SRC_RGB),this.GldFactor=a.getParameter(a.BLEND_DST_RGB),this.GldepthWriteMask=a.getParameter(a.DEPTH_WRITEMASK),this.GlcullFaceModel=a.getParameter(a.CULL_FACE_MODE),this.Glglviewport=a.getParameter(a.VIEWPORT),this.GlfrontFace=a.getParameter(a.FRONT_FACE),this.GlDepthTest=a.getParameter(a.DEPTH_TEST),this.GlCullFace=a.getParameter(a.CULL_FACE)},a.resetBasePrarame=function(a){a.useProgram(this.Glprogram),a.viewport(this.Glglviewport[0],this.Glglviewport[1],this.Glglviewport[2],this.Glglviewport[3]),a.bindBuffer(a.ARRAY_BUFFER,this.GlarrayBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.GlelementArrayBuffer),a.blendFunc(this.GlsFactor,this.GldFactor),a.depthMask(this.GldepthWriteMask),a.cullFace(this.GlcullFaceModel),a.frontFace(this.GlfrontFace),this.GlCullFace?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.GlDepthTest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST)},a}();a.GlReset=b;var c=function(){function b(){this.setTextureNum=0,this.setProgramNum=0}return b.prototype.init=function(a){var b=a.getContext("webgl",{stencil:!0,alpha:!0,depth:!0,antialias:!1})||a.getContext("experimental-webgl",{stencil:!0,alpha:!0,depth:!0,antialias:!1});this.renderContext=b,this._contextSetTest=new e},b.prototype.resetSize=function(a,b){this.renderContext.viewport(0,0,a,b)},b.prototype.uploadBuff3D=function(a){var b=this.renderContext.getParameter(this.renderContext.ARRAY_BUFFER_BINDING),c=this.renderContext.createBuffer();return this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,c),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,new Float32Array(a),this.renderContext.STATIC_DRAW),b&&this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,b),c},b.prototype.uploadBuff3DArrayBuffer=function(a){var b=this.renderContext.getParameter(this.renderContext.ARRAY_BUFFER_BINDING),c=this.renderContext.createBuffer();return this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,c),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,a,this.renderContext.STATIC_DRAW),b&&this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,b),c},b.prototype.uploadBuff3DByBuffer=function(a,b){this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,a),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,new Float32Array(b),this.renderContext.STATIC_DRAW)},b.prototype.uploadIndexBuff3D=function(a){var b=this.renderContext.getParameter(this.renderContext.ELEMENT_ARRAY_BUFFER_BINDING),c=this.renderContext.createBuffer();return this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,c),this.renderContext.bufferData(this.renderContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),this.renderContext.STATIC_DRAW),b&&this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,b),c},b.prototype.uploadIndexBuff3DByBuffer=function(a,b){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,a),this.renderContext.bufferData(this.renderContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),this.renderContext.STATIC_DRAW)},b.prototype.clearContext=function(){this.renderContext.depthMask(!0),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT)},b.prototype.update=function(){this._contextSetTest.clear(),this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,null),this.renderContext.clearColor(63/255,63/255,63/255,1),this.renderContext.clearDepth(1),this.renderContext.clearStencil(0),this.renderContext.enable(this.renderContext.DEPTH_TEST),this.renderContext.depthMask(!0),this.renderContext.enable(this.renderContext.BLEND),this.renderContext.frontFace(this.renderContext.CW),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT),this.setBlendParticleFactors(0),this.renderContext.disable(this.renderContext.CULL_FACE),this.setTextureNum=0,this.setProgramNum=0},b.prototype.updateFBO=function(a){this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,a.frameBuffer),this.renderContext.clearColor(63/255,63/255,63/255,1),this.renderContext.clearDepth(1),this.renderContext.clearStencil(0),this.renderContext.enable(this.renderContext.DEPTH_TEST),this.renderContext.depthMask(!0),this.renderContext.enable(this.renderContext.BLEND),this.renderContext.frontFace(this.renderContext.CW),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT),this.setBlendParticleFactors(0),this.renderContext.disable(this.renderContext.CULL_FACE)},b.prototype.setDepthTest=function(a){a?this.renderContext.enable(this.renderContext.DEPTH_TEST):this.renderContext.disable(this.renderContext.DEPTH_TEST)},b.prototype.setWriteDepth=function(a){this._contextSetTest.testZbuffer(a)||this.renderContext.depthMask(a)},b.prototype.setBlendParticleFactors=function(a){switch(this._contextSetTest.testBlend(a),a){case 0:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE_MINUS_SRC_ALPHA);break;case 1:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE);break;case 2:this.renderContext.blendFunc(this.renderContext.DST_COLOR,this.renderContext.ZERO);break;case 3:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE_MINUS_SRC_COLOR);break;case 4:this.renderContext.blendFunc(this.renderContext.SRC_ALPHA,this.renderContext.ONE);break;case-1:this.renderContext.blendFunc(this.renderContext.SRC_ALPHA,this.renderContext.ONE_MINUS_SRC_ALPHA)}},b.prototype.setProgram=function(a){this._contextSetTest.testProgram(a)||(this.renderContext.useProgram(a),this.setProgramNum++)},b.prototype.getLocation=function(a,b){return this.renderContext.getUniformLocation(a,b)},b.prototype.setVcMatrix3fv=function(a,b,c){this.renderContext.uniformMatrix3fv(a.getWebGLUniformLocation(b),!1,c)},b.prototype.setVcMatrix4fv=function(a,b,c){this.renderContext.uniformMatrix4fv(a.getWebGLUniformLocation(b),!1,c)},b.prototype.setVpMatrix=function(a,b){this._contextSetTest.testVp()||this.renderContext.uniformMatrix4fv(a.getWebGLUniformLocation("vpMatrix3D"),!1,b)},b.prototype.setVc4fv=function(a,b,c){this.renderContext.uniform4fv(a.getWebGLUniformLocation(b),c)},b.prototype.setVc1fv=function(a,b,c){this.renderContext.uniform1fv(a.getWebGLUniformLocation(b),c)},b.prototype.setVc3fv=function(a,b,c){this.renderContext.uniform3fv(a.getWebGLUniformLocation(b),c)},b.prototype.setVc2fv=function(a,b,c){this.renderContext.uniform2fv(a.getWebGLUniformLocation(b),c)},b.prototype.setVcFloat=function(a,b,c){this.renderContext.uniform1fv(a.getWebGLUniformLocation(b),c)},b.prototype.setuniform1f=function(a,b,c){this.renderContext.uniform1f(a.getWebGLUniformLocation(b),c)},b.prototype.setuniform3f=function(a,b,c,d,e){this.renderContext.uniform3f(a.getWebGLUniformLocation(b),c,d,e)},b.prototype.setVcMatrix4fvLocation=function(a,b){this.renderContext.uniformMatrix4fv(a,!1,b)},b.prototype.setVc2f=function(a,b,c,d){this.renderContext.uniform2f(a.getWebGLUniformLocation(b),c,d)},b.prototype.setVcMatrix2fvLocation=function(a,b){this.renderContext.uniformMatrix2fv(a,!1,b)},b.prototype.setVc4fvLocation=function(a,b){this.renderContext.uniform4fv(a,b)},b.prototype.setVa=function(a,b,c){this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,c),this.renderContext.enableVertexAttribArray(a),this.renderContext.vertexAttribPointer(a,b,this.renderContext.FLOAT,!1,0,0)},b.prototype.pushVa=function(a){return this.renderContext.getParameter(this.renderContext.ARRAY_BUFFER_BINDING)==a?!0:(this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,a),!1)},b.prototype.setVaOffset=function(a,b,c,d){this.renderContext.enableVertexAttribArray(a),this.renderContext.vertexAttribPointer(a,b,this.renderContext.FLOAT,!1,c,d)},b.prototype.clearVa=function(a){this.renderContext.disableVertexAttribArray(a)},b.prototype.drawCall=function(a,b){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,a),this.renderContext.drawElements(this.renderContext.TRIANGLES,b,this.renderContext.UNSIGNED_SHORT,0)},b.prototype.drawLine=function(a,b){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,a),this.renderContext.drawElements(this.renderContext.LINES,b,this.renderContext.UNSIGNED_SHORT,0)},b.prototype.setRenderTexture=function(a,b,c,d,e){void 0===e&&(e=!0),e&&this._contextSetTest.testTexture(b,c)||(0==d?this.renderContext.activeTexture(this.renderContext.TEXTURE0):1==d?this.renderContext.activeTexture(this.renderContext.TEXTURE1):2==d?this.renderContext.activeTexture(this.renderContext.TEXTURE2):3==d?this.renderContext.activeTexture(this.renderContext.TEXTURE3):4==d?this.renderContext.activeTexture(this.renderContext.TEXTURE4):5==d?this.renderContext.activeTexture(this.renderContext.TEXTURE5):6==d&&this.renderContext.activeTexture(this.renderContext.TEXTURE6),this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,c),this.renderContext.uniform1i(a.getWebGLUniformLocation(b),d),this.setTextureNum++)},b.prototype.setRenderTextureCube=function(a,b,c,d){0==d?this.renderContext.activeTexture(this.renderContext.TEXTURE0):1==d?this.renderContext.activeTexture(this.renderContext.TEXTURE1):2==d?this.renderContext.activeTexture(this.renderContext.TEXTURE2):3==d?this.renderContext.activeTexture(this.renderContext.TEXTURE3):4==d?this.renderContext.activeTexture(this.renderContext.TEXTURE4):5==d?this.renderContext.activeTexture(this.renderContext.TEXTURE5):6==d&&this.renderContext.activeTexture(this.renderContext.TEXTURE6),this.renderContext.bindTexture(this.renderContext.TEXTURE_CUBE_MAP,c),this.renderContext.uniform1i(this.renderContext.getUniformLocation(a,b),d)},b.prototype.updateTexture=function(a,b,c,d){this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,a),this.renderContext.texSubImage2D(this.renderContext.TEXTURE_2D,0,b,c,this.renderContext.RGBA,this.renderContext.UNSIGNED_BYTE,d)},b.prototype.getTexture=function(b,c,d,e){void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0);var f=new a.Rectangle(0,0,Math.pow(2,Math.ceil(Math.log(b.width)/Math.log(2))),Math.pow(2,Math.ceil(Math.log(b.height)/Math.log(2))));if(f.width!=b.width||f.height!=b.height){var g=a.UIManager.getInstance().getContext2D(f.width,f.height,!1);return g.drawImage(b,0,0,b.width,b.height,0,0,f.width,f.height),this.getTexture(g.canvas,0,0)}var h=this.renderContext.createTexture();this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,h),this.renderContext.texImage2D(this.renderContext.TEXTURE_2D,0,this.renderContext.RGBA,this.renderContext.RGBA,this.renderContext.UNSIGNED_BYTE,b);var i;i=0==d?this.renderContext.LINEAR:this.renderContext.NEAREST;var j;return 0==d?0==e?j=this.renderContext.LINEAR:1==e?j=this.renderContext.LINEAR_MIPMAP_LINEAR:2==e&&(j=this.renderContext.LINEAR_MIPMAP_NEAREST):0==e?j=this.renderContext.NEAREST:1==e?j=this.renderContext.NEAREST_MIPMAP_LINEAR:2==e&&(j=this.renderContext.NEAREST_MIPMAP_NEAREST),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MAG_FILTER,i),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MIN_FILTER,j),0==c?(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.REPEAT),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.REPEAT)):(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.CLAMP_TO_EDGE),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.CLAMP_TO_EDGE)),0!=e&&this.renderContext.generateMipmap(this.renderContext.TEXTURE_2D),h},b.prototype.creatTexture=function(a,b,c){void 0===c&&(c=0);var d=this.renderContext.createTexture();return this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,d),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MAG_FILTER,this.renderContext.LINEAR),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MIN_FILTER,this.renderContext.LINEAR),0==c?(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.REPEAT),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.REPEAT)):(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.CLAMP_TO_EDGE),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.CLAMP_TO_EDGE)),this.renderContext.texImage2D(this.renderContext.TEXTURE_2D,0,this.renderContext.RGB,a,b,0,this.renderContext.RGB,this.renderContext.UNSIGNED_BYTE,null),d},b.prototype.createFramebuffer=function(){var a=this.renderContext.createFramebuffer();return this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,a),a},b.prototype.deleteBuffer=function(a){
this.renderContext.deleteBuffer(a),0!=this.renderContext.getError()},b.prototype.deleteTexture=function(a){this.renderContext.deleteTexture(a)},b.prototype.deleteShader=function(a){this.renderContext.deleteShader(a.vShader),this.renderContext.deleteShader(a.fShader),this.renderContext.deleteProgram(a.program)},b.prototype.cullFaceBack=function(a){var b=this.renderContext;a?(b.enable(b.CULL_FACE),b.getParameter(b.CULL_FACE_MODE)!=b.FRONT&&b.cullFace(b.FRONT)):(b.enable(b.CULL_FACE),b.getParameter(b.CULL_FACE_MODE)!=b.BACK&&b.cullFace(b.BACK))},b.prototype.setCullFaceModel=function(a){if(a=0)this.cullFaceBack(!1);else if(a=1)this.cullFaceBack(!0);else if(a=2){var b=this.renderContext;b.enable(b.CULL_FACE)}},b.prototype.clearTest=function(){this._contextSetTest.clear()},b}();a.Context3D=c;var d=function(){function b(b,c){void 0===b&&(b=128),void 0===c&&(c=128),this.color=new a.Vector3D(20/255,20/255,20/255,1),this.makeSize(b,c)}return b.prototype.resetSize=function(a,b){var c=Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))),d=Math.pow(2,Math.ceil(Math.log(b)/Math.log(2)));(this.width!=c||this.height!=d)&&(console.log("改变FBO尺寸",c,d),this.makeSize(c,d))},b.prototype.makeSize=function(b,c){var d=a.Scene_data.context3D.renderContext;this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,c,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),this.frameBuffer=d.createFramebuffer(),this.depthBuffer=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,this.depthBuffer),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,b,c),this.width=b,this.height=c},b}();a.FBO=d;var e=function(){function a(){this.vaAry=new Array,this._blendType=-1e3,this._cullType=!1,this._zbufferType=!0,this._vpMatrix=!1}return a.prototype.testTexture=function(a,b){return this._textureDic[a]==b?!0:(this._textureDic[a]=b,!1)},a.prototype.testProgram=function(a){return this._program==a?!0:(this._program=a,this._textureDic=new Object,this._vpMatrix=!1,!1)},a.prototype.testVa=function(a){return!1},a.prototype.clear=function(){this._blendType=-1e3,this._cullType=!1,this._vpMatrix=!1,this._program=null,this._vabuffer=null},a.prototype.testBlend=function(a){return this._blendType==a?!0:(this._blendType=a,!1)},a.prototype.testCull=function(a){return this._cullType==a?!0:(this._cullType=a,!1)},a.prototype.testZbuffer=function(a){return this._zbufferType==a?!0:(this._zbufferType=a,!1)},a.prototype.testVp=function(){return this._vpMatrix?!0:(this._vpMatrix=!0,!1)},a}();a.ContextSetTest=e}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return Object.defineProperty(a,"viewMatrx3D",{get:function(){return a._viewMatrx3D},set:function(b){a._viewMatrx3D=b},enumerable:!0,configurable:!0}),a.sceneViewHW=500,a.fileRoot="res/",a.ossRoot="https://webpan.oss-cn-shanghai.aliyuncs.com/",a.fileuiRoot="res/",a.verticalScene=!1,a.effectsLev=2,a.camFar=1e3,a.version=1,a.frameTime=1e3/60,a.MAX_NUMBER=1e7,a.user=0,a.scaleLight=[2],a.useByte=!0,a.fogColor=[0,0,0],a.fogData=[1e3,.003],a.gameAngle=0,a.sceneNumId=0,a.supportBlob=!1,a}();a.Scene_data=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return b.sceneVisible=!0,b._hasDestory=!1,b._onStage=!1,b}return __extends(b,a),b.prototype.update=function(){},Object.defineProperty(b.prototype,"onStage",{get:function(){return this._onStage},enumerable:!0,configurable:!0}),b.prototype.addStage=function(){this._onStage=!0},b.prototype.removeStage=function(){this._onStage=!1},b.prototype.resize=function(){},b.prototype.destory=function(){this.objData&&this.objData.useNum--},b}(a.Object3D);a.Display3D=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.time=0,c.dynamic=!1,c._rotationMatrix=new a.Matrix3D,c}return __extends(c,b),c.prototype.getSocket=function(a,b){b=this.posMatrix.clone()},Object.defineProperty(c.prototype,"aabbVect",{get:function(){if(!this._aabbVect){var b=this.aabb,c=b.x,d=b.y,e=b.z,f=b.width,g=b.height,h=b.depth;this._aabbVect=new Array,this._aabbVect.push(new a.Vector3D(c,d,e)),this._aabbVect.push(new a.Vector3D(c+f,d,e)),this._aabbVect.push(new a.Vector3D(c,d+g,e)),this._aabbVect.push(new a.Vector3D(c,d,e+h)),this._aabbVect.push(new a.Vector3D(c+f,d+g,e)),this._aabbVect.push(new a.Vector3D(c+f,d,e+h)),this._aabbVect.push(new a.Vector3D(c,d+g,e+h)),this._aabbVect.push(new a.Vector3D(c+f,d+g,e+h))}return this._aabbVect},enumerable:!0,configurable:!0}),c.prototype.setObjUrl=function(b){var c=this;this.objurl=b,a.ObjDataManager.getInstance().getObjData(a.Scene_data.fileRoot+b,function(b){c.objData=b,c.material&&(c.objData.tangentBuffer||a.ObjDataManager.getInstance().creatTBNBuffer(c.objData))})},c.prototype.setPicUrl=function(b){var c=this;this.picUrl=b,a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+b,function(a){c.baseTexture=a})},c.prototype.setLightMapUrl=function(b){var c=this;if(b&&""!=b){var d=a.Scene_data.fileRoot+b;a.TextureManager.getInstance().getTexture(d,function(a){c.lightMapTextureRes=a})}},Object.defineProperty(c.prototype,"lightMapTexture",{get:function(){return!this.lightMapTextureRes,this.lightMapTextureRes.texture},enumerable:!0,configurable:!0}),c.prototype.setMaterialUrl=function(b,c){var d=this;void 0===c&&(c=null),b=b.replace("_byte.txt",".txt"),b=b.replace(".txt","_byte.txt"),this.materialUrl=a.Scene_data.fileRoot+b,a.MaterialManager.getInstance().getMaterialByte(this.materialUrl,function(b){d.material=b,d.material.useNormal&&d.objData&&!d.objData.tangentBuffer&&a.ObjDataManager.getInstance().creatTBNBuffer(d.objData),(d.material.usePbr||d.material.directLight)&&(d._rotationData=new Float32Array(9),d.updateRotationMatrix()),c&&(d.materialParam=new a.MaterialBaseParam,d.materialParam.setData(d.material,c))},null,!0,a.MaterialShader.MATERIAL_SHADER,a.MaterialShader)},Object.defineProperty(c.prototype,"lightProbe",{get:function(){return this._lightProbe},set:function(b){if(this._lightProbe=b,this._lightProbe&&!this.resultSHVec){this.resultSHVec=new Array;for(var c=[.4444730390920146,-.3834955622240026,-.33124467509627725,.09365654209093091,-.05673310882817577,.2120523322966496,.02945768486978205,-.04965996229802928,-.1136529129285836],d=0;9>d;d++)this.resultSHVec.push(new a.Vector3D(c[d],c[d],c[d]))}},enumerable:!0,configurable:!0}),c.prototype.update=function(){(!this.dynamic||this.sceneVisible)&&this.updateMaterial()},c.prototype.updateMaterial=function(){this.material&&this.objData&&(a.Scene_data.context3D.setBlendParticleFactors(this.material.blendMode),a.Scene_data.context3D.cullFaceBack(this.material.backCull),this.updateBind(),a.Scene_data.context3D.setProgram(this.material.shader.program),a.Scene_data.context3D.setWriteDepth(this.material.writeZbuffer),a.Scene_data.context3D.setVcMatrix4fv(this.material.shader,"posMatrix3D",this.posMatrix.m),this.setCam(),this.setMaterialVc(this.material,this.materialParam),this.setMaterialTexture(this.material,this.materialParam),this.setDirectLight(this.material),this.setMaterialVa(),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},c.prototype.setMaterialVa=function(){this.objData.compressBuffer?this.setMaterialVaCompress():this.setMaterialVaIndependent()},c.prototype.setMaterialVaIndependent=function(){a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),this.material.directLight||this.material.noLight||a.Scene_data.context3D.setVa(2,2,this.objData.lightUvBuffer),(this.material.usePbr||this.material.directLight)&&(a.Scene_data.context3D.setVa(3,3,this.objData.normalsBuffer),a.Scene_data.context3D.setVcMatrix3fv(this.material.shader,"rotationMatrix3D",this._rotationData)),this.material.useNormal&&(a.Scene_data.context3D.setVa(4,3,this.objData.tangentBuffer),a.Scene_data.context3D.setVa(5,3,this.objData.bitangentBuffer))},c.prototype.setMaterialVaCompress=function(){var b=a.Scene_data.context3D.pushVa(this.objData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.objData.stride,0),a.Scene_data.context3D.setVaOffset(1,2,this.objData.stride,this.objData.uvsOffsets),this.material.directLight||this.material.noLight||a.Scene_data.context3D.setVaOffset(2,2,this.objData.stride,this.objData.lightuvsOffsets),(this.material.usePbr||this.material.directLight)&&(a.Scene_data.context3D.setVaOffset(3,3,this.objData.stride,this.objData.normalsOffsets),a.Scene_data.context3D.setVcMatrix3fv(this.material.shader,"rotationMatrix3D",this._rotationData)),this.material.useNormal&&(a.Scene_data.context3D.setVaOffset(4,3,this.objData.stride,this.objData.tangentsOffsets),a.Scene_data.context3D.setVaOffset(5,3,this.objData.stride,this.objData.bitangentsOffsets)))},c.prototype.setDirectLight=function(b){b.directLight&&(a.Scene_data.context3D.setVc3fv(b.shader,"ambientColor",a.Scene_data.light.ambientColor),a.Scene_data.context3D.setVc3fv(b.shader,"sunDirect",a.Scene_data.light.sunDirect),a.Scene_data.context3D.setVc3fv(b.shader,"sunColor",a.Scene_data.light.sunColor))},c.prototype.setCam=function(){a.Scene_data.context3D.setVpMatrix(this.material.shader,a.Scene_data.vpMatrix.m)},c.prototype.setBind=function(b,c){this.bindTarget=b,this.bindSocket=c,this.bindMatrix=new a.Matrix3D},c.prototype.setGroup=function(b,c,d){this._isInGroup=!0,this._groupPos=b,this._groupRotation=c,this._groupScale=d,this.groupMatrix=new a.Matrix3D,this.groupRotationMatrix=new a.Matrix3D,this.groupMatrix.isIdentity=!1,this.groupMatrix.identity(),this.groupMatrix.appendScale(d.x,d.y,d.z),this.groupMatrix.appendRotation(c.x,a.Vector3D.X_AXIS),this.groupMatrix.appendRotation(c.y,a.Vector3D.Y_AXIS),this.groupMatrix.appendRotation(c.z,a.Vector3D.Z_AXIS),this.groupMatrix.appendTranslation(b.x,b.y,b.z),this.groupRotationMatrix.isIdentity=!1,this.groupRotationMatrix.identity(),this.groupRotationMatrix.prependRotation(c.z,a.Vector3D.Z_AXIS),this.groupRotationMatrix.prependRotation(c.y,a.Vector3D.Y_AXIS),this.groupRotationMatrix.prependRotation(c.x,a.Vector3D.X_AXIS)},c.prototype.updateBind=function(){this.bindTarget&&(this.posMatrix.identity(),this.posMatrix.appendScale(this._scaleX,this._scaleY,this._scaleZ),this._isInGroup&&this.posMatrix.append(this.groupMatrix),this.bindTarget.getSocket(this.bindSocket,this.bindMatrix),this.posMatrix.append(this.bindMatrix),this.bindMatrix.copyTo(this._rotationMatrix),this._rotationMatrix.identityPostion(),this._isInGroup&&this._rotationMatrix.prepend(this.groupRotationMatrix),this.sceneVisible=this.bindTarget.visible)},c.prototype.setBaseMaterialVc=function(b){var c=0;b.hasTime&&(c=(a.TimeUtil.getTimer()-this.time)%1e5*.001),(b.hasTime||b.usePbr||b.useKill)&&a.Scene_data.context3D.setVc4fv(b.shader,"fc0",[1,0,b.killNum,c]),b.scaleLightMap&&a.Scene_data.context3D.setVcFloat(b.shader,"scalelight",a.Scene_data.scaleLight),(b.usePbr||1==b.fogMode)&&this.setCamPos(b),0!=b.fogMode&&(a.Scene_data.context3D.setVc2fv(b.shader,"fogdata",a.Scene_data.fogData),a.Scene_data.context3D.setVc3fv(b.shader,"fogcolor",a.Scene_data.fogColor))},c.prototype.setCamPos=function(b){b.updateCam(a.Scene_data.cam3D.x/100,a.Scene_data.cam3D.y/100,a.Scene_data.cam3D.z/100)},c.prototype.setMaterialVc=function(b,c){if(void 0===c&&(c=null),!(b.fcNum<=0)){var d=0;b.hasTime&&(d=(a.TimeUtil.getTimer()-this.time)%1e5*.001),b.update(d),this.setCamPos(b),c&&c.update(),a.Scene_data.context3D.setVc4fv(b.shader,"fc",b.fcData)}},c.prototype.setMaterialTexture=function(b,c){void 0===c&&(c=null);for(var d=b.texList,e=0;e<d.length;e++)if(d[e].type==a.TexItem.LIGHTMAP)a.Scene_data.context3D.setRenderTexture(b.shader,d[e].name,this.lightMapTexture,d[e].id);else if(d[e].type==a.TexItem.LTUMAP&&a.Scene_data.pubLut)a.Scene_data.context3D.setRenderTexture(b.shader,d[e].name,a.Scene_data.pubLut,d[e].id);else if(d[e].type==a.TexItem.CUBEMAP)if(b.useDynamicIBL);else{var f=Math.floor(5*b.roughness);if(a.Scene_data.skyCubeMap){var g=a.Scene_data.skyCubeMap[f];a.Scene_data.context3D.setRenderTextureCube(b.shader.program,d[e].name,g,d[e].id)}}else d[e].texture&&a.Scene_data.context3D.setRenderTexture(b.shader,d[e].name,d[e].texture,d[e].id);if(c)for(e=0;e<c.dynamicTexList.length;e++)c.dynamicTexList[e].target&&a.Scene_data.context3D.setRenderTexture(b.shader,c.dynamicTexList[e].target.name,c.dynamicTexList[e].texture,c.dynamicTexList[e].target.id)},c.prototype.checkMaterialTexture=function(b){for(var c=b.texList,d=0;d<c.length;d++)if(c[d].type==a.TexItem.LIGHTMAP){if(!this.lightMapTexture)return!1}else if(c[d].type==a.TexItem.LTUMAP){if(!a.Scene_data.pubLut)return!1}else if(c[d].type==a.TexItem.CUBEMAP){if(b.useDynamicIBL);else if(!a.Scene_data.skyCubeMap)return!1}else if(!c[d].texture)return!1;return!0},c.prototype.updateRotationMatrix=function(){try{this._rotationMatrix.identity(),this._rotationMatrix.appendRotation(this._rotationX,a.Vector3D.X_AXIS),this._rotationMatrix.appendRotation(this._rotationY,a.Vector3D.Y_AXIS),this._rotationMatrix.appendRotation(this._rotationZ,a.Vector3D.Z_AXIS),this._rotationData&&this._rotationMatrix.getRotaionM33(this._rotationData)}catch(b){}},c.prototype.setPos=function(a){this.x=a.x,this.y=a.y+10,this.z=a.z},c.prototype.destory=function(){b.prototype.destory.call(this),this.name=null,this.objurl=null,this.picUrl=null,this.materialUrl=null,this.material&&this.material.useNum--,this.materialParam&&(this.materialParam.destory(),this.materialParam=null),this.lightMapTextureRes&&this.lightMapTextureRes.clearUseNum(),this._rotationMatrix=null,this._rotationData=null,this.bindMatrix=null,this.bindTarget=null,this.bindSocket=null,this._groupPos=null,this._groupRotation=null,this._groupScale=null,this.groupMatrix=null,this.groupRotationMatrix=null},c}(a.Display3D);a.Display3DSprite=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.shader=a.ProgrmaManager.getInstance().getProgram(a.SkyShader.Sky_Shader),c.program=c.shader.program,c}return __extends(c,b),c.prototype.setObjUrl=function(b){var c=this;this.objurl=b,a.ObjDataManager.getInstance().getObjData(a.Scene_data.fileRoot+b,function(a){c.objData=a})},c.prototype.setCubeUrl=function(b){var c=this;a.TextureManager.getInstance().loadCubeTexture(b,function(a){c.cubeTextList=a})},c.prototype.update=function(){a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),this.cubeTextList&&a.Scene_data.context3D.setRenderTextureCube(this.program,"s_texture",this.cubeTextList[0],0),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.normalsBuffer),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},c}(a.Display3D);a.Display3DSky=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._completeState=0,a._defaultAction="stand",a._curentFrame=0,a._actionTime=0,a._fileScale=1,a._hasDestory=!1,a._isSinging=!1,a.meshVisible=!0,a._nextScale=1,a.locationDic=new Object,a._animDic=new Object,a._partDic=new Object,a._partUrl=new Object,a._preLoadActionDic=new Object,a._waitLoadActionDic=new Object,a.showCapsule=!1,a._enablePhysics=!1,a}return __extends(c,b),Object.defineProperty(c.prototype,"isSinging",{get:function(){return this._isSinging},set:function(a){this._isSinging=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"curentAction",{get:function(){return this._curentAction},set:function(a){this._curentAction=a},enumerable:!0,configurable:!0}),c.prototype.fixAstartData=function(a){},c.prototype.setRoleUrl=function(b){var c=this;this.clearMesh(),a.MeshDataManager.getInstance().getMeshData(b,function(a){return c._hasDestory?void a.useNum--:(c._skinMesh=a,c.fileScale=a.fileScale,c.onStage&&c.addSkinMeshParticle(),c._animDic=a.animDic,void c.onMeshLoaded())})},c.prototype.onMeshLoaded=function(){this.dispatchEvent(new a.BaseEvent(a.BaseEvent.COMPLETE))},c.prototype.clearMesh=function(){this.removeSkinMeshParticle(),this._skinMesh&&this._skinMesh.useNum--,this._skinMesh=null,this._animDic=new Object},c.prototype.addSkinMeshParticle=function(){if(this._skinMesh){var b=new Array;this._partDic.mesh=b;var c=this._skinMesh.meshAry;if(c)for(var d=0;d<c.length;d++)for(var e=c[d].particleAry,f=0;f<e.length;f++){var g,h=e[f];g=a.ParticleManager.getInstance().getParticleByte(a.Scene_data.fileRoot+h.url),g.sourceData||console.log("particle.sourceData error"),g.dynamic=!0,g.bindSocket=h.socketName,b.push(g),g.bindTarget=this,a.ParticleManager.getInstance().addParticle(g)}}},c.prototype.removeSkinMeshParticle=function(){var b=this._partDic.mesh;if(b){for(var c=0;c<b.length;c++)a.ParticleManager.getInstance().removeParticle(b[c]),b[c].destory();this._partDic.mesh=null}},c.prototype.roleResCom=function(a,b){},c.prototype.setMeshUrl=function(b,c){var d=this;void 0===c&&(c=1),this._meshUrl=a.Scene_data.fileRoot+b,a.MeshDataManager.getInstance().getMeshData(this._meshUrl,function(a){d._skinMesh=a,1!=c&&(d._skinMesh.type=1);for(var b in d._animDic)d.processAnimByMesh(d._animDic[b]);a.loadMaterial(function(a){d.loadMaterialCom(a)}),d.fileScale=a.fileScale},c)},Object.defineProperty(c.prototype,"scale",{get:function(){return this._nextScale},set:function(a){this._nextScale=a,this._scaleX=a*this._fileScale,this._scaleY=a*this._fileScale,this._scaleZ=a*this._fileScale,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fileScale",{set:function(a){this._fileScale=a,this._scaleX=this._nextScale*a,this._scaleY=this._nextScale*a,this._scaleZ=this._nextScale*a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"shadow",{set:function(b){b?this._shadow||(this._shadow=a.ShadowManager.getInstance().addShadow()):this._shadow&&a.ShadowManager.getInstance().removeShadow(this._shadow)},enumerable:!0,configurable:!0}),c.prototype.setShadowSize=function(a){this._shadow&&(this._shadow.size=a)},c.prototype.addStage=function(){b.prototype.addStage.call(this),this.addSkinMeshParticle(),this._shadow&&(this._shadow.visible=!0)},c.prototype.removeStage=function(){b.prototype.removeStage.call(this),this._shadow&&a.ShadowManager.getInstance().removeShadow(this._shadow);for(var c in this._partDic)for(var d=this._partDic[c],e=0;e<d.length;e++)d[e]instanceof a.CombineParticle?a.ParticleManager.getInstance().removeParticle(d[e]):d[e]instanceof a.Display3DSprite&&a.SceneManager.getInstance().removeSpriteDisplay(d[e])},c.prototype.loadMaterialCom=function(a){a.lightProbe&&(this.lightProbe=!0)},c.prototype.setCollision=function(a,b){},c.prototype.applyVisible=function(){},c.prototype.removePart=function(b){var c=this._partDic[b];if(c){for(var d=0;d<c.length;d++)c[d]instanceof a.CombineParticle?(a.ParticleManager.getInstance().removeParticle(c[d]),c[d].destory()):c[d]instanceof a.Display3DSprite&&(a.SceneManager.getInstance().removeSpriteDisplay(c[d]),c[d].destory());this._partDic[b]=null,this._partUrl[b]=null,delete this._partDic[b],delete this._partUrl[b]}},c.prototype.addPart=function(b,c,d){var e=this;if(this._partUrl[b]!=d){this._partUrl[b]&&this.removePart(b),this._partDic[b]||(this._partDic[b]=new Array),this._partUrl[b]=d;var f=this._partDic[b];a.GroupDataManager.getInstance().getGroupData(a.Scene_data.fileRoot+d,function(a){e.loadPartRes(c,a,f)})}},c.prototype.loadPartRes=function(b,c,d){if(!this._hasDestory){for(var e=0;e<c.dataAry.length;e++){var f,g,h,i=c.dataAry[e];if(i.isGroup&&(f=new a.Vector3D(i.x,i.y,i.z),g=new a.Vector3D(i.rotationX,i.rotationY,i.rotationZ),h=new a.Vector3D(i.scaleX,i.scaleY,i.scaleZ)),i.types==a.BaseRes.SCENE_PARTICLE_TYPE){var j=a.ParticleManager.getInstance().getParticleByte(a.Scene_data.fileRoot+i.particleUrl);d.push(j),j.bindTarget=this,j.bindSocket=b,j.dynamic=!0,a.ParticleManager.getInstance().addParticle(j),i.isGroup&&j.setGroup(f,g,h)}else if(i.types==a.BaseRes.PREFAB_TYPE){var k=new a.Display3DSprite;k.setObjUrl(i.objUrl),k.setMaterialUrl(i.materialUrl,i.materialInfoArr),k.dynamic=!0,d.push(k),k.setBind(this,b),a.SceneManager.getInstance().addSpriteDisplay(k),i.isGroup&&k.setGroup(f,g,h)}}this.applyVisible()}},c.prototype.getSocket=function(b,c){if(c.identity(),!this._skinMesh)return void c.append(this.posMatrix);if(!this._skinMesh.boneSocketDic[b])return void((b="none")?c.appendTranslation(this._x,this._y,this._z):c.append(this.posMatrix));var d,e=this._skinMesh.boneSocketDic[b],f=e.index;d=this.getFrameMatrix(f),c.appendScale(1/this._scaleX,1/this._scaleY,1/this._scaleZ),c.appendRotation(e.rotationX,a.Vector3D.X_AXIS),c.appendRotation(e.rotationY,a.Vector3D.Y_AXIS),c.appendRotation(e.rotationZ,a.Vector3D.Z_AXIS),c.appendTranslation(e.x,e.y,e.z),d&&(c.append(this._skinMesh.meshAry[this._skinMesh.meshAry.length-1].bindPosInvertMatrixAry[f]),c.append(d)),c.append(this.posMatrix)},c.prototype.getSunType=function(){return 0},c.prototype.getFrameMatrix=function(a){if(this._animDic[this.curentAction]){var b=this._animDic[this.curentAction];return this._curentFrame>=b.matrixAry.length?b.matrixAry[0][a]:b.matrixAry[this._curentFrame][a]}if(this._animDic[this._defaultAction]){var b=this._animDic[this._defaultAction];return b.matrixAry[this._curentFrame][a]}return null},c.prototype.addAction=function(a,b,c){void 0===c&&(c=!1),this._preLoadActionDic[a]=b,a==this._defaultAction||a==this.curentAction?this.setAnimUrl(a,b):c&&this.setAnimUrl(a,b)},c.prototype.setAnimUrl=function(b,c){var d=this;this._waitLoadActionDic[b]=!0,a.AnimManager.getInstance().getAnimData(c,function(a){d._animDic[b]=a,d.processAnimByMesh(a),d._waitLoadActionDic[b]=!1})},c.prototype.play=function(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=!0),this.curentAction!=a?(this.curentAction=a,this._completeState=b,this._actionTime=0,this.updateFrame(0),this._animDic.hasOwnProperty(a)?!0:(!this._waitLoadActionDic[a]&&this._preLoadActionDic[a]&&this.setAnimUrl(a,this._preLoadActionDic[a]),!1)):void 0},c.prototype.processAnimByMesh=function(a){if(this._skinMesh&&!a.hasProcess){for(var b=0;b<a.matrixAry.length;b++)for(var c=a.matrixAry[b],d=0;d<c.length;d++)c[d].prepend(this._skinMesh.meshAry[0].bindPosMatrixAry[d]);a.hasProcess=!0}},c.prototype.update=function(){if(this._skinMesh){if(this.lightProbe&&(this.resultSHVec=a.LightProbeManager.getInstance().getData(new a.Vector3D(this.x,this.y+10,this.z))),this.updateBind(),this.meshVisible)for(var b=0;b<this._skinMesh.meshAry.length;b++)this.updateMaterialMesh(this._skinMesh.meshAry[b]);this.showCapsule&&this.updateShowCapsule()}},c.prototype.updateFrame=function(b){this._actionTime+=b;var c;if(this.curentAction&&this._animDic[this.curentAction])c=this.curentAction;else{if(!this._animDic[this._defaultAction])return;c=this._defaultAction}var d=this._animDic[c];this._curentFrame=float2int(this._actionTime/(2*a.Scene_data.frameTime)),this._curentFrame>=d.matrixAry.length&&(0==this._completeState?(this._actionTime=0,this._curentFrame=0):1==this._completeState?this._curentFrame=d.matrixAry.length-1:2==this._completeState?(this._curentFrame=0,this._completeState=0,this.changeAction(this.curentAction)):3==this._completeState)},c.prototype.changeAction=function(a){this.curentAction=this._defaultAction},c.prototype.destory=function(){b.prototype.destory.call(this),this._skinMesh&&this._skinMesh.useNum--;for(var c in this._partDic)for(var d=this._partDic[c],e=0;e<d.length;e++)d[e]instanceof a.CombineParticle?d[e].destory():d[e]instanceof a.Display3DSprite&&d[e].destory();this._partDic=null,this._hasDestory=!0},c.prototype.updateShowCapsule=function(){this.capsuleLineSprite?(this.capsuleLineSprite.x=this.x,this.capsuleLineSprite.y=this.y+this._capsule.radius,this.capsuleLineSprite.z=this.z,this.capsuleLineSprite.update()):(this.capsuleLineSprite=new a.LineDisplaySprite,this.capsuleLineSprite.clear(),this.capsuleLineSprite.baseColor=new a.Vector3D(1,0,0,1),this.drawCylinder(this._capsule.radius,this._capsule.height),this.drawBall(this._capsule.radius),this.capsuleLineSprite.upToGpu())},c.prototype.drawBall=function(b){var c,d,e,f,g,h,i,j=b,k=12;for(g=0;k>=g;g++)for(e=null,f=k/2;k>f;f++)c=new a.Vector3D(j,0,0),d=new a.Matrix3D,d.appendRotation(360/k*f,a.Vector3D.Z_AXIS),c=d.transformVector(c),h=new a.Matrix3D,h.appendRotation(360/k*g,a.Vector3D.Y_AXIS),c=h.transformVector(c),e&&this.capsuleLineSprite.makeLineMode(e,c),e=c.clone();for(g=1;4>=g;g++)for(h=new a.Matrix3D,h.appendRotation(-20*g,a.Vector3D.Z_AXIS),i=h.transformVector(new a.Vector3D(j,0,0)),e=null,f=0;k>f;f++)c=i.clone(),d=new a.Matrix3D,d.appendRotation(360/k*f,a.Vector3D.Y_AXIS),c=d.transformVector(c),e&&this.capsuleLineSprite.makeLineMode(e,c),f==k-1&&this.capsuleLineSprite.makeLineMode(i,c),e=c.clone()},c.prototype.drawCylinder=function(b,c){var d,e,f,g=b,h=c,i=12;for(f=0;i>f;f++){var j=new a.Vector3D(g,0,0),k=new a.Vector3D(g,+h,0),l=new a.Matrix3D;l.appendRotation(f*(360/i),a.Vector3D.Y_AXIS);var m=l.transformVector(j),n=l.transformVector(k);this.capsuleLineSprite.makeLineMode(m,n),this.capsuleLineSprite.makeLineMode(n,new a.Vector3D(0,+h,0)),f==i-1&&(this.capsuleLineSprite.makeLineMode(m,j),this.capsuleLineSprite.makeLineMode(n,k)),(d||e)&&(this.capsuleLineSprite.makeLineMode(m,d),this.capsuleLineSprite.makeLineMode(n,e)),d=m.clone(),e=n.clone()}},c.prototype.setVcMatrix=function(b){a.Scene_data.context3D.setVpMatrix(b.material.shader,a.Scene_data.vpMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"posMatrix3D",this.posMatrix.m)},c.prototype.setVa=function(a){a.compressBuffer?this.setVaCompress(a):this.setVaIndependent(a)},c.prototype.setVaIndependent=function(b){a.Scene_data.context3D.setVa(0,3,b.vertexBuffer),a.Scene_data.context3D.setVa(1,2,b.uvBuffer),a.Scene_data.context3D.setVa(2,4,b.boneIdBuffer),a.Scene_data.context3D.setVa(3,4,b.boneWeightBuffer),b.material.usePbr?(a.Scene_data.context3D.setVa(4,4,b.normalsBuffer),a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"rotationMatrix3D",this._rotationMatrix.m),b.material.useNormal&&(a.Scene_data.context3D.setVa(5,4,b.tangentBuffer),a.Scene_data.context3D.setVa(6,4,b.bitangentBuffer))):(b.material.lightProbe||b.material.directLight)&&(a.Scene_data.context3D.setVa(4,4,b.normalsBuffer),a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"rotationMatrix3D",this._rotationMatrix.m))},c.prototype.setVaCompress=function(b){var c=a.Scene_data.context3D.pushVa(b.vertexBuffer);c||(a.Scene_data.context3D.setVaOffset(0,3,b.stride,0),a.Scene_data.context3D.setVaOffset(1,2,b.stride,b.uvsOffsets),a.Scene_data.context3D.setVaOffset(2,4,b.stride,b.boneIDOffsets),a.Scene_data.context3D.setVaOffset(3,4,b.stride,b.boneWeightOffsets),b.material.usePbr?(a.Scene_data.context3D.setVaOffset(4,3,b.stride,b.normalsOffsets),a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"rotationMatrix3D",this._rotationMatrix.m),b.material.useNormal&&(a.Scene_data.context3D.setVaOffset(5,3,b.stride,b.tangentsOffsets),a.Scene_data.context3D.setVaOffset(6,3,b.stride,b.bitangentsOffsets))):(b.material.lightProbe||b.material.directLight)&&(a.Scene_data.context3D.setVaOffset(4,3,b.stride,b.normalsOffsets),a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"rotationMatrix3D",this._rotationMatrix.m)))},c.prototype.clearVa=function(){a.Scene_data.context3D.clearVa(2),a.Scene_data.context3D.clearVa(3),a.Scene_data.context3D.clearVa(4),a.Scene_data.context3D.clearVa(5),a.Scene_data.context3D.clearVa(6)},c.prototype.updateMaterialMesh=function(b){b.material&&(a.Scene_data.context3D.setProgram(b.material.shader.program),a.Scene_data.context3D.cullFaceBack(!1),a.Scene_data.context3D.setBlendParticleFactors(b.material.blendMode),this.setVcMatrix(b),this.setMaterialVc(b.material,b.materialParam),this.setMaterialTexture(b.material,b.materialParam),this.setVa(b),this.setDirectLight(b.material),this.setMeshVc(b),a.Scene_data.context3D.drawCall(b.indexBuffer,b.treNum))},c.prototype.setLightProbeVc=function(b){if(b.lightProbe)for(var c=0;c<this.resultSHVec.length;c++)a.Scene_data.context3D.setVc3fv(b.shader,"sh["+c+"]",[this.resultSHVec[c].x,this.resultSHVec[c].y,this.resultSHVec[c].z])},c.prototype.setMeshVc=function(b){var c;if(this._animDic[this.curentAction])c=this._animDic[this.curentAction];else{if(!this._animDic[this._defaultAction])return;c=this._animDic[this._defaultAction]}var d=c.getBoneQPAryByMesh(b)[b.uid][this._curentFrame];d&&(a.Scene_data.context3D.setVc4fv(b.material.shader,"boneQ",d.quat),a.Scene_data.context3D.setVc3fv(b.material.shader,"boneD",d.pos))},c.prototype.setPos=function(a){b.prototype.setPos.call(this,a),this._shadow&&(this._shadow.x=a.x,this._shadow.y=a.y+8,this._shadow.z=a.z)},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.updateMatrix(),this._shadow&&(this._shadow.x=a),this.changePos()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.updateMatrix(),this._shadow&&(this._shadow.y=a),this.changePos()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"z",{get:function(){return this._z},set:function(a){this._z=a,this.updateMatrix(),this._shadow&&(this._shadow.z=a),this.changePos()},enumerable:!0,configurable:!0}),c.prototype.changePos=function(){},c}(a.Display3DSprite);a.Display3dMovie=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.batchNum=0,a.batchPos=new Array,a}return __extends(c,b),Object.defineProperty(c.prototype,"fileScale",{set:function(a){this._fileScale=a;for(var b=0;b<this.batchPos.length;b++)this.batchPos[b].fileScale=a},enumerable:!0,configurable:!0}),c.prototype.addSun=function(a){this.batchPos.push(a),a.fileScale=this._fileScale},c.prototype.setVcMatrix=function(b){a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),
a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"rotationMatrix3D",this._rotationMatrix.m);for(var c=0;c<this.batchPos.length;c++)a.Scene_data.context3D.setVcMatrix4fv(b.material.shader,"posMatrixAry["+c+"]",this.batchPos[c].posMatrix.m)},c.prototype.setLightProbeVc=function(a){},c.prototype.setVa=function(b){a.Scene_data.context3D.setVa(0,3,b.vertexBuffer),a.Scene_data.context3D.setVa(1,3,b.uvBuffer),a.Scene_data.context3D.setVa(2,4,b.boneIdBuffer),a.Scene_data.context3D.setVa(3,4,b.boneWeightBuffer),b.material.usePbr?(a.Scene_data.context3D.setVa(4,4,b.normalsBuffer),b.material.useNormal&&(a.Scene_data.context3D.setVa(5,4,b.tangentBuffer),a.Scene_data.context3D.setVa(6,4,b.bitangentBuffer))):(b.material.lightProbe||b.material.directLight)&&a.Scene_data.context3D.setVa(4,4,b.normalsBuffer)},c.prototype.addStage=function(){if(b.prototype.addStage.call(this),this.batchPos.length)for(var a=0;a<this.batchPos.length;a++)this.batchPos[a].add()},c.prototype.removeStage=function(){if(b.prototype.removeStage.call(this),this.batchPos.length)for(var a=0;a<this.batchPos.length;a++)this.batchPos[a].remove()},c}(a.Display3dMovie);a.Display3dBatchMovie=b;var c=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.posData=[0,0,0,10],a.hasReach=!1,a._fileScale=1,a}return __extends(c,b),Object.defineProperty(c.prototype,"shadow",{set:function(b){b&&(this._shadow||(this._shadow=a.ShadowManager.getInstance().addShadow(),this._shadow.x=this._x,this._shadow.y=this._y,this._shadow.z=this._z))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fileScale",{set:function(a){this._fileScale=a,this._scaleX*=a,this._scaleY*=a,this._scaleZ*=a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{set:function(a){this._scaleX=a*this._fileScale,this._scaleY=a*this._fileScale,this._scaleZ=a*this._fileScale,this.posData[3]=20*a,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.posData[0]=a,this.updateMatrix(),this._shadow&&(this.retinueShadowFix?this._shadow.x=a+this.retinueShadowFix.x:this._shadow.x=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.posData[1]=a,this.updateMatrix(),this._shadow&&(this.retinueShadowFix?this._shadow.y=a+this.retinueShadowFix.y+2:this._shadow.y=a+2)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"z",{get:function(){return this._z},set:function(a){this._z=a,this.posData[2]=a,this.updateMatrix(),this._shadow&&(this.retinueShadowFix?this._shadow.z=a+this.retinueShadowFix.z:this._shadow.z=a)},enumerable:!0,configurable:!0}),c.prototype.add=function(){this._shadow&&(this._shadow.visible=!0)},c.prototype.remove=function(){this._shadow&&(this._shadow.visible=!1)},c}(a.Object3D);a.Movie3D=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.needUpdate=!1,c.locationFloat32=new Float32Array(0),c.shadowList=new Array,c.objData=new a.ObjData,c.shader=a.ProgrmaManager.getInstance().getProgram(a.Display3DShadowShader.Display3DShadowShader),c.program=c.shader.program,c.posProLocation=a.Scene_data.context3D.getLocation(c.program,"pos"),c}return __extends(c,b),c.prototype.addShadow=function(a){this.shadowList.push(a),a.display=this,this.applyObjData()},c.prototype.removeShadow=function(a){var b=this.shadowList.indexOf(a);-1!=b&&(this.shadowList.splice(b,1),this.applyObjData()),0==this.shadowList.length},c.prototype.stateChage=function(){for(var a=0;a<this.shadowList.length&&!this.shadowList[a].visible;a++);a==this.shadowList.length?this.needUpdate=!1:this.needUpdate=!0},c.prototype.hasIdle=function(){return this.shadowList.length<30},c.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var b=5,c=0;c<this.shadowList.length;c++)this.objData.vertices.push(-b,0,b,b,0,b,b,0,-b,-b,0,-b),this.objData.uvs.push(0,0,c,0,1,c,1,1,c,1,0,c),this.objData.indexs.push(4*c,1+4*c,2+4*c,4*c,2+4*c,3+4*c);this.objData.treNum=6*this.shadowList.length,this.objData.vertexBuffer?(a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),a.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},c.prototype.update=function(){if(this.needUpdate=!0,this.needUpdate&&0!=this.shadowList.length&&this.objData.treNum){a.Scene_data.context3D.setBlendParticleFactors(0),a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),this.locationFloat32.length!=4*this.shadowList.length&&(this.locationFloat32=new Float32Array(4*this.shadowList.length));for(var b=0;b<this.shadowList.length;b++)this.shadowList[b].visible?(this.locationFloat32[4*b+0]=this.shadowList[b].data[0],this.locationFloat32[4*b+1]=this.shadowList[b].data[1],this.locationFloat32[4*b+2]=this.shadowList[b].data[2],this.locationFloat32[4*b+3]=this.shadowList[b].data[3]):(this.locationFloat32[4*b+0]=0,this.locationFloat32[4*b+1]=1e4,this.locationFloat32[4*b+2]=0,this.locationFloat32[4*b+3]=0);a.Scene_data.context3D.setVc4fvLocation(this.posProLocation,this.locationFloat32),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",c.texture,0),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},c}(a.Display3D);a.Display3dShadow=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._scaleData=[1,1],c.shader=a.ProgrmaManager.getInstance().getProgram(a.UIImageShader.UI_IMG_SHADER),c.program=c.shader,c.initData(),c}return __extends(c,b),c.prototype.initData=function(){this.objData=new a.ObjData,this.objData.vertices.push(-1,1,.99,1,1,.99,1,-1,.99,-1,-1,.99),this.objData.uvs.push(0,0,1,0,1,1,0,1),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=6,this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},c.prototype.resize=function(){this.appleyPos()},c.prototype.setImgInfo=function(a,b,c){this.setImgUrl(a),this._width=b,this._height=c},c.prototype.setImgUrl=function(a){},c.prototype.appleyPos=function(){var b=this._width/a.Scene_data.stageWidth,c=this._height/a.Scene_data.stageHeight;c>b?(this._scaleData[0]=1,this._scaleData[1]=this._height/a.Scene_data.stageHeight/b):(this._scaleData[0]=this._width/a.Scene_data.stageWidth/c,this._scaleData[1]=1)},c.prototype.update=function(){this.appleyPos(),a.Scene_data.context3D.setBlendParticleFactors(0),a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),a.Scene_data.context3D.setVc2fv(this.shader,"scale",this._scaleData),a.Scene_data.context3D.setVcFloat(this.shader,"alpha",[1]),a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},c}(a.Display3D);a.Display3dBg=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.batchPos=new Array,c._time=0,c._allFrame=12,c._uvData=[0,0],c._uWidth=0,c._vWidth=0,c._state=0,c.frameRate=3,c.objData=new a.ObjData,c.watchCaramMatrix=new a.Matrix3D,c.shader=a.ProgrmaManager.getInstance().getProgram(a.Movie2DShader.MOVIE2D_SHADER),c.program=c.shader.program,c}return __extends(c,b),c.prototype.update=function(){this.watchCaramMatrix.identity(),this.watchCaramMatrix.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),this.watchCaramMatrix.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS),a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"watchCamMatrix3D",this.watchCaramMatrix.m);for(var b=0;b<this.batchPos.length;b++)a.Scene_data.context3D.setVc4fv(this.shader,"posdata["+b+"]",this.batchPos[b].posData);a.Scene_data.context3D.setVc2fv(this.shader,"outuv",this._uvData),a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.movieTexture,0),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},c.prototype.updateFrame=function(b){this._time+=b;var c=float2int(this._time/(2*a.Scene_data.frameTime)/this.frameRate);c>=this._allFrame&&(0==this._state?(this._time=0,c=0):1==this._state?c=this._allFrame-1:2==this._state?(this.play("stand"),c=0,this._state=0):3==this._state),this._uvData[0]=c*this._uWidth},c.prototype.play=function(a,b){void 0===b&&(b=0),this._state=b,this._time=0,"walk"==a?this._uvData[1]=this._vWidth:-1!=a.indexOf("attack")?this._uvData[1]=2*this._vWidth:this._uvData[1]=0},c.prototype.addSun=function(a){this.batchPos.push(a)},c.prototype.setUrl=function(a){},c.prototype.initData=function(b,c,d,e,f,g){void 0===g&&(g=!1),this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0,this._uWidth=d,this._vWidth=e,this._allFrame=f;for(var h=0;b>h;h++){this.objData.vertices.push(-.5*c,1,0,.5*c,1,0,.5*c,0,0,-.5*c,0,0);var i=0;g&&(i=float2int(f*Math.random())*d),this.objData.uvs.push(0+i,0,h,d+i,0,h,d+i,1*e,h,0+i,1*e,h),this.objData.indexs.push(4*h,1+4*h,2+4*h,4*h,2+4*h,3+4*h)}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),a.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},c.prototype.addStage=function(){if(b.prototype.addStage.call(this),this.batchPos.length)for(var a=0;a<this.batchPos.length;a++)this.batchPos[a].add()},c.prototype.removeStage=function(){if(b.prototype.removeStage.call(this),this.batchPos.length)for(var a=0;a<this.batchPos.length;a++)this.batchPos[a].remove()},c}(a.Display3D);a.Display2dMovie=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.uiMatrix=new a.Matrix3D,c.uiMatrix.prependTranslation(0,0,600),c.uiMatrix.prependRotation(-15,a.Vector3D.X_AXIS),c.uiMatrix.prependRotation(0,a.Vector3D.Y_AXIS),c.uiViewMatrix=new a.Matrix3D,c}return __extends(c,b),c.prototype.loadRes=function(b){var c=this;this.modelRes||(this.modelRes=new a.ModelRes),this.modelRes.load(a.Scene_data.fileRoot+getModelUrl(b),function(){c.loadResComFinish()})},c.prototype.loadResComFinish=function(){this.setObjUrl(this.modelRes.objUrl),this.setMaterialUrl(this.modelRes.materialUrl)},c.prototype.loadGroup=function(b){var c=this,d=new a.GroupRes;d.load(a.Scene_data.fileRoot+"model/"+b+".txt",function(){c.loadPartRes(d)})},c.prototype.loadPartRes=function(b){for(var c=0;c<b.dataAry.length;c++){var d=b.dataAry[c];d.types==a.BaseRes.SCENE_PARTICLE_TYPE||d.types==a.BaseRes.PREFAB_TYPE&&(this.setObjUrl(d.objUrl),this.setMaterialUrl(d.materialUrl,d.materialInfoArr))}},c.prototype.resize=function(){this.uiViewMatrix.identity(),this.uiViewMatrix.perspectiveFieldOfViewLH(1,1,500,5e3),this.uiViewMatrix.appendScale(1e3/a.Scene_data.stageWidth,1e3/a.Scene_data.stageHeight,1)},c.prototype.setCam=function(){a.Scene_data.context3D.setVcMatrix4fv(this.material.shader,"viewMatrix3D",this.uiViewMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(this.material.shader,"camMatrix3D",this.uiMatrix.m)},c.prototype.update=function(){a.Scene_data.context3D.setWriteDepth(!0),a.Scene_data.context3D.setDepthTest(!0),b.prototype.update.call(this),a.Scene_data.context3D.setWriteDepth(!1),a.Scene_data.context3D.setDepthTest(!1)},c}(a.Display3DSprite);a.Display3DUISprite=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function d(){var c=b.call(this)||this;return c.batchPos=new Array,c.objData=new a.ObjData,c.watchCaramMatrix=new a.Matrix3D,c.shader=a.ProgrmaManager.getInstance().getProgram(a.Sprite2DShader.SPRITE2D_SHADER),c.program=c.shader.program,c}return __extends(d,b),d.prototype.setInfo=function(b,c,d){this._imgAtlas||(this._imgAtlas=new a.UIAtlas),this._imgAtlas.setInfo(b,c,d)},d.prototype.getSprite=function(a){var b=new c;return b.uvData=this._imgAtlas.getRec(a),b},d.prototype.addSprite=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var c=0;c<a.length;c++)this.batchPos.push(a[c]);this.applyData()},d.prototype.applyData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var b=0;b<this.batchPos.length;b++){var c=this.batchPos[b].uvData,d=c.pixelHeight/c.pixelWitdh;this.objData.vertices.push(-.5*c.width,1*d*c.width,0,.5*c.width,1*d*c.width,0,.5*c.width,0,0,-.5*c.width,0,0),this.objData.uvs.push(c.x,c.y,b,c.x+c.width,c.y,b,c.x+c.width,c.y+c.height,b,c.x,c.y+c.height,b),this.objData.indexs.push(4*b,1+4*b,2+4*b,4*b,2+4*b,3+4*b)}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),a.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},d.prototype.update=function(){if(0!=this.batchPos.length){this.watchCaramMatrix.identity(),this.watchCaramMatrix.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),this.watchCaramMatrix.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS),a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"watchCamMatrix3D",this.watchCaramMatrix.m);for(var b=0;b<this.batchPos.length;b++)a.Scene_data.context3D.setVc4fv(this.shader,"posdata["+b+"]",this.batchPos[b].posData);a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this._imgAtlas.texture,0),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},d}(a.Display3D);a.Display2DSprite=b;var c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.posData=[0,0,0,100],b}return __extends(b,a),b.prototype.setPos=function(a,b,c){this.x=a,this.y=b,this.z=c},Object.defineProperty(b.prototype,"scale",{get:function(){return this._scaleX},set:function(a){this._scaleX=a,this.posData[3]=100*a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{set:function(a){this._x=a,this.posData[0]=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{set:function(a){this._y=a,this.posData[1]=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"z",{set:function(a){this._z=a,this.posData[2]=a},enumerable:!0,configurable:!0}),b}(a.Object3D)}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(){function b(){}return b.prototype.mekeUseTexture=function(b){var c=new a.Rectangle(0,0,Math.pow(2,Math.ceil(Math.log(b.width)/Math.log(2))),Math.pow(2,Math.ceil(Math.log(b.height)/Math.log(2))));if(c.width!=b.width||c.height!=b.height){for(var d=new a.BitMapData(c.width,c.height),e=0;e<d.width;e++)for(var f=0;f<d.height;f++){var g=b.getRgb(e/d.width*b.width,f/d.height*b.height);d.setRgb(e,f,g)}return d}return b},b.prototype.calibration=function(){this.idBitmap=this.mekeUseTexture(this.idBitmap),this.infoBitmap=this.mekeUseTexture(this.infoBitmap)},b.meshAllgroundData=function(c){for(var d=c.readInt(),e=c.readInt(),f=new Array,g=0;d>g;g++)for(var h=0;e>h;h++){var i=c.readInt(),j=c.readInt(),k=c.readInt(),l=c.readInt(),m=new b;m.idBitmap=new a.BitMapData(k,l),m.infoBitmap=new a.BitMapData(k,l),m.tx=i,m.ty=j,f.push(m);for(var n=0;k>n;n++)for(var o=0;l>o;o++){var p,q=c.readByte();switch(q){case 0:p=new a.Vector3D(0,1,2);break;case 1:p=new a.Vector3D(0,1,3);break;case 2:p=new a.Vector3D(0,2,3);break;case 3:p=new a.Vector3D(1,2,3);break;default:throw new Error("信息索引没有编入")}m.idBitmap.setRgb(n,o,new a.Vector3D(p.x/255,p.y/255,p.z/255,1));var r=new a.Vector3D;r.x=c.readByte()+128,r.y=c.readByte()+128,r.z=255-r.x-r.y,m.infoBitmap.setRgb(n,o,new a.Vector3D(r.x/255,r.y/255,r.z/255,1))}m.calibration()}for(var s=c.readUTF(),t=0;t<f.length;t++)f[t].sixurl=s;return f},b}();a.GroundDataMesh=b;var c=function(b){function c(){var c=b.call(this)||this;return a.ProgrmaManager.getInstance().registe(a.TerrainDisplay3DShader.TerrainDisplay3DShader,new a.TerrainDisplay3DShader),c.groundShader=a.ProgrmaManager.getInstance().getProgram(a.TerrainDisplay3DShader.TerrainDisplay3DShader),c}return __extends(c,b),c.prototype.update=function(){this.groundShader&&this.baseSixteenRes&&this.idMapPicDataTexture?this.upDataToDraw():b.prototype.update.call(this)},c.prototype.upDataToDraw=function(){if(this.groundShader&&this.baseSixteenRes){a.Scene_data.context3D.cullFaceBack(!1),a.Scene_data.context3D.setProgram(this.groundShader.program),a.Scene_data.context3D.setVcMatrix4fv(this.groundShader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(this.groundShader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(this.groundShader,"posMatrix3D",this.posMatrix.m),a.Scene_data.context3D.setVc4fv(this.groundShader,"colorData",[1,0,1,1]);var b=a.Scene_data.context3D.pushVa(this.objData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.objData.stride,0),a.Scene_data.context3D.setVaOffset(1,2,this.objData.stride,this.objData.uvsOffsets)),a.Scene_data.context3D.setRenderTexture(this.groundShader,"idmaptexture",this.idMapPicDataTexture,0),a.Scene_data.context3D.setRenderTexture(this.groundShader,"infotexture",this.infoMapPicDataTexture,1),a.Scene_data.context3D.setRenderTexture(this.groundShader,"sixtexture",this.baseSixteenRes.texture,2),a.Scene_data.context3D.setRenderTexture(this.groundShader,"lightexture",this.lightMapTexture,3),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},c.prototype.setGrounDataMesh=function(b){var c=this;this.idMapPicDataTexture=a.Scene_data.context3D.getTexture(b.idBitmap.imgData,0,1),this.infoMapPicDataTexture=a.Scene_data.context3D.getTexture(b.infoBitmap.imgData,0,1);var d=b.sixurl;a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+d,function(a){c.baseSixteenRes=a})},c}(a.Display3DSprite);a.TerrainDisplay3DSprite=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.init=function(c){var d=/ipad/i.test(navigator.userAgent),e=/iPhone/i.test(navigator.userAgent),f=/android/i.test(navigator.userAgent);/iindow/i.test(navigator.userAgent),navigator.userAgent.toLowerCase();d||e||f?a.Scene_data.isPc=!1:a.Scene_data.isPc=!0,d||e?a.Scene_data.isIos=!0:a.Scene_data.isIos=!1,a.Scene_data.vpMatrix=new a.Matrix3D,a.Scene_data.canvas3D=c,a.Scene_data.context3D=new a.Context3D,a.Scene_data.context3D.init(c),a.UIManager.getInstance().init(),a.Scene_data.cam3D=new a.Camera3D,a.Scene_data.focus3D=new a.Object3D,a.Scene_data.focus3D.x=0,a.Scene_data.focus3D.y=0,a.Scene_data.focus3D.z=0,a.Scene_data.focus3D.rotationY=135,a.Scene_data.focus3D.rotationX=-45,a.Scene_data.light=new a.LightVo,b.testBlob(),b.resetSize(),a.TimeUtil.init(),a.PathManager.init()},b.resReady=function(){b.initPbr()},b.testBlob=function(){try{new Blob}catch(b){return void(a.Scene_data.supportBlob=!1)}a.Scene_data.supportBlob=!0},b.initPbr=function(){a.Scene_data.pubLut||a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+"base/brdf_ltu.jpg",function(b){a.Scene_data.pubLut=b.texture},1),a.Scene_data.skyCubeMap||a.TextureManager.getInstance().loadCubeTexture(a.Scene_data.fileRoot+"base/cube/e",function(b){a.Scene_data.skyCubeMap=b})},b.initShadow=function(){a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+"base/shadow.png",function(b){a.Display3dShadow.texture=b.texture})},b.resetSize=function(b,c){void 0===b&&(b=0),void 0===c&&(c=0),a.Scene_data.stageWidth=document.body.clientWidth,a.Scene_data.stageHeight=document.body.clientHeight,a.Scene_data.canvas3D.width=a.Scene_data.stageWidth,a.Scene_data.canvas3D.height=a.Scene_data.stageHeight,a.Scene_data.context3D.resetSize(a.Scene_data.stageWidth,a.Scene_data.stageHeight),a.UIManager.getInstance().resize(),a.BloodManager.getInstance().resize(),this.resetViewMatrx3D(),a.Scene_data.canvas3D.style.position="absolute",a.Scene_data.canvas3D.style.left="0px",a.Scene_data.canvas3D.style.top="0px"},b.resetViewMatrx3D=function(){a.Scene_data.viewMatrx3D?a.Scene_data.viewMatrx3D.identity():a.Scene_data.viewMatrx3D=new a.Matrix3D;var b=a.Scene_data.stageWidth,c=a.Scene_data.stageHeight;a.Scene_data.sceneViewHW=Math.max(b,c),a.Scene_data.viewMatrx3D.perspectiveFieldOfViewLH(this.sceneCamScale,1,50,a.Scene_data.camFar),a.Scene_data.viewMatrx3D.appendScale(1*(a.Scene_data.sceneViewHW/b*2),b/c*(a.Scene_data.sceneViewHW/b*2),1)},b.update=function(){a.TimeUtil.update(),a.SceneManager.getInstance().update(),a.FpsMc.update()},b.unload=function(){},b.needVertical=!0,b.needInputTxt=!1,b.sceneCamScale=1.76,b}();a.Engine=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.getCamView=function(b,c){b.update();var d=new a.Matrix3D;d.appendRotation(-c.rotationX,a.Vector3D.X_AXIS),d.appendRotation(-c.rotationY,a.Vector3D.Y_AXIS),d.appendTranslation(c.x,c.y,c.z);var e=d.transformVector(new a.Vector3D(0,0,-b.distance));return b.x=e.x,b.y=e.y,b.z=e.z,b.rotationX=c.rotationX,b.rotationY=c.rotationY,b.cameraMatrix.identity(),b.cameraMatrix.prependTranslation(0,0,b.distance),b.cameraMatrix.prependRotation(b.rotationX,a.Vector3D.X_AXIS),b.cameraMatrix.prependRotation(b.rotationY,a.Vector3D.Y_AXIS),b.cameraMatrix.prependTranslation(-c.x,-c.y,-c.z),this.camOffSetShock(b),this.updateVp(),b.cameraMatrix.m},b.camOffSetShock=function(a){this.SetShock&&a.cameraMatrix.prependTranslation(a.offset.x,a.offset.y,a.offset.z)},b.updateVp=function(){a.Scene_data.vpMatrix.identity(),a.Scene_data.vpMatrix.prepend(a.Scene_data.viewMatrx3D),a.Scene_data.vpMatrix.prepend(a.Scene_data.cam3D.cameraMatrix)},b.MathCam=function(b){var c=new a.Matrix3D;c.prependRotation(b.rotationX,a.Vector3D.X_AXIS),c.prependRotation(b.rotationY,a.Vector3D.Y_AXIS),c.prependTranslation(-b.x,-b.y,-b.z),b.cameraMatrix.identity(),b.cameraMatrix.append(c)},b.GetViewHitBoxData=function(b){var c=a.Scene_data.cam3D.cameraMatrix.clone();c.invert();var d=a.Scene_data.viewMatrx3D.m[0],e=a.Scene_data.viewMatrx3D.m[5];this.viewBoxVecItem?(this.lastViewScale.x!=d||this.lastViewScale.y!=e)&&(this.viewBoxVecItem[0]=new a.Vector3D(-b/d,-b/e,b),this.viewBoxVecItem[1]=new a.Vector3D(-b/d,+b/e,b),this.viewBoxVecItem[2]=new a.Vector3D(+b/d,-b/e,b),this.viewBoxVecItem[3]=new a.Vector3D(+b/d,+b/e,b),this.viewBoxVecItem[4]=new a.Vector3D(0,0,0)):(this.lastViewScale=new a.Vector2D(d,e),this.viewBoxVecItem=new Array,this.viewBoxVecItem.push(new a.Vector3D(-b/d,-b/e,b)),this.viewBoxVecItem.push(new a.Vector3D(-b/d,+b/e,b)),this.viewBoxVecItem.push(new a.Vector3D(+b/d,-b/e,b)),this.viewBoxVecItem.push(new a.Vector3D(+b/d,+b/e,b)),this.viewBoxVecItem.push(new a.Vector3D(0,0,0)))},b.GetViewHitBoxDataCopy=function(b){this.viewBoxVecItem||(this.viewBoxVecItem=new Array,this.viewBoxVecItem.push(new a.Vector3D),this.viewBoxVecItem.push(new a.Vector3D),this.viewBoxVecItem.push(new a.Vector3D),this.viewBoxVecItem.push(new a.Vector3D));var c=b/(a.Scene_data.sceneViewHW/2),d=a.Scene_data.sceneViewHW/2*c,e=a.Scene_data.stageWidth,f=a.Scene_data.stageHeight,g=new a.Matrix3D;g.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),g.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS);var h=a.Scene_data.viewMatrx3D.transformVector(new a.Vector3D(500,0,500)),i=h.x/h.w,j=.8,k=e/2/i*c*j,l=f/2/i*c*j;this.viewBoxVecItem[0]=this.gettempPos(new a.Vector3D(-k,-l,d),g),this.viewBoxVecItem[1]=this.gettempPos(new a.Vector3D(+k,-l,d),g),this.viewBoxVecItem[2]=this.gettempPos(new a.Vector3D(+k,+l,d),g),this.viewBoxVecItem[3]=this.gettempPos(new a.Vector3D(-k,+l,d),g)},b.gettempPos=function(b,c){var d=c.transformVector(b);return d=d.add(new a.Vector3D(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z))},b.mathmidpoint=function(a,b,c){var d,e,f;d=a.x+(b.x-a.x)*c,e=a.y+(b.y-a.y)*c,f=a.z+(b.z-a.z)*c,a.x=d,a.y=e,a.z=f},b.drawbezier=function(a,b){var c=new Array;if(0==a.length)return{x:0,y:0,z:0};for(var d=0;d<a.length;d++)c.push({x:a[d].x,y:a[d].y,z:a[d].z});for(;c.length>1;){for(var e=0;e<c.length-1;e++)this.mathmidpoint(c[e],c[e+1],b);c.pop()}return c[0]},b.math_distance=function(a,b,c,d){return Math.sqrt((d-b)*(d-b)+(c-a)*(c-a))},b.math_angle=function(a,b,c,d){var e=a-c,f=b-d,g=180*Math.atan(f/e)/Math.PI;return g},b.easeIn=function(a,b,c,d){return c*(a/=d)*a+b},b.easeOut=function(a,b,c,d){return-c*(a/=d)*(a-2)+b},b.easeInOut=function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},b.mathDisplay2Dto3DWorldPos=function(b,c,d){void 0===d&&(d=300);var e=a.Scene_data.cam3D.cameraMatrix.clone(),f=a.Scene_data.viewMatrx3D.clone();e.invert(),f.invert();var g=new a.Vector3D;return g.x=c.x-b.x,g.y=c.y-b.y,g.x=2*g.x/b.width-1,g.y=1-2*g.y/b.height,g.w=d,g.x=g.x*g.w,g.y=g.y*g.w,g=f.transformVector(g),g.z=d,g=e.transformVector(g)},b.SetShock=!0,b}();a.MathClass=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.mathDisplay2Dto3DWorldPos=function(b,c){void 0===c&&(c=300);var d=c/(a.Scene_data.sceneViewHW/2),e=a.Scene_data.sceneViewHW/2*d,f=a.Scene_data.stageWidth,g=a.Scene_data.stageHeight,h=new a.Matrix3D;h.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),h.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS);var i=a.Scene_data.viewMatrx3D.transformVector(new a.Vector3D(500,0,500)),j=i.x/i.w,k=f/2/j*d,l=g/2/j*d,m=b.x/f*k*2,n=b.y/g*l*2,o=this.gettempPos(new a.Vector3D(-k+m,+l-n,e),h);return o},b.getGroundPanelPos=function(b){var c=a.MathClass.mathDisplay2Dto3DWorldPos(new a.Rectangle(0,0,a.Scene_data.stageWidth,a.Scene_data.stageHeight),new a.Vector2D(b.x,b.y),300),d=new Array;d.push(new a.Vector3D(0,0,0)),d.push(new a.Vector3D(-100,0,100)),d.push(new a.Vector3D(100,0,100));var e=new a.Vector3D(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z);return this.getLinePlaneInterectPointByTri(e,c,d)},b.gettempPos=function(b,c){var d=c.transformVector(b);return d=d.add(new a.Vector3D(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z))},b.math3DWorldtoDisplay2DPos=function(b){var c=a.Scene_data.cam3D.cameraMatrix.clone();c.append(a.Scene_data.viewMatrx3D.clone());var d=a.Scene_data.stageWidth,e=a.Scene_data.stageHeight,f=c.transformVector(b),g=new a.Vector2D;return g.x=(f.x/f.w+1)*(d/2),g.y=(-f.y/f.w+1)*(e/2),g},b.pointToLine2dDis=function(a,b,c){var d=(a.y-b.y)/Math.sqrt(Math.pow(a.y-b.y,2)+Math.pow(a.x-b.x,2)),e=(b.x-a.x)/Math.sqrt(Math.pow(a.y-b.y,2)+Math.pow(a.x-b.x,2)),f=(a.x*b.y-b.x*a.y)/Math.sqrt(Math.pow(a.y-b.y,2)+Math.pow(a.x-b.x,2));return Math.abs(d*c.x+e*c.y+f)/Math.sqrt(Math.pow(d,2)+Math.pow(e,2))},b.argbToHex=function(a,b,c,d){var e=a<<24|b<<16|c<<8|d;return e},b.hexToArgb=function(b){var c=new a.Vector3D;return c.w=b>>24&255,c.x=b>>16&255,c.y=b>>8&255,c.z=255&b,c},b.getLinePlaneInterectPointByTri=function(b,c,d){if(d.length<3)return null;var e=new a.Vector3D(0,2e3,0);return e=a.Vector3D.calTriNormal(d[0],d[1],d[2]),this.getLineAndPlaneIntersectPoint(b,c,d[0],e)},b.getLineAndPlaneIntersectPoint=function(b,c,d,e){var f=new a.Vector3D(b.x-c.x,b.y-c.y,b.z-c.z);f.normalize();var g=f.x*e.x+f.y*e.y+f.z*e.z,h=((d.x-b.x)*e.x+(d.y-b.y)*e.y+(d.z-b.z)*e.z)/g,i=new a.Vector3D;return i.setTo(b.x+f.x*h,b.y+f.y*h,b.z+f.z*h),i},b.lookAt=function(b,c){var d=new a.Matrix3D;return d.buildLookAtLH(b,c,a.Vector3D.Y_AXIS),d},b.MathCam=function(b){b.cameraMatrix.identity(),b.cameraMatrix.prependRotation(b.rotationX,a.Vector3D.X_AXIS),b.cameraMatrix.prependRotation(b.rotationY,a.Vector3D.Y_AXIS),b.cameraMatrix.prependTranslation(-b.x+b.offset.x,-b.y+b.offset.y,-b.z+b.offset.z)},b}();a.MathUtil=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.isIdentity=!0;var a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];this.m=new Float32Array(a);
}return b.prototype.clone=function(a){return void 0===a&&(a=null),a||(a=new b),a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a.m[6]=this.m[6],a.m[7]=this.m[7],a.m[8]=this.m[8],a.m[9]=this.m[9],a.m[10]=this.m[10],a.m[11]=this.m[11],a.m[12]=this.m[12],a.m[13]=this.m[13],a.m[14]=this.m[14],a.m[15]=this.m[15],a},Object.defineProperty(b.prototype,"position",{get:function(){return new a.Vector3D(this.m[12],this.m[13],this.m[14],this.m[15])},enumerable:!0,configurable:!0}),b.prototype.copyTo=function(a){a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a.m[6]=this.m[6],a.m[7]=this.m[7],a.m[8]=this.m[8],a.m[9]=this.m[9],a.m[10]=this.m[10],a.m[11]=this.m[11],a.m[12]=this.m[12],a.m[13]=this.m[13],a.m[14]=this.m[14],a.m[15]=this.m[15]},b.prototype.identity=function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=0,this.m[13]=0,this.m[14]=0,this.m[15]=1},b.prototype.invert=function(){var a=this.m,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p,D=r*C-s*B+t*A+u*z-v*y+w*x;return D?(D=1/D,this.m[0]=(g*C-h*B+i*A)*D,this.m[1]=(d*B-c*C-e*A)*D,this.m[2]=(o*w-p*v+q*u)*D,this.m[3]=(l*v-k*w-m*u)*D,this.m[4]=(h*z-f*C-i*y)*D,this.m[5]=(b*C-d*z+e*y)*D,this.m[6]=(p*t-n*w-q*s)*D,this.m[7]=(j*w-l*t+m*s)*D,this.m[8]=(f*B-g*z+i*x)*D,this.m[9]=(c*z-b*B-e*x)*D,this.m[10]=(n*v-o*t+q*r)*D,this.m[11]=(k*t-j*v-m*r)*D,this.m[12]=(g*y-f*A-h*x)*D,this.m[13]=(b*A-c*y+d*x)*D,this.m[14]=(o*s-n*u-p*r)*D,void(this.m[15]=(j*u-k*s+l*r)*D)):null},b.prototype.invertToMatrix=function(a){var b=this.m,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a.m[0]=(h*D-i*C+j*B)*E,a.m[1]=(e*C-d*D-f*B)*E,a.m[2]=(p*x-q*w+r*v)*E,a.m[3]=(m*w-l*x-n*v)*E,a.m[4]=(i*A-g*D-j*z)*E,a.m[5]=(c*D-e*A+f*z)*E,a.m[6]=(q*u-o*x-r*t)*E,a.m[7]=(k*x-m*u+n*t)*E,a.m[8]=(g*C-h*A+j*y)*E,a.m[9]=(d*A-c*C-f*y)*E,a.m[10]=(o*w-p*u+r*s)*E,a.m[11]=(l*u-k*w-n*s)*E,a.m[12]=(h*z-g*B-i*y)*E,a.m[13]=(c*B-d*z+e*y)*E,a.m[14]=(p*t-o*v-q*s)*E,void(a.m[15]=(k*v-l*t+m*s)*E)):null},b.prototype.appendTranslation=function(a,c,d){b.tempM.identity(),b.tempM.prependTranslation(a,c,d),this.append(b.tempM)},b.prototype.prependTranslation=function(a,b,c){var d=this.m;d[12]=d[0]*a+d[4]*b+d[8]*c+d[12],d[13]=d[1]*a+d[5]*b+d[9]*c+d[13],d[14]=d[2]*a+d[6]*b+d[10]*c+d[14],d[15]=d[3]*a+d[7]*b+d[11]*c+d[15]},b.prototype.transformVector=function(b){var c=new a.Vector3D;return c.x=this.m[0]*b.x+this.m[4]*b.y+this.m[8]*b.z+this.m[12]*b.w,c.y=this.m[1]*b.x+this.m[5]*b.y+this.m[9]*b.z+this.m[13]*b.w,c.z=this.m[2]*b.x+this.m[6]*b.y+this.m[10]*b.z+this.m[14]*b.w,c.w=this.m[3]*b.x+this.m[7]*b.y+this.m[11]*b.z+this.m[15]*b.w,c},b.prototype.append=function(a){b.tempM.m[0]=a.m[0],b.tempM.m[1]=a.m[1],b.tempM.m[2]=a.m[2],b.tempM.m[3]=a.m[3],b.tempM.m[4]=a.m[4],b.tempM.m[5]=a.m[5],b.tempM.m[6]=a.m[6],b.tempM.m[7]=a.m[7],b.tempM.m[8]=a.m[8],b.tempM.m[9]=a.m[9],b.tempM.m[10]=a.m[10],b.tempM.m[11]=a.m[11],b.tempM.m[12]=a.m[12],b.tempM.m[13]=a.m[13],b.tempM.m[14]=a.m[14],b.tempM.m[15]=a.m[15],b.tempM.prepend(this),this.m[0]=b.tempM.m[0],this.m[1]=b.tempM.m[1],this.m[2]=b.tempM.m[2],this.m[3]=b.tempM.m[3],this.m[4]=b.tempM.m[4],this.m[5]=b.tempM.m[5],this.m[6]=b.tempM.m[6],this.m[7]=b.tempM.m[7],this.m[8]=b.tempM.m[8],this.m[9]=b.tempM.m[9],this.m[10]=b.tempM.m[10],this.m[11]=b.tempM.m[11],this.m[12]=b.tempM.m[12],this.m[13]=b.tempM.m[13],this.m[14]=b.tempM.m[14],this.m[15]=b.tempM.m[15]},b.prototype.prepend=function(a){var b=a.m,c=this.m,d=this.m,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],l=d[7],m=d[8],n=d[9],o=d[10],p=d[11],q=d[12],r=d[13],s=d[14],t=d[15],u=b[0],v=b[1],w=b[2],x=b[3];c[0]=u*e+v*i+w*m+x*q,c[1]=u*f+v*j+w*n+x*r,c[2]=u*g+v*k+w*o+x*s,c[3]=u*h+v*l+w*p+x*t,u=b[4],v=b[5],w=b[6],x=b[7],c[4]=u*e+v*i+w*m+x*q,c[5]=u*f+v*j+w*n+x*r,c[6]=u*g+v*k+w*o+x*s,c[7]=u*h+v*l+w*p+x*t,u=b[8],v=b[9],w=b[10],x=b[11],c[8]=u*e+v*i+w*m+x*q,c[9]=u*f+v*j+w*n+x*r,c[10]=u*g+v*k+w*o+x*s,c[11]=u*h+v*l+w*p+x*t,u=b[12],v=b[13],w=b[14],x=b[15],c[12]=u*e+v*i+w*m+x*q,c[13]=u*f+v*j+w*n+x*r,c[14]=u*g+v*k+w*o+x*s,c[15]=u*h+v*l+w*p+x*t},b.prototype.appendRotation=function(a,c){b.tempM.identity(),b.tempM.prependRotation(a,c),this.append(b.tempM)},b.prototype.tomat3=function(){var a=Array.prototype.concat.apply([],arguments);a=[1,0,0,0,1,0,0,0,1];var b=new Float32Array(a);return b[0]=this.m[0],b[1]=this.m[1],b[2]=this.m[2],b[3]=this.m[4],b[4]=this.m[5],b[5]=this.m[6],b[6]=this.m[8],b[7]=this.m[9],b[8]=this.m[10],b},b.prototype.getRotaionM33=function(a){a[0]=this.m[0],a[1]=this.m[1],a[2]=this.m[2],a[3]=this.m[4],a[4]=this.m[5],a[5]=this.m[6],a[6]=this.m[8],a[7]=this.m[9],a[8]=this.m[10]},b.prototype.identityScale=function(){},b.prototype.identityPostion=function(){this.m[12]=0,this.m[13]=0,this.m[14]=0},Object.defineProperty(b.prototype,"x",{get:function(){return this.m[12]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this.m[13]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"z",{get:function(){return this.m[14]},enumerable:!0,configurable:!0}),b.prototype.prependRotation=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=this.m,B=this.m,C=b.x,D=b.y,E=b.z,F=Math.sqrt(C*C+D*D+E*E);return Math.abs(F)<1e-6?null:(F=1/F,C*=F,D*=F,E*=F,c=Math.sin(a*Math.PI/180),d=Math.cos(a*Math.PI/180),e=1-d,f=B[0],g=B[1],h=B[2],i=B[3],j=B[4],k=B[5],l=B[6],m=B[7],n=B[8],o=B[9],p=B[10],q=B[11],r=C*C*e+d,s=D*C*e+E*c,t=E*C*e-D*c,u=C*D*e-E*c,v=D*D*e+d,w=E*D*e+C*c,x=C*E*e+D*c,y=D*E*e-C*c,z=E*E*e+d,A[0]=f*r+j*s+n*t,A[1]=g*r+k*s+o*t,A[2]=h*r+l*s+p*t,A[3]=i*r+m*s+q*t,A[4]=f*u+j*v+n*w,A[5]=g*u+k*v+o*w,A[6]=h*u+l*v+p*w,A[7]=i*u+m*v+q*w,A[8]=f*x+j*y+n*z,A[9]=g*x+k*y+o*z,A[10]=h*x+l*y+p*z,A[11]=i*x+m*y+q*z,B!==A&&(A[12]=B[12],A[13]=B[13],A[14]=B[14],A[15]=B[15]),A)},b.prototype.prependScale=function(a,b,c){var d=this.m,e=this.m;return e[0]=d[0]*a,e[1]=d[1]*a,e[2]=d[2]*a,e[3]=d[3]*a,e[4]=d[4]*b,e[5]=d[5]*b,e[6]=d[6]*b,e[7]=d[7]*b,e[8]=d[8]*c,e[9]=d[9]*c,e[10]=d[10]*c,e[11]=d[11]*c,e[12]=d[12],e[13]=d[13],e[14]=d[14],e[15]=d[15],e},b.prototype.appendScale=function(a,c,d){b.tempM.identity(),b.tempM.prependScale(a,c,d),this.append(b.tempM)},b.prototype.perspectiveFieldOfViewLH=function(a,b,c,d){var e=1/Math.tan(a/2),f=e/b,g=this.m;g[0]=f,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=e,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=d/(d-c),g[11]=1,g[12]=0,g[13]=0,g[14]=c*d/(c-d),g[15]=0},b.prototype.fromVtoV=function(b,c){var d=b.cross(c);d.normalize();var e=Math.acos(b.dot(c)),f=new a.Quaternion;f.fromAxisAngle(d,e),f.toMatrix3D(this)},b.prototype.buildLookAtLH=function(b,c,d){var e=this.m,f=new a.Vector3D;f.x=c.x-b.x,f.y=c.y-b.y,f.z=c.z-b.z,f.normalize();var g=d.cross(f);g.normalize();var h=f.cross(g);e[0]=g.x,e[1]=h.x,e[2]=f.x,e[3]=0,e[4]=g.y,e[5]=h.y,e[6]=f.y,e[7]=0,e[8]=g.z,e[9]=h.z,e[10]=f.z,e[11]=0,e[12]=-g.dot(b),e[13]=-h.dot(b),e[14]=-f.dot(b),e[15]=1},b.mul=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14];b=b[15];var s=c[0],t=c[1],u=c[2],v=c[3];return a[0]=s*d+t*h+u*l+v*p,a[1]=s*e+t*i+u*m+v*q,a[2]=s*f+t*j+u*n+v*r,a[3]=s*g+t*k+u*o+v*b,s=c[4],t=c[5],u=c[6],v=c[7],a[4]=s*d+t*h+u*l+v*p,a[5]=s*e+t*i+u*m+v*q,a[6]=s*f+t*j+u*n+v*r,a[7]=s*g+t*k+u*o+v*b,s=c[8],t=c[9],u=c[10],v=c[11],a[8]=s*d+t*h+u*l+v*p,a[9]=s*e+t*i+u*m+v*q,a[10]=s*f+t*j+u*n+v*r,a[11]=s*g+t*k+u*o+v*b,s=c[12],t=c[13],u=c[14],v=c[15],a[12]=s*d+t*h+u*l+v*p,a[13]=s*e+t*i+u*m+v*q,a[14]=s*f+t*j+u*n+v*r,a[15]=s*g+t*k+u*o+v*b,a},b.prototype.toEulerAngles=function(){var b=new a.Quaternion;b.fromMatrix(this);var c=b.toEulerAngles();return c.scaleBy(180/Math.PI),c},b.prototype.getRotationing=function(){var b=[0,0,0,0],c=this.getScaling(),d=1/c.x,e=1/c.y,f=1/c.z,g=this.m[0]*d,h=this.m[1]*e,i=this.m[2]*f,j=this.m[4]*d,k=this.m[5]*e,l=this.m[6]*f,m=this.m[8]*d,n=this.m[9]*e,o=this.m[10]*f,p=g+k+o,q=0;return p>0?(q=2*Math.sqrt(p+1),b[3]=.25*q,b[0]=(l-n)/q,b[1]=(m-i)/q,b[2]=(h-j)/q):g>k&&g>o?(q=2*Math.sqrt(1+g-k-o),b[3]=(l-n)/q,b[0]=.25*q,b[1]=(h+j)/q,b[2]=(m+i)/q):k>o?(q=2*Math.sqrt(1+k-g-o),b[3]=(m-i)/q,b[0]=(h+j)/q,b[1]=.25*q,b[2]=(l+n)/q):(q=2*Math.sqrt(1+o-g-k),b[3]=(h-j)/q,b[0]=(m+i)/q,b[1]=(l+n)/q,b[2]=.25*q),new a.Vector3D(b[0],b[1],b[2],b[3])},b.prototype.getScaling=function(){var b=this.m[0],c=this.m[1],d=this.m[2],e=this.m[4],f=this.m[5],g=this.m[6],h=this.m[8],i=this.m[9],j=this.m[10],k=Math.sqrt(b*b+c*c+d*d),l=Math.sqrt(e*e+f*f+g*g),m=Math.sqrt(h*h+i*i+j*j);return new a.Vector3D(k,l,m)},b.tempM=new b,b}();a.Matrix3D=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=a,this.y=b,this.z=c,this.w=d}return b.prototype.print=function(){alert(String(this.x)+" "+String(this.y)+" "+String(this.z)+" "+String(this.w))},b.prototype.toEulerAngles=function(b){void 0===b&&(b=null),b||(b=new a.Vector3D);var c=this.x,d=this.y,e=this.z,f=this.w;return b.x=Math.atan2(2*(f*c+d*e),1-2*(c*c+d*d)),b.y=Math.asin(2*(f*d-e*c)),b.z=Math.atan2(2*(f*e+c*d),1-2*(d*d+e*e)),b},b.prototype.toMatrix3D=function(b){void 0===b&&(b=null),b||(b=new a.Matrix3D);var c=b.m,d=this.x,e=this.y,f=this.z,g=this.w,h=d+d,i=e+e,j=f+f,k=d*h,l=e*h,m=e*i,n=f*h,o=f*i,p=f*j,q=g*h,r=g*i,s=g*j;return c[0]=1-m-p,c[1]=l+s,c[2]=n-r,c[3]=0,c[4]=l-s,c[5]=1-k-p,c[6]=o+q,c[7]=0,c[8]=n+r,c[9]=o-q,c[10]=1-k-m,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,b},b.prototype.fromAxisAngle=function(a,b){var c=Math.sin(b/2),d=Math.cos(b/2);this.x=a.x*c,this.y=a.y*c,this.z=a.z*c,this.w=d,this.normalize()},b.prototype.normalize=function(a){void 0===a&&(a=1);var b=a/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=b,this.y*=b,this.z*=b,this.w*=b},b.prototype.fromMatrix=function(a){var b=[0,0,0,0,0,0,0,0,0];b[0]=a.m[0],b[1]=a.m[1],b[2]=a.m[2],b[3]=a.m[4],b[4]=a.m[5],b[5]=a.m[6],b[6]=a.m[8],b[7]=a.m[9],b[8]=a.m[10];var c,d=b[0]+b[4]+b[8],e=[0,0,0,0];if(d>0)c=Math.sqrt(d+1),e[3]=.5*c,c=.5/c,e[0]=(b[5]-b[7])*c,e[1]=(b[6]-b[2])*c,e[2]=(b[1]-b[3])*c;else{var f=0;b[4]>b[0]&&(f=1),b[8]>b[3*f+f]&&(f=2);var g=(f+1)%3,h=(f+2)%3;c=Math.sqrt(b[3*f+f]-b[3*g+g]-b[3*h+h]+1),e[f]=.5*c,c=.5/c,e[3]=(b[3*g+h]-b[3*h+g])*c,e[g]=(b[3*g+f]+b[3*f+g])*c,e[h]=(b[3*h+f]+b[3*f+h])*c}this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3]},b.prototype.setMd5W=function(){this.w=1-(this.x*this.x+this.y*this.y+this.z*this.z),this.w<0?this.w=0:this.w=-Math.sqrt(this.w)},b.prototype.slerp=function(a,b,c){var d=a.w,e=a.x,f=a.y,g=a.z,h=b.w,i=b.x,j=b.y,k=b.z,l=d*h+e*i+f*j+g*k;if(0>l&&(l=-l,h=-h,i=-i,j=-j,k=-k),.95>l){var m=Math.acos(l),n=1/Math.sin(m),o=Math.sin(m*(1-c))*n,p=Math.sin(m*c)*n;this.w=d*o+h*p,this.x=e*o+i*p,this.y=f*o+j*p,this.z=g*o+k*p}else{this.w=d+c*(h-d),this.x=e+c*(i-e),this.y=f+c*(j-f),this.z=g+c*(k-g);var q=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=q,this.x*=q,this.y*=q,this.z*=q}},b}();a.Quaternion=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=a,this.y=b,this.z=c,this.w=d}return a.prototype.normalize=function(){var a=this.length;0!=a&&this.scaleBy(1/a)},Object.defineProperty(a.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),a.prototype.scaleBy=function(a){this.x*=a,this.y*=a,this.z*=a,this.w*=a},a.prototype.divideScalar=function(a){0!=a?(this.x=this.x/a,this.y=this.y/a,this.z=this.z/a):(this.x=0,this.y=0,this.z=0)},a.prototype.distanceToSquared=function(b){return a.distance(this,b)},a.prototype.scaleByW=function(){this.x*=this.w,this.y*=this.w,this.z*=this.w},a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y,this.z+b.z)},a.prototype.subtract=function(b){return new a(this.x-b.x,this.y-b.y,this.z-b.z)},a.prototype.addByNum=function(a,b,c,d){void 0===d&&(d=0),this.x+=a,this.y+=b,this.z+=c,this.w+=d},a.prototype.setTo=function(a,b,c){this.x=a,this.y=b,this.z=c},a.prototype.setByte=function(a){this.x=a.readFloat(),this.y=a.readFloat(),this.z=a.readFloat()},a.prototype.cross=function(b){return new a(this.y*b.z-this.z*b.y,this.z*b.x-this.x*b.z,this.x*b.y-this.y*b.x)},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},a.prototype.clone=function(){return new a(this.x,this.y,this.z)},a.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return Math.sqrt(c*c+d*d+e*e)},a.prototype.toString=function(){return"Vector3D("+String(this.x)+","+String(this.y)+","+String(this.z)+","+String(this.w)+")"},a.dotMulVector=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},a.getNrmByTwoVect=function(a,b){var c=b.subtract(a);return c.normalize(),c},a.calTriNormal=function(a,b,c,d){void 0===d&&(d=!1);var e=b.subtract(a),f=c.subtract(b),g=e.cross(f);return d&&g.normalize(),g},a.getPointPedalInPlane=function(a,b,c,d){var e=this.calTriNormal(b,c,d,!0),f=[];return f.push(b,c,d),this.getProjPosition(e,a,f)},a.getProjPosition=function(b,c,d){var e=c,f=(b.x*(d[0].x-e.x)+b.y*(d[0].y-e.y)+b.z*(d[0].z-e.z))/(b.x*b.x+b.y*b.y+b.z*b.z),g=new a(e.x+f*b.x,e.y+f*b.y,e.z+f*b.z);return g},a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a}();a.Vector3D=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=0,this.y=0,this.x=a,this.y=b}return a.prototype.normalize=function(){var a=this.length;0!=a&&this.scaleBy(1/a)},Object.defineProperty(a.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),a.prototype.scaleBy=function(a){this.x*=a,this.y*=a},a.prototype.sub=function(b){return new a(b.x-this.x,b.y-this.y)},a.prototype.add=function(b){return new a(b.x+this.x,b.y+this.y)},a.prototype.toString=function(){return"Vector2D("+String(this.x)+","+String(this.y)+")"},a.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},a.prototype.subtract=function(b){return new a(this.x-b.x,this.y-b.y)},a}();a.Vector2D=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=1),void 0===d&&(d=1),this.x=0,this.y=0,this.width=0,this.height=1,this.x=a,this.y=b,this.width=c,this.height=d}return a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)},a.prototype.sets=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d},a.prototype.setRec=function(a){this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height},a.prototype.isHitByPoint=function(a,b){return a>=this.x&&b>=this.y&&a<=this.x+this.width&&b<=this.y+this.height},a}();a.Rectangle=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.setData(a,b,c)}return a.prototype.setData=function(a,b,c){this.x=a,this.y=b,this.radius=c},a.prototype.setPos=function(a,b){this.x=a,this.y=b},Object.defineProperty(a.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a},enumerable:!0,configurable:!0}),a.prototype.setRadius=function(a){this.radius=a},a.prototype.testPoint=function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)<this.radius},a}();a.Circle=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.getGroundPos=function(b,c){var d=-500;if(!this._plantObjectMath){var e=new a.Vector3D(0,d,500),f=new a.Vector3D(-500,d,0),g=new a.Vector3D(500,d,0);this._plantObjectMath=a.Calculation._PanelEquationFromThreePt(e,f,g),this._plantnormal=new a.Vector3D(this._plantObjectMath.a,this._plantObjectMath.b,this._plantObjectMath.c),this._plantnormal.normalize(),this._plane_a=new a.Vector3D(e.x,e.y,e.z)}var h=a.MathUtil.mathDisplay2Dto3DWorldPos(new a.Vector2D(b,c),500),i=new a.Vector3D(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z),j=a.Calculation.calPlaneLineIntersectPoint(this._plantnormal,this._plane_a,h,i);return j},b}();a.Groundposition=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this.a=0,this.b=0,this.c=0,this.d=0}return a}();a.ObjectMath=b;var c=function(){function c(){}return c._PanelEquationFromThreePt=function(a,c,d){var e=(c.y-a.y)*(d.z-a.z)-(c.z-a.z)*(d.y-a.y),f=(c.z-a.z)*(d.x-a.x)-(c.x-a.x)*(d.z-a.z),g=(c.x-a.x)*(d.y-a.y)-(c.y-a.y)*(d.x-a.x),h=0-(e*a.x+f*a.y+g*a.z),i=new b;return i.a=e,i.b=f,i.c=g,i.d=h,i},c.calPlaneLineIntersectPoint=function(b,c,d,e){var f=new a.Vector3D,g=b.x,h=b.y,i=b.z,j=c.x,k=c.y,l=c.z,m=d.x-e.x,n=d.y-e.y,o=d.z-e.z,p=e.x,q=e.y,r=e.z,s=m*g+n*h+o*i;if(0==s)return null;var t=((j-p)*g+(k-q)*h+(l-r)*i)/s;return f.x=p+m*t,f.y=q+n*t,f.z=r+o*t,f},c}();a.Calculation=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.LITTLE_ENDIAN="littleEndian",a.BIG_ENDIAN="bigEndian",a}();a.Endian=b;var c=function(){function c(a){this.BUFFER_EXT_SIZE=0,this.optcode=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(a||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=b.BIG_ENDIAN}return c.prototype._setArrayBuffer=function(a){this.write_position=a.byteLength,this.data=new DataView(a),this._position=0},c.prototype.setdata=function(a){this._setArrayBuffer(a.buffer)},Object.defineProperty(c.prototype,"buffer",{get:function(){return this.data.buffer},set:function(a){this.data=new DataView(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"dataView",{get:function(){return this.data},set:function(a){this.data=a,this.write_position=a.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),c.prototype.getByte=function(a){return this.data.getUint8(a)},c.prototype.setByte=function(a,b){this.data.setUint8(a,b)},Object.defineProperty(c.prototype,"position",{get:function(){return this._position},set:function(a){this._position=a,this.write_position=a>this.write_position?a:this.write_position},enumerable:!0,configurable:!0}),c.prototype.reset=function(){this.clear()},Object.defineProperty(c.prototype,"length",{get:function(){return this.write_position},set:function(a){this.validateBuffer(a,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),c.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},c.prototype.readBoolean=function(){return 0!=this.data.getUint8(this.position++)},c.prototype.readByte=function(){return this.data.getInt8(this.position++)},c.prototype.readBytes=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);for(var d=0;c>d;d++)a.data.setUint8(d+b,this.data.getUint8(this.position++))},c.prototype.readDouble=function(){var a=this.data.getFloat64(this.position,this.endian==b.LITTLE_ENDIAN);return this.position+=c.SIZE_OF_FLOAT64,a},c.prototype.readFloat=function(){var a=this.data.getFloat32(this.position,this.endian==b.LITTLE_ENDIAN);return this.position+=c.SIZE_OF_FLOAT32,a},c.prototype.readInt=function(){var a=this.data.getInt32(this.position,this.endian==b.LITTLE_ENDIAN);return this.position+=c.SIZE_OF_INT32,a},c.prototype.getInt=function(){var a=this.data.getInt32(this.position,this.endian==b.LITTLE_ENDIAN);return a},c.prototype.readInt32=function(){return this.readInt()},c.prototype.readShort=function(){this.position>=this.data.byteLength;var a=this.data.getInt16(this.position,this.endian==b.LITTLE_ENDIAN);return this.position+=c.SIZE_OF_INT16,a},c.prototype.readFloatTwoByte=function(a){return this.readShort()/a},c.prototype.readFloatOneByte=function(){return(this.readByte()+128)/256},c.prototype.readUnsignedByte=function(){return this.data.getUint8(this.position++)},c.prototype.readUint8=function(){return this.readUnsignedByte()},c.prototype.readInt8=function(){return this.readByte()},c.prototype.readUnsignedInt=function(){var a=this.data.getUint32(this.position,this.endian==b.LITTLE_ENDIAN);return this.position+=c.SIZE_OF_UINT32,a},c.prototype.readUint32=function(){return this.readUnsignedInt()},c.prototype.readUint64=function(){return this.readDouble()},c.prototype.readUnsignedShort=function(){var a=this.data.getUint16(this.position,this.endian==b.LITTLE_ENDIAN);return this.position+=c.SIZE_OF_UINT16,a},c.prototype.readUint16=function(){return this.readUnsignedShort()},c.prototype.readUTF=function(){var a=this.data.getUint16(this.position,this.endian==b.LITTLE_ENDIAN);return this.position+=c.SIZE_OF_UINT16,a>0?this.readUTFBytes(a):""},c.prototype.readString=function(){return this.readUTF()},c.prototype.readUTFBytes=function(a){var b=new Uint8Array(this.buffer,this.bufferOffset+this.position,a);return this.position+=a,this.decodeUTF8(b)},c.prototype.readStringByLen=function(a){return this.readUTFBytes(a)},c.prototype.writeBoolean=function(a){this.validateBuffer(c.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,a?1:0)},c.prototype.writeByte=function(a){this.validateBuffer(c.SIZE_OF_INT8),this.data.setInt8(this.position++,a)},c.prototype.writeUint8=function(a){this.writeByte(a)},c.prototype.writeInt8=function(a){this.writeByte(a)},c.prototype.writeBytes=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d;if(!(0>b)&&!(0>c)&&(d=0==c?a.length-b:Math.min(a.length-b,c),d>0)){this.validateBuffer(d);for(var e=new DataView(a.buffer),f=b;d+b>f;f++)this.data.setUint8(this.position++,e.getUint8(f))}},c.prototype.writeDouble=function(a){this.validateBuffer(c.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,a,this.endian==b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_FLOAT64},c.prototype.writeFloat=function(a){this.validateBuffer(c.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,a,this.endian==b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_FLOAT32},c.prototype.writeInt=function(a){this.validateBuffer(c.SIZE_OF_INT32),this.data.setInt32(this.position,a,this.endian==b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_INT32},c.prototype.writeInt32=function(a){this.writeInt(a)},c.prototype.writeUnsignedShort=function(a){this.validateBuffer(c.SIZE_OF_INT16),this.data.setInt16(this.position,a,this.endian==b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_INT16},c.prototype.writeUint16=function(a){this.writeUnsignedShort(a)},c.prototype.writeUint64=function(a){this.validateBuffer(c.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,a,this.endian==b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_FLOAT64},c.prototype.writeShort=function(a){this.validateBuffer(c.SIZE_OF_INT16),this.data.setUint16(this.position,a,this.endian==b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_INT16},c.prototype.writeUnsignedInt=function(a){this.validateBuffer(c.SIZE_OF_UINT32),this.data.setUint32(this.position,a,this.endian==b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_UINT32},c.prototype.writeUint32=function(a){this.writeUnsignedInt(a)},c.prototype.writeUTF=function(a){var d=this.encodeUTF8(a),e=d.length;this.validateBuffer(c.SIZE_OF_UINT16+e),this.data.setUint16(this.position,e,this.endian===b.LITTLE_ENDIAN),this.position+=c.SIZE_OF_UINT16,this._writeUint8Array(d,!1)},c.prototype.writeString=function(a){var b=new c;b.writeUTFBytes(a),this.writeUint16(b.length+1),this.writeBytes(b,0,b.length),this.writeByte(0)},c.prototype.writeStringByLen=function(a,b){var c=this.position;this.writeUTFBytes(a),this.position=c+b,this.length=this.position+1},c.prototype.readVector3D=function(b){void 0===b&&(b=!1);var c=new a.Vector3D;return c.x=this.readFloat(),c.y=this.readFloat(),c.z=this.readFloat(),b&&(c.w=this.readFloat()),c},c.prototype.writeUTFBytes=function(a){this._writeUint8Array(this.encodeUTF8(a))},c.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},c.prototype._writeUint8Array=function(a,b){void 0===b&&(b=!0),b&&this.validateBuffer(this.position+a.length);for(var c=0;c<a.length;c++)this.data.setUint8(this.position++,a[c])},c.prototype.validate=function(a){return this.data.byteLength>0&&this._position+a<=this.data.byteLength?!0:void 0},c.prototype.validateBuffer=function(a,b){if(void 0===b&&(b=!1),this.write_position=a>this.write_position?a:this.write_position,a+=this._position,this.data.byteLength<a||b){var c=new Uint8Array(new ArrayBuffer(a+this.BUFFER_EXT_SIZE)),d=Math.min(this.data.buffer.byteLength,a+this.BUFFER_EXT_SIZE);c.set(new Uint8Array(this.data.buffer,0,d)),this.buffer=c.buffer}},c.prototype.encodeUTF8=function(a){for(var b=0,c=this.stringToCodePoints(a),d=[];c.length>b;){var e=c[b++];if(this.inRange(e,55296,57343))this.encoderError(e);else if(this.inRange(e,0,127))d.push(e);else{var f,g;for(this.inRange(e,128,2047)?(f=1,g=192):this.inRange(e,2048,65535)?(f=2,g=224):this.inRange(e,65536,1114111)&&(f=3,g=240),d.push(this.div(e,Math.pow(64,f))+g);f>0;){var h=this.div(e,Math.pow(64,f-1));d.push(128+h%64),f-=1}}}return new Uint8Array(d)},c.prototype.decodeUTF8=function(a){for(var b,c=!1,d=0,e="",f=0,g=0,h=0,i=0;a.length>d;){var j=a[d++];if(j===this.EOF_byte)b=0!==g?this.decoderError(c):this.EOF_code_point;else if(0===g)this.inRange(j,0,127)?b=j:(this.inRange(j,194,223)?(g=1,i=128,f=j-192):this.inRange(j,224,239)?(g=2,i=2048,f=j-224):this.inRange(j,240,244)?(g=3,i=65536,f=j-240):this.decoderError(c),f*=Math.pow(64,g),b=null);else if(this.inRange(j,128,191))if(h+=1,f+=(j-128)*Math.pow(64,g-h),h!==g)b=null;else{var k=f,l=i;f=0,g=0,h=0,i=0,b=this.inRange(k,l,1114111)&&!this.inRange(k,55296,57343)?k:this.decoderError(c,j)}else f=0,g=0,h=0,i=0,d--,b=this.decoderError(c,j);null!==b&&b!==this.EOF_code_point&&(65535>=b?b>0&&(e+=String.fromCharCode(b)):(b-=65536,e+=String.fromCharCode(55296+(b>>10&1023)),e+=String.fromCharCode(56320+(1023&b))))}return e},c.prototype.encoderError=function(a){},c.prototype.decoderError=function(a,b){return b||65533},c.prototype.inRange=function(a,b,c){return a>=b&&c>=a},c.prototype.div=function(a,b){return Math.floor(a/b)},c.prototype.stringToCodePoints=function(a){for(var b=[],c=0,d=a.length;c<a.length;){var e=a.charCodeAt(c);if(this.inRange(e,55296,57343))if(this.inRange(e,56320,57343))b.push(65533);else if(c===d-1)b.push(65533);else{var f=a.charCodeAt(c+1);if(this.inRange(f,56320,57343)){var g=1023&e,h=1023&f;c+=1,b.push(65536+(g<<10)+h)}else b.push(65533)}else b.push(e);c+=1}return b},c.SIZE_OF_BOOLEAN=1,c.SIZE_OF_INT8=1,c.SIZE_OF_INT16=2,c.SIZE_OF_INT32=4,c.SIZE_OF_UINT8=1,c.SIZE_OF_UINT16=2,c.SIZE_OF_UINT32=4,c.SIZE_OF_FLOAT32=4,c.SIZE_OF_FLOAT64=8,c}();a.Pan3dByteArray=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(a,b,c,d){void 0===a&&(a=null),void 0===b&&(b=null),void 0===c&&(c=null),void 0===d&&(d=.1),this.p1=a,this.p2=b,this.p3=c,this.precision=d}return a.prototype.setAllPoint=function(a,b,c){this.p1=a,this.p2=b,this.p3=c},a.prototype.checkPointIn=function(b){var c=this.getArea(),d=0;return d+=a.getAreaByPoints(b,this.p1,this.p2),d+=a.getAreaByPoints(b,this.p2,this.p3),d+=a.getAreaByPoints(b,this.p3,this.p1),d==c||Math.abs(d-c)<this.precision},a.prototype.getArea=function(){return a.getAreaByPoints(this.p1,this.p2,this.p3)},a.getAreaByPoints=function(a,b,c){var d=a.x-b.x,e=a.y-b.y,f=Math.sqrt(d*d+e*e);d=b.x-c.x,e=b.y-c.y;var g=Math.sqrt(d*d+e*e);d=c.x-a.x,e=c.y-a.y;var h=Math.sqrt(d*d+e*e),i=(f+g+h)/2,j=i*(i-f)*(i-g)*(i-h);return j>0?Math.sqrt(j):0},a.baseTri=new a,a}();a.TestTriangle=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.getProgram=function(a){return this._dic[a]?this._dic[a]:(alert("please registe Program=>"+a),null)},b.prototype.registe=function(a,b){this._dic[a]||(b.encode(),b.useNum=1,b.name=a,this._dic[a]=b)},b.prototype.getMaterialProgram=function(a,b,c,d,e){void 0===d&&(d=null),void 0===e&&(e=!1);var f=a+"_"+c.url;if(d){for(var g=0;g<d.length;g++)f+="_"+d[g];f+=e?"true_":"false_"}if(this._dic[f])return this._dic[f].useNum++,this._dic[f];e&&(d=[c.usePbr,c.useNormal,c.hasFresnel,c.useDynamicIBL,c.lightProbe,c.directLight,c.noLight,c.fogMode]);var h=new b;h.paramAry=d,h.fragment=c.shaderStr;h.encode();return h.useNum++,this._dic[f]=h,h},b.prototype.outShader=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++){var d='"';d+=b[c],c<b.length-1?(d+="\\n",d+='"',d+="+"):d+='"'}},b.prototype.gc=function(){a.prototype.gc.call(this)},b}(a.ResGC);a.ProgrmaManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.fragment=a.getFragmentShaderString(),a}return __extends(c,b),Object.defineProperty(c.prototype,"paramAry",{get:function(){return this._paramAry},set:function(a){this._paramAry=a},enumerable:!0,configurable:!0}),c.prototype.encode=function(){this.vertex=this.getVertexShaderString();var b=a.Scene_data.context3D.renderContext;this.program=b.createProgram(),this.vShader=b.createShader(b.VERTEX_SHADER),this.fShader=b.createShader(b.FRAGMENT_SHADER),b.shaderSource(this.vShader,this.vertex),b.shaderSource(this.fShader,this.fragment),b.compileShader(this.vShader),b.compileShader(this.fShader),b.attachShader(this.program,this.vShader),b.attachShader(this.program,this.fShader),this.binLocation(b),b.linkProgram(this.program),this.localDic=new Object;var c=b.getProgramInfoLog(this.program),d=b.getShaderInfoLog(this.vShader),e=b.getShaderInfoLog(this.fShader);return""!=c?""==d&&""==e?!0:!1:!0},c.prototype.getWebGLUniformLocation=function(b){var c=this.localDic[b];return c?c:(this.localDic[b]=a.Scene_data.context3D.getLocation(this.program,b),this.localDic[b])},c.prototype.binLocation=function(a){},c.prototype.getVertexShaderString=function(){return""},c.prototype.getFragmentShaderString=function(){return""},c.prototype.destory=function(){this.vertex=null,this.fragment=null,this.name=null,this.localDic=null,a.Scene_data.context3D.deleteShader(this)},c}(a.ResCount);a.Shader3D=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v2CubeTexST")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 v2CubeTexST;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2CubeTexST.x, v2CubeTexST.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";
return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D s_texture;\nuniform vec4 testconst;uniform vec4 testconst2;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\nvec4 test = vec4(0,0,0,1);\ntest.xyz = mix(vec3(1,1,1)*0.5,testconst.xyz,0.5);\ninfoUv.xyz = test.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return a},b.buildShader="BuildShader",b}(a.Shader3D);a.BuildShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return b.name="Material_shader",b}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v2CubeTexST");var b=this.paramAry[0],c=this.paramAry[1],d=(this.paramAry[4],this.paramAry[5]),e=this.paramAry[6];d||e||a.bindAttribLocation(this.program,2,"v2lightuv"),b?(a.bindAttribLocation(this.program,3,"v3Normal"),c&&(a.bindAttribLocation(this.program,4,"v3Tangent"),a.bindAttribLocation(this.program,5,"v3Bitangent"))):d&&a.bindAttribLocation(this.program,3,"v3Normal")},b.prototype.getVertexShaderString=function(){var a=this.paramAry[0],b=this.paramAry[1],c=(this.paramAry[2],this.paramAry[3],this.paramAry[4],this.paramAry[5]),d=this.paramAry[6],e=this.paramAry[7],f="attribute vec3 v3Position;\nattribute vec2 v2CubeTexST;\nvarying vec2 v0;\n";return c?f+="varying vec3 v2;\n":d||(f+="attribute vec2 v2lightuv;\nvarying vec2 v2;\n"),a?(f+="attribute vec3 v3Normal;\nvarying vec3 v1;\n",f+=b?"varying mat3 v4;\n":"varying vec3 v4;\n"):0!=e&&(f+="varying vec3 v1;\n"),b&&(f+="attribute vec3 v3Tangent;\nattribute vec3 v3Bitangent;\n"),c&&(a||(f+="attribute vec3 v3Normal;\n"),f+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\n"),f+="uniform mat4 vpMatrix3D;\nuniform mat4 posMatrix3D;\nuniform mat3 rotationMatrix3D;\n",f+="void main(void){\nv0 = vec2(v2CubeTexST.x, v2CubeTexST.y);\nvec4 vt0= vec4(v3Position, 1.0);\nvt0 = posMatrix3D * vt0;\n",c||d||(f+="v2 = vec2(v2lightuv.x, v2lightuv.y);\n"),(a||0!=e)&&(f+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),f+="vt0 = vpMatrix3D * vt0;\n",a&&(f+=b?"v4 = mat3(rotationMatrix3D * v3Tangent,rotationMatrix3D * v3Bitangent, rotationMatrix3D * v3Normal);\n":"v4 = rotationMatrix3D * v3Normal;\n"),c&&(f+=a?"float suncos = dot(v4.xyz,sunDirect.xyz);\n":"vec3 n = rotationMatrix3D * v3Normal;\nfloat suncos = dot(n.xyz,sunDirect.xyz);\n",f+="suncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;"),f+="gl_Position = vt0;}"},b.prototype.outstr=function(a){for(var b=a.split(";"),c=0;c<b.length;c++){String(trim(b[c]))}},b.prototype.getFragmentShaderString=function(){var a="uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return a},b.MATERIAL_SHADER="Material_shader",b}(a.Shader3D);a.MaterialShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return b.name="Material_Anim_shader",b}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"pos"),a.bindAttribLocation(this.program,1,"v2Uv"),a.bindAttribLocation(this.program,2,"boneID"),a.bindAttribLocation(this.program,3,"boneWeight");var b=this.paramAry[0],c=this.paramAry[1],d=this.paramAry[4],e=this.paramAry[5];b?(a.bindAttribLocation(this.program,4,"normal"),c&&(a.bindAttribLocation(this.program,5,"tangent"),a.bindAttribLocation(this.program,6,"bitangent"))):(d||e)&&a.bindAttribLocation(this.program,4,"normal")},b.getMd5M44Str=function(){var a="vec4 qdv(vec4 q,vec3 d, vec3 v ){\nvec3 t = 2.0 * cross(q.xyz, v);\nvec3 f = v + q.w * t + cross(q.xyz, t);\nreturn  vec4(f.x+d.x,f.y+d.y,f.z+d.z,1.0);\n }\nvec4 getQDdata(vec3 vdata){\nvec4 tempnum = qdv(boneQ[int(boneID.x)],boneD[int(boneID.x)],vdata) * boneWeight.x;\ntempnum += qdv(boneQ[int(boneID.y)],boneD[int(boneID.y)],vdata) * boneWeight.y;\ntempnum += qdv(boneQ[int(boneID.z)],boneD[int(boneID.z)],vdata)* boneWeight.z;\ntempnum += qdv(boneQ[int(boneID.w)],boneD[int(boneID.w)],vdata) * boneWeight.w;\ntempnum.x = tempnum.x*-1.0;\nreturn  tempnum;\n }\n";return a},b.getMd5M44NrmStr=function(){var a="vec4 qdvNrm(vec4 q, vec3 v ){\nvec3 t = 2.0 * cross(q.xyz, v);\nvec3 f = v + q.w * t + cross(q.xyz, t);\nreturn  vec4(f.x,f.y,f.z,1.0);\n }\nvec4 getQDdataNrm(vec3 vdata){\nvec4 tempnum = qdvNrm(boneQ[int(boneID.x)],vdata) * boneWeight.x;\ntempnum += qdvNrm(boneQ[int(boneID.y)],vdata) * boneWeight.y;\ntempnum += qdvNrm(boneQ[int(boneID.z)],vdata)* boneWeight.z;\ntempnum += qdvNrm(boneQ[int(boneID.w)],vdata) * boneWeight.w;\ntempnum.x = tempnum.x*-1.0;\ntempnum.xyz = normalize(tempnum.xyz);\nreturn  tempnum;\n }\n";return a},b.prototype.getVertexShaderString=function(){var a=this.paramAry[0],c=this.paramAry[1],d=(this.paramAry[2],this.paramAry[3],this.paramAry[4]),e=this.paramAry[5],f=this.paramAry[6],g="attribute vec4 pos;\nattribute vec2 v2Uv;\nattribute vec4 boneID;\nattribute vec4 boneWeight;\nvarying vec2 v0;\nuniform vec4 boneQ[54];\nuniform vec3 boneD[54];\nuniform mat4 vpMatrix3D;\nuniform mat4 posMatrix3D;\n";return d?g+="uniform vec3 sh[9];\nvarying vec3 v2;\n":e?g+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\nvarying vec3 v2;\n":f||(g+="varying vec2 v2;\n"),a?(g+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\nvarying vec3 v1;\n",g+=c?"varying mat3 v4;\n":"varying vec3 v4;\n",c&&(g+="attribute vec4 tangent;\nattribute vec4 bitangent;\n")):(d||e)&&(g+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\n"),g+=b.getMd5M44Str()+b.getMd5M44NrmStr()+"void main(void){\nv0 = v2Uv;\nvec4 vt0 = getQDdata(vec3(pos.x,pos.y,pos.z));\nvt0.xyz = vt0.xyz*1.0;\nvt0 = posMatrix3D * vt0;\n",a&&(g+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),g+="vt0 = vpMatrix3D * vt0;\ngl_Position = vt0;\n",a?g+=c?"vec4 vt2 = getQDdataNrm(vec3(tangent.x,tangent.y,tangent.z));\nvt2 = rotationMatrix3D * vt2;\nvt2.xyz = normalize(vt2.xyz);\nvec4 vt1 = getQDdataNrm(vec3(bitangent.x,bitangent.y,bitangent.z));\nvt1 = rotationMatrix3D * vt1;\nvt1.xyz = normalize(vt1.xyz);\nvt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = mat3(vec3(vt2.x,vt2.y,vt2.z),vec3(vt1.x,vt1.y,vt1.z),vec3(vt0.x,vt0.y,vt0.z));\n":"vt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = vec3(vt0.x,vt0.y,vt0.z);\n":(d||e)&&(g+="vt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\n"),d?g+="vec3 lpb = sh[0] * 0.28209479177387814;\nlpb += sh[1] * (vt0.y * -0.4886025119029199);\nlpb += sh[2] * (vt0.z * 0.4886025119029199);\nlpb += sh[3] * (vt0.x * -0.4886025119029199);\nlpb += sh[4] * (vt0.x * vt0.y * 1.0925484305920792);\nlpb += sh[5] * (vt0.z * vt0.y * -1.0925484305920792);\nlpb += sh[6] * ((3.0 * vt0.z * vt0.z - 1.0) * 0.31539156525252005);\nlpb += sh[7] * (vt0.z * vt0.x * -1.0925484305920792);\nlpb += sh[8] * ((vt0.x * vt0.x - vt0.y * vt0.y) * 0.5462742152960396);\nv2 = lpb;\n":e?g+="float suncos = dot(vt0.xyz,sunDirect.xyz);\nsuncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;":f||(g+="v2 = v2Uv;\n"),g+="}"},b.prototype.getFragmentShaderString=function(){var a="uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return a},b.MATERIAL_ANIM_SHADER="Material_Anim_shader",b}(a.Shader3D);a.MaterialAnimShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return b.name="Material_Batch_Anim_Shader",b}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"pos"),a.bindAttribLocation(this.program,1,"v2Uv"),a.bindAttribLocation(this.program,2,"boneID"),a.bindAttribLocation(this.program,3,"boneWeight");var b=this.paramAry[0],c=this.paramAry[1],d=this.paramAry[4],e=this.paramAry[5];b?(a.bindAttribLocation(this.program,4,"normal"),c&&(a.bindAttribLocation(this.program,5,"tangent"),a.bindAttribLocation(this.program,6,"bitangent"))):(d||e)&&a.bindAttribLocation(this.program,4,"normal")},b.prototype.getVertexShaderString=function(){var a=this.paramAry[0],b=this.paramAry[1],c=(this.paramAry[2],this.paramAry[3],this.paramAry[4]),d=this.paramAry[5],e=this.paramAry[6],f="precision mediump float;\nattribute vec4 pos;\nattribute vec3 v2Uv;\nattribute vec4 boneID;\nattribute vec4 boneWeight;\nvarying vec2 v0;\nuniform mat4 bone[19];\nuniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 posMatrixAry[6];\n";return c?f+="varying vec3 v2;\n":d?f+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\nvarying vec3 v2;\n":e||(f+="varying vec2 v2;\n"),a?(f+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\nvarying vec3 v1;\n",f+=b?"varying mat3 v4;\n":"varying vec3 v4;\n",b&&(f+="attribute vec4 tangent;\nattribute vec4 bitangent;\n")):(c||d)&&(f+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\n"),f+="void main(void){\nv0 = vec2(v2Uv.xy);\nvec4 vt0 = bone[int(boneID.x)] * pos * boneWeight.x;\nvt0 += bone[int(boneID.y)] * pos * boneWeight.y;\nvt0 += bone[int(boneID.z)] * pos * boneWeight.z;\nvt0 += bone[int(boneID.w)] * pos * boneWeight.w;\nvt0 = posMatrixAry[int(v2Uv.z)] * vt0;\n",a&&(f+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),f+="vt0 = camMatrix3D * vt0;\nvt0 = viewMatrix3D * vt0;\ngl_Position = vt0;\n",a?f+=b?"vec4 vt2 = bone[int(boneID.x)] * tangent * boneWeight.x;\nvt2 += bone[int(boneID.y)] * tangent * boneWeight.y;\nvt2 += bone[int(boneID.z)] * tangent * boneWeight.z;\nvt2 += bone[int(boneID.w)] * tangent * boneWeight.w;\nvt2 = rotationMatrix3D * vt2;\nvt2.xyz = normalize(vt2.xyz);\nvec4 vt1 = bone[int(boneID.x)] * bitangent * boneWeight.x;\nvt1 += bone[int(boneID.y)] * bitangent * boneWeight.y;\nvt1 += bone[int(boneID.z)] * bitangent * boneWeight.z;\nvt1 += bone[int(boneID.w)] * bitangent * boneWeight.w;\nvt1 = rotationMatrix3D * vt1;\nvt1.xyz = normalize(vt1.xyz);\nvt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = mat3(vec3(vt2.x,vt2.y,vt2.z),vec3(vt1.x,vt1.y,vt1.z),vec3(vt0.x,vt0.y,vt0.z));\n":"vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = vec3(vt0.x,vt0.y,vt0.z);\n":(c||d)&&(f+="vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\n"),c?f+="vec3 lpb = normalize(vec3(1.0,1.0,-1.0));\nfloat lp = min(0.0,dot(lpb,vec3(vt0.xyz)));\nlp = lp * 2.0 + 0.7;\nv2 = vec3(lp,lp,lp);\n":d?f+="float suncos = dot(vt0.xyz,sunDirect.xyz);\nsuncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;":e||(f+="v2 = v2Uv;\n"),f+="}"},b.prototype.getFragmentShaderString=function(){var a="uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return a},b}(a.Shader3D);a.MaterialBatchAnimShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v3Normal")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec3 v3Normal;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec3 vNormal;void main(void){   vNormal = vec3(v3Normal.x, v3Normal.y,v3Normal.z);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform samplerCube s_texture;\nvarying vec3 vNormal;\nvoid main(void)\n{\nvec4 infoUv = textureCube(s_texture, vNormal);\ngl_FragColor = infoUv;\n}";return a},b.Sky_Shader="SkyShader",b}(a.Shader3D);a.SkyShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform vec4 pos[30];varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2uv.x, v2uv.y);   vec3 vt1= vec3(v3Pos.xyz * pos[int(v2uv.z)].w + pos[int(v2uv.z)].xyz);   vec4 vt0= vec4(vt1, 1.0);   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return a},b.Display3DShadowShader="Display3DShadowShader",b}(a.Shader3D);a.Display3DShadowShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[50];uniform vec4 ui2[50];varying vec2 v_texCoord;void main(void){   vec4 data = ui2[int(v2uv.z)];   v_texCoord = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return a},b.UI_SHADER="UIShader",b}(a.Shader3D);a.UIShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec2 v2uv;uniform vec2 scale;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2uv.x, v2uv.y);   vec4 vt0= vec4(v3Pos.x*scale.x,v3Pos.y*scale.y,v3Pos.z,1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D s_texture;\nuniform float alpha;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.w = alpha;\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return a},b.UI_IMG_SHADER="UI_img_Shader",b}(a.Shader3D);a.UIImageShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;uniform vec4 ui;void main(void){   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * ui.zw * 2.0;   pos.x += ui.x * 2.0 - 1.0;   pos.y += -ui.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nvoid main(void)\n{\ngl_FragColor = vec4(0.5,0.5,0.5,1.0);\n}";return a},b.UI_MASK_SHADER="UImaskShader",b}(a.Shader3D);a.UIMaskShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 watchCamMatrix3D;\nuniform vec4 posdata[24];uniform vec2 outuv;varying vec2 v_texCoord;void main(void){   vec4 data = posdata[int(v2uv.z)];   vec4 vt0= vec4(v3Pos * data.w,1.0);   vt0= watchCamMatrix3D * vt0;   vt0.xyz += data.xyz;   v_texCoord = vec2(v2uv.x,v2uv.y) + outuv;   gl_Position = viewMatrix3D * camMatrix3D * vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\nif(infoUv.w < 0.1){discard;}\ngl_FragColor = infoUv;\n}";return a},b.MOVIE2D_SHADER="Movie2DShader",b}(a.Shader3D);a.Movie2DShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 watchCamMatrix3D;\nuniform vec4 posdata[12];varying vec2 v_texCoord;void main(void){   vec4 data = posdata[int(v2uv.z)];   vec4 vt0= vec4(v3Pos * data.w,1.0);   vt0= watchCamMatrix3D * vt0;   vt0.xyz += data.xyz;   v_texCoord = vec2(v2uv.x,v2uv.y);   gl_Position = viewMatrix3D * camMatrix3D * vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\nif(infoUv.w < 0.1){discard;}\ngl_FragColor = infoUv;\n}";return a},b.SPRITE2D_SHADER="Sprite2DShader",b}(a.Shader3D);a.Sprite2DShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v2TexCoord")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 v2TexCoord;\nuniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v0;\nvoid main(void){ v0 = v2TexCoord;   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;uniform sampler2D idmaptexture;uniform sampler2D infotexture;uniform sampler2D sixtexture;uniform sampler2D lightexture;vec4 qdvNrm(float indx ,vec2 uvpos){vec2 sixuvTx=uvpos; float ccavid= floor(indx*255.0);if (ccavid==0.0) {\n} else  if (ccavid==1.0){\nsixuvTx.x=sixuvTx.x+0.5;} else  if (ccavid==2.0){sixuvTx.y=sixuvTx.y+0.5;}else{sixuvTx.x=sixuvTx.x+0.5;sixuvTx.y=sixuvTx.y+0.5;}; sixuvTx.x=sixuvTx.x+0.001;sixuvTx.y=sixuvTx.y+0.001;vec4 sixUvColor = texture2D(sixtexture, sixuvTx.xy);\nreturn  sixUvColor;\n }\nvarying vec2 v0;void main(void){vec4 idUv = texture2D(idmaptexture, v0.xy);\nvec4 infoUv = texture2D(infotexture, v0.xy);\nvec4 sixUv = texture2D(sixtexture, v0.xy);\nvec4 lightUv = texture2D(lightexture, v0*0.995+0.0025);\nvec2 sixuv=fract(v0*10.0);  sixuv=sixuv*0.498; vec4 tempnumA = qdvNrm(idUv.x,sixuv) * infoUv.x;\nvec4 tempnumB = qdvNrm(idUv.y,sixuv) * infoUv.y;\nvec4 tempnumC = qdvNrm(idUv.z,sixuv) * infoUv.z;\nvec4 tempnumD = tempnumA+tempnumB+tempnumC;\n tempnumD.xyz=tempnumD.xyz*lightUv.xyz*2.0; gl_FragColor = tempnumD;}";return a},b.TerrainDisplay3DShader="TerrainDisplay3DShader",b}(a.Shader3D);a.TerrainDisplay3DShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.destory=function(){for(var a=0;a<this.dataAry.length;a++)this.dataAry[a].destory()},c.prototype.getCombineParticle=function(){var b=new a.CombineParticle;b.maxTime=this.maxTime;for(var c=0;c<this.dataAry.length;c++){var d=this.dataAry[c].creatPartilce();b.addPrticleItem(d)}return b.sourceData=this,this.useNum++,b},c.prototype.setDataByte=function(b){b.position=0;var c=b.readInt(),d=b.readInt();this.maxTime=0,this.dataAry=new Array;for(var e=0;d>e;e++){var f=b.readInt(),g=this.getParticleDataType(f);g.version=c,g.setAllByteInfo(b),this.dataAry.push(g),g.timelineData.maxFrameNum>this.maxTime&&(this.maxTime=g.timelineData.maxFrameNum)}this.maxTime*=a.Scene_data.frameTime},c.prototype.getParticleDataType=function(b){var c;switch(b){case 1:c=new a.ParticleFacetData;break;case 18:c=new a.ParticleBallData;break;case 3:c=new a.ParticleLocusData;break;case 14:c=new a.ParticleLocusballData;break;case 9:case 4:case 7:c=new a.ParticleModelData;break;case 8:c=new a.ParticleFollowData;break;case 12:c=new a.ParticleFollowLocusData;break;case 13:c=new a.ParticleBoneData}return c},c}(a.ResCount);a.CombineParticleData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._maxTime=1e6,c._rotationX=0,c._rotationY=0,c._rotationZ=0,c.hasMulItem=!1,c.sceneVisible=!0,c.dynamic=!1,c.hasDestory=!1,c._displayAry=new Array,c._time=0,c.bindMatrix=new a.Matrix3D,c.invertBindMatrix=new a.Matrix3D,c.bindVecter3d=new a.Vector3D,c.bindScale=new a.Vector3D(1,1,1),c.groupMatrix=new a.Matrix3D,c.groupRotationMatrix=new a.Matrix3D,c}return __extends(c,b),Object.defineProperty(c.prototype,"displayAry",{get:function(){return this._displayAry},set:function(a){this._displayAry=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxTime",{set:function(a){this._maxTime=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bindTarget",{set:function(a){this._bindTarget=a,this.invertBindMatrix.isIdentity=!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bindSocket",{set:function(a){this._bindSocket=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"x",{get:function(){return this.bindVecter3d.x},set:function(a){this.bindVecter3d.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this.bindVecter3d.y},set:function(a){this.bindVecter3d.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"z",{get:function(){return this.bindVecter3d.z},set:function(a){this.bindVecter3d.z=a},enumerable:!0,configurable:!0}),c.prototype.setPos=function(a,b,c){this.bindVecter3d.setTo(a,b,c);for(var d=0;d<this._displayAry.length;d++)this._displayAry[d].resetPos()},c.prototype.setMulPos=function(a){for(var b=0;b<this._displayAry.length;b++)this._displayAry[b].resetMulPos(a)},Object.defineProperty(c.prototype,"scaleX",{set:function(a){this.bindScale.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleY",{set:function(a){this.bindScale.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleZ",{set:function(a){this.bindScale.z=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationX",{set:function(a){this._rotationX=a,this.applyRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationY",{set:function(a){this._rotationY=a,this.applyRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationZ",{set:function(a){this._rotationZ=a,this.applyRotation()},enumerable:!0,configurable:!0}),c.prototype.applyRotation=function(){this.bindMatrix.identity(),this.bindMatrix.appendRotation(this._rotationX,a.Vector3D.X_AXIS),this.bindMatrix.appendRotation(this._rotationY,a.Vector3D.Y_AXIS),this.bindMatrix.appendRotation(this._rotationZ,a.Vector3D.Z_AXIS),this.bindMatrix.copyTo(this.invertBindMatrix),this.invertBindMatrix.invert(),this.invertBindMatrix.isIdentity=!1},c.prototype.setGroup=function(b,c,d){this._isInGroup=!0,this._groupPos=b,this._groupRotation=c,this._groupScale=d,this.groupMatrix.isIdentity=!1,this.groupMatrix.identity(),this.groupMatrix.appendScale(d.x,d.y,d.z),this.groupMatrix.appendRotation(c.x,a.Vector3D.X_AXIS),this.groupMatrix.appendRotation(c.y,a.Vector3D.Y_AXIS),this.groupMatrix.appendRotation(c.z,a.Vector3D.Z_AXIS),this.groupMatrix.appendTranslation(b.x,b.y,b.z),this.groupRotationMatrix.isIdentity=!1,this.groupRotationMatrix.identity(),this.groupRotationMatrix.prependRotation(c.z,a.Vector3D.Z_AXIS),this.groupRotationMatrix.prependRotation(c.y,a.Vector3D.Y_AXIS),this.groupRotationMatrix.prependRotation(c.x,a.Vector3D.X_AXIS)},c.prototype.setDataByte=function(b){b.position=0;var c=b.readInt(),d=b.readInt();this._maxTime=0,this._displayAry=new Array;for(var e=0;d>e;e++){var f=b.readInt(),g=this.getDisplay3DById(f);g.setAllByteInfo(b,c),g.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(g),g.timeline.maxFrameNum>this._maxTime&&(this._maxTime=g.timeline.maxFrameNum)}this._maxTime*=a.Scene_data.frameTime},c.prototype.addPrticleItem=function(a){a.visible=!1,a.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(a)},c.prototype.getDisplay3DById=function(a){var b=new Object;return b.particleType=a,this.getDisplay3D(b)},c.prototype.setData=function(b){this._displayAry=new Array,this._maxTime=0;for(var c=0;c<b.length;c++){var d=b[c].display,e=this.getDisplay3D(d);e.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(e),e.timeline.maxFrameNum>this._maxTime&&(this._maxTime=e.timeline.maxFrameNum)}this._maxTime*=a.Scene_data.frameTime},c.prototype.updateTime=function(b){if(this._time+=b,this._displayAry){for(var c=0;c<this._displayAry.length;c++)this._displayAry[c].updateTime(this._time);this.updateBind(),this._time>=this._maxTime&&this.dispatchEvent(new a.BaseEvent(a.BaseEvent.COMPLETE))}},c.prototype.updateBind=function(){this._bindTarget&&(this._bindTarget.getSocket(this._bindSocket,this.bindMatrix),this.bindVecter3d.setTo(this.bindMatrix.x,this.bindMatrix.y,this.bindMatrix.z),this.bindMatrix.identityPostion(),this.groupRotationMatrix.isIdentity?this.bindMatrix.invertToMatrix(this.invertBindMatrix):(this.bindMatrix.copyTo(this.invertBindMatrix),this.invertBindMatrix.prepend(this.groupRotationMatrix),this.invertBindMatrix.invert()))},c.prototype.reset=function(){
this._time=0;for(var a=0;a<this._displayAry.length;a++)this._displayAry[a].reset()},c.prototype.update=function(){if(this.sceneVisible&&this._displayAry)for(var a=0;a<this._displayAry.length;a++)this._displayAry[a].update()},c.prototype.updateItem=function(a){this.sceneVisible&&(this.hasDestory||this._displayAry[a].update())},Object.defineProperty(c.prototype,"size",{get:function(){return this._displayAry?this._displayAry.length:0},enumerable:!0,configurable:!0}),c.prototype.getDisplay3D=function(b){var c,d=b.particleType;switch(d){case 1:c=new a.Display3DFacetParticle;break;case 18:c=new a.Display3DBallPartilce;break;case 3:c=new a.Display3DLocusPartilce;break;case 14:c=new a.Display3DLocusBallPartilce;break;case 9:c=new a.Display3DModelObjParticle;break;case 4:c=new a.Display3DModelPartilce;break;case 7:c=new a.Display3dModelAnimParticle;break;case 8:c=new a.Display3DFollowPartilce}return c.visible=!1,c},c.prototype.destory=function(){this.sourceData&&this.sourceData.useNum--;for(var a=0;a<this._displayAry.length;a++)this._displayAry[a].destory();this._displayAry.length=0,this._displayAry=null,this.bindMatrix=null,this.bindVecter3d=null,this.bindScale=null,this.invertBindMatrix=null,this._bindTarget=null,this._bindSocket=null,this._groupPos=null,this._groupRotation=null,this._groupScale=null,this.groupMatrix=null,this.groupRotationMatrix=null,this.hasDestory=!0},c}(a.EventDispatcher);a.CombineParticle=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._time=0,a.renderDic=new Object,a._particleList=new Array,a}return __extends(c,b),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.getParticleByte=function(b){b=b.replace("_byte.txt",".txt"),b=b.replace(".txt","_byte.txt");var c=new a.CombineParticle,d=b;if(this._dic[d]){var e=this._dic[d];c=e.getCombineParticle()}return c.url=d,c},c.prototype.registerUrl=function(a){if(a=a.replace("_byte.txt",".txt"),a=a.replace(".txt","_byte.txt"),this._dic[a]){var b=this._dic[a];b.useNum++}},c.prototype.releaseUrl=function(a){if(a=a.replace("_byte.txt",".txt"),a=a.replace(".txt","_byte.txt"),this._dic[a]){var b=this._dic[a];b.clearUseNum()}},c.prototype.addResByte=function(b,c){if(!this._dic[b]){var d=new a.CombineParticleData;d.setDataByte(c),this._dic[b]=d}},c.prototype.update=function(){this.updateRenderDic(),this.clearPaticleVa()},c.prototype.clearPaticleVa=function(){a.Scene_data.context3D.clearVa(2),a.Scene_data.context3D.clearVa(3),a.Scene_data.context3D.clearVa(4),a.Scene_data.context3D.clearVa(5)},c.prototype.setHide=function(){for(var a=0;a<this._particleList.length;a++)!this._particleList[a].dynamic},Object.defineProperty(c.prototype,"particleList",{get:function(){return this._particleList},enumerable:!0,configurable:!0}),c.prototype.updateTime=function(){for(var b=a.TimeUtil.getTimer(),c=b-this._time,d=0;d<this._particleList.length;d++)this._particleList[d].sceneVisible&&this._particleList[d].updateTime(c);this._time=b},c.prototype.addRenderDic=function(a){var b=a.url;this.renderDic[b]||(this.renderDic[b]=new Array),this.renderDic[b].push(a)},c.prototype.removeRenderDic=function(a){var b=a.url,c=this.renderDic[b].indexOf(a);-1!=c&&(this.renderDic[b].splice(c,1),0==this.renderDic[b].length&&delete this.renderDic[b])},c.prototype.updateRenderDic=function(){for(var a in this.renderDic){var b=this.renderDic[a];if(1==b.length)b[0].update();else for(var c=b[0].size,d=0;c>d;d++)for(var e=0;e<b.length;e++)b[e].updateItem(d)}},c.prototype.addParticle=function(a){-1==this._particleList.lastIndexOf(a)&&(this._particleList.push(a),this.addRenderDic(a))},c.prototype.removeParticle=function(a){var b=this._particleList.indexOf(a);-1!=b&&(this._particleList.splice(b,1),this.removeRenderDic(a))},c.prototype.gc=function(){b.prototype.gc.call(this)},c}(a.ResGC);a.ParticleManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.isInGroup=!1,c.visible=!0,c._rotationMatrix=new a.Matrix3D,c.modelMatrix=new a.Matrix3D,c}return __extends(c,b),c.prototype.onCreated=function(){},c.prototype.setBind=function(a,b,c,d,e){this.bindVecter3d=a,this.bindMatrix=b,this.bindScale=c,this.invertBindMatrix=d,this.groupMatrix=e},c.prototype.getMulBindList=function(){return null},c.prototype.updateMatrix=function(){this.bindMatrix&&(this.modelMatrix.identity(),this.groupMatrix.isIdentity||this.posMatrix.append(this.groupMatrix),this.modelMatrix.append(this.posMatrix),this.modelMatrix.append(this.bindMatrix),this.modelMatrix.appendTranslation(this.bindVecter3d.x,this.bindVecter3d.y,this.bindVecter3d.z))},Object.defineProperty(c.prototype,"cantUseEffectsLev",{get:function(){var b=this.data._renderPriority<=a.Scene_data.effectsLev;return!b},enumerable:!0,configurable:!0}),c.prototype.updateTime=function(a){this.cantUseEffectsLev||(this._time=a-this._beginTime,this._time+=this.data._delayedTime,this.timeline.updateTime(a),this.visible=this.timeline.visible,this.posMatrix.identity(),this.posMatrix.prependScale(.1*this._scaleX*this.bindScale.x*this.data.overAllScale,.1*this._scaleY*this.bindScale.y*this.data.overAllScale,.1*this._scaleZ*this.bindScale.z*this.data.overAllScale),this.timeline.updateMatrix(this.posMatrix,this))},c.prototype.reset=function(){this.timeline.reset(),this.updateTime(0)},c.prototype.clearAllAnim=function(){},c.prototype.update=function(){this.cantUseEffectsLev||this.visible&&this.data.materialParam&&(0==this.data._alphaMode&&(this.data._alphaMode=-1),a.Scene_data.context3D.setBlendParticleFactors(this.data._alphaMode),a.Scene_data.context3D.cullFaceBack(this.data.materialParam.material.backCull),this.data.materialParam&&a.Scene_data.context3D.setProgram(this.data.materialParam.program),this.updateMatrix(),this.setVc(),this.setVa(),this.resetVa())},c.prototype.setVc=function(){},c.prototype.pushVc=function(){a.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData)},c.prototype.setVa=function(){},c.prototype.resetVa=function(){},c.prototype.setMaterialVc=function(){if(this.data.materialParam){for(var b=this.data.materialParam.dynamicConstList,c=this._time%(a.Scene_data.frameTime*this.data._life),d=0;d<b.length;d++)b[d].update(c);this.data.materialParam.material.fcNum<=0||(c*=this.data.materialParam.material.timeSpeed,this.data.materialParam.material.update(c),a.Scene_data.context3D.setVc4fv(this.data.materialParam.shader,"fc",this.data.materialParam.material.fcData))}},c.prototype.setMaterialTexture=function(){if(this.data.materialParam){for(var b=this.data.materialParam.material.texList,c=0;c<b.length;c++)b[c].isDynamic||a.Scene_data.context3D.setRenderTexture(this.data.materialParam.shader,b[c].name,b[c].texture,b[c].id,!0);for(var d=this.data.materialParam.dynamicTexList,c=0;c<d.length;c++)a.Scene_data.context3D.setRenderTexture(this.data.materialParam.shader,d[c].target.name,d[c].texture,d[c].target.id,!0)}},c.prototype.inverBind=function(){this.invertBindMatrix.isIdentity||this._rotationMatrix.prepend(this.invertBindMatrix)},c.prototype.resetPos=function(){},c.prototype.resetMulPos=function(a){},c.prototype.getVector3DByObject=function(b){return b?new a.Vector3D(b.x,b.y,b.z,b.w):null},c.prototype.clone=function(){return null},c.prototype.setAllByteInfo=function(b,c){void 0===c&&(c=0),this.creatData(),this.data.version=c,this.data.setAllByteInfo(b),this.timeline=new a.TimeLine,this.timeline.setAllDataInfo(this.data.timelineData),this._beginTime=this.timeline.beginTime},c.prototype.creatData=function(){this.data=new a.ParticleData},c.prototype.setTimeLine=function(a){this.timeline=a,this._beginTime=a.beginTime},c.prototype.destory=function(){this.timeline=null,this.bindMatrix=null,this.bindVecter3d=null,this.bindScale=null,this.invertBindMatrix=null,this.groupMatrix=null,this._rotationMatrix=null,this.modelMatrix=null,this.groupPos=null,this.groupScale=null,this.groupRotation=null},c}(a.Object3D);a.Display3DParticle=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._delayedTime=0,this._width=100,this._height=100,this._originWidthScale=.5,this._originHeightScale=.5,this._eyeDistance=0,this._watchEye=!1,this._isZiZhuan=!1,this.overAllScale=1}return b.prototype.destory=function(){this.objData&&this.objData.destory(),this.materialParam.destory(),this.timelineData.destory(),this.timelineData=null},b.prototype.uploadGpu=function(){},b.prototype.regShader=function(){},b.prototype.initVcData=function(){},b.prototype.creatPartilce=function(){var b=this.getParticle();b.data=this;var c=new a.TimeLine;return c.setAllDataInfo(this.timelineData),b.setTimeLine(c),b.onCreated(),b},b.prototype.getParticle=function(){return null},b.prototype.setAllByteInfo=function(b){this.timelineData=new a.TimeLineData,this.timelineData.setByteData(b),this._beginTime=this.timelineData.beginTime,this.version>=15&&(this._delayedTime=b.readFloat()),this._width=b.readFloat(),this._height=b.readFloat(),this._widthFixed=b.readBoolean(),this._heightFixed=b.readBoolean(),this._originWidthScale=b.readFloat(),this._originHeightScale=b.readFloat(),this._eyeDistance=b.readFloat(),this._alphaMode=b.readFloat(),this._uSpeed=b.readFloat(),this._vSpeed=b.readFloat(),this._animLine=b.readFloat(),this._animRow=b.readFloat(),this._animInterval=b.readFloat(),this._renderPriority=b.readFloat(),this._distortion=b.readBoolean(),this._isUV=b.readBoolean(),this._isU=b.readBoolean(),this._isV=b.readBoolean(),this._life=b.readFloat(),this._life=this._life>1e4?a.Scene_data.MAX_NUMBER:this._life,this._watchEye=b.readBoolean(),this._ziZhuanAngly=new a.Vector3D,this._ziZhuanAngly.x=b.readFloat(),this._ziZhuanAngly.y=b.readFloat(),this._ziZhuanAngly.z=b.readFloat(),this._ziZhuanAngly.w=b.readFloat(),this.rotationV3d=new a.Vector3D,this.rotationV3d.x=b.readFloat(),this.rotationV3d.y=b.readFloat(),this.rotationV3d.z=b.readFloat(),this.center=new a.Vector3D,this.center.x=b.readFloat(),this.center.y=b.readFloat(),this.center.z=b.readFloat(),this.center.w=b.readFloat(),this.overAllScale=b.readFloat(),!this._ziZhuanAngly||0==this._ziZhuanAngly.x&&0==this._ziZhuanAngly.y&&0==this._ziZhuanAngly.z||(this._isZiZhuan=!0),this.readMaterialPara(b);var c=b.readUTF();c=c.replace("_byte.txt",".txt"),c=c.replace(".txt","_byte.txt"),this.materialByteUrl=c},Object.defineProperty(b.prototype,"materialByteUrl",{set:function(b){var c=this;this._materialUrl!=b&&(this._materialUrl=b,a.MaterialManager.getInstance().getMaterialByte(a.Scene_data.fileRoot+b,function(a){c.onMaterialLoad(a)}))},enumerable:!0,configurable:!0}),b.prototype.onMaterialLoad=function(b){this.materialParam=new a.MaterialParam,this.materialParam.setMaterial(b),this.materialParam.setLife(this._life),this.materialParamData&&(this.materialParam.setTextObj(this.materialParamData.texAry),this.materialParam.setConstObj(this.materialParamData.conAry)),a.MaterialManager.getInstance().loadDynamicTexUtil(this.materialParam),this.regShader()},b.prototype.readMaterialPara=function(a){this.materialParamData=new Object;var b=(a.readUTF(),a.readInt());this.materialParamData.texAry=new Array;for(var c=0;b>c;c++){var d=new Object;d.isParticleColor=a.readBoolean(),d.paramName=a.readUTF(),d.url=a.readUTF(),d.isParticleColor&&(d.curve=new Object,this.readTempCurve(a,d.curve)),this.materialParamData.texAry.push(d)}this.readMaterialParaConAry(a)},b.prototype.readTempCurve=function(a,b){b.values=new Array;var c=!1;if(this.version>=12){var d=a.readInt();if(d>0)var e=a.readFloat();for(var f=0;d>f;f++){for(var g=a.readInt(),h=new Array,i=0;g>i;i++)h.push(a.readByte()/127*e);b.values.push(h)}c=!0}b.type=a.readFloat(),b.maxFrame=a.readFloat(),b.sideType=a.readBoolean(),b.speedType=a.readBoolean(),b.useColorType=a.readBoolean(),b.items=this.readItems(a),c||this.makeCurveData(b)},b.prototype.readItems=function(a){for(var b=new Array,c=a.readInt(),d=0;c>d;d++){var e=new Object;e.frame=a.readInt(),e.vec3=a.readVector3D(!0),e.rotation=a.readVector3D(!0),e.rotationLeft=a.readVector3D(!0),b.push(e)}return b},b.prototype.makeCurveData=function(a){for(var b=a.items,c=new Array,d=new Array,e=new Array,f=new Array,g=0;g<b.length;g++)if(g==b.length-1)c.push(b[g].vec3.x),d.push(b[g].vec3.y),e.push(b[g].vec3.z),f.push(b[g].vec3.w);else{var h=b[g+1].frame-b[g].frame,i=b[g].vec3,j=b[g+1].vec3,k=a.items[g].rotation,l=a.items[g+1].rotationLeft;c=c.concat(this.getBzData(i.x,j.x,k.x,l.x,h)),d=d.concat(this.getBzData(i.y,j.y,k.y,l.y,h)),e=e.concat(this.getBzData(i.z,j.z,k.z,l.z,h)),f=f.concat(this.getBzData(i.w,j.w,k.w,l.w,h))}a.values=new Array,a.values[0]=c,a.values[1]=d,a.values[2]=e,a.values[3]=f},b.prototype.getBzData=function(b,c,d,e,f){var g=10,h=new a.Vector2D(0,b*g),i=new a.Vector2D(f,c*g),j=new a.Matrix3D,k=new a.Vector3D;j.identity(),j.appendRotation(-d,a.Vector3D.Z_AXIS),k=j.transformVector(new a.Vector3D(f/2,0,0));var l=new a.Vector2D(f/2,h.y+k.y);j.identity(),j.appendRotation(-e,a.Vector3D.Z_AXIS),k=j.transformVector(new a.Vector3D(-f/2,0,0));for(var m=new a.Vector2D(f/2,i.y+k.y),n=[h,l,m,i],o=new Array,p=1;3*f>p;p++)o.push(this.drawbezier(n,p/(3*f)));var q=new Array;for(p=0;f>p;p++)for(var r=0;r<o.length;r++)if(o[r].x>=p){q.push(o[r].y/g);break}return q},b.prototype.drawbezier=function(b,c){var d=new Array;if(0==b.length)return new a.Vector2D;for(var e in b)d.push(new a.Vector2D(b[e].x,b[e].y));for(;d.length>1;){for(var f=0;f<d.length-1;f++)this.mathmidpoint(d[f],d[f+1],c);d.pop()}return d[0]},b.prototype.mathmidpoint=function(a,b,c){var d,e;d=a.x+(b.x-a.x)*c,e=a.y+(b.y-a.y)*c,a.x=d,a.y=e},b.prototype.readMaterialParaConAry=function(a){for(var b=new Array,c=a.readInt(),d=0;c>d;d++){var e=new Object;e.type=a.readFloat(),e.indexID=a.readFloat(),e.paramName=a.readUTF(),e.curve=new Object,this.readTempCurve(a,e.curve),b.push(e)}this.materialParamData.conAry=b},b.prototype.setFloat32Vec=function(a,b){},b.prototype.setFloat32Mat=function(a,b){},b}();a.ParticleData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.ObjData);a.ParticleGpuData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._lifeVisible=!0,a._resultUvVec=new Array(2),a}return __extends(c,b),Object.defineProperty(c.prototype,"facetdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),c.prototype.creatData=function(){this.data=new a.ParticleFacetData},c.prototype.update=function(){this._lifeVisible&&b.prototype.update.call(this)},c.prototype.reset=function(){b.prototype.reset.call(this),this._lifeVisible=!0},c.prototype.setVc=function(){this.updateRotaionMatrix(),this.updateUV(),this.data.vcmatData.set(a.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(a.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,48),this.data.vcmatData.set(this._rotationMatrix.m,32),this.data.vcmatData.set(this._resultUvVec,64),this.setMaterialVc(),!this.facetdata._isCycle&&this._time/a.Scene_data.frameTime>this.data._life-2&&(this._lifeVisible=!1),a.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData)},c.prototype.setVa=function(){var b=a.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),a.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,12)),this.setMaterialTexture(),a.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},c.prototype.updateRotaionMatrix=function(){this._rotationMatrix.identity(),this.data._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this.facetdata._locky||this.facetdata._lockx||this.inverBind(),this.facetdata._locky||this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),this.facetdata._lockx||this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS)),this.data._isZiZhuan&&this.timeline.applySelfRotation(this._rotationMatrix,this.data._ziZhuanAngly)},c.prototype.updateUV=function(){var b=float2int(this._time/a.Scene_data.frameTime);b=b>this.facetdata._maxAnimTime?this.facetdata._maxAnimTime:b,b=b/this.data._animInterval%(this.data._animLine*this.data._animRow),this._resultUvVec[0]=float2int(b%this.data._animLine)/this.data._animLine+this._time/a.Scene_data.frameTime*this.data._uSpeed,this._resultUvVec[1]=float2int(b/this.data._animLine)/this.data._animRow+this._time/a.Scene_data.frameTime*this.data._vSpeed},c}(a.Display3DParticle);a.Display3DFacetParticle=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v2TexCoord")},b.prototype.getMat4Str=function(a){return"vcmat["+b.shader_mat4[a]+"]"},b.prototype.getVec4Str=function(a){return"vcmat["+b.shader_vec4[a][0]+"]["+b.shader_vec4[a][1]+"]"},b.getVcSize=function(){return 5},b.prototype.getVertexShaderString=function(){var a="attribute vec4 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 vcmat["+b.getVcSize()+"];\nvarying vec2 v0;\nvoid main(void){\n   v0 = v2TexCoord + vec2("+this.getVec4Str("uvMove")+".xy);\n   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("posMatrix3D")+" * "+this.getMat4Str("rotationMatrix3D")+" * v3Position;\n}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return a},b.Display3D_Facet_Shader="Display3DFacetShader",b.shader_mat4={viewMatrix3D:0,camMatrix3D:1,rotationMatrix3D:2,posMatrix3D:3},b.shader_vec4={uvMove:[4,0]},b}(a.Shader3D);a.Display3DFacetShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._isCycle=!1,a}return __extends(c,b),c.prototype.setAllByteInfo=function(a){this._maxAnimTime=a.readFloat(),this._isCycle=a.readBoolean(),this._lockx=a.readBoolean(),this._locky=a.readBoolean(),b.prototype.setAllByteInfo.call(this,a),this.initVcData(),this.uploadGpu()},c.prototype.getParticle=function(){return new a.Display3DFacetParticle},c.prototype.uploadGpu=function(){this.objData=new a.ObjData,this.makeRectangleData(this._width,this._height,this._originWidthScale,this._originHeightScale,this._isUV,this._isU,this._isV,this._animLine,this._animRow)},c.prototype.makeRectangleData=function(b,c,d,e,f,g,h,i,j){void 0===d&&(d=.5),void 0===e&&(e=.5),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=!1),void 0===i&&(i=1),void 0===j&&(j=1);var k=new Array,l=new Array,m=new Array;if(m.push(new a.Vector2D(0,0)),m.push(new a.Vector2D(0,1/j)),m.push(new a.Vector2D(1/i,1/j)),m.push(new a.Vector2D(1/i,0)),g)for(var n=0;n<m.length;n++)m[n].x=-m[n].x;if(h)for(var n=0;n<m.length;n++)m[n].y=-m[n].y;f&&m.push(m.shift());for(var n=0;n<m.length;n++)k.push(m[n].x,m[n].y);l.push(-d*b,c-e*c,0),l.push(m[0].x,m[0].y),l.push(b-d*b,c-e*c,0),l.push(m[1].x,m[1].y),l.push(b-d*b,-e*c,0),l.push(m[2].x,m[2].y),l.push(-d*b,-e*c,0),l.push(m[3].x,m[3].y);var o=new Array;o.push(0,1,2,0,2,3),this.objData.stride=20,this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(l),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(o),this.objData.treNum=o.length},c.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*a.Display3DFacetShader.getVcSize())},c.prototype.setFloat32Vec=function(b,c){var d=a.Display3DFacetShader.shader_vec4[b],e=16*d[0]+4*d[1];this.vcmatData.set(c,e)},c.prototype.setFloat32Mat=function(b,c){var d=16*a.Display3DFacetShader.shader_mat4[b];this.vcmatData.set(c,d)},c.prototype.regShader=function(){this.materialParam.shader=a.ProgrmaManager.getInstance().getMaterialProgram(a.Display3DFacetShader.Display3D_Facet_Shader,a.Display3DFacetShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program},c}(a.ParticleData);a.ParticleFacetData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),Object.defineProperty(c.prototype,"balldata",{get:function(){return this.data},enumerable:!0,configurable:!0}),c.prototype.creatData=function(){this.data=new a.ParticleBallData},c.prototype.setVa=function(){this.setVaCompress(),this.setMaterialTexture(),a.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},c.prototype.setVaCompress=function(){var b=a.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),a.Scene_data.context3D.setVaOffset(1,3,this.data.objData.stride,12),a.Scene_data.context3D.setVaOffset(2,4,this.data.objData.stride,24),a.Scene_data.context3D.setVaOffset(3,3,this.data.objData.stride,40),this.balldata._needSelfRotation&&a.Scene_data.context3D.setVaOffset(4,2,this.data.objData.stride,52),this.balldata._needRandomColor&&a.Scene_data.context3D.setVaOffset(5,4,this.particleBallData.stride,this.particleBallData.randomOffset))},c.prototype.resetVa=function(){},c.prototype.setVc=function(){this.updateWatchCaramMatrix(),this.balldata.vcmatData.set(a.Scene_data.viewMatrx3D.m,0),this.balldata.vcmatData.set(a.Scene_data.cam3D.cameraMatrix.m,16),this.balldata.vcmatData.set(this.modelMatrix.m,32),this.balldata.vcmatData.set(this._rotationMatrix.m,48),this.balldata._timeVec[0]=this._time/a.Scene_data.frameTime*this.balldata._playSpeed,this.balldata.vcmatData.set(this.balldata._timeVec,80),this.balldata._is3Dlizi&&(this.updateAllRotationMatrix(),this.balldata._wordPosVec[0]=this.bindVecter3d.x,this.balldata._wordPosVec[1]=this.bindVecter3d.y,this.balldata._wordPosVec[2]=this.bindVecter3d.z,this.balldata._caramPosVec[0]=a.Scene_data.cam3D.x,this.balldata._caramPosVec[1]=a.Scene_data.cam3D.y,this.balldata._caramPosVec[2]=a.Scene_data.cam3D.z,this.balldata.vcmatData.set(this.balldata._allRotationMatrix.m,64),this.balldata.vcmatData.set(this.balldata._wordPosVec,96),this.balldata.vcmatData.set(this.balldata._caramPosVec,100)),a.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.balldata.vcmatData),this.setMaterialVc()},c.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.balldata.facez?this._rotationMatrix.prependRotation(90,a.Vector3D.X_AXIS):this.balldata._is3Dlizi?(this.timeline.inverAxisRotation(this._rotationMatrix),this.inverBind()):this.balldata._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this.inverBind(),this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS))},c.prototype.updateAllRotationMatrix=function(){this.balldata._allRotationMatrix.identity(),this.balldata._allRotationMatrix.prependScale(this.data.overAllScale*this._scaleX*.1*this.bindScale.x,this.data.overAllScale*this._scaleY*.1*this.bindScale.y,this.data.overAllScale*this._scaleZ*.1*this.bindScale.z),this.timeline.inverAxisRotation(this._rotationMatrix),this.isInGroup&&(this.balldata._allRotationMatrix.appendRotation(this.groupRotation.x,a.Vector3D.X_AXIS),this.balldata._allRotationMatrix.appendRotation(this.groupRotation.y,a.Vector3D.Y_AXIS),this.balldata._allRotationMatrix.appendRotation(this.groupRotation.z,a.Vector3D.Z_AXIS)),this.bindMatrix&&this.balldata._allRotationMatrix.append(this.bindMatrix)},Object.defineProperty(c.prototype,"particleBallData",{get:function(){return this.data.objData},enumerable:!0,configurable:!0}),c}(a.Display3DParticle);a.Display3DBallPartilce=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"vPosition"),a.bindAttribLocation(this.program,1,"texcoord"),a.bindAttribLocation(this.program,2,"basePos"),a.bindAttribLocation(this.program,3,"speed");var b=this.paramAry[3];b&&a.bindAttribLocation(this.program,4,"rotation");var c=this.paramAry[1];c&&a.bindAttribLocation(this.program,5,"color")},b.prototype.getMat4Str=function(a){return"vcmat["+b.shader_mat4[a]+"]"},b.prototype.getVec4Str=function(a){return"vcmat["+b.shader_vec4[a][0]+"]["+b.shader_vec4[a][1]+"]"},b.getVcSize=function(){return 7},b.prototype.getVertexShaderString=function(){var a,c,d,e,f,g,h,i,j,k,l,m,j,i,n,o,p,q,r,s,t,u,v;n="attribute vec4 vPosition;\nattribute vec3 texcoord;\nattribute vec4 basePos;\nattribute vec3 speed;\nuniform mat4 vcmat["+b.getVcSize()+"];\nvarying vec2 v0;\n",u="attribute vec4 color;\nvarying vec4 v2;\n",o="",p="attribute vec2 rotation;\n",q="",r="",s="",t="",v="varying vec2 v1;\n",a="float ctime = "+this.getVec4Str("time")+".x - basePos.w;\nif ("+this.getVec4Str("time")+".w > 0.0 && ctime >= 0.0) {\n    ctime = fract(ctime / "+this.getVec4Str("time")+".z) * "+this.getVec4Str("time")+".z;\n}\nvec4 pos = vPosition;\n",c="float stime = ctime - "+this.getVec4Str("scale")+".w;\nstime = max(stime,0.0);\nfloat sf = "+this.getVec4Str("scale")+".x * stime;\nif ("+this.getVec4Str("scale")+".y != 0.0 && "+this.getVec4Str("scale")+".z != 0.0) {\n    sf += sin("+this.getVec4Str("scale")+".y * stime) * "+this.getVec4Str("scale")+".z;\n}\nif (sf > "+this.getVec4Str("scaleCtrl")+".z) {\n    sf = "+this.getVec4Str("scaleCtrl")+".z;\n} else if (sf < "+this.getVec4Str("scaleCtrl")+".w) {\n    sf = "+this.getVec4Str("scaleCtrl")+".w;\n}\nvec2 sv2 = vec2("+this.getVec4Str("scaleCtrl")+".x * sf, "+this.getVec4Str("scaleCtrl")+".y * sf);\nsv2 = sv2 + 1.0;\npos.x *= sv2.x;\npos.y *= sv2.y;\n",d="float angle = rotation.x + rotation.y * ctime;\nvec4 np = vec4(sin(angle), cos(angle), 0, 0);\nnp.z = np.x * pos.y + np.y * pos.x;\nnp.w = np.y * pos.y - np.x * pos.x;\npos.xy = np.zw;\n",e="vec3 addPos = speed * ctime;\nvec3 uspeed = vec3(0,0,0);\nif (ctime < 0.0 || ctime >= "+this.getVec4Str("time")+".z) {\n    addPos.y = addPos.y + 100000.0;\n}\n",f="if("+this.getVec4Str("time")+".y != 0.0 && length(speed) != 0.0) {\n    uspeed = vec3(speed.x, speed.y, speed.z);\n    uspeed = normalize(uspeed);\n    uspeed = uspeed * "+this.getVec4Str("time")+".y;\n    uspeed.xyz = uspeed.xyz + "+this.getVec4Str("force")+".xyz;\n} else {\n    uspeed = vec3("+this.getVec4Str("force")+".x, "+this.getVec4Str("force")+".y, "+this.getVec4Str("force")+".z);\n}\naddPos.xyz = addPos.xyz + uspeed.xyz * ctime * ctime;\n",g="uspeed = speed + uspeed * ctime * 2.0;\nuspeed = normalize(uspeed);\nvec4 tempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(uspeed,1.0);\nuspeed.xyz = tempMul.xyz;\nuspeed = normalize(uspeed);\nvec3 cPos = addPos;\ntempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(cPos,1.0);\ncPos.xyz = tempMul.xyz; \ncPos.xyz = "+this.getVec4Str("worldPos")+".xyz + cPos.xyz;\ncPos.xyz = "+this.getVec4Str("camPos")+".xyz - cPos.xyz;\ncPos = normalize(cPos);\ncPos = cross(uspeed, cPos);\ncPos = normalize(cPos);\nuspeed = uspeed * pos.x;\ncPos = cPos * pos.y;\npos.xyz = uspeed.xyz + cPos.xyz;\n",h="pos = "+this.getMat4Str("watheye")+" * pos;\npos.xyz = pos.xyz + basePos.xyz + addPos.xyz;\ngl_Position = "+this.getMat4Str("viewMatrix3D")+" * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("modelMatrix")+" * pos;\n",k="v0 = vec2(texcoord.x,texcoord.y);\n",l="vec2 uv = vec2(texcoord.x,texcoord.y);\nfloat animframe = floor(ctime / "+this.getVec4Str("animCtrl")+".z);\nanimframe = animframe / "+this.getVec4Str("animCtrl")+".x;\nuv.x += animframe;\nanimframe = floor(animframe);\nuv.y += animframe / "+this.getVec4Str("animCtrl")+".y;\nv0.xy = uv.xy;\n",m="vec2 uv = vec2("+this.getVec4Str("uvCtrl")+".x,"+this.getVec4Str("uvCtrl")+".y);\nuv.xy = uv.xy * ctime + texcoord.xy;\nv0.xy = uv.xy;\n",j="v2 = color;\n",i="v1 = vec2(ctime/"+this.getVec4Str("time")+".z,1.0);\n";var w=this.paramAry[0],x=this.paramAry[1],y=this.paramAry[2],z=this.paramAry[3],A=this.paramAry[4],B=this.paramAry[5],C=this.paramAry[6],D="",E="";D+=a,E+=n,A&&(D+=c,E+=o),z&&(D+=d,E+=p),D+=e,B&&(D+=f,E+=q),y&&(D+=g,E+=r),D+=h,1==C?(D+=l,E+=s):2==C?(D+=m,E+=t):D+=k,x&&(D+=j,E+=u),w&&(D+=i,E+=v);var F=E+"void main(){\n"+D+"}";return F},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return a},b.Display3D_Ball_Shader="Display3DBallShader",b.shader_mat4={viewMatrix3D:0,camMatrix3D:1,modelMatrix:2,watheye:3,rotationMatrix:4},b.shader_vec4={time:[5,0],scale:[5,1],scaleCtrl:[5,2],force:[5,3],worldPos:[6,0],camPos:[6,1],animCtrl:[6,2],uvCtrl:[6,3]},b}(a.Shader3D);a.Display3DBallShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b;
}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c._totalNum=1,c._acceleration=.2,c._toscale=0,c._shootAngly=new a.Vector3D(1,0,0),c._shootSpeed=0,c._isRandom=!1,c._isSendRandom=!1,c._isSendAngleRandom=!1,c._paticleMaxScale=1,c._paticleMinScale=1,c._addforce=new a.Vector3D(0,0,0),c._lixinForce=new a.Vector3D(0,0,0),c._waveform=new a.Vector3D(0,0,0,0),c._round=new a.Vector3D,c._is3Dlizi=!1,c._speed=1,c._isLoop=!1,c._basePositon=new a.Vector3D(0,0,0),c._baseRandomAngle=0,c._shapeType=0,c._playSpeed=1,c._beginScale=0,c}return __extends(c,b),c.prototype.getParticle=function(){return new a.Display3DBallPartilce},c.prototype.setAllByteInfo=function(c){this._totalNum=c.readFloat(),this._acceleration=c.readFloat(),this._toscale=c.readFloat(),this._shootSpeed=c.readFloat(),this._isRandom=c.readBoolean(),this._isSendRandom=c.readBoolean(),this._round.x=c.readFloat(),this._round.y=c.readFloat(),this._round.z=c.readFloat(),this._round.w=c.readFloat(),this._is3Dlizi=c.readBoolean(),this._halfCircle=c.readBoolean(),this._shootAngly.x=c.readFloat(),this._shootAngly.y=c.readFloat(),this._shootAngly.z=c.readFloat(),this._shootAngly.w=c.readFloat(),this._shootAngly.normalize(),this._speed=c.readFloat(),this._isLoop=c.readBoolean(),this._isSendAngleRandom=c.readBoolean(),this._waveform.x=c.readFloat(),this._waveform.y=c.readFloat(),this._waveform.z=c.readFloat(),this._waveform.w=c.readFloat(),this._closeSurface=c.readBoolean(),this._isEven=c.readBoolean(),this._paticleMaxScale=c.readFloat(),this._paticleMinScale=c.readFloat(),this._basePositon.x=c.readFloat(),this._basePositon.y=c.readFloat(),this._basePositon.z=c.readFloat(),this._basePositon.w=c.readFloat(),this._baseRandomAngle=c.readFloat(),this._shapeType=c.readFloat(),this._lockX=c.readBoolean(),this._lockY=c.readBoolean(),this._addforce.x=c.readFloat(),this._addforce.y=c.readFloat(),this._addforce.z=c.readFloat(),this._addforce.w=c.readFloat(),this._addforce.scaleByW(),this._lixinForce.x=c.readFloat(),this._lixinForce.y=c.readFloat(),this._lixinForce.z=c.readFloat(),this._lixinForce.w=c.readFloat(),this._islixinAngly=c.readBoolean(),this._particleRandomScale=new a.Vector3D,this._particleRandomScale.x=c.readFloat(),this._particleRandomScale.y=c.readFloat(),this._particleRandomScale.z=c.readFloat(),this._particleRandomScale.w=c.readFloat(),this._playSpeed=c.readFloat(),this.facez=c.readBoolean(),this._beginScale=c.readFloat(),this._widthFixed=c.readBoolean(),this._heightFixed=c.readBoolean(),this.readRandomColor(c),0!=this._acceleration||0!=this._addforce.x||0!=this._addforce.y||0!=this._addforce.z?(this._needAddSpeed=!0,this._addSpeedVec=[this._addforce.x,this._addforce.y,this._addforce.z]):this._needAddSpeed=!1,0!=this._toscale||0!=this._waveform.x||0!=this._waveform.y?(this._needScale=!0,this._scaleVec=[this._toscale,this._waveform.x,this._waveform.y,this._beginScale],this._scaleCtrlVec=[this._widthFixed?0:1,this._heightFixed?0:1,this._paticleMaxScale-1,this._paticleMinScale-1]):this._needScale=!1,b.prototype.setAllByteInfo.call(this,c),this._timeVec=[0,this._acceleration,this._life,this._isLoop?1:-1],this._is3Dlizi&&(this._wordPosVec=[0,0,0],this._caramPosVec=[0,0,0],this._allRotationMatrix=new a.Matrix3D),this.initVcData()},c.prototype.readRandomColor=function(a){var b=a.readInt(),c=new Object;c.alpha=new Array,c.color=new Array,c.pos=new Array;for(var d=0;b>d;d++)c.alpha.push(a.readFloat()),c.color.push(a.readFloat()),c.pos.push(a.readFloat());this._textureRandomColorInfo=c},Object.defineProperty(c.prototype,"objBallData",{get:function(){return this.objData},enumerable:!0,configurable:!0}),c.prototype.uploadGpu=function(){this.objData=new a.ParticleBallGpuData,this.initBaseData(),this.initBasePos(),this.initSpeed(),this.initSelfRotaion(),this._needRandomColor&&this.initBaseColor(),this.pushToGpu()},c.prototype.initBaseData=function(){for(var a=new Array,b=new Array,c=new Array,d=0;d<this._totalNum;d++)this.makeRectangleData(a,b,this._width,this._height,this._originWidthScale,this._originHeightScale,this._isUV,this._isU,this._isV,this._animLine,this._animRow,d),c.push(0+4*d,1+4*d,2+4*d,0+4*d,2+4*d,3+4*d);this.objBallData.vertices=a,this.objBallData.uvs=b,this.objBallData.indexs=c},c.prototype.makeRectangleData=function(b,c,d,e,f,g,h,i,j,k,l,m){void 0===f&&(f=.5),void 0===g&&(g=.5),void 0===h&&(h=!1),void 0===i&&(i=!1),void 0===j&&(j=!1),void 0===k&&(k=1),void 0===l&&(l=1),void 0===m&&(m=0);var n=Math.random()*(this._particleRandomScale.x-this._particleRandomScale.y)+this._particleRandomScale.y;b.push(-f*d*n,(e-g*e)*n,0),b.push((d-f*d)*n,(e-g*e)*n,0),b.push((d-f*d)*n,-g*e*n,0),b.push(-f*d*n,-g*e*n,0);var o=new Array;if(o.push(new a.Vector2D(0,0)),o.push(new a.Vector2D(0,1/l)),o.push(new a.Vector2D(1/k,1/l)),o.push(new a.Vector2D(1/k,0)),i)for(var p=0;p<o.length;p++)o[p].x=-o[p].x;if(j)for(var p=0;p<o.length;p++)o[p].y=-o[p].y;h&&o.push(o.shift());for(var p=0;p<o.length;p++)c.push(o[p].x,o[p].y,m)},c.prototype.initBasePos=function(){for(var b=new Array,c=0;c<this._totalNum;c++){var d,e;if(this._isRandom){var f=new a.Vector3D(this._round.x*this._round.w,this._round.y*this._round.w,this._round.z*this._round.w);this._isEven?this._closeSurface?(d=new a.Vector3D(0,0,f.z),e=new a.Matrix3D,e.appendRotation(360*Math.random(),a.Vector3D.Y_AXIS),d=e.transformVector(d),d.y=f.y*Math.random()*2-f.y):(d=new a.Vector3D(0,0,f.z*Math.random()*2-f.z),e=new a.Matrix3D,e.appendRotation(360*Math.random(),a.Vector3D.Y_AXIS),d=e.transformVector(d),d.y=f.y*Math.random()*2-f.y):this._closeSurface?(d=new a.Vector3D(0,0,f.z),e=new a.Matrix3D,this._halfCircle?e.appendRotation(180*-Math.random(),a.Vector3D.X_AXIS):e.appendRotation(360*Math.random(),a.Vector3D.X_AXIS),e.appendRotation(360*Math.random(),a.Vector3D.Y_AXIS),d=e.transformVector(d)):d=this._halfCircle?new a.Vector3D(f.x*Math.random()*2-f.x,f.y*Math.random(),f.z*Math.random()*2-f.z):new a.Vector3D(f.x*Math.random()*2-f.x,f.y*Math.random()*2-f.y,f.z*Math.random()*2-f.z)}else d=new a.Vector3D;d=d.add(this._basePositon);for(var g=0;4>g;g++)b.push(d.x,d.y,d.z,c*this._shootSpeed)}this.objBallData.basePos=b},c.prototype.initSpeed=function(){for(var b=new Array,c=0;c<this._totalNum;c++){var d=new a.Vector3D,e=new a.Vector3D;if(0!=this._shootAngly.x||0!=this._shootAngly.y||0!=this._shootAngly.z){var f=Math.tan(this._shootAngly.w*Math.PI/180*Math.random()),g=360*Math.PI/180*Math.random();e=new a.Vector3D(Math.sin(g)*f,Math.cos(g)*f,1);var h=new a.Matrix3D;if(h.fromVtoV(new a.Vector3D(0,.0101,.99994),new a.Vector3D(this._shootAngly.x,this._shootAngly.y,this._shootAngly.z)),e=h.transformVector(e),isNaN(e.x))throw new Error("发射锥角，可能有问题，确定是否有取膜");e.normalize(),d=d.add(e)}(0!=this._lixinForce.x||0!=this._lixinForce.y||0!=this._lixinForce.z)&&(e=new a.Vector3D(Math.random()>.5?-this._lixinForce.x:this._lixinForce.x,Math.random()>.5?-this._lixinForce.y:this._lixinForce.y,Math.random()>.5?-this._lixinForce.z:this._lixinForce.z),e.normalize(),d=d.add(e)),this._islixinAngly&&(e=this._isEven?new a.Vector3D(this.objBallData.basePos[16*c],0,this.objBallData.basePos[16*c+2]):new a.Vector3D(this.objBallData.basePos[16*c],this.objBallData.basePos[16*c+1],this.objBallData.basePos[16*c+2]),e.normalize(),d=d.add(e)),d.normalize(),this._isSendRandom?d.scaleBy(this._speed*Math.random()):d.scaleBy(this._speed);for(var i=(this._baseRandomAngle*Math.random()*Math.PI/180,0);4>i;i++)b.push(d.x,d.y,d.z)}this.objBallData.beMove=b},c.prototype.initSelfRotaion=function(){var a=0,b=0;if(0==this._ziZhuanAngly.x&&0==this._ziZhuanAngly.y&&0==this._ziZhuanAngly.z&&0==this._ziZhuanAngly.w)return void(this._needSelfRotation=!1);if(this._is3Dlizi)return void(this._needSelfRotation=!1);this._needSelfRotation=!0;for(var c=new Array,d=0;d<this._totalNum;)a=this._ziZhuanAngly.x,1==this._ziZhuanAngly.y&&(a*=Math.random()),b=this._ziZhuanAngly.z,1==this._ziZhuanAngly.w?b*=Math.random():-1==this._ziZhuanAngly.w&&(b*=2*Math.random()-1),c.push(a,b),c.push(a,b),c.push(a,b),c.push(a,b),d++;this.objBallData.baseRotation=c},c.prototype.initBaseColor=function(){for(var b=a.ColorTransition.getInstance().getImageData(this._textureRandomColorInfo),c=b.data,d=new Array,e=0;e<this._totalNum;e++){var f=4*float2int(128*Math.random()),g=new a.Vector3D(c[f],c[f+1],c[f+2],c[f+3]);g.scaleBy(1/255),d.push(g.x,g.y,g.z,g.w),d.push(g.x,g.y,g.z,g.w),d.push(g.x,g.y,g.z,g.w),d.push(g.x,g.y,g.z,g.w)}this.objBallData.randomColor=d},c.prototype.pushToGpu=function(){this.compressVertex()},c.prototype.compressVertex=function(){var b=this.objBallData.vertices.length/3,c=13;this._needSelfRotation&&(c+=2),this._needRandomColor&&(this.objBallData.randomOffset=4*c,c+=4),this.objBallData.stride=4*c;for(var d=new Array,e=0;b>e;e++){for(var f=0;3>f;f++)d.push(this.objBallData.vertices[3*e+f]);for(var f=0;3>f;f++)d.push(this.objBallData.uvs[3*e+f]);for(var f=0;4>f;f++)d.push(this.objBallData.basePos[4*e+f]);for(var f=0;3>f;f++)d.push(this.objBallData.beMove[3*e+f]);if(this._needSelfRotation)for(var f=0;2>f;f++)d.push(this.objBallData.baseRotation[2*e+f]);if(this._needRandomColor)for(var f=0;4>f;f++)d.push(this.objBallData.randomColor[4*e+f])}this.objBallData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(d),this.objBallData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objBallData.indexs),this.objBallData.treNum=this.objBallData.indexs.length},c.prototype.setFloat32Vec=function(b,c){var d=a.Display3DBallShader.shader_vec4[b],e=16*d[0]+4*d[1];this.vcmatData.set(c,e)},c.prototype.setFloat32Mat=function(b,c){var d=16*a.Display3DBallShader.shader_mat4[b];this.vcmatData.set(c,d)},c.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*a.Display3DBallShader.getVcSize()),this.setFloat32Vec("time",this._timeVec),this._needAddSpeed&&this.setFloat32Vec("force",this._addSpeedVec),this._needScale&&(this.setFloat32Vec("scale",this._scaleVec),this.setFloat32Vec("scaleCtrl",this._scaleCtrlVec)),1==this._uvType?this.setFloat32Vec("animCtrl",this._animCtrlVec):2==this._uvType&&this.setFloat32Vec("uvCtrl",this._uvCtrlVec)},c.prototype.regShader=function(){if(this.materialParam){var b=this.getShaderParam();this.materialParam.shader=a.ProgrmaManager.getInstance().getMaterialProgram(a.Display3DBallShader.Display3D_Ball_Shader,a.Display3DBallShader,this.materialParam.material,b),this.materialParam.program=this.materialParam.shader.program}},c.prototype.getShaderParam=function(){1!=this._animRow||1!=this._animLine?(this._uvType=1,this._animCtrlVec=[this._animLine,this._animRow,this._animInterval]):0!=this._uSpeed||0!=this._vSpeed?(this._uvType=2,this._uvCtrlVec=[this._uSpeed,this._vSpeed]):this._uvType=0;var a=this.materialParam.material.hasParticleColor;this._needRandomColor=this.materialParam.material.hasVertexColor,this.uploadGpu();var b,c;c=a?1:0;var d=this._needRandomColor?1:0,e=this._is3Dlizi?1:0,f=this._needSelfRotation?1:0,g=this._needScale?1:0,h=this._needAddSpeed?1:0;return b=[c,d,e,f,g,h,this._uvType]},c}(a.ParticleData);a.ParticleBallData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.destory=function(){b.prototype.destory.call(this),this.basePos&&(this.basePos.length=0,this.basePos=null,this.basePosBuffer&&(a.Scene_data.context3D.deleteBuffer(this.basePosBuffer),this.basePosBuffer=null)),this.beMove&&(this.beMove.length=0,this.beMove=null,this.beMoveBuffer&&(a.Scene_data.context3D.deleteBuffer(this.beMoveBuffer),this.beMoveBuffer=null)),this.randomColor&&(this.randomColor.length=0,this.randomColor=null,this.randomColorBuffer&&(a.Scene_data.context3D.deleteBuffer(this.randomColorBuffer),this.randomColorBuffer=null)),this.baseRotation&&(this.baseRotation.length=0,this.baseRotation=null,this.baseRotationBuffer&&(a.Scene_data.context3D.deleteBuffer(this.baseRotationBuffer),this.baseRotationBuffer=null))},c}(a.ParticleGpuData);a.ParticleBallGpuData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"u2Texture")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 u2Texture;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(u2Texture.x, u2Texture.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ngl_FragColor =infoUv;\n}";return a},b.BaseDiplay3dShader="BaseDiplay3dShader",b}(a.Shader3D);a.BaseDiplay3dShader=b;var c=function(c){function d(){var a=c.call(this)||this;return a.initData(),a.updateMatrix,a}return __extends(d,c),d.prototype.initData=function(){a.ProgrmaManager.getInstance().registe(b.BaseDiplay3dShader,new b),this.shader=a.ProgrmaManager.getInstance().getProgram(b.BaseDiplay3dShader),this.program=this.shader.program,this.objData=new a.ObjData,this.objData.vertices=new Array,this.objData.vertices.push(0,0,0),this.objData.vertices.push(100,0,0),this.objData.vertices.push(100,0,100),this.objData.uvs=new Array,this.objData.uvs.push(0,0),this.objData.uvs.push(1,0),this.objData.uvs.push(0,1),this.objData.indexs=new Array,this.objData.indexs.push(0,1,2),this.loadTexture(),this.upToGpu()},d.prototype.loadTexture=function(){var b=a.UIManager.getInstance().getContext2D(128,128,!1);b.fillStyle="rgb(255,255,255)",b.fillRect(0,0,128,128),this._uvTextureRes=a.TextureManager.getInstance().getCanvasTexture(b)},d.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},d.prototype.update=function(){this.objData&&this.objData.indexBuffer&&this._uvTextureRes&&(a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this._uvTextureRes.texture,0),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},d}(a.Display3D);a.BaseDiplay3dSprite=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),Object.defineProperty(c.prototype,"locusdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),c.prototype.creatData=function(){this.data=new a.ParticleLocusData},c.prototype.setVa=function(){var b=a.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),a.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,28),this.data._watchEye&&a.Scene_data.context3D.setVaOffset(2,4,this.data.objData.stride,12)),this.setMaterialTexture(),a.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},c.prototype.setVc=function(){this.updateUV(),this.data.vcmatData.set(a.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(a.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,32),this.data.vcmatData.set(this.locusdata._resultUvVec,48),this.data._watchEye&&(this.locusdata._caramPosVec[0]=a.Scene_data.cam3D.x,this.locusdata._caramPosVec[1]=a.Scene_data.cam3D.y,this.locusdata._caramPosVec[2]=a.Scene_data.cam3D.z,this.data.vcmatData.set(this.locusdata._caramPosVec,52)),this.locusdata._changUv&&this.data.setFloat32Vec("isUv",this.locusdata._uvVec),a.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData),this.setMaterialVc()},c.prototype.updateUV=function(){var b=this._time/a.Scene_data.frameTime,c=this.data._life/100,d=this.locusdata._speed*b/this.locusdata._density/10;this.locusdata._isEnd&&(d=Math.min(1,d)),this.locusdata._isLoop&&(d%=this.locusdata._life?c+1:1),this.locusdata._resultUvVec[0]=d},c}(a.Display3DParticle);a.Display3DLocusPartilce=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v2TexCoord"),this.paramAry[0]&&a.bindAttribLocation(this.program,2,"v3Normal")},c.prototype.getMat4Str=function(a){return"vcmat["+c.shader_mat4[a]+"]"},c.prototype.getVec4Str=function(a){return"vcmat["+c.shader_vec4[a][0]+"]["+c.shader_vec4[a][1]+"]"},c.getVcSize=function(){return 4},c.prototype.getVertexShaderString=function(){var b="attribute vec4 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 vcmat["+a.Display3DFacetShader.getVcSize()+"];\nvarying vec2 v0;\nvarying vec4 v2;\n",c="attribute vec4 v3Normal;\n",d="",e="varying vec2 v1;\n",f="   vec2 tempv0 = v2TexCoord;\n   tempv0.x -= "+this.getVec4Str("uvMove")+".x;\n",g="   v1 = v2TexCoord;\n",h="   v0 = tempv0;\n",i="   tempv0.xy *= "+this.getVec4Str("isUv")+".xy;\n   if("+this.getVec4Str("isUv")+".z >= 0.0){\n   vec2 tempv1 = tempv0;\n   tempv0.y = tempv1.x;\n   tempv0.x = tempv1.y;}\n   v0 = tempv0;\n",j="   float alpha = tempv0.x/"+this.getVec4Str("uvMove")+".y;\n   alpha = 1.0 - clamp(abs(alpha),0.0,1.0);\n   float kill = -tempv0.x;\n   kill *= tempv0.x - "+this.getVec4Str("uvMove")+".z;\n   v2 = vec4(kill,0.0,0.0,alpha);\n",k="   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("posMatrix3D")+" * v3Position;\n",l="   vec4 tempPos = "+this.getMat4Str("posMatrix3D")+" * v3Position;\n   vec3 mulPos = vec3(tempPos.x,tempPos.y,tempPos.z);\n   vec3 normals = vec3(v3Normal.x,v3Normal.y,v3Normal.z);\n   mulPos = normalize(vec3("+this.getVec4Str("camPos")+".xyz) - mulPos);\n   mulPos = cross(mulPos, normals);\n   mulPos = normalize(mulPos);\n   mulPos *= v3Normal.w;\n   tempPos.xyz = mulPos.xyz + v3Position.xyz;\n   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("posMatrix3D")+" * tempPos;\n",m=this.paramAry[0],n=this.paramAry[1],o=this.paramAry[2],p=b;m&&(p+=c),n&&(p+=d),o&&(p+=e);var q=f+j;o&&(q+=g),q+=n?i:h,q+=m?l:k;var r=p+"void main(void){\n"+q+"}";return r},c.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return a},c.Display3D_Locus_Shader="Display3DLocusShader",c.shader_mat4={viewMatrix3D:0,camMatrix3D:1,posMatrix3D:2},c.shader_vec4={uvMove:[3,0],camPos:[3,1],isUv:[3,2]},c}(a.Shader3D);a.Display3DLocusShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._speed=1,a._isLoop=!1,a}return __extends(c,b),c.prototype.getParticle=function(){return new a.Display3DLocusPartilce},c.prototype.setAllByteInfo=function(c){this._isLoop=c.readBoolean(),this._speed=c.readFloat(),this._density=c.readFloat(),this._isEnd=c.readBoolean(),this.objData=new a.ObjData;var d=c.getInt(),e=9,f=d*e*4,g=new ArrayBuffer(f),h=new DataView(g);a.BaseRes.readBytes2ArrayBuffer(c,h,3,0,e,4),a.BaseRes.readBytes2ArrayBuffer(c,h,4,3,e,4),a.BaseRes.readBytes2ArrayBuffer(c,h,2,7,e,4);for(var i=c.readInt(),j=0;i>j;j++)this.objData.indexs.push(c.readInt());this.objData.stride=4*e,b.prototype.setAllByteInfo.call(this,c),this.initUV(),this._watchEye&&(this._caramPosVec=[0,0,0]),this._uvVec=[this._isU?-1:1,this._isV?-1:1,this._isUV?1:-1],this.initVcData(),this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3DArrayBuffer(g),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},c.prototype.initUV=function(){this._resultUvVec=new Array(3);var b=0,c=this._life/100,d=this._speed*b/this._density/10;this._isEnd&&(d=Math.min(1,d));var e;this._isLoop?this._life?(d%=c+1,e=new a.Vector3D(d,c,-c)):(d%=1,e=new a.Vector3D(d+1,99,-2)):e=this._life?new a.Vector3D(d,c,-1):new a.Vector3D(d,99,-1),this._resultUvVec[0]=e.x,this._resultUvVec[1]=e.y,this._resultUvVec[2]=e.z},c.prototype.uploadGpu=function(){this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this._watchEye&&(this.objData.normalsBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.normals)),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},c.prototype.regShader=function(){if(this.materialParam){var b=this._watchEye?1:0,c=0,d=this.materialParam.material.hasParticleColor;this._isU||this._isV||this._isUV?(c=1,this._changUv=!0):this._changUv=!1;var e;e=[b,c,d?1:0],this.materialParam.shader=a.ProgrmaManager.getInstance().getMaterialProgram(a.Display3DLocusShader.Display3D_Locus_Shader,a.Display3DLocusShader,this.materialParam.material,e),this.materialParam.program=this.materialParam.shader.program}},c.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*a.Display3DLocusShader.getVcSize())},c.prototype.setFloat32Vec=function(b,c){var d=a.Display3DLocusShader.shader_vec4[b],e=16*d[0]+4*d[1];this.vcmatData.set(c,e)},c.prototype.setFloat32Mat=function(b,c){var d=16*a.Display3DLocusShader.shader_mat4[b];this.vcmatData.set(c,d)},c}(a.ParticleData);a.ParticleLocusData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.creatData=function(){this.data=new a.ParticleLocusballData},c}(a.Display3DBallPartilce);a.Display3DLocusBallPartilce=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getParticle=function(){return new a.Display3DLocusBallPartilce},c.prototype.initBasePos=function(){for(var b=new Array,c=0;c<this._totalNum;c++){var d,e=3*c;if(this._isRandom){var f=new a.Vector3D(this._round.x*this._round.w,this._round.y*this._round.w,this._round.z*this._round.w);d=new a.Vector3D(this._posAry[e]+Math.random()*f.x,this._posAry[e+1]+Math.random()*f.y,this._posAry[e+2]+Math.random()*f.z)}else d=new a.Vector3D(this._posAry[e],this._posAry[e+1],this._posAry[e+2]);d=d.add(this._basePositon);for(var g=0;4>g;g++)b.push(d.x,d.y,d.z,c*this._shootSpeed)}this.objBallData.basePos=b},c.prototype.initSpeed=function(){for(var b=new Array,c=0;c<this._totalNum;c++){var d=new a.Vector3D;if(0==this._tangentSpeed)d.addByNum(this._angleAry[3*c],this._angleAry[3*c+1],this._angleAry[3*c+2]);else if(2==this._tangentSpeed)d.setTo(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);else{var e=new a.Vector3D(this._tangentAry[3*c],this._tangentAry[3*c+1],this._tangentAry[3*c+2]);e.scaleBy(this._tangentSpeed),d=d.add(e)}d.normalize(),this._isSendRandom?d.scaleBy(this._speed*Math.random()):d.scaleBy(this._speed);for(var f=0;4>f;f++)b.push(d.x,d.y,d.z)}this.objBallData.beMove=b},c.prototype.setAllByteInfo=function(a){this._tangentSpeed=a.readFloat(),this._posAry=JSON.parse(a.readUTF()),this._angleAry=JSON.parse(a.readUTF()),this._tangentAry=JSON.parse(a.readUTF()),b.prototype.setAllByteInfo.call(this,a),this.uploadGpu()},c}(a.ParticleBallData);a.ParticleLocusballData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._resultUvVec=new Array(2),a}return __extends(c,b),Object.defineProperty(c.prototype,"modeldata",{get:function(){return this.data},enumerable:!0,configurable:!0}),c.prototype.creatData=function(){this.data=new a.ParticleModelData},c.prototype.setVc=function(){this.updateWatchCaramMatrix(),this.updateUV(),this.data.vcmatData.set(a.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(a.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,48),this.data.vcmatData.set(this._rotationMatrix.m,32),this.data.vcmatData.set(this._resultUvVec,64),a.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData),this.setMaterialVc()},c.prototype.setVa=function(){a.Scene_data.context3D.setWriteDepth(1==this.data._depthMode);var b=a.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),a.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,12)),this.setMaterialTexture(),a.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum),a.Scene_data.context3D.setWriteDepth(!1)},c.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.data._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS)),this.data._isZiZhuan&&this.timeline.applySelfRotation(this._rotationMatrix,this.data._ziZhuanAngly)},c.prototype.updateUV=function(){var b=Math.floor(this._time/a.Scene_data.frameTime/this.data._animInterval);this.data._animLine*this.data._animRow;this._resultUvVec[0]=Math.floor(b%this.data._animLine)/this.data._animLine,this._resultUvVec[1]=Math.floor(b/this.data._animLine)/this.data._animRow,this._resultUvVec[0]+=this._time/a.Scene_data.frameTime*this.data._uSpeed,this._resultUvVec[1]+=this._time/a.Scene_data.frameTime*this.data._vSpeed},c}(a.Display3DParticle);a.Display3DModelPartilce=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.update=function(){this._depthMode&&a.Scene_data.context3D.setDepthTest(!0),b.prototype.update.call(this),this._depthMode&&a.Scene_data.context3D.setDepthTest(!1)},c}(a.Display3DModelPartilce);a.Display3DModelObjParticle=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.updateUV=function(){var b=this._time/a.Scene_data.frameTime;b=b>this.modeldata._maxAnimTime?this.modeldata._maxAnimTime:b,b=b/this.data._animInterval%(this.data._animLine*this.data._animRow),this._resultUvVec[0]=float2int(b%this.data._animLine)/this.data._animLine+this._time/a.Scene_data.frameTime*this.data._uSpeed,this._resultUvVec[1]=float2int(b/this.data._animLine)/this.data._animRow+this._time/a.Scene_data.frameTime*this.data._vSpeed},c}(a.Display3DModelPartilce);a.Display3dModelAnimParticle=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getParticle=function(){return new a.Display3DModelPartilce},c.prototype.setAllByteInfo=function(c){this.objData=new a.ObjData,this._maxAnimTime=c.readFloat();var d=c.getInt(),e=5,f=d*e*4,g=new ArrayBuffer(f),h=new DataView(g);a.BaseRes.readBytes2ArrayBuffer(c,h,3,0,e,4),a.BaseRes.readBytes2ArrayBuffer(c,h,2,3,e,4);for(var i=c.readInt(),j=0;i>j;j++)this.objData.indexs.push(c.readInt());this.objData.stride=4*e,this.version>=36&&(this._depthMode=c.readInt()),b.prototype.setAllByteInfo.call(this,c),this.initVcData(),this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3DArrayBuffer(g),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),
this.objData.treNum=this.objData.indexs.length},c.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*a.Display3DFacetShader.getVcSize())},c.prototype.uploadGpu=function(){this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},c.prototype.regShader=function(){this.materialParam.shader=a.ProgrmaManager.getInstance().getMaterialProgram(a.Display3DFacetShader.Display3D_Facet_Shader,a.Display3DFacetShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program},c.prototype.setFloat32Vec=function(b,c){var d=a.Display3DFacetShader.shader_vec4[b],e=16*d[0]+4*d[1];this.vcmatData.set(c,e)},c.prototype.setFloat32Mat=function(b,c){var d=16*a.Display3DFacetShader.shader_mat4[b];this.vcmatData.set(c,d)},c}(a.ParticleData);a.ParticleModelData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.flag=0,a}return __extends(c,b),Object.defineProperty(c.prototype,"followdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),c.prototype.creatData=function(){this.data=new a.ParticleFollowData},c.prototype.onCreated=function(){this.initBingMatrixAry()},c.prototype.setVc=function(){b.prototype.setVc.call(this),this.updateBind(),a.Scene_data.context3D.setVc3fv(this.data.materialParam.shader,"bindpos",this._bindMatrixAry)},c.prototype.initBingMatrixAry=function(){this._bindMatrixAry=new Float32Array(120),this._bindFlagAry=new Array;for(var a=0;a<this.followdata._totalNum;a++)this._bindFlagAry.push(0)},c.prototype.updateBind=function(){for(var b=this._time/a.Scene_data.frameTime,c=this.flag;c<this.followdata._totalNum;c++){var d=(b-c*this.followdata._shootSpeed)/this.followdata._life;if(d>=this._bindFlagAry[c]){var e=3*c;this._bindMatrixAry[e]=this.bindVecter3d.x,this._bindMatrixAry[e+1]=this.bindVecter3d.y,this._bindMatrixAry[e+2]=this.bindVecter3d.z,this._bindFlagAry[c]++}}},c.prototype.updateMatrix=function(){this.bindMatrix&&(this.modelMatrix.identity(),this.groupMatrix.isIdentity||this.posMatrix.append(this.groupMatrix),this.modelMatrix.append(this.posMatrix))},c.prototype.updateAllRotationMatrix=function(){this.followdata._allRotationMatrix.identity(),this.followdata._allRotationMatrix.prependScale(this.followdata.overAllScale*this._scaleX*.1*this.bindScale.x,this.followdata.overAllScale*this._scaleY*.1*this.bindScale.y,this.followdata.overAllScale*this._scaleZ*.1*this.bindScale.z),this.isInGroup&&(this.followdata._allRotationMatrix.appendRotation(this.groupRotation.x,a.Vector3D.X_AXIS),this.followdata._allRotationMatrix.appendRotation(this.groupRotation.y,a.Vector3D.Y_AXIS),this.followdata._allRotationMatrix.appendRotation(this.groupRotation.z,a.Vector3D.Z_AXIS))},c.prototype.reset=function(){b.prototype.reset.call(this);for(var a=0;a<this.followdata._totalNum;a++)this._bindMatrixAry[3*a]=0,this._bindMatrixAry[3*a+1]=0,this._bindMatrixAry[3*a+2]=0,this._bindFlagAry[a]=0},c.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.followdata.facez?this._rotationMatrix.prependRotation(90,a.Vector3D.X_AXIS):this.followdata._watchEye&&(this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS))},c}(a.Display3DBallPartilce);a.Display3DFollowPartilce=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"vPosition"),a.bindAttribLocation(this.program,1,"texcoord"),a.bindAttribLocation(this.program,2,"basePos"),a.bindAttribLocation(this.program,3,"speed");var b=this.paramAry[3];b&&a.bindAttribLocation(this.program,4,"rotation");var c=this.paramAry[1];c&&a.bindAttribLocation(this.program,5,"color")},c.prototype.getMat4Str=function(b){return"vcmat["+a.Display3DBallShader.shader_mat4[b]+"]"},c.prototype.getVec4Str=function(b){return"vcmat["+a.Display3DBallShader.shader_vec4[b][0]+"]["+a.Display3DBallShader.shader_vec4[b][1]+"]"},c.getVcSize=function(){return 7},c.prototype.getVertexShaderString=function(){var b,c,d,e,f,g,h,i,j,k,l,m,j,i,n,o,p,q,r,s,t,u,v;n="attribute vec4 vPosition;\nattribute vec3 texcoord;\nattribute vec4 basePos;\nattribute vec3 speed;\nuniform mat4 vcmat["+a.Display3DBallShader.getVcSize()+"];\nuniform vec3 bindpos[30];\nvarying vec2 v0;\n",u="attribute vec4 color;\nvarying vec4 v2;\n",o="",p="attribute vec2 rotation;\n",q="",r="",s="",t="",v="varying vec2 v1;\n",b="float ctime = "+this.getVec4Str("time")+".x - basePos.w;\nif ("+this.getVec4Str("time")+".w > 0.0 && ctime >= 0.0) {\n    ctime = fract(ctime / "+this.getVec4Str("time")+".z) * "+this.getVec4Str("time")+".z;\n}\nvec4 pos = vPosition;\n",c="float stime = ctime - "+this.getVec4Str("scale")+".w;\nstime = max(stime,0.0);\nfloat sf = "+this.getVec4Str("scale")+".x * stime;\nif ("+this.getVec4Str("scale")+".y != 0.0 && "+this.getVec4Str("scale")+".z != 0.0) {\n    sf += sin("+this.getVec4Str("scale")+".y * stime) * "+this.getVec4Str("scale")+".z;\n}\nif (sf > "+this.getVec4Str("scaleCtrl")+".z) {\n    sf = "+this.getVec4Str("scaleCtrl")+".z;\n} else if (sf < "+this.getVec4Str("scaleCtrl")+".w) {\n    sf = "+this.getVec4Str("scaleCtrl")+".w;\n}\nvec2 sv2 = vec2("+this.getVec4Str("scaleCtrl")+".x * sf, "+this.getVec4Str("scaleCtrl")+".y * sf);\nsv2 = sv2 + 1.0;\npos.x *= sv2.x;\npos.y *= sv2.y;\n",d="float angle = rotation.x + rotation.y * ctime;\nvec4 np = vec4(sin(angle), cos(angle), 0, 0);\nnp.z = np.x * pos.y + np.y * pos.x;\nnp.w = np.y * pos.y - np.x * pos.x;\npos.xy = np.zw;\n",e="vec3 addPos = speed * ctime;\nvec3 uspeed = vec3(0,0,0);\nif (ctime < 0.0 || ctime >= "+this.getVec4Str("time")+".z) {\n    addPos.y = addPos.y + 100000.0;\n}\n",f="if("+this.getVec4Str("time")+".y != 0.0 && length(speed) != 0.0) {\n    uspeed = vec3(speed.x, speed.y, speed.z);\n    uspeed = normalize(uspeed);\n    uspeed = uspeed * "+this.getVec4Str("time")+".y;\n    uspeed.xyz = uspeed.xyz + "+this.getVec4Str("force")+".xyz;\n} else {\n    uspeed = vec3("+this.getVec4Str("force")+".x, "+this.getVec4Str("force")+".y, "+this.getVec4Str("force")+".z);\n}\naddPos.xyz = addPos.xyz + uspeed.xyz * ctime * ctime;\n",g="uspeed = speed + uspeed * ctime * 2.0;\nuspeed = normalize(uspeed);\nvec4 tempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(uspeed,1.0);\nuspeed.xyz = tempMul.xyz;\nuspeed = normalize(uspeed);\nvec3 cPos = addPos;\ntempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(cPos,1.0);\ncPos.xyz = tempMul.xyz; \ncPos.xyz = "+this.getVec4Str("worldPos")+".xyz + cPos.xyz;\ncPos.xyz = "+this.getVec4Str("camPos")+".xyz - cPos.xyz;\ncPos = normalize(cPos);\ncPos = cross(uspeed, cPos);\ncPos = normalize(cPos);\nuspeed = uspeed * pos.x;\ncPos = cPos * pos.y;\npos.xyz = uspeed.xyz + cPos.xyz;\n",h="pos = "+this.getMat4Str("watheye")+" * pos;\npos.xyz = pos.xyz + basePos.xyz + addPos.xyz;\npos = "+this.getMat4Str("modelMatrix")+" * pos;\npos.xyz = pos.xyz + bindpos[int(texcoord.z)].xyz;\ngl_Position = "+this.getMat4Str("viewMatrix3D")+" * "+this.getMat4Str("camMatrix3D")+" * pos;\n",k="v0 = vec2(texcoord.x,texcoord.y);\n",l="vec2 uv = vec2(texcoord.x,texcoord.y);\nfloat animframe = floor(ctime / "+this.getVec4Str("animCtrl")+".z);\nanimframe = animframe / "+this.getVec4Str("animCtrl")+".x;\nuv.x += animframe;\nanimframe = floor(animframe);\nuv.y += animframe / "+this.getVec4Str("animCtrl")+".y;\nv0.xy = uv.xy;\n",m="vec2 uv = vec2("+this.getVec4Str("uvCtrl")+".x,"+this.getVec4Str("uvCtrl")+".y);\nuv.xy = uv.xy * ctime + texcoord.xy;\nv0.xy = uv.xy;\n",j="v2 = color;\n",i="v1 = vec2(ctime/"+this.getVec4Str("time")+".z,1.0);\n";var w=this.paramAry[0],x=this.paramAry[1],y=this.paramAry[2],z=this.paramAry[3],A=this.paramAry[4],B=this.paramAry[5],C=this.paramAry[6],D="",E="";D+=b,E+=n,A&&(D+=c,E+=o),z&&(D+=d,E+=p),D+=e,B&&(D+=f,E+=q),y&&(D+=g,E+=r),D+=h,1==C?(D+=l,E+=s):2==C?(D+=m,E+=t):D+=k,x&&(D+=j,E+=u),w&&(D+=i,E+=v);var F=E+"void main(){\n"+D+"}";return F},c.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return a},c.Display3D_Follow_Shader="Display3DFollowShader",c.shader_mat4={viewMatrix3D:0,camMatrix3D:1,modelMatrix:2,watheye:3,rotationMatrix:4},c.shader_vec4={time:[5,0],scale:[5,1],scaleCtrl:[5,2],force:[5,3],worldPos:[6,0],camPos:[6,1],animCtrl:[6,2],uvCtrl:[6,3]},c}(a.Shader3D);a.Display3DFollowShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getParticle=function(){return new a.Display3DFollowPartilce},c.prototype.setAllByteInfo=function(a){b.prototype.setAllByteInfo.call(this,a),this.uploadGpu()},c.prototype.regShader=function(){if(this.materialParam){var b=this.getShaderParam();this.materialParam.shader=a.ProgrmaManager.getInstance().getMaterialProgram(a.Display3DFollowShader.Display3D_Follow_Shader,a.Display3DFollowShader,this.materialParam.material,b),this.materialParam.program=this.materialParam.shader.program}},c}(a.ParticleBallData);a.ParticleFollowData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.flag=0,a._caramPosVec=[0,0,0],a}return __extends(c,b),Object.defineProperty(c.prototype,"followlocusdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),c.prototype.creatData=function(){this.data=new a.ParticleFollowLocusData},c.prototype.onCreated=function(){this.initBindMatrixAry()},c.prototype.initBindMatrixAry=function(){this._bindPosAry=new Array,this._gpuVc=new Float32Array(6*this.followlocusdata._fenduanshu);for(var a=0;a<=this.followlocusdata._fenduanshu;a++)this._bindPosAry.push([0,0,5*a]),this._bindPosAry.push([0,0,1])},c.prototype.setVa=function(){var b=a.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),a.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,12)),this.setMaterialTexture(),a.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},c.prototype.setVc=function(){this.updateMatrix(),this.updateBind(),this.data.vcmatData.set(a.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(a.Scene_data.cam3D.cameraMatrix.m,16),this._caramPosVec[0]=a.Scene_data.cam3D.x,this._caramPosVec[1]=a.Scene_data.cam3D.y,this._caramPosVec[2]=a.Scene_data.cam3D.z,this.data.vcmatData.set(this._caramPosVec,32),a.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData),this.setBindPosVc(),this.setMaterialVc()},c.prototype.setBindPosVc=function(){for(var b=0;b<this._bindPosAry.length;b++)a.Scene_data.context3D.setVc3fv(this.data.materialParam.shader,"bindpos["+b+"]",this._bindPosAry[b])},c.prototype.reset=function(){this.resetPos(),b.prototype.reset.call(this)},c.prototype.updateMatrix=function(){this.modelMatrix.identity(),this.modelMatrix.prepend(this.posMatrix)},c.prototype.resetPos=function(){for(var b=0;b<this._bindPosAry.length;b+=2)this._bindPosAry[b][0]=this.bindVecter3d.x,this._bindPosAry[b][1]=this.bindVecter3d.y,this._bindPosAry[b][2]=this.bindVecter3d.z;this.flag=a.TimeUtil.getTimer()},c.prototype.updateBind=function(){var b=a.TimeUtil.getTimer();if(b-this.flag>=c.waitCdTime){var d=this._bindPosAry.pop(),e=this._bindPosAry.pop();e[0]=this.bindVecter3d.x,e[1]=this.bindVecter3d.y,e[2]=this.bindVecter3d.z;var f=this._bindPosAry[0],g=this._bindPosAry[1],h=new a.Vector3D(e[0]-f[0],e[1]-f[1],e[2]-f[2]);h.normalize(),g[0]=h.x,d[0]=h.x,g[1]=h.y,d[1]=h.y,g[2]=h.z,d[2]=h.z,this._bindPosAry.unshift(d),this._bindPosAry.unshift(e),this.flag=b}},c.waitCdTime=35,c}(a.Display3DParticle);a.Display3DFollowLocusPartilce=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v2TexCoord")},c.prototype.getMat4Str=function(a){return"vcmat["+c.shader_mat4[a]+"]"},c.prototype.getVec4Str=function(a){return"vcmat["+c.shader_vec4[a][0]+"]["+c.shader_vec4[a][1]+"]"},c.getVcSize=function(){return 3},c.prototype.getVertexShaderString=function(){var b="attribute vec3 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 vcmat["+a.Display3DFacetShader.getVcSize()+"];\nuniform vec3 bindpos[30];\nvarying vec2 v0;\n",c="   vec3 cpos = bindpos[int(v3Position.x)];\n   vec3 mulPos = normalize(vec3("+this.getVec4Str("camPos")+".xyz) - cpos);\n   vec3 normals = bindpos[int(v3Position.y)];\n   mulPos = cross(mulPos, normals);\n   mulPos = normalize(mulPos);\n   mulPos *= v3Position.z;\n   cpos += mulPos;\n   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * vec4(cpos,1.0);\n",d="v0 = v2TexCoord;\n",e=b+"void main(){\n"+c+d+"}";return e},c.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return a},c.Display3D_FollowLocus_Shader="Display3DFollowLocusShader",c.shader_mat4={viewMatrix3D:0,camMatrix3D:1},c.shader_vec4={camPos:[2,0]},c}(a.Shader3D);a.Display3DFollowLocusShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getParticle=function(){return new a.Display3DFollowLocusPartilce},c.prototype.setAllByteInfo=function(a){this._fenduanshu=a.readFloat(),b.prototype.setAllByteInfo.call(this,a),this.uploadGpu(),this.initVcData()},c.prototype.uploadGpu=function(){this.objData=new a.ObjData,this.objData.vertices=new Array,this.objData.uvs=new Array,this.objData.indexs=new Array;for(var b=0;b<=this._fenduanshu;b++){var c=new a.Vector2D(b/this._fenduanshu,0),d=new a.Vector2D(b/this._fenduanshu,1);c.scaleBy(.9),d.scaleBy(.9),this._isU&&(c.x=-c.x,d.x=-d.x),this._isV&&(c.y=-c.y,d.y=-d.y);var e=2*b;this.objData.vertices.push(e,e+1,-this._originWidthScale*this._width/100),this._isUV?this.objData.vertices.push(c.y,c.x):this.objData.vertices.push(c.x,c.y),this.objData.vertices.push(e,e+1,(1-this._originWidthScale)*this._width/100),this._isUV?this.objData.vertices.push(d.y,d.x):this.objData.vertices.push(d.x,d.y)}for(b=0;b<this._fenduanshu;b++)this.objData.indexs.push(0+2*b,1+2*b,2+2*b,1+2*b,3+2*b,2+2*b);this.pushToGpu()},c.prototype.pushToGpu=function(){this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.stride=20,this.objData.treNum=this.objData.indexs.length},c.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*a.Display3DFollowLocusShader.getVcSize())},c.prototype.regShader=function(){if(this.materialParam){new a.Display3DFollowLocusShader;this.materialParam.shader=a.ProgrmaManager.getInstance().getMaterialProgram(a.Display3DFollowLocusShader.Display3D_FollowLocus_Shader,a.Display3DFollowLocusShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program}},c}(a.ParticleData);a.ParticleFollowLocusData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"pos"),a.bindAttribLocation(this.program,1,"v2uv"),a.bindAttribLocation(this.program,2,"boneWeight"),a.bindAttribLocation(this.program,3,"boneID")},c.prototype.getMat4Str=function(a){return"vcmat["+c.shader_mat4[a]+"]"},c.getVcSize=function(){return 3},c.prototype.getVertexShaderString=function(){var b="attribute vec3 pos;attribute vec2 v2uv;attribute vec4 boneWeight;attribute vec4 boneID;uniform vec4 boneQ[54];\nuniform vec3 boneD[54];\nuniform mat4 vcmat["+c.getVcSize()+"];\nvarying vec2 v0;\n"+a.MaterialAnimShader.getMd5M44Str()+"void main(void){v0 = v2uv;\nvec4 vt0 = getQDdata(vec3(pos.x,pos.y,pos.z));\n gl_Position = "+this.getMat4Str("viewMatrix3D")+" * "+this.getMat4Str("camMatrix3D")+" *"+this.getMat4Str("posMatrix3D")+"* vt0;}";return b},c.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nvarying vec2 v0;\nvoid main(void)\n{\ngl_FragColor = vec4(1.0,0.0,1.0,1.0);\n}";return a},c.Display3DBoneShader="Display3DBoneShader",c.shader_mat4={viewMatrix3D:0,camMatrix3D:1,posMatrix3D:2},c}(a.Shader3D);a.Display3DBoneShader=b;var c=function(b){function c(){var a=b.call(this)||this;return a.skipNum=0,a}return __extends(c,b),Object.defineProperty(c.prototype,"modeldata",{get:function(){return this.data},enumerable:!0,configurable:!0}),c.prototype.creatData=function(){this.data=new a.ParticleBoneData},c.prototype.update=function(){a.Scene_data.context3D.setWriteDepth(!1),b.prototype.update.call(this)},c.prototype.setVc=function(){var b=float2int(this._time/a.Scene_data.frameTime/2);this.data.vcmatData.set(a.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(a.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,32),a.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData);var c=this.modeldata.animData.boneQPAry[0],d=c.length,e=b%d,f=c[e];a.Scene_data.context3D.setVc4fv(this.data.materialParam.shader,"boneQ",f.quat),a.Scene_data.context3D.setVc3fv(this.data.materialParam.shader,"boneD",f.pos),this.setMaterialVc()},c.prototype.setVa=function(){var b=a.Scene_data.context3D.pushVa(this.modeldata.meshData.vertexBuffer);b||(a.Scene_data.context3D.setVaOffset(0,3,this.modeldata.meshData.stride,0),a.Scene_data.context3D.setVaOffset(1,2,this.modeldata.meshData.stride,12),a.Scene_data.context3D.setVaOffset(3,4,this.modeldata.meshData.stride,20),a.Scene_data.context3D.setVaOffset(2,4,this.modeldata.meshData.stride,36)),this.setMaterialTexture(),a.Scene_data.context3D.drawCall(this.modeldata.meshData.indexBuffer,this.modeldata.meshData.treNum)},c.prototype.resetVa=function(){b.prototype.resetVa.call(this)},c}(a.Display3DParticle);a.Display3DBonePartilce=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.objScale=1,a}return __extends(c,b),c.prototype.getParticle=function(){return new a.Display3DBonePartilce},c.prototype.destory=function(){b.prototype.destory.call(this),this.meshData.destory(),this.animData=null},c.prototype.setAllByteInfo=function(c){this.meshData=new a.MeshData,this.animData=new a.AnimData,this.objScale=c.readFloat();var d=13,e=c.getInt();e*=4*d;var f=new ArrayBuffer(e),g=new DataView(f);a.BaseRes.readBytes2ArrayBuffer(c,g,3,0,d),a.BaseRes.readBytes2ArrayBuffer(c,g,2,3,d),a.BaseRes.readIntForTwoByte(c,this.meshData.indexs),a.BaseRes.readBytes2ArrayBuffer(c,g,4,5,d,2),a.BaseRes.readBytes2ArrayBuffer(c,g,4,9,d,3),this.meshData.stride=4*d,this.readFrameQua(c),b.prototype.setAllByteInfo.call(this,c),this.initVcData(),this.meshData.vertexBuffer=a.Scene_data.context3D.uploadBuff3DArrayBuffer(f),this.meshData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.meshData.indexs),this.meshData.treNum=this.meshData.indexs.length},c.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*a.Display3DBoneShader.getVcSize())},c.prototype.setFloat32Mat=function(b,c){var d=16*a.Display3DBoneShader.shader_mat4[b];this.vcmatData.set(c,d)},c.prototype.readFrameQua=function(b){for(var c=b.readFloat(),d=32767,e=b.readInt(),f=new Array,g=0;e>g;g++){var h=b.readInt(),i=new a.DualQuatFloat32Array;i.quat=new Float32Array(4*h),i.pos=new Float32Array(3*h);for(var j=0;h>j;j++)i.quat[4*j+0]=b.readShort()/d,i.quat[4*j+1]=b.readShort()/d,i.quat[4*j+2]=b.readShort()/d,i.quat[4*j+3]=b.readShort()/d,i.pos[3*j+0]=b.readShort()/d*c,i.pos[3*j+1]=b.readShort()/d*c,i.pos[3*j+2]=b.readShort()/d*c;f.push(i)}this.animData.boneQPAry=new Array,this.animData.boneQPAry.push(f)},c.prototype.uploadGpu=function(){this.uploadMesh(this.meshData)},c.prototype.uploadMesh=function(b){b.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(b.vertices),b.uvBuffer=a.Scene_data.context3D.uploadBuff3D(b.uvs),b.boneIdBuffer=a.Scene_data.context3D.uploadBuff3D(b.boneIDAry),b.boneWeightBuffer=a.Scene_data.context3D.uploadBuff3D(b.boneWeightAry),b.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(b.indexs),b.treNum=b.indexs.length},c.prototype.regShader=function(){this.materialParam.shader=a.ProgrmaManager.getInstance().getMaterialProgram(a.Display3DBoneShader.Display3DBoneShader,a.Display3DBoneShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program},c}(a.ParticleData);a.ParticleBoneData=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a}();a.KeyFrame=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.dataAry=new Array}return b.prototype.destory=function(){this.dataAry=null},b.prototype.setByteData=function(b){for(var c=b.readFloat(),d=0;c>d;d++){var e=b.readFloat(),f=this.addKeyFrame(e);f.frameNum=e,f.baseValue=new Array;for(var g=0;10>g;g++)f.baseValue.push(b.readFloat());var h=b.readFloat();if(f.animData=new Array,h>0)for(var i=0;h>i;i++)f.animData.push(this.getByteDataTemp(b))}this.maxFrameNum=this.dataAry[this.dataAry.length-1].frameNum,this.beginTime=this.dataAry[0].frameNum*a.Scene_data.frameTime},b.prototype.addKeyFrame=function(a){var b=new Object;return b.frameNum=a,this.dataAry.push(b),b},b.prototype.getByteDataTemp=function(b){var c=new Object,d=b.readInt(),e=b.readInt();c.data=new Array,c.dataByte=new Array;for(var f=0;e>f;f++){var g=new Object;if(g.type=b.readInt(),1==g.type){var h=b.readFloat();c.dataByte.push(h)}if(2==g.type){var i=new a.Vector3D;i.x=b.readFloat(),i.y=b.readFloat(),i.z=b.readFloat(),c.dataByte.push(i)}}return c.type=d,c},b}();a.TimeLineData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._time=0,a.targetFlag=-1,a.beginTime=0,a.isByteData=!1,a.targetFlag=-1,a.visible=!1,a.maxFrameNum=0,a._time=0,a._keyFrameAry=new Array,a}return __extends(c,b),c.prototype.updateMatrix=function(b,c){this._axisMove&&b.prependTranslation(this._axisMove.axis.x*this._axisMove.num,this._axisMove.axis.y*this._axisMove.num,this._axisMove.axis.z*this._axisMove.num),this._axisRotaion&&b.prependRotation(this._axisRotaion.num,this._axisRotaion.axis),b.prependTranslation(c.data.center.x,c.data.center.y,c.data.center.z),this._scaleChange?b.prependScale(c.data._widthFixed?1:this._scaleChange.num,c.data._heightFixed?1:this._scaleChange.num,c.data._widthFixed?1:this._scaleChange.num):this._scaleNosie?b.prependScale(c.data._widthFixed?1:1+this._scaleNosie.num,c.data._heightFixed?1:1+this._scaleNosie.num,c.data._widthFixed?1:1+this._scaleNosie.num):this._scaleAnim&&b.prependScale(c.data._widthFixed?1:this._scaleAnim.num,c.data._heightFixed?1:this._scaleAnim.num,c.data._widthFixed?1:this._scaleAnim.num),b.prependRotation(c.data.rotationV3d.z,a.Vector3D.Z_AXIS),b.prependRotation(c.data.rotationV3d.y,a.Vector3D.Y_AXIS),b.prependRotation(c.data.rotationV3d.x,a.Vector3D.X_AXIS)},c.prototype.inverAxisRotation=function(a){this._axisRotaion&&a.prependRotation(-this._axisRotaion.num,this._axisRotaion.axis)},c.prototype.applySelfRotation=function(a,b){this._selfRotaion&&a.prependRotation(this._selfRotaion.num,b)},c.prototype.addKeyFrame=function(b){var c=new a.KeyFrame;return c.frameNum=b,this._keyFrameAry.push(c),c},c.prototype.updateTime=function(a){this._currentKeyFrame&&(this._time=a,this.getTarget(),this._axisRotaion&&this._axisRotaion.update(this._time),this._selfRotaion&&this._selfRotaion.update(this._time),this._axisMove&&this._axisMove.update(this._time),this._scaleChange?this._scaleChange.update(this._time):this._scaleNosie?this._scaleNosie.update(this._time):this._scaleAnim&&this._scaleAnim.update(this._time))},c.prototype.getTarget=function(){for(var b=-1,c=0;c<this._keyFrameAry.length&&this._keyFrameAry[c].frameNum*a.Scene_data.frameTime<this._time;c++)b=c;b!=this.targetFlag&&(this._currentKeyFrame=this._keyFrameAry[b],this.targetFlag=b,b>=this._keyFrameAry.length-1||!this._currentKeyFrame?(this.visible=!1,this._currentKeyFrame=null):(this.visible=!0,this.enterKeyFrame(this._currentKeyFrame.animData,this._currentKeyFrame.frameNum*a.Scene_data.frameTime,this._currentKeyFrame.baseValue)))},c.prototype.enterKeyFrame=function(b,c,d){if(void 0===c&&(c=0),void 0===d&&(d=null),null!=d){for(var e=0;10>e;e++)if(d[e])switch(e){case 1:this._selfRotaion||(this._selfRotaion=new a.SelfRotation),this._selfRotaion.num=this._selfRotaion.baseNum=d[e];break;case 2:this._axisRotaion||(this._axisRotaion=new a.AxisRotaion),this._axisRotaion.num=this._axisRotaion.baseNum=d[e];break;case 6:this._scaleChange||(this._scaleChange=new a.ScaleChange),this._scaleChange.num=this._scaleChange.baseNum=d[e];break;case 7:this._scaleAnim||(this._scaleAnim=new a.ScaleAnim),this._scaleAnim.num=this._scaleAnim.baseNum=d[e];break;case 8:this._scaleNosie||(this._scaleNosie=new a.ScaleNoise),this._scaleNosie.num=this._scaleNosie.baseNum=d[e];break;case 9:this._axisMove||(this._axisMove=new a.AxisMove),this._axisMove.num=this._axisMove.baseNum=d[e]}this._selfRotaion&&(this._selfRotaion.isDeath=!0),this._axisRotaion&&(this._axisRotaion.isDeath=!0),this._scaleChange&&(this._scaleChange.isDeath=!0),this._scaleAnim&&(this._scaleAnim.isDeath=!0),this._scaleNosie&&(this._scaleNosie.isDeath=!0),this._axisMove&&(this._axisMove.isDeath=!0),b&&this.setBaseTimeByte(b,c,d)}},c.prototype.reset=function(){this._time=0,this._currentKeyFrame=this._keyFrameAry[0],this.visible=!1,this.targetFlag=-1},c.prototype.setAllByteInfo=function(b,c){this.isByteData=!0;for(var d=b.readFloat(),e=0;d>e;e++){var f=b.readFloat(),g=this.addKeyFrame(f);g.frameNum=f,g.baseValue=new Array;for(var h=0;10>h;h++)g.baseValue.push(b.readFloat());var i=b.readFloat();if(g.animData=new Array,i>0)for(var j=0;i>j;j++)g.animData.push(this.getByteDataTemp(b))}this.maxFrameNum=this._keyFrameAry[this._keyFrameAry.length-1].frameNum,this.beginTime=this._keyFrameAry[0].frameNum*a.Scene_data.frameTime,this._currentKeyFrame=this._keyFrameAry[0]},c.prototype.setAllDataInfo=function(a){this.isByteData=!0;for(var b=a.dataAry.length,c=0;b>c;c++){var d=this.addKeyFrame(a.dataAry[c].frameNum);d.baseValue=a.dataAry[c].baseValue,d.animData=a.dataAry[c].animData}this.maxFrameNum=a.maxFrameNum,this.beginTime=a.beginTime,this._currentKeyFrame=this._keyFrameAry[0]},c.prototype.setBaseTimeByte=function(b,c,d){void 0===c&&(c=0),void 0===d&&(d=null);for(var e=0;e<b.length;e++)1==b[e].type?(this._selfRotaion?this._selfRotaion.reset():this._selfRotaion=new a.SelfRotation,this._selfRotaion.dataByte(b[e].data,b[e].dataByte),this._selfRotaion.baseTime=c):2==b[e].type?(this._axisRotaion?this._axisRotaion.reset():this._axisRotaion=new a.AxisRotaion,this._axisRotaion.dataByte(b[e].data,b[e].dataByte),this._axisRotaion.baseTime=c):6==b[e].type?(this._scaleChange?this._scaleChange.reset():this._scaleChange=new a.ScaleChange,this._scaleChange.dataByte(b[e].data,b[e].dataByte),this._scaleChange.baseTime=c):7==b[e].type?(this._scaleAnim?this._scaleAnim.reset():this._scaleAnim=new a.ScaleAnim,this._scaleAnim.dataByte(b[e].data,b[e].dataByte),this._scaleAnim.baseTime=c):8==b[e].type?(this._scaleNosie?this._scaleNosie.reset():this._scaleNosie=new a.ScaleNoise,this._scaleNosie.dataByte(b[e].data,b[e].dataByte),this._scaleNosie.baseTime=c):9==b[e].type&&(this._axisMove?this._axisMove.reset():this._axisMove=new a.AxisMove,this._axisMove.dataByte(b[e].data,b[e].dataByte),this._axisMove.baseTime=c)},c.prototype.getByteDataTemp=function(b){var c=new Object,d=b.readInt(),e=b.readInt();c.data=new Array,c.dataByte=new Array;for(var f=0;e>f;f++){var g=new Object;if(g.type=b.readInt(),1==g.type){var h=b.readFloat();c.dataByte.push(h)}if(2==g.type){var i=new a.Vector3D;i.x=b.readFloat(),i.y=b.readFloat(),i.z=b.readFloat(),c.dataByte.push(i)}}return c.type=d,c},c.prototype.getMaxFrame=function(){return this._keyFrameAry[this._keyFrameAry.length-1].frameNum},c.prototype.dispose=function(){},c}(a.EventDispatcher);a.TimeLine=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this.baseNum=0,this.num=0,this.time=0,this.speed=0,this.aSpeed=0,this.beginTime=0,this.lastTime=0,this.baseTime=0}return a.prototype.BaseAnim=function(){},a.prototype.update=function(a){
this._isDeath||(this.time=a-this.baseTime,this._isActiva?(this.time=this.time-this.beginTime,this.time>this.lastTime&&(this.time=this.lastTime-this.beginTime,this._isDeath=!0),this.coreCalculate()):this.time>=this.beginTime&&(this.time>=this.lastTime?(this.time=this.lastTime-this.beginTime,this.coreCalculate(),this._isDeath=!0):(this.time=this.time-this.beginTime,this.coreCalculate()),this._isActiva=!0))},a.prototype.coreCalculate=function(){this.num=this.speed*this.time+this.aSpeed*this.time*this.time+this.baseNum},a.prototype.reset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.num=0},a.prototype.depthReset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.baseNum=0,this.num=0},Object.defineProperty(a.prototype,"data",{set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isDeath",{get:function(){return this._isDeath},set:function(a){this._isDeath=a},enumerable:!0,configurable:!0}),a.prototype.getAllNum=function(a){a=Math.min(a,this.lastTime),a-=this.beginTime;var b=this.speed*a+this.aSpeed*a*a;this.baseNum+=b},a}();a.BaseAnim=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),Object.defineProperty(c.prototype,"data",{set:function(b){this.beginTime=Number(b[0].value),-1==Number(b[1].value)?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=Number(b[1].value);var c=b[2].value.split("|");this.axis=new a.Vector3D(Number(c[0]),Number(c[1]),Number(c[2])),this.axis.normalize(),this.speed=.1*Number(b[3].value),this.aSpeed=.001*Number(b[4].value)},enumerable:!0,configurable:!0}),c.prototype.dataByte=function(b,c){this.beginTime=c[0],-1==c[1]?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=c[1],this.axis=c[2],this.axis.normalize(),this.speed=.1*c[3],this.aSpeed=.001*c[4]},c}(a.BaseAnim);a.AxisMove=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),Object.defineProperty(c.prototype,"data",{set:function(b){this.beginTime=Number(b[0].value),-1==Number(b[1].value)?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=Number(b[1].value);var c=String(b[2].value).split("|");this.axis=new a.Vector3D(Number(c[0]),Number(c[1]),Number(c[2])),c=String(b[3].value).split("|"),this.axisPos=new a.Vector3D(100*Number(c[0]),100*Number(c[1]),100*Number(c[2])),this.speed=.1*Number(b[4].value),this.aSpeed=.1*Number(b[5].value)},enumerable:!0,configurable:!0}),c.prototype.dataByte=function(b,c){this.beginTime=Number(c[0]),-1==Number(c[1])?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=Number(c[1]),this.axis=c[2],this.axisPos=c[3],this.speed=.1*c[4],this.aSpeed=.1*c[5]},c}(a.BaseAnim);a.AxisRotaion=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.num=1,a}return __extends(c,b),c.prototype.update=function(a){this._isDeath||(this.time=a-this.baseTime,this._isActiva?(this.coreCalculate(),this.time>this.lastTime&&(this._isDeath=!0)):this.time>=this.beginTime&&(this._isActiva=!0))},c.prototype.coreCalculate=function(){var b=float2int(this.time/a.Scene_data.frameTime);b>=this.numAry.length?this.num=this.numAry[this.numAry.length-1]:this.num=this.numAry[b]},c.prototype.reset=function(){b.prototype.reset.call(this),this.num=1},c.prototype.depthReset=function(){b.prototype.depthReset.call(this),this.num=1},Object.defineProperty(c.prototype,"data",{set:function(b){this.numAry=new Array,this.beginTime=Number(b[0].value),-1==Number(b[1].value)?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=Number(b[1].value),this.beginScale=Number(b[2].value),this.scaleNum=Number(b[3].value),this.scaleAry=new Array;for(var c=0,d=4;d<4+2*this.scaleNum;d+=2){var e=new Object;e.value=Number(b[d].value),e.time=Number(b[d+1].value),c+=e.time,e.beginTime=this.beginTime+c,this.scaleAry.push(e)}var f,g=0,h=1;this.scaleAry.length?(f=(this.scaleAry[this.scaleAry.length-1].beginTime+this.scaleAry[this.scaleAry.length-1].time)/a.Scene_data.frameTime,h=this.scaleAry[0].beginTime,this._currentTarget=this.scaleAry[0]):f=0;var i=0;for(d=0;f>d;d++){var j=a.Scene_data.frameTime*d;j>=this._currentTarget.beginTime&&(this.beginScale=this._currentTarget.value,g=this._currentTarget.beginTime,i==this.scaleAry.length-1?this._currentTarget=this.scaleAry[this.scaleAry.length-1]:(i++,this._currentTarget=this.scaleAry[i]),h=this._currentTarget.time);var k=(j-g)/h*(this._currentTarget.value-this.beginScale)+this.beginScale;this.numAry.push(k)}this._currentTarget=this.scaleAry[0]},enumerable:!0,configurable:!0}),c.prototype.dataByte=function(b,c){this.numAry=new Array,this.beginTime=c[0],-1==c[1]?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=c[1],this.beginScale=c[2],this.scaleNum=c[3],this.scaleAry=new Array;for(var d=0,e=4;e<4+2*this.scaleNum;e+=2){var f=new Object;f.value=c[e],f.time=c[e+1],d+=f.time,f.beginTime=this.beginTime+d,this.scaleAry.push(f)}var g,h=0,i=1;this.scaleAry.length?(g=(this.scaleAry[this.scaleAry.length-1].beginTime+this.scaleAry[this.scaleAry.length-1].time)/a.Scene_data.frameTime,i=this.scaleAry[0].beginTime,this._currentTarget=this.scaleAry[0]):g=0;var j=0;for(e=0;g>e;e++){var k=a.Scene_data.frameTime*e;k>=this._currentTarget.beginTime&&(this.beginScale=this._currentTarget.value,h=this._currentTarget.beginTime,j==this.scaleAry.length-1?this._currentTarget=this.scaleAry[this.scaleAry.length-1]:(j++,this._currentTarget=this.scaleAry[j]),i=this._currentTarget.time);var l=(k-h)/i*(this._currentTarget.value-this.beginScale)+this.beginScale;this.numAry.push(l)}this._currentTarget=this.scaleAry[0]},c.prototype.getAllNum=function(a){a=Math.min(a,this.lastTime+this.beginTime);var b=this.scaleAry[this.scaleAry.length-1];if(a>=b.beginTime+b.time)return void(this.baseNum=b.value);for(var c,d=0;d<this.scaleAry.length;d++)a>this.scaleAry[d]["this"].beginTime&&(this._currentTarget=this.scaleAry[d],this.beginTime=this._currentTarget["this"].beginTime,this.beginScale=this._currentTarget.value,c=d);c++,this._currentTarget=this.scaleAry[c],this.baseNum=(this._currentTarget.value-this.beginScale)/this._currentTarget["this"].time*(a-this.beginTime)+this.beginScale},c}(a.BaseAnim);a.ScaleAnim=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.num=1,a}return __extends(c,b),c.prototype.coreCalculate=function(){this.num=1+this.speed*this.time+this.baseNum,this.num<this.minNum?this.num=this.minNum:this.num>this.maxNum&&(this.num=this.maxNum)},Object.defineProperty(c.prototype,"data",{set:function(b){this.beginTime=Number(b[0].value),-1==Number(b[1].value)?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=Number(b[1].value),this.speed=.001*Number(b[2].value),this.minNum=.01*Number(b[3].value),this.maxNum=.01*Number(b[4].value)},enumerable:!0,configurable:!0}),c.prototype.dataByte=function(b,c){this.beginTime=c[0],-1==c[1]?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=c[1],this.speed=.001*c[2],this.minNum=.01*c[3],this.maxNum=.01*c[4]},c.prototype.getAllNum=function(a){a=Math.min(a,this.lastTime),a-=this.beginTime;var b=this.speed*a;this.baseNum+=b,this.baseNum<this.minNum?this.baseNum=this.minNum:b>this.maxNum&&(this.baseNum=this.maxNum)},c.prototype.reset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.num=1},c.prototype.depthReset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.baseNum=0,this.num=1},c}(a.BaseAnim);a.ScaleChange=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.coreCalculate=function(){this.num=this.amplitude+this.amplitude*Math.sin(this.speed*this.time)},Object.defineProperty(c.prototype,"data",{set:function(b){this.beginTime=Number(b[0].value),-1==Number(b[1].value)?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=Number(b[1].value),this.amplitude=Number(b[2].value),this.speed=.01*Number(b[3].value)},enumerable:!0,configurable:!0}),c.prototype.dataByte=function(b,c){this.beginTime=c[0],-1==c[1]?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=c[1],this.amplitude=c[2],this.speed=.01*c[3]},c.prototype.getAllNum=function(a){this.baseNum=this.amplitude+this.amplitude*Math.sin(this.speed*a)},c}(a.BaseAnim);a.ScaleNoise=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),Object.defineProperty(c.prototype,"data",{set:function(b){this.beginTime=Number(b[0].value),-1==Number(b[1].value)?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=Number(b[1].value),this.speed=.1*Number(b[2].value),this.aSpeed=.1*Number(b[3].value)},enumerable:!0,configurable:!0}),c.prototype.dataByte=function(b,c){this.beginTime=c[0],-1==c[1]?this.lastTime=a.Scene_data.MAX_NUMBER:this.lastTime=c[1],this.speed=.1*c[2],this.aSpeed=.1*c[3]},c}(a.BaseAnim);a.SelfRotation=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.Down="down",b.Up="Up",b.Move="Move",b.PinchStart="PinchStart",b.Pinch="Pinch",b}(a.BaseEvent);a.InteractiveEvent=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.LEFT="left",a.CENTER="center",a.RIGHT="right",a.TOP="top",a.MIDDLE="middle",a.BOTTOM="bottom",a}();a.TextAlign=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._hasDispose=!1}return Object.defineProperty(b.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),b.prototype.setInfo=function(b,c,d,e){var f=this;void 0===e&&(e=null),this._useImgUrl=e,a.LoadManager.getInstance().load(a.Scene_data.fileuiRoot+b,a.LoadManager.XML_TYPE,function(a){var b=JSON.parse(a);f.configData=b.uiArr,f.layoutData=b.panelArr,f.loadImgUrl(c,d)})},b.prototype.loadConfig=function(b,c){var d=this;a.LoadManager.getInstance().load(a.Scene_data.fileuiRoot+b,a.LoadManager.XML_TYPE,function(a){var b=JSON.parse(a);d.configData=b.uiArr,c()})},b.prototype.loadImgUrl=function(b,c){var d=this;a.TextureManager.getInstance().getTexture(a.Scene_data.fileuiRoot+b,function(a){d.textureRes=a,d._useImgUrl?d.loadUseImg(c):c()},1,null,0)},b.prototype.loadUseImg=function(b){this.useImg=makeImage(),this.useImg.onload=function(){b()},this.useImg.src=a.Scene_data.fileRoot+this._useImgUrl},b.prototype.getRec=function(b){for(var c=new a.UIRectangle,d=0;d<this.configData.length;d++)if(this.configData[d].name==b){c.x=this.configData[d].x,c.y=this.configData[d].y,c.width=this.configData[d].width,c.height=this.configData[d].height,c.pixelWitdh=this.configData[d].ow,c.pixelHeight=this.configData[d].oh,c.pixelX=this.configData[d].ox,c.pixelY=this.configData[d].oy,c.type=this.configData[d].type,c.cellX=this.configData[d].cellX,c.cellY=this.configData[d].cellY;break}return c},b.prototype.getLayoutData=function(a){if(!this.layoutData)return null;for(var b in this.layoutData)for(var c=this.layoutData[b].item,d=0;d<c.length;d++)if(c[d].name==a)return c[d]},b.prototype.getGridRec=function(b){for(var c=new a.UIGridRentangle,d=0;d<this.configData.length;d++)if(this.configData[d].name==b){c.x=this.configData[d].x,c.y=this.configData[d].y,c.width=this.configData[d].width,c.height=this.configData[d].height,c.pixelWitdh=this.configData[d].ow,c.pixelHeight=this.configData[d].oh,c.pixelX=this.configData[d].ox,c.pixelY=this.configData[d].oy,c.ogw=this.configData[d].uow,c.ogh=this.configData[d].uoh;break}return c},Object.defineProperty(b.prototype,"hasData",{get:function(){return this.configData},enumerable:!0,configurable:!0}),b.prototype.getObject=function(a,b,c,d,e,f,g,h,i){void 0===h&&(h=0),void 0===i&&(i=0);var j=new Object;return j.x=b/f,j.y=c/g,j.width=d/f,j.height=e/g,j.ow=d,j.oh=e,j.ox=b,j.oy=c,j.name=a,j.cellX=h,j.cellY=i,j},b.prototype.updateCtx=function(b,c,d){a.TextureManager.getInstance().updateTexture(this.texture,c,d,b)},b.prototype.upDataPicToTexture=function(b,c){var d=this;a.LoadManager.getInstance().load(a.Scene_data.fileRoot+b,a.LoadManager.IMG_TYPE,function(b){var e=d.getRec(c);d.ctx=a.UIManager.getInstance().getContext2D(e.pixelWitdh,e.pixelHeight,!1),d.ctx.drawImage(b,0,0,e.pixelWitdh,e.pixelHeight),a.TextureManager.getInstance().updateTexture(d.texture,e.pixelX,e.pixelY,d.ctx)})},b.prototype.upDataWebPicToTexture=function(b,c){var d=this;a.LoadManager.getInstance().load(b,a.LoadManager.IMG_TYPE,function(b){var e=d.getRec(c);d.ctx=a.UIManager.getInstance().getContext2D(e.pixelWitdh,e.pixelHeight,!1),d.ctx.drawImage(b,0,0,e.pixelWitdh,e.pixelHeight),a.TextureManager.getInstance().updateTexture(d.texture,e.pixelX,e.pixelY,d.ctx)})},b.prototype.clearCtxTextureBySkilname=function(b){var c=this.getRec(b);this.ctx=a.UIManager.getInstance().getContext2D(c.pixelWitdh,c.pixelHeight,!1),this.ctx.clearRect(0,0,c.pixelWitdh,c.pixelHeight),a.TextureManager.getInstance().updateTexture(this.texture,c.pixelX,c.pixelY,this.ctx)},b.prototype.copyPicToTexture=function(b,c){var d=this.getRec(b),e=this.getRec(c);this.ctx=a.UIManager.getInstance().getContext2D(e.pixelWitdh,e.pixelHeight,!1),this.ctx.drawImage(this.useImg,d.pixelX,d.pixelY,d.pixelWitdh,d.pixelWitdh,0,0,e.pixelWitdh,e.pixelWitdh),a.TextureManager.getInstance().updateTexture(this.texture,e.pixelX,e.pixelY,this.ctx)},b.prototype.updateLable=function(b,c,d,e,f,g,h,i){void 0===f&&(f=a.TextAlign.MIDDLE),void 0===g&&(g=a.TextAlign.CENTER),void 0===h&&(h=!1),void 0===i&&(i=0);var j=this.getRec(b);this.ctx=this.getTextCtx(j,d,e,h,f,g);var k=this.getTextxpos(g,this.ctx),l=this.getTextypos(f,this.ctx);i>0?this.wrapText(this.ctx,c,k,l,i,d+3):this.ctx.fillText(c,k,l),a.TextureManager.getInstance().updateTexture(this.texture,j.pixelX,j.pixelY,this.ctx)},b.prototype.updateArtNum=function(b,c,d){var e=String(d),f=this.getRec(b),g=this.getRec(c);this.ctx=a.UIManager.getInstance().getContext2D(f.pixelWitdh,f.pixelHeight,!1);for(var h=g.pixelWitdh/10,i=0;i<e.length;i++){var j=Number(e.charAt(i));this.ctx.drawImage(this.useImg,g.pixelX+j*h,g.pixelY,h,g.pixelHeight,i*h,0,h,g.pixelHeight)}a.TextureManager.getInstance().updateTexture(this.texture,f.pixelX,f.pixelY,this.ctx)},b.prototype.writeSingleLabel=function(b,c,d,e,f){void 0===d&&(d=12),void 0===e&&(e=a.TextAlign.CENTER),void 0===f&&(f="#ffffff"),a.LabelTextFont.writeSingleLabel(this,b,c,d,e,f)},b.prototype.writeSingleLabelToCxt=function(b,c,d,e,f){void 0===d&&(d=12),void 0===e&&(e=0),void 0===f&&(f=0),b.textBaseline=a.TextAlign.TOP,b.textAlign=a.TextAlign.LEFT,b.font="bolder  "+d+"px "+a.UIData.font,a.TextRegExp.wrapText(b,c,"#ffffff",e,f,9999,20)},b.prototype.updateLableCtx=function(b,c,d,e,f,g,h,i,j,k){void 0===g&&(g=a.TextAlign.CENTER),void 0===h&&(h=a.TextAlign.MIDDLE),void 0===i&&(i="#000000"),void 0===j&&(j="bolder"),void 0===k&&(k=0),b.textAlign=g,b.textBaseline=h,b.fillStyle=i,b.font=j+" "+f+"px "+a.UIData.font;var l=this.getTextxpos(g,b);k>0?this.wrapText(b,c,d,e,k,f+3):b.fillText(c,d+l,e)},b.prototype.getTextCtx=function(b,c,d,e,f,g){var h=a.UIManager.getInstance().getContext2D(b.pixelWitdh,b.pixelHeight,!1);return h.textBaseline=f,h.textAlign=g,h.fillStyle=d,h.font=(e?"bolder ":"")+" "+c+"px "+a.UIData.font,h},b.prototype.getTextxpos=function(b,c){var d=0;return b==a.TextAlign.LEFT?d=0:b==a.TextAlign.RIGHT?d=c.canvas.width:b==a.TextAlign.CENTER&&(d=c.canvas.width/2),d},b.prototype.getTextypos=function(b,c){var d=0;return b==a.TextAlign.BOTTOM?d=c.canvas.height:b==a.TextAlign.TOP?d=0:b==a.TextAlign.MIDDLE&&(d=c.canvas.height/2),d},b.prototype.wrapText=function(a,b,c,d,e,f){for(var g=b,h="",i=0;i<g.length;i++)if("\n"==g[i])a.fillText(h,c,d),h="",d+=f;else{var j=h+g[i]+" ",k=a.measureText(j),l=k.width;l>e?(a.fillText(h,c,d),h=g[i]+"",d+=f):h=j}a.fillText(h,c,d)},b.prototype.dispose=function(){this._hasDispose||(this.textureRes.clearUseNum(),this.configData=null,this.layoutData=null,this.useImg=null,this._hasDispose=!0)},b}();a.UIAtlas=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.pixelWitdh=1,b.pixelHeight=1,b.pixelX=0,b.pixelY=0,b.cellX=0,b.cellY=0,b.type=0,b}return __extends(b,a),b}(a.Rectangle);a.UIRectangle=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.ogw=0,b.ogh=0,b}return __extends(b,a),b}(a.UIRectangle);a.UIGridRentangle=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._x=0,c._y=0,c._width=0,c._height=0,c.z=0,c.absoluteX=0,c.absoluteY=0,c.absoluteWidth=0,c.absoluteHeight=0,c.enable=!0,c._left=0,c._right=0,c._center=0,c._xType=-1,c._top=0,c._bottom=0,c._middle=0,c._yType=-1,c.renderX=0,c.renderY=0,c.renderWidth=0,c.renderHeight=0,c.scale=1,c.isVirtual=!1,c.vcId=0,c._uvScale=1,c._rendering=!1,c.isU=!1,c.isV=!1,c.tr=new a.Rectangle,c.mouseEnable=!0,c}return __extends(c,b),Object.defineProperty(c.prototype,"rendering",{get:function(){return this._rendering},set:function(a){this._rendering=a},enumerable:!0,configurable:!0}),c.prototype.addStage=function(){this.renderData=[0,0,0,0],this.renderData2=[1,1,0,0],this.applyAbsolutePoint(),this.uiRender.addRenderUI(this)},c.prototype.removeStage=function(){this.uiRender.removeRenderUI(this)},c.prototype.pushVaData=function(a,b,c){return a.vertices.push(0,0,0,1,0,0,1,-1,0,0,-1,0),a.uvs.push(this.isU?1:0,this.isV?1:0,b,this.isU?0:1,this.isV?1:0,b,this.isU?0:1,this.isV?0:1,b,this.isU?1:0,this.isV?0:1,b),a.indexs.push(c,1+c,2+c,c,2+c,3+c),c+4},c.prototype.setVc=function(b,c){a.Scene_data.context3D.setVc4fv(b,"ui["+c+"]",this.renderData),a.Scene_data.context3D.setVc4fv(b,"ui2["+c+"]",this.renderData2)},c.prototype.update=function(){},c.prototype.applyRenderSize=function(){if(this.parent){if(this.renderX=this.absoluteX/a.Scene_data.stageWidth,this.renderY=this.absoluteY/a.Scene_data.stageHeight,this.renderWidth=this.absoluteWidth/a.Scene_data.stageWidth,this.renderHeight=this.absoluteHeight/a.Scene_data.stageHeight,this._uvScale>=0)this.renderData[0]=this.renderX,this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth*this.scale*this._uvScale,this.renderData[3]=this.renderHeight*this.scale,this.renderData2[0]=this.tr.width*this._uvScale,this.renderData2[1]=this.tr.height,this.renderData2[2]=this.tr.x,this.renderData2[3]=this.tr.y;else{var b=Math.abs(this._uvScale);this.renderData[0]=this.renderX+this.renderWidth*(1-b),this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth*this.scale*b,this.renderData[3]=this.renderHeight*this.scale,this.renderData2[0]=this.tr.width*b,this.renderData2[1]=this.tr.height,this.renderData2[2]=this.tr.x+this.tr.width*(1-b),this.renderData2[3]=this.tr.y}this.uiRender.makeRenderDataVc(this.vcId)}},Object.defineProperty(c.prototype,"uvScale",{get:function(){return this._uvScale},set:function(a){this._uvScale=a,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),c.prototype.setScale=function(a){this.scale=a,this.applyAbsolutePoint()},c.prototype.applyAbsolutePoint=function(){if(this.parent){var b=a.UIData.Scale*this.parent.uiScale;-1==this._xType?this.absoluteX=this._x*b*this.scale+this.parent.x:0==this._xType?this.absoluteX=this._left*b:1==this._xType?this.absoluteX=a.Scene_data.stageWidth-this._right*b-this.width*b:2==this._xType&&(this.absoluteX=this._center*b+a.Scene_data.stageWidth/2-this.width*b/2),-1==this._yType?this.absoluteY=this._y*b*this.scale+this.parent.y:0==this._yType?this.absoluteY=this._top*b:1==this._yType?this.absoluteY=a.Scene_data.stageHeight-this._bottom*b-this.height*b:2==this._yType&&(this.absoluteY=this._middle*b+a.Scene_data.stageHeight/2-this.height*b/2),this.absoluteWidth=this.width*b,this.absoluteHeight=this.height*b,this.applyRenderSize()}},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){a!=this._x&&(this._x=a,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){a!=this._y&&(this._y=a,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){return this._width},set:function(a){a!=this._width&&(this._width=a,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(a){a!=this._height&&(this._height=a,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"left",{set:function(a){this._left=a,this._xType=0,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"right",{set:function(a){this._right=a,this._xType=1,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"center",{set:function(a){this._center=a,this._xType=2,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"top",{set:function(a){this._top=a,this._yType=0,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bottom",{set:function(a){this._bottom=a,this._yType=1,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"middle",{set:function(a){this._middle=a,this._yType=2,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),c.prototype.testPoint=function(a,b){return a>this.absoluteX&&a<this.absoluteX+this.absoluteWidth&&b>this.absoluteY&&b<this.absoluteY+this.absoluteHeight?!0:!1},c.prototype.setPos=function(a,b){this.x=a,this.y=b},c.prototype.interactiveEvent=function(a){if(!this.enable)return!1;var b=(a.type,this._eventsMap);if(!b)return!1;var c=b[a.type];if(!c)return!1;if(!this.testPoint(a.x,a.y))return!1;var d=c.length;if(0==d)return!1;a.target=this;for(var e=d-1;e>=0;e--){var f=c[e];f.listener.call(f.thisObject,a)}return!0},c.prototype.preShow=function(){this.preParent&&this.preParent.addChild(this)},c.prototype.preHide=function(){this.preParent&&this.preParent.removeChild(this)},c}(a.EventDispatcher);a.UICompenent=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(){function b(){this._x=0,this._y=0,this._width=0,this._height=0,this._left=0,this._right=0,this._center=0,this._xType=0,this._top=0,this._bottom=0,this._middle=0,this._yType=0,this._list=new Array,this.renderList=new Array,this._hasStage=!1,this._hasLoad=!1,this._isLoading=!1,this._needShowLoading=!0,this._interfaceUI=!1,this._layer=100,this._uiScale=1}return Object.defineProperty(b.prototype,"uiScale",{get:function(){return this._uiScale},set:function(a){this._uiScale=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"layer",{get:function(){return this._layer},set:function(a){this._layer=a;for(var b=0;b<this.renderList.length;b++)this.renderList[b].sortnum=this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"interfaceUI",{get:function(){return this._interfaceUI},set:function(a){this._interfaceUI=a,a?this.layer=0:this.layer=100},enumerable:!0,configurable:!0}),b.prototype.load=function(b,c){void 0===c&&(c=!0),this._isLoading||(this._completeFun=b,this._needShowLoading=c,this._hasLoad?b():(this._isLoading=!0,this._needShowLoading&&a.UILoading.getInstance().show(),this.makeBaseWinUi()))},Object.defineProperty(b.prototype,"hasLoad",{get:function(){return this._hasLoad},enumerable:!0,configurable:!0}),b.prototype.makeBaseWinUi=function(){this.applyLoad()},b.prototype.applyLoad=function(){},b.prototype.applyLoadComplete=function(){this._isLoading=!1,this._completeFun(),this._needShowLoading&&a.UILoading.getInstance().hide(),this._hasLoad=!0},Object.defineProperty(b.prototype,"hasStage",{get:function(){return this._hasStage},set:function(a){this._hasStage=a,a?this.onAdd():this.onRemove()},enumerable:!0,configurable:!0}),b.prototype.setUiListVisibleByItem=function(a,b){try{for(var c=0;c<a.length;c++)b?a[c].parent||this.addChild(a[c]):a[c].parent&&this.removeChild(a[c])}catch(d){}},b.prototype.onAdd=function(){},b.prototype.onRemove=function(){},b.prototype.addChild=function(a){if(!a)throw new Error("ui cuo");if(!a.parent)return this._list.push(a),a.parent=this,a.addStage(),a},b.prototype.addVirtualContainer=function(a){this.virtualContainerList||(this.virtualContainerList=new Array),a.parent=this,this.virtualContainerList.push(a)},b.prototype.removeVirtualContainer=function(a){},b.prototype.addUIList=function(a,b){for(var c=new Array,d=0;d<a.length;d++){var e=b.getComponent(a[d]);this.addChild(e),c.push(e)}return c},b.prototype.getUIList=function(a,b){for(var c=new Array,d=0;d<a.length;d++){var e=b.getComponent(a[d]);c.push(e)}return c},b.prototype.addEvntBut=function(b,c){var d=this.addChild(c.getComponent(b));return d.addEventListener(a.InteractiveEvent.Down,this.butClik,this),d},b.prototype.addEvntButUp=function(b,c){var d=this.addChild(c.getComponent(b));return d.addEventListener(a.InteractiveEvent.Up,this.butClik,this),d},b.prototype.removeEvntBut=function(b){b.removeEventListener(a.InteractiveEvent.Down,this.butClik,this),this.removeChild(b)},b.prototype.butClik=function(a){},b.prototype.renderSetVisibel=function(a,b){for(var c=0;c<a.length;c++)b?a[c].rendering||this.addRender(a[c]):a[c].rendering&&this.removeRender(a[c])},b.prototype.removeChild=function(a){var b=this._list.indexOf(a);-1!=b&&(this._list.splice(b,1),a.parent=null,a.removeStage())},b.prototype.removeAll=function(){for(;this._list.length;)this.removeChild(this._list[0]);for(;this._maskList.length;)this.removeMaks(this._maskList[0])},b.prototype.addMask=function(a){this._maskList||(this._maskList=new Array),a.parent=this,a.applyAbsolutePoint(),this._maskList.push(a)},b.prototype.removeMaks=function(a){if(this._maskList){var b=this._maskList.indexOf(a);-1!=b&&this._maskList.splice(b,1)}},b.prototype.addRender=function(a){var b=this.renderList.indexOf(a);-1==b&&(a.container=this,a.sortnum=this._layer,this.renderList.push(a),this.hasStage&&this.perent.addUI(a))},b.prototype.addRenderAt=function(b,c){var d=this.renderList.indexOf(b);-1==d&&(b.container=this,b.sortnum=this._layer,this.renderList.splice(c,0,b),this.hasStage&&a.UIManager.getInstance().addUI(b))},b.prototype.removeRender=function(b){var c=this.renderList.indexOf(b);-1!=c&&(this.renderList.splice(c,1),this.hasStage&&a.UIManager.getInstance().removeUI(b))},Object.defineProperty(b.prototype,"panelScale",{get:function(){return this.uiScale*a.UIData.Scale},enumerable:!0,configurable:!0}),b.prototype.resize=function(){0==this._xType?this._x=this._left*this.panelScale:1==this._xType?this._x=a.Scene_data.stageWidth-this._right*this.panelScale-this.width*this.panelScale:2==this._xType&&(this._x=this._center*this.panelScale+a.Scene_data.stageWidth/2-this.width*this.panelScale/2),0==this._yType?this._y=this._top*this.panelScale:1==this._yType?this._y=a.Scene_data.stageHeight-this._bottom*this.panelScale-this.height*this.panelScale:2==this._yType&&(this._y=this._middle*this.panelScale+a.Scene_data.stageHeight/2-this.height*this.panelScale/2),this.applyChild(),this.resizeVirtualList()},b.prototype.resizeVirtualList=function(){if(this.virtualContainerList)for(var a=0;a<this.virtualContainerList.length;a++)this.virtualContainerList[a].resize()},Object.defineProperty(b.prototype,"left",{get:function(){return this._left},set:function(a){this._left=a,this._xType=0,this._x=this._left*this.panelScale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._right},set:function(b){this._right=b,this._xType=1,this._x=a.Scene_data.stageWidth-this._right*this.panelScale-this.width*this.panelScale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"center",{set:function(b){this._center=b,this._xType=2,this._x=this._center*this.panelScale+a.Scene_data.stageWidth/2-this.width*this.panelScale/2,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"top",{get:function(){return this._top;
},set:function(a){this._top=a,this._yType=0,this._y=this._top*this.panelScale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bottom",{get:function(){return this._bottom},set:function(b){this._bottom=b,this._yType=1,this._y=a.Scene_data.stageHeight-this._bottom*this.panelScale-this.height*this.panelScale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"middle",{set:function(b){this._middle=b,this._yType=2,this._y=this._middle*this.panelScale+a.Scene_data.stageHeight/2-this.height*this.panelScale/2,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){if(0!=this._width)return this._width;for(var a=0,b=0;b<this._list.length;b++)a=Math.max(this._list[b].width);return a},set:function(a){this._width=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){if(0!=this._height)return this._height;for(var a=0,b=0;b<this._list.length;b++)a=Math.max(this._list[b].height);return a},set:function(a){this._height=a},enumerable:!0,configurable:!0}),b.prototype.applyChild=function(){for(var a=0;a<this._list.length;a++)this._list[a].applyAbsolutePoint();if(this._maskList)for(var a=0;a<this._maskList.length;a++)this._maskList[a].applyAbsolutePoint()},Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){},b.prototype.setSizeForPanelUiCopy=function(a,b,c){var d=c.getComponent(b);a.x=d.x,a.y=d.y,a.width=d.width,a.height=d.height},b.prototype.makeBaseUiatlas=function(b,c){var d=new a.UIAtlas;d.configData=[];var e=Math.pow(2,Math.ceil(Math.log(b)/Math.log(2))),f=Math.pow(2,Math.ceil(Math.log(c)/Math.log(2)));return d.ctx=a.UIManager.getInstance().getContext2D(e,f,!1),d.textureRes=a.TextureManager.getInstance().getCanvasTexture(d.ctx),d.configData.push(d.getObject("temp_ui",0,0,b,c,e,f)),d},b}();a.UIConatiner=b;var c=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.update=function(a){},b.prototype.clearOneTemp=function(){},b}(b);a.Dis2DUIContianerBase=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.visible=!0,b}return __extends(b,a),b}(a.UIConatiner);a.UIVirtualContainer=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.init=function(a,b,c){return void 0===c&&(c=null),this._itemLoad=a,this._bFun=b,this.loadFun=c,this.loadBaseConfigCom(),a.length},b.loadBaseConfigCom=function(){for(var a=0;a<this._itemLoad.length;a++)this.loadUIdata(this._itemLoad[a].xmlurl,this._itemLoad[a].picurl,this._itemLoad[a].name,Boolean(this._itemLoad[a].isTexture))},b.loadOkNum=function(a){this.loadFun&&this.loadFun(a)},b.loadUIdata=function(b,c,d,e){var f=this;if(void 0===d&&(d="default"),void 0===e&&(e=!1),!e){var g=makeImage();this._imgDic[d]=g,g.onload=function(a){f.loadOkd()}}a.LoadManager.getInstance().load(a.Scene_data.fileRoot+b,a.LoadManager.XML_TYPE,function(b){var h=Array(JSON.parse(b))[0];f._dic[d]=h,e?a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+c,function(a){f._imgDic[d]=a,f.loadOkd()},1,null,0):g.src=a.Scene_data.fileRoot+c})},b.loadOkd=function(){this._skipnum++,this.loadOkNum(this._skipnum),this._skipnum>=this._itemLoad.length&&this._bFun()},b._skipnum=0,b._dic=new a.Dictionary([]),b._imgDic=new a.Dictionary([]),b}();a.MainUiLoad=b;var c=function(){function b(){}return b.setDesignWH=function(a,b){this.designWidth=a,this.designHeight=b,this.resize()},b.resize=function(){this.Scale=Math.min(a.Scene_data.stageWidth/this.designWidth,a.Scene_data.stageHeight/this.designHeight)},b.init=function(a,b,c){return void 0===c&&(c=null),this._itemLoad=a,this._bFun=b,this.loadFun=c,this.loadBaseConfigCom(),a.length},Object.defineProperty(b,"mainUIAtlas",{get:function(){return null},enumerable:!0,configurable:!0}),b.loadBaseConfigCom=function(){for(var a=0;a<this._itemLoad.length;a++)this.loadUIdata(this._itemLoad[a].xmlurl,this._itemLoad[a].picurl,this._itemLoad[a].name,Boolean(this._itemLoad[a].isTexture))},b.loadOkNum=function(a){this.loadFun&&this.loadFun(a)},b.loadUIdata=function(b,c,d,e){var f=this;if(void 0===d&&(d="default"),void 0===e&&(e=!1),!e){var g=makeImage();this._imgDic[d]=g,g.onload=function(a){f.loadOkd()}}a.LoadManager.getInstance().load(a.Scene_data.fileRoot+b,a.LoadManager.XML_TYPE,function(b){var h=Array(JSON.parse(b))[0];f._dic[d]=h,e?a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+c,function(a){f._imgDic[d]=a,f.loadOkd()},1,null,0):g.src=a.Scene_data.fileRoot+c})},b.loadOkd=function(){this._skipnum++,this.loadOkNum(this._skipnum),this._skipnum>=this._itemLoad.length&&(b.textImg=this._imgDic[b.textlist],this._bFun())},b.getImgByKey=function(a){return this._imgDic.containsKey(a)?this._imgDic[a]:null},b.getUiByName=function(a,b){if(this._dic.containsKey(a))for(var c=this._dic[a].uiArr,d=0;d<c.length;d++)if(c[d].name==b)return c[d];return null},b.getUiArrByKey=function(a){return this._dic.containsKey(a)?this._dic[a].uiArr:null},b.designWidth=960,b.designHeight=540,b.font="Helvetica",b._skipnum=0,b.textlist="textlist",b.publicUi="publicUi",b.faceItem=["/大笑","/脸2","/脸3","/脸4","/脸5","/脸6","/脸7","/脸8","/脸9","/脸a","/脸b","/脸c","/脸d","/脸e","/脸f","/脸g","/脸h","/脸i"],b._dic=new a.Dictionary([]),b._imgDic=new a.Dictionary([]),b}();a.UIData=c;var d=function(){function b(){}return b.drawUseImg=function(b,c,d){var e=b.uiRender.uiAtlas.getRec(b.skinName),f=a.UIManager.getInstance().getContext2D(e.pixelWitdh,e.pixelHeight,!1),g=c.getRec(d);f.drawImage(c.useImg,g.pixelX,g.pixelY,g.pixelWitdh,g.pixelHeight,0,0,e.pixelWitdh,e.pixelHeight),b.uiRender.uiAtlas.updateCtx(f,e.pixelX,e.pixelY)},b.clearUI=function(b){var c=b.uiRender.uiAtlas.getRec(b.skinName),d=a.UIManager.getInstance().getContext2D(c.pixelWitdh,c.pixelHeight,!1);b.uiRender.uiAtlas.updateCtx(d,c.pixelX,c.pixelY)},b.drawTxtLab=function(d,e,f,g,h,i){void 0===h&&(h=0),void 0===i&&(i=3);var j=d.uiRender.uiAtlas.getRec(d.skinName),k=a.UIManager.getInstance().getContext2D(j.pixelWitdh,j.pixelHeight,!1);b.cxtDrawImg(k,a.PuiData.TXTBG,new a.Rectangle(0,0,j.pixelWitdh,j.pixelHeight),c.publicUi),a.LabelTextFont.writeSingleLabelToCtx(k,e,f,h,i,g),d.uiRender.uiAtlas.updateCtx(k,j.pixelX,j.pixelY)},b.drawAttVal=function(c,d,e,f,g){void 0===f&&(f=a.TextAlign.LEFT),void 0===g&&(g=!1);var h="";return"undefined"==typeof d?void b.clearUI(c):(h=a.ColorType.Orange7a2f21+getKeyProById(d)+":  "+a.ColorType.Orange9a683f+Snum(Math.floor(e/100)),g&&(h=a.ColorType.Orange7a2f21+getKeyProById(d)+":  "+a.ColorType.Orange9a683f+"+"+Snum(Math.floor(e/100))),void a.LabelTextFont.writeSingleLabel(c.uiRender.uiAtlas,c.skinName,h,14,f))},b.drawAttValAdd=function(c,d,e){var f="";return"undefined"==typeof d?void b.clearUI(c):(f=a.ColorType.Orange7a2f21+getKeyProById(d)+":    "+a.ColorType.Green2ca937+"+"+Snum(Math.floor(e/100)),void a.LabelTextFont.writeSingleLabel(c.uiRender.uiAtlas,c.skinName,f,14,a.TextAlign.LEFT))},b.drawAddValTop=function(d,e){var f="";f=e>0?"+"+Snum(Math.floor(e/100)):"+0";var g=d.uiRender.uiAtlas.getRec(d.skinName),h=a.UIManager.getInstance().getContext2D(g.pixelWitdh,g.pixelHeight,!1);""!=f&&b.cxtDrawImg(h,a.PuiData.ARROW_TOP,new a.Rectangle(0,3,12,16),c.publicUi),a.LabelTextFont.writeSingleLabelToCtx(h,f,14,15,0,a.TextAlign.LEFT,a.ColorType.Green2ca937),d.uiRender.uiAtlas.updateCtx(h,g.pixelX,g.pixelY)},b.drawAddValRight=function(d,e,f,g){if(void 0===f&&(f=!1),void 0===g&&(g=a.TextAlign.RIGHT),e>=0){var h=d.uiRender.uiAtlas.getRec(d.skinName),i=a.UIManager.getInstance().getContext2D(h.pixelWitdh,h.pixelHeight,!1);b.cxtDrawImg(i,a.PuiData.ARROW_RIGHT,new a.Rectangle(0,3,16,12),c.publicUi);var j=Snum(Math.floor(e/100));f&&(j="+"+j);var k=0;g==a.TextAlign.LEFT&&(k=22),a.LabelTextFont.writeSingleLabelToCtx(i,j,14,k,0,g,a.ColorType.Green2ca937),d.uiRender.uiAtlas.updateCtx(i,h.pixelX,h.pixelY)}else b.clearUI(d)},b.drawResHasNumAndAllNum=function(a,b,c){void 0===c&&(c="");return!1},b.drawCost=function(d,f,g,h){b.cxtDrawImg(d,e.getInstance().costtype(h),new a.Rectangle(f,g,35,35),c.publicUi)},b.drawCostUI=function(d,f,g,h){var i=d.uiRender.uiAtlas.getRec(d.skinName),j=a.UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1);b.cxtDrawImg(j,e.getInstance().costtype(h),new a.Rectangle(f,g,35,35),c.publicUi),d.uiRender.uiAtlas.updateCtx(j,i.pixelX,i.pixelY)},b.cxtDrawImg=function(a,b,d,e){var f=c.getUiByName(e,b);f&&((0==d.width||0==d.height)&&(d.width=f.ow,d.height=f.oh),0==f.type?a.drawImage(c.getImgByKey(e),f.ox,f.oy,f.ow,f.oh,d.x,d.y,d.width,d.height):1==f.type?(a.drawImage(c.getImgByKey(e),f.ox,f.oy,f.uow,f.uoh,d.x,d.y,f.uow,f.uoh),a.drawImage(c.getImgByKey(e),f.ox+f.uow,f.oy,f.ow-2*f.uow,f.uoh,d.x+f.uow,d.y,d.width-2*f.uow,f.uoh),a.drawImage(c.getImgByKey(e),f.ox+f.ow-f.uow,f.oy,f.uow,f.uoh,d.x+d.width-f.uow,d.y,f.uow,f.uoh),a.drawImage(c.getImgByKey(e),f.ox,f.oy+f.uoh,f.uow,f.oh-2*f.uoh,d.x,d.y+f.uoh,f.uow,d.height-2*f.uoh),a.drawImage(c.getImgByKey(e),f.ox+f.uow,f.oy+f.uoh,f.ow-2*f.uow,f.oh-2*f.uoh,d.x+f.uow,d.y+f.uoh,d.width-2*f.uow,d.height-2*f.uoh),a.drawImage(c.getImgByKey(e),f.ox+f.ow-f.uow,f.oy+f.uoh,f.uow,f.uoh,d.x+d.width-f.uow,d.y+f.uoh,f.uow,d.height-2*f.uoh),a.drawImage(c.getImgByKey(e),f.ox,f.oy+f.oh-f.uoh,f.uow,f.uoh,d.x,d.y+d.height-f.uoh,f.uow,f.uoh),a.drawImage(c.getImgByKey(e),f.ox+f.uow,f.oy+f.oh-f.uoh,f.ow-2*f.uow,f.uoh,d.x+f.uow,d.y+d.height-f.uoh,d.width-2*f.uow,f.uoh),a.drawImage(c.getImgByKey(e),f.ox+f.ow-f.uow,f.oy+f.oh-f.uoh,f.uow,f.uoh,d.x+d.width-f.uow,d.y+d.height-f.uoh,f.uow,f.uoh)):alert("UiDraw没有绘制成功  "+f.type))},b.uiAtlasDrawImg=function(b,d,e,f){var g=b.getRec(d);b.ctx=a.UIManager.getInstance().getContext2D(g.pixelWitdh,g.pixelHeight,!1);var h=c.getUiByName(e,f);h?(0==h.type?b.ctx.drawImage(c.getImgByKey(e),h.ox,h.oy,h.ow,h.oh,0,0,g.pixelWitdh,g.pixelHeight):1==h.type&&(b.ctx.drawImage(c.getImgByKey(e),h.ox,h.oy,h.uow,h.uoh,0,0,h.uow,h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox+h.uow,h.oy,h.ow-2*h.uow,h.uoh,h.uow,0,g.pixelWitdh-2*h.uow,h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox+h.ow-h.uow,h.oy,h.uow,h.uoh,g.pixelWitdh-h.uow,0,h.uow,h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox,h.oy+h.uoh,h.uow,h.oh-2*h.uoh,0,h.uoh,h.uow,g.pixelHeight-2*h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox+h.uow,h.oy+h.uoh,h.ow-2*h.uow,h.oh-2*h.uoh,h.uow,h.uoh,g.pixelWitdh-2*h.uow,g.pixelHeight-2*h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox+h.ow-h.uow,h.oy+h.uoh,h.uow,h.uoh,g.pixelWitdh-h.uow,h.uoh,h.uow,g.pixelHeight-2*h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox,h.oy+h.oh-h.uoh,h.uow,h.uoh,0,g.pixelHeight-h.uoh,h.uow,h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox+h.uow,h.oy+h.oh-h.uoh,h.ow-2*h.uow,h.uoh,h.uow,g.pixelHeight-h.uoh,g.pixelWitdh-2*h.uow,h.uoh),b.ctx.drawImage(c.getImgByKey(e),h.ox+h.ow-h.uow,h.oy+h.oh-h.uoh,h.uow,h.uoh,g.pixelWitdh-h.uow,g.pixelHeight-h.uoh,h.uow,h.uoh)),a.TextureManager.getInstance().updateTexture(b.texture,g.pixelX,g.pixelY,b.ctx)):alert("uiAtlasDrawImg错误")},b.SharedDrawImg=function(b,c,d,e,f,g,h){void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=!0);var i=b.getRec(d);b.ctx=a.UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1);var j=c.getRec(e),k=h?0:f,l=h?0:g,m=h?i.pixelWitdh:j.pixelWitdh,n=h?i.pixelHeight:j.pixelHeight;b.ctx.drawImage(c.useImg,j.pixelX,j.pixelY,j.pixelWitdh,j.pixelHeight,k,l,m,n),a.TextureManager.getInstance().updateTexture(b.texture,i.pixelX,i.pixelY,b.ctx)},b.drawToUiAtlasToCtx=function(b,c,d,e){var f=c.getRec(d);e||(e=new a.Rectangle(0,0,0,0)),e.width>1&&e.height>1?b.drawImage(c.useImg,f.pixelX,f.pixelY,f.pixelWitdh,f.pixelHeight,e.x,e.y,e.width,e.height):b.drawImage(c.useImg,f.pixelX,f.pixelY,f.pixelWitdh,f.pixelHeight,e.x,e.y,f.pixelWitdh,f.pixelHeight)},b.RepeatLoadImg=function(b,c,d){void 0===d&&(d=null);var e=makeImage();e.onload=function(){a.LoadManager.getInstance().load(c,a.LoadManager.IMG_TYPE,function(a){d&&d(e,a)})},e.src=b},b}();a.UiDraw=d;var e=function(){function b(){}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.drawCostUI=function(b,e,f,g,h,i){void 0===g&&(g="#000000"),void 0===h&&(h=0),void 0===i&&(i=0),-1!=g.indexOf("[")&&(g="#"+g.substr(1,6));var j=b.getRec(e),k=a.UIManager.getInstance().getContext2D(j.pixelWitdh,j.pixelHeight,!1);0==h&&(h=j.pixelWitdh,i=j.pixelHeight),d.cxtDrawImg(k,a.PuiData.TXTBG,new a.Rectangle(j.pixelWitdh-h,j.pixelHeight-i-3,h,i+3),c.publicUi);var l,m;Number(f[0])>-1?(d.cxtDrawImg(k,this.costtype(Number(f[0])),new a.Rectangle(0,0,35,35),c.publicUi),l=(h-35)/2+35,m=i>=35?2:35-i):(l=h/2+(j.pixelWitdh-h),m=j.pixelHeight-i),a.LabelTextFont.writeSingleLabelToCtxSetAnchor(k,String(f[1]),16,l,m,a.TextAlign.CENTER,g),a.ArtFont.getInstance(),b.updateCtx(k,j.pixelX,j.pixelY)},b.prototype.costtype=function(b){switch(b){case 1:return a.PuiData.A_YUANBAO;case 2:return a.PuiData.A_BANGYUAN;case 3:return a.PuiData.A_YINBI;case 101:return a.PuiData.A_ZHENQI;case 102:return a.PuiData.A_SHOULING;case 103:return a.PuiData.A_JINGHUA;case 6:return a.PuiData.A_BANGGONG;case 7:return a.PuiData.A_HONOR;case 8:return a.PuiData.A_DOUHUN;case 9:return a.PuiData.A_DOUHUN;case 10:return a.PuiData.A_CARD_G;case 11:return a.PuiData.A_CARD_C;case 12:return a.PuiData.A_CARD_B;case 104:return a.PuiData.A_EXP}},b}();a.UIuitl=e}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._rendering=!1,this.scale=1,this.sortnum=0,this.blenderMode=0,this.renderData=new Float32Array(0),this.renderData2=new Float32Array(0),this.num=0,this.visible=!0,this.initData()}return Object.defineProperty(b.prototype,"uiListLen",{get:function(){return this._uiList.length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rendering",{get:function(){return this._rendering},set:function(a){if(this._rendering=a,this._uiList)for(var b=0;b<this._uiList.length;b++)this._uiList[b].rendering=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),b.prototype.initData=function(){this._uiList=new Array,this.objData=new a.ObjData,this.shader=a.ProgrmaManager.getInstance().getProgram(a.UIShader.UI_SHADER),this.program=this.shader.program,this.uiProLocation=a.Scene_data.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=a.Scene_data.context3D.getLocation(this.program,"ui2")},b.prototype.resize=function(){},b.prototype.setImgUrl=function(b){var c=this;a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+b,function(a){c.textureRes=a})},b.prototype.setInfo=function(b,c,d){this.uiAtlas=new a.UIAtlas,this.uiAtlas.setInfo(b,c,function(){d()})},b.prototype.setAtlas=function(a){this.uiAtlas=a},b.prototype.creatComponent=function(b,c,d,e){var f=new a.UICompenent;return f.tr.sets(b,c,d,e),f.uiRender=this,f},b.prototype.getComponent=function(a){var b=this.uiAtlas.getLayoutData(a);if(b){var c=b.type;if(0==c){var d=this.creatBaseComponent(b.dataItem[0]);return d.width=b.rect.width,d.height=b.rect.height,d.x=b.rect.x,d.y=b.rect.y,d.baseRec=b.rect,d.name=a,d}if(1==c){var e=this.creatGrid9Component(b.dataItem[0],b.rect.width,b.rect.height);return e.x=b.rect.x,e.y=b.rect.y,e.baseRec=b.rect,e.name=a,e}if(2==c){if(b.selected){var f=this.createSelectButton(b.dataItem[0],b.dataItem[1]);return f.width=b.rect.width,f.height=b.rect.height,f.x=b.rect.x,f.y=b.rect.y,f.baseRec=b.rect,f.name=a,f}var g=this.creatButton(b.dataItem[0],b.dataItem[1]);return g.width=b.rect.width,g.height=b.rect.height,g.x=b.rect.x,g.y=b.rect.y,g.baseRec=b.rect,g.name=a,g}if(4==c){var h=this.createFrame(b.dataItem[0]);return h.width=b.rect.width,h.height=b.rect.height,h.x=b.rect.x,h.y=b.rect.y,h.baseRec=b.rect,h.name=a,h}}return null},b.prototype.createFrame=function(b){var c=new a.FrameCompenent;c.skinName=b;var d=this.uiAtlas.getRec(b);return c.setFrameData(d),c.uiRender=this,c},b.prototype.creatBaseComponent=function(b){var c=new a.UICompenent;c.skinName=b;var d=this.uiAtlas.getRec(b);return c.tr.setRec(d),c.width=d.pixelWitdh,c.height=d.pixelHeight,c.uiRender=this,c},b.prototype.creatGrid9Component=function(b,c,d){var e=new a.Grid9Compenent;e.skinName=b;var f=this.uiAtlas.getGridRec(b);return e.tr.setRec(f),e.ogw=f.ogw,e.ogh=f.ogh,e.gw=e.ogw/f.pixelWitdh,e.gh=e.ogh/f.pixelHeight,e.width=c,e.height=d,e.uiRender=this,e},b.prototype.creatButton=function(b,c){if(!this.uiAtlas.hasData)return null;var d=new a.Button,e=this.uiAtlas.getRec(b);return d.tr.setRec(e),d.trDown.setRec(this.uiAtlas.getRec(c)),d.width=e.pixelWitdh,d.height=e.pixelHeight,d.uiRender=this,d},b.prototype.createSelectButton=function(b,c){if(!this.uiAtlas.hasData)return null;var d=new a.SelectButton,e=this.uiAtlas.getRec(b);return d.tr.setRec(e),d.trDown.setRec(this.uiAtlas.getRec(c)),d.width=e.pixelWitdh,d.height=e.pixelHeight,d.uiRender=this,d},b.prototype.addRenderUI=function(a){return this._uiList.length>=50?void alert("UIRenderComponent超限制51"):(this._uiList.push(a),a.rendering=this.rendering,void this.applyObjData())},b.prototype.removeRenderUI=function(a){var b=this._uiList.indexOf(a);-1!=b&&this._uiList.splice(b,1),a.rendering=!1,this.applyObjData()},b.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var b=0,c=0;c<this._uiList.length;c++){var d=this._uiList[c];d.isVirtual||(b=d.pushVaData(this.objData,c,b))}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),a.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),a.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)),this.mask&&(this.mask.scale=this.scale,this.mask.applyAbsolutePoint()),this.makeRenderDataVc(-1)},b.prototype.makeRenderDataVc=function(a){if((!this.renderData||this.renderData&&this.renderData.length!=4*this._uiList.length)&&(this.renderData=new Float32Array(4*this._uiList.length),this.renderData2=new Float32Array(4*this._uiList.length)),-1==a)for(var b=0;this._uiList&&b<this._uiList.length;b++)this._uiList[b].vcId=b,this.renderData[4*b+0]=this._uiList[b].renderData[0],this.renderData[4*b+1]=this._uiList[b].renderData[1],this.renderData[4*b+2]=this._uiList[b].renderData[2],this.renderData[4*b+3]=this._uiList[b].renderData[3],this.renderData2[4*b+0]=this._uiList[b].renderData2[0],this.renderData2[4*b+1]=this._uiList[b].renderData2[1],this.renderData2[4*b+2]=this._uiList[b].renderData2[2],this.renderData2[4*b+3]=this._uiList[b].renderData2[3];else a<this._uiList.length&&(this.renderData[4*a+0]=this._uiList[a].renderData[0],this.renderData[4*a+1]=this._uiList[a].renderData[1],this.renderData[4*a+2]=this._uiList[a].renderData[2],this.renderData[4*a+3]=this._uiList[a].renderData[3],this.renderData2[4*a+0]=this._uiList[a].renderData2[0],this.renderData2[4*a+1]=this._uiList[a].renderData2[1],this.renderData2[4*a+2]=this._uiList[a].renderData2[2],this.renderData2[4*a+3]=this._uiList[a].renderData2[3])},b.prototype.update=function(){if(this.visible&&0!=this._uiList.length||this.modelRenderList&&this.modelRenderList.length){if(this.mask){var b=a.Scene_data.context3D.renderContext;b.enable(b.STENCIL_TEST),b.stencilMask(255),b.stencilFunc(b.NEVER,this.mask.level,255),b.stencilOp(b.REPLACE,b.REPLACE,b.REPLACE),this.mask.update(),b.stencilFunc(b.LESS,this.mask.level-1,255),b.stencilOp(b.KEEP,b.KEEP,b.KEEP)}if(a.Scene_data.context3D.setBlendParticleFactors(this.blenderMode),a.Scene_data.context3D.setProgram(this.program),this.setVc(),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),this.setTextureToGpu(),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum),this.mask&&a.Scene_data.context3D.renderContext.disable(a.Scene_data.context3D.renderContext.STENCIL_TEST),this.modelRenderList)for(var c=0;c<this.modelRenderList.length;c++)this.modelRenderList[c].update()}},b.prototype.setTextureToGpu=function(){this.uiAtlas?a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.uiAtlas.texture,0):a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0)},b.prototype.setVc=function(){for(var b=0;b<this._uiList.length;b++)this._uiList[b].update(),this._uiList[b].vcId!=b;a.Scene_data.context3D.setVc4fvLocation(this.uiProLocation,this.renderData),a.Scene_data.context3D.setVc4fvLocation(this.ui2ProLocation,this.renderData2)},b.prototype.addModel=function(a){this.modelRenderList||(this.modelRenderList=new Array);var b=this.modelRenderList.indexOf(a);-1==b&&this.modelRenderList.push(a)},b.prototype.removeModel=function(a){var b=this.modelRenderList.indexOf(a);-1!=b&&this.modelRenderList.splice(b,1)},b.prototype.insetUi=function(a){for(var b=0;b<this._uiList.length;b++)if(this._uiList[b].testPoint(a.x,a.y))return this._uiList[b];return null},b.prototype.interactiveEvent=function(b){if(this.mask&&!this.mask.testPoint(b.x,b.y))return!1;for(var c=!1,d=0;d<this._uiList.length;d++)if(this._uiList[d].interactiveEvent(b)&&a.UIManager.cando)return c=!0,a.UIManager.cando=!1,!0;return c},b.prototype.dispose=function(){this.objData.destory(),this.objData=null,this.uiAtlas&&(this.uiAtlas.dispose(),this.uiAtlas=null),this.mask&&(this.mask.dispose(),this.mask=null),this.renderData=null,this.renderData2=null},b}();a.UIRenderComponent=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.createList=function(){var b=new a.List;return b.uiRender=this,b},c.prototype.createGridList=function(){var b=new a.GridList;return b.uiRender=this,b},c}(a.UIRenderComponent);a.UIListRenderComponent=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._scaleData=[1,1],a._isFBO=!1,a.alpha=1,a}return __extends(c,b),c.prototype.initData=function(){this.objData=new a.ObjData,this.shader=a.ProgrmaManager.getInstance().getProgram(a.UIImageShader.UI_IMG_SHADER),this.program=this.shader.program,this.objData.vertices.push(-1,1,0,1,1,0,1,-1,0,-1,-1,0),this.objData.uvs.push(0,0,1,0,1,1,0,1),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=6,this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},c.prototype.resize=function(){this.appleyPos()},c.prototype.setImgInfo=function(a,b,c){this.setImgUrl(a),this._width=b,this._height=c},c.prototype.appleyPos=function(){var b=this._width/a.Scene_data.stageWidth,c=this._height/a.Scene_data.stageHeight;c>b?(this._scaleData[0]=1,this._scaleData[1]=this._height/a.Scene_data.stageHeight/b):(this._scaleData[0]=this._width/a.Scene_data.stageWidth/c,this._scaleData[1]=1)},c.prototype.setFbo=function(){this._isFBO=!0},c.prototype.update=function(){var b=!1;this._isFBO?(a.Scene_data.fbo&&(b=!0),a.Scene_data.context3D.clearContext(),a.Scene_data.context3D.setDepthTest(!1)):this.texture&&(b=!0),this.objData&&b&&(a.Scene_data.context3D.setBlendParticleFactors(0),a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),a.Scene_data.context3D.setVc2fv(this.shader,"scale",this._scaleData),this._isFBO?(a.Scene_data.context3D.setVc2fv(this.shader,"scale",[1,-1]),a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",a.Scene_data.fbo.texture,0)):a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0),a.Scene_data.context3D.setVcFloat(this.shader,"alpha",[this.alpha]),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},c.prototype.interactiveEvent=function(a){return!0},c}(a.UIRenderComponent);a.UIBackImg=b;var c=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.makeRenderDataVc=function(a){b.prototype.makeRenderDataVc.call(this,a);for(var c=0;c<this.renderData2.length/4;c++)this.renderData2[4*c+0]=1,this.renderData2[4*c+1]=1,this.renderData2[4*c+2]=0,this.renderData2[4*c+3]=0},c.prototype.update=function(){this.texture&&b.prototype.update.call(this)},c.prototype.setTextureToGpu=function(){a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0)},c.prototype.dispose=function(){b.prototype.dispose.call(this),this.textureRes&&this.textureRes.clearUseNum()},c}(a.UIRenderComponent);a.UIRenderOnlyPicComponent=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._x=0,this._y=0,this._width=0,this._height=0,this.absoluteX=0,this.absoluteY=0,this.absoluteWidth=0,this.absoluteHeight=0,this.scale=1,this.level=2,this._hasDisposed=!1,this.initData(),this.renderData=[0,0,0,0]}return b.prototype.initData=function(){this.objData=new a.ObjData,this.shader=a.ProgrmaManager.getInstance().getProgram(a.UIMaskShader.UI_MASK_SHADER),this.program=this.shader.program,this.applyObjData()},b.prototype.applyAbsolutePoint=function(){this.parent&&(this.absoluteX=this._x*this.scale*a.UIData.Scale+this.parent.x,this.absoluteY=this._y*this.scale*a.UIData.Scale+this.parent.y,this.absoluteWidth=this._width*a.UIData.Scale*this.scale,this.absoluteHeight=this._height*a.UIData.Scale*this.scale,this.applyRenderSize())},b.prototype.testPoint=function(a,b){return a>this.absoluteX&&a<this.absoluteX+this.absoluteWidth&&b>this.absoluteY&&b<this.absoluteY+this.absoluteHeight?!0:!1},b.prototype.applyRenderSize=function(){this.parent&&(this.renderData[0]=this.absoluteX/a.Scene_data.stageWidth,this.renderData[1]=this.absoluteY/a.Scene_data.stageHeight,this.renderData[2]=this.absoluteWidth/a.Scene_data.stageWidth,this.renderData[3]=this.absoluteHeight/a.Scene_data.stageHeight)},b.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0,this.objData.vertices.push(0,0,0,1,0,0,1,-1,0,0,-1,0),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},b.prototype.update=function(){a.Scene_data.context3D.setBlendParticleFactors(0),a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVc4fv(this.shader,"ui",this.renderData),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this._hasDisposed||(this.objData.destory(),this.objData=null,this.program=null,this.shader=null,this.renderData=null,this.parent=null,this._hasDisposed=!0)},b}();a.UIMask=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.trDown=new a.Rectangle,c._state=0,c._currentState=0,c}return __extends(c,b),c.prototype.update=function(){this._currentState!=this._state&&(this.applyRenderSize(),this._currentState=this._state)},c.prototype.applyRenderSize=function(){b.prototype.applyRenderSize.call(this),0==this._state?(this.renderData2[0]=this.tr.width,this.renderData2[1]=this.tr.height,this.renderData2[2]=this.tr.x,this.renderData2[3]=this.tr.y):1==this._state&&(this.renderData2[0]=this.trDown.width,this.renderData2[1]=this.trDown.height,this.renderData2[2]=this.trDown.x,this.renderData2[3]=this.trDown.y),this.uiRender.makeRenderDataVc(this.vcId)},c}(a.UICompenent);a.BaseButton=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.interactiveEvent=function(b){return a.prototype.interactiveEvent.call(this,b)},b}(a.BaseButton);a.Button=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._selected=!1,a}return __extends(c,b),Object.defineProperty(c.prototype,"selected",{get:function(){return this._selected},set:function(a){this._selected=a,this._selected?this._state=1:this._state=0},enumerable:!0,configurable:!0}),c.prototype.interactiveEvent=function(c){return this.enable?(c.type==a.InteractiveEvent.Down&&this.testPoint(c.x,c.y)&&(this._selected=!this._selected,this._selected?this._state=1:this._state=0),b.prototype.interactiveEvent.call(this,c)):!1},c}(a.BaseButton);a.SelectButton=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);
})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.pushVaData=function(a,b,c){for(var d=[0,0,0,this.ogw,0,0,this.width-this.ogw,0,0,this.width,0,0,0,-this.ogh,0,this.ogw,-this.ogh,0,this.width-this.ogw,-this.ogh,0,this.width,-this.ogh,0,0,this.ogh-this.height,0,this.ogw,this.ogh-this.height,0,this.width-this.ogw,this.ogh-this.height,0,this.width,this.ogh-this.height,0,0,-this.height,0,this.ogw,-this.height,0,this.width-this.ogw,-this.height,0,this.width,-this.height,0],e=0;e<d.length;e+=3)a.vertices.push(d[e]/this.width,d[e+1]/this.height,d[e+2]);a.uvs.push(0,0,b,this.gw,0,b,1-this.gw,0,b,1,0,b,0,this.gh,b,this.gw,this.gh,b,1-this.gw,this.gh,b,1,this.gh,b,0,1-this.gh,b,this.gw,1-this.gh,b,1-this.gw,1-this.gh,b,1,1-this.gh,b,0,1,b,this.gw,1,b,1-this.gw,1,b,1,1,b);for(var f=[0,1,5,0,5,4,1,2,6,1,6,5,2,3,7,2,7,6,4,5,9,4,9,8,5,6,10,5,10,9,6,7,11,6,11,10,8,9,13,8,13,12,9,10,14,9,14,13,10,11,15,10,15,14],e=0;e<f.length;e++)a.indexs.push(c+f[e]);return c+16},b}(a.UICompenent);a.Grid9Compenent=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.isTrue=!1,a.current=0,a.totalcurrent=0,a.speed=6,a.endFlag=!1,a.stopStatic=0,a.speedNum=0,a}return __extends(c,b),c.prototype.setFrameData=function(a){this._frameData=a,this.totalcurrent=this._frameData.cellX*this._frameData.cellY},c.prototype.applyRenderSize=function(){if(this.parent){this.renderX=this.absoluteX/a.Scene_data.stageWidth,this.renderY=this.absoluteY/a.Scene_data.stageHeight,this.renderWidth=this.absoluteWidth/a.Scene_data.stageWidth,this.renderHeight=this.absoluteHeight/a.Scene_data.stageHeight,this.renderData[0]=this.renderX,this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth*this._uvScale,this.renderData[3]=this.renderHeight;var b=this._frameData.cellX,c=this._frameData.cellY,d=this._frameData.width/b,e=this._frameData.height/c,f=new a.Rectangle(0,0,d,e),g=this.current%(b*c);f.x=g%b*d,f.y=float2int(g/b)*e,this.renderData2[0]=f.width*this._uvScale,this.renderData2[1]=f.height,this.renderData2[2]=f.x+this._frameData.x,this.renderData2[3]=f.y+this._frameData.y,this.uiRender.makeRenderDataVc(this.vcId)}},c.prototype.getSkinCtxRect=function(){var b=this._frameData,c=new a.Rectangle;return c.width=b.pixelWitdh/b.cellX,c.height=b.pixelHeight/b.cellY,c.x=this.current%b.cellX*c.width,c.y=Math.floor(this.current/b.cellX)*c.height,c},c.prototype.drawToCtx=function(a,b){var c=this._frameData,d=this.getSkinCtxRect();a.updateCtx(b,c.pixelX+d.x,c.pixelY+d.y)},c.prototype.update=function(){if(this._frameData&&2!=this.stopStatic){this.applyRenderSize(),this.speedNum++,this.speedNum>this.speed&&(this.current++,this.speedNum=0);var a=this._frameData.cellX,b=this._frameData.cellY;this.current>a*b-1&&(1==this.stopStatic?(this.stopStatic=2,this.endFlag=!0):this.current=0)}},c.prototype.goToAndPlay=function(a){this.stopStatic=1,this.current=a},c.prototype.goToAndStop=function(a){this.stopEnd(),this.current=a,this.applyRenderSize()},c.prototype.Invisible=function(){0!=this.renderData[2]&&0!=this.renderData[3]&&(this.stopEnd(),this.renderData[0]=0,this.renderData[1]=0,this.renderData[2]=0,this.renderData[3]=0,this.uiRender.makeRenderDataVc(this.vcId))},c.prototype.play=function(){this.stopStatic=0},c.prototype.stopEnd=function(){this.stopStatic=2;var a=this._frameData.cellX,b=this._frameData.cellY;this.current=a*b-1,this.applyRenderSize()},c}(a.UICompenent);a.FrameCompenent=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function d(){var c=b.call(this)||this;return c._contentX=0,c._contentY=0,c._needScoller=!1,c.lastcontentY=0,c.addEventListener(a.InteractiveEvent.Down,c.onDown,c),c.addEventListener(a.InteractiveEvent.Up,c.onListUp,c),c}return __extends(d,b),d.prototype.applyAbsolutePoint=function(){this.parent&&(this.absoluteX=(this._x*this.scale+this._contentX)*a.UIData.Scale+this.parent.x,this.absoluteY=(this._y*this.scale+this._contentY)*a.UIData.Scale+this.parent.y,this.absoluteWidth=this.width*a.UIData.Scale,this.absoluteHeight=this.height*a.UIData.Scale,this.applyRenderSize())},Object.defineProperty(d.prototype,"contentX",{get:function(){return this._contentX},set:function(a){this._contentX=a,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"contentY",{get:function(){return this._contentY},set:function(a){this._contentY=a,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),d.prototype.testPoint=function(b,c){return b>this.absoluteX&&b<this.absoluteX+this._showWidth*a.UIData.Scale&&c>this.absoluteY&&c<this.absoluteY+this._showHeight*a.UIData.Scale?!0:!1},d.prototype.setData=function(a,b,d,e,f,g,h,i){void 0===h&&(h=256),void 0===i&&(i=300),this.uiRender.uiAtlas&&this.uiRender.uiAtlas.dispose(),this.width=f,this.height=g,this._showWidth=h,this._showHeight=i,this._itemWidth=d,this._itemHeight=e,this.data=a;var j=new c;this.uiRender.setAtlas(j),j.setData(f,g,d,e,a.length),this._itemRenderAry=new Array;for(var k=0;k<a.length;k++){var l=new b;l.setData(a[k],j,j.configData[k]),this._itemRenderAry.push(l)}this._oHeight=e*a.length,this._oHeight>this._showHeight?this._needScoller=!0:this._needScoller=!1,this.uiRender.applyObjData()},d.prototype.refresh=function(){for(var a=0;this._itemRenderAry&&a<this._itemRenderAry.length;a++)this._itemRenderAry[a].draw()},d.prototype.pushVaData=function(a,b,c){if(!this._itemRenderAry)return 0;for(var d=0;d<this._itemRenderAry.length;d++){var e=this._itemRenderAry[d].uvData;a.vertices.push(0,-e.y,0,1,-e.y,0),a.uvs.push(0,e.y,b,1,e.y,b)}a.vertices.push(0,-1,0,1,-1,0),a.uvs.push(0,1,b,1,1,b);for(var d=0;d<this._itemRenderAry.length;d++)a.indexs.push(c+2*d,1+c+2*d,3+c+2*d,c+2*d,3+c+2*d,2+c+2*d);return c+2*(this._itemRenderAry.length+1)},d.prototype.onDown=function(b){this._ypos=b.y,this.lastcontentY=this.contentY,this._needScoller&&(a.Scene_data.uiStage.addEventListener(a.InteractiveEvent.Move,this.onMove,this),a.Scene_data.uiStage.addEventListener(a.InteractiveEvent.Up,this.onUp,this))},d.prototype.onListUp=function(b){if(this.uiRender.mask)this.uiRender.mask.testPoint(b.x,b.y)&&this.testItemClick(b.x,b.y);else if(Math.abs(this.contentY-this.lastcontentY)<1){var c=(b.y-this.absoluteY+this.contentY)/a.UIData.Scale;c>=0&&c<this._showHeight&&this.testItemClick(b.x,b.y)}},d.prototype.testItemClick=function(b,c){var d=b-this.absoluteX,e=c-this.absoluteY,f=this._itemHeight*a.UIData.Scale,g=Math.floor(e/f);g>=this._itemRenderAry.length||0>g||this._itemRenderAry[g].click(d,e-f*g)},d.prototype.onMove=function(a){this.contentY-=this._ypos-a.y,this.contentY>0?this.contentY=0:this.contentY<this._showHeight*this.scale-this._oHeight*this.scale&&(this.contentY=this._showHeight*this.scale-this._oHeight*this.scale),this._ypos=a.y},d.prototype.onUp=function(b){a.Scene_data.uiStage.removeEventListener(a.InteractiveEvent.Move,this.onMove,this),a.Scene_data.uiStage.removeEventListener(a.InteractiveEvent.Up,this.onUp,this)},d}(a.UICompenent);a.List=b;var c=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.setData=function(b,c,d,e,f){this.ctx=a.UIManager.getInstance().getContext2D(b,c,!1),this.textureRes=a.TextureManager.getInstance().getCanvasTexture(this.ctx),this.configData=new Array;for(var g=0;f>g;g++){var h=new Object;h.ox=0,h.oy=g*e,h.ow=d,h.oh=e,h.x=0,h.y=g*e/c,h.width=d/b,h.height=e/c,h.name=g.toString(),this.configData.push(h)}},c}(a.UIAtlas);a.ListAtlas=c;var d=function(){function a(){}return a}();a.ListItemData=d;var e=function(){function b(){}return b.prototype.setData=function(a,b,c){this._listItemData=a,this._listItemData.itemRender=this,this.uvData=c,this.atlas=b,this.draw()},Object.defineProperty(b.prototype,"listItemData",{get:function(){return this._listItemData},enumerable:!0,configurable:!0}),b.prototype.setNewData=function(a){},Object.defineProperty(b.prototype,"selected",{get:function(){return this._selected},set:function(a){this._selected=a},enumerable:!0,configurable:!0}),b.prototype.draw=function(){},b.prototype.redraw=function(){},b.prototype.click=function(b,c){if(this._listItemData.clickFun){if(this._listItemData.clickRect&&!this._listItemData.clickRect.isHitByPoint(b/a.UIData.Scale,c/a.UIData.Scale))return;this._listItemData.clickFun(this._listItemData)}},b}();a.ListItemRender=e}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.p_scrollY=0,a.p_scrollX=0,a._showItemNum=0,a._allItemNum=0,a._topSize=0,a._bottomSize=0,a._outSize=0,a._showDataIndex=0,a.scrollLock=!1,a._minScrollY=0,a._maskLevel=2,a._mouseY=0,a._dragFlag=!1,a._dragY=0,a._dragMaxY=100,a}return __extends(c,b),c.prototype.setData=function(b,c,d,h,i,j,k,l,m,n,o,p){if(void 0===p&&(p=0),this.width=d,this._height=h,this.p_itemHeight=j,this.p_itemWidth=i,this._showIndexList=new Array,this._dataAry=b,this._showItemNum=k,this._allItemNum=n*o,this._contentX=n,this._contentY=o,this._outSize=(o-this._showItemNum)*j,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._sAtlas=new g,this._sAtlas.setData(l,m,n,o),this.bgMask=new a.UIMask,this.bgMask.x=0,this.bgMask.y=0,this.bgMask.width=d,this.bgMask.height=h,this.bgMask.level=this._maskLevel,this.addMask(this.bgMask),this._bgRender=new e,this._bgRender.uiAtlas=this._sAtlas,this._bgRender.slist=this,this.addRender(this._bgRender),this._baseRender=new f,this._baseRender.uiAtlas=this._sAtlas,this.addRender(this._baseRender),this._bgRender.mask=this.bgMask,this._baseRender.mask=this.bgMask,0!=p){this.customRenderAry=new Array;for(var q=0;p>q;q++){var r=new f;r.uiAtlas=this._sAtlas,this.addRender(r),r.mask=this.bgMask,this.customRenderAry.push(r)}}this._itemList=new Array;for(var q=0;q<this._allItemNum;q++){var s=new c;s.baseY=float2int(q/n)*j,s.baseX=q%n*i,s.uiAtlas=this._sAtlas,s.index=q,s.parentTarget=this,s.create(this,this._bgRender,this._baseRender,this.customRenderAry),s.render(b[q]),this._itemList.push(s),this._showIndexList.push(q)}this._minScrollY=this._height-float2int(this._dataAry.length/this._contentX)*this.p_itemHeight,this.scrollY(0),Math.ceil(b.length/this._contentX)<=this._showItemNum?this.scrollLock=!0:this.scrollLock=!1,this.initComplte()},c.prototype.initComplte=function(){},c.prototype.setShowLevel=function(a){this._maskLevel=a,this.bgMask&&(this.bgMask.level=this._maskLevel)},c.prototype.setSelect=function(a){for(var b=0;b<this._itemList.length;b++)this._itemList[b]==a?(this._currentSelIdx=this._dataAry.indexOf(this._itemList[b].itdata),this._itemList[b].selected=!0):this._itemList[b].selected&&(this._itemList[b].selected=!1)},c.prototype.setSelectIndex=function(a){this._currentSelIdx=a;for(var b=0;b<this._itemList.length;b++)this._itemList[b].itdata&&this._itemList[b].itdata.id==a?this._itemList[b].selected=!0:this._itemList[b].selected&&(this._itemList[b].selected=!1)},c.prototype.getCurrentSelectIndex=function(){return this._currentSelIdx||(this._currentSelIdx=0),this._currentSelIdx},c.prototype.changeMinScrollY=function(){this._minScrollY=this._height-Math.ceil(this._dataAry.length/this._contentX)*this.p_itemHeight},c.prototype.refreshData=function(a){this._dataAry=a,this._showIndexList=new Array;for(var b=0;b<this._itemList.length;b++)this._itemList[b].render(a[b]),this._itemList[b].baseY=float2int(b/this._contentX)*this.p_itemHeight,this._showIndexList.push(b);this._outSize=(this._contentY-this._showItemNum)*this.p_itemHeight,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._minScrollY=this._height-Math.ceil(this._dataAry.length/this._contentX)*this.p_itemHeight,this.scrollY(0),Math.ceil(a.length/this._contentX)<=this._showItemNum?this.scrollLock=!0:this.scrollLock=!1},c.prototype.setItemData=function(a,b){this._dataAry[b].data=a;for(var c=0;c<this._itemList.length;c++)if(this._itemList[c].itdata==this._dataAry[b]){this._itemList[c].refreshDraw();break}},c.prototype.clearItemByPos=function(a){this._dataAry[a].data=null;for(var b=0;b<this._itemList.length;b++)if(this._itemList[b].itdata==this._dataAry[a]){this._itemList[b].refreshDraw();break}},c.prototype.getDataSize=function(){return this._dataAry.length},c.prototype.refreshDraw=function(){for(var a=0;a<this._itemList.length;a++)this._itemList[a].refreshDraw()},c.prototype.scroll=function(){},c.prototype.interactiveEvent=function(b){return b.type==a.InteractiveEvent.Down?this.bgMask.testPoint(b.x,b.y)?(this._mouseY=b.y,(!this.scrollLock||this._dragFlag)&&(a.Scene_data.uiStage.addEventListener(a.InteractiveEvent.Move,this.onMove,this),a.Scene_data.uiStage.addEventListener(a.InteractiveEvent.Up,this.onUp,this)),!0):!1:b.type==a.InteractiveEvent.Up?this.bgMask.testPoint(b.x,b.y):!1},c.prototype.onMove=function(a){var b=a.y-this._mouseY;this._mouseY=a.y,0>b&&this.scrollLock||this.scrollY(b)},c.prototype.onUp=function(b){var c=this;a.Scene_data.uiStage.removeEventListener(a.InteractiveEvent.Move,this.onMove,this),a.Scene_data.uiStage.removeEventListener(a.InteractiveEvent.Up,this.onUp,this),this._dragFlag&&(this._dragY<0?this._dragDownFun&&this._dragDownFun():this._dragY>0&&this._dragUpFun&&this._dragUpFun(),0!=this._dragY&&TweenMoveTo(this,.5,{dragY:0,onUpdate:function(){c.refreshResultPos()}}))},c.prototype.setDragFun=function(a,b){this._dragUpFun=a,this._dragDownFun=b,a||b?this._dragFlag=!0:(this._dragFlag=!1,this._dragY=0)},Object.defineProperty(c.prototype,"dragY",{get:function(){return this._dragY},set:function(a){this._dragY=a},enumerable:!0,configurable:!0}),c.prototype.scrollIdx=function(a){var b=-this.p_itemHeight*a,c=b-this.p_scrollY,d=Math.ceil(Math.abs(c)/this.p_itemHeight);c/=d;for(var e=0;d>e;e++)this.scrollY(c)},c.prototype.getIdxY=function(a){return this.p_itemHeight*a},c.prototype.getIdxX=function(a){return this.p_itemWidth*a},c.prototype.scrollY=function(a){if(this._topSize-=a,this._bottomSize+=a,this._topSize<=0)if(this._bottomflag=!0,0==this._showDataIndex)this._topSize=0,this._bottomSize=this._outSize,this.p_scrollY=0,this._topflag=!1,this._dragFlag&&Math.abs(this._dragY)<this._dragMaxY&&(this._dragY+=a);else{for(var b=this._showIndexList[0],c=this._itemList[b].baseY-this.p_itemHeight,d=0;d<this._contentX;d++){var e=this._showIndexList.pop();this._showIndexList.unshift(e),this._itemList[e].baseY=c,this._itemList[e].render(this._dataAry[this._showDataIndex-1]),this._itemList[e].selected=this.getCurrentSelectIndex()==this._showDataIndex-1,this._showDataIndex--}this._bottomSize-=this.p_itemHeight,this._topSize+=this.p_itemHeight,this.p_scrollY+=a,this._topflag=!0}else if(this._bottomSize<=0)if(this._topflag=!0,this._showDataIndex+this._allItemNum>=this._dataAry.length)this._bottomSize=0,this._topSize=this._outSize,this.p_scrollY=-(Math.ceil(this._dataAry.length/this._contentX)-this._showItemNum)*this.p_itemHeight,this._bottomflag=!1;else{this._bottomflag=!0;for(var f=this._showIndexList[this._showIndexList.length-1],g=this._itemList[f].baseY+this.p_itemHeight,d=0;d<this._contentX;d++){var e=this._showIndexList.shift();this._showIndexList.push(e),this._itemList[e].baseY=g,this._itemList[e].render(this._dataAry[this._showDataIndex+this._allItemNum]),this._itemList[e].selected=this.getCurrentSelectIndex()==this._showDataIndex+this._allItemNum,this._showDataIndex++}this._bottomSize+=this.p_itemHeight,this._topSize-=this.p_itemHeight,this.p_scrollY+=a}else this._showItemNum>=this._dataAry.length?(this._topflag=!1,this._bottomflag=!1,this.p_scrollY=0):(this._topflag=!0,this._bottomflag=!0,this.p_scrollY+=a);this.p_scrollY<=this._minScrollY&&this._minScrollY<0&&(this.p_scrollY=this._minScrollY,this._topSize+=a,this._bottomSize-=a,this._topflag=!0,this._bottomflag=!1,this._dragFlag&&Math.abs(this._dragY)<this._dragMaxY&&(this._dragY+=a)),this.refreshResultPos(),this.backFun&&this.backFun(this._topflag,this._bottomflag,a)},c.prototype.refreshResultPos=function(){for(var a=0;a<this._itemList.length;a++)this._itemList[a].setY(this.p_scrollY+this._dragY)},c.prototype.dispose=function(){if(this._bgRender.dispose(),this._baseRender.dispose(),this.customRenderAry)for(var a=0;a<this.customRenderAry.length;a++)this.customRenderAry[a].dispose();this.bgMask.dispose()},c}(a.UIVirtualContainer);a.SList=b;var c=function(){function b(){this._height=10,this._list=new Array,this.index=0,this.baseY=0,this.baseX=0,this._selected=!1}return b.prototype.addUI=function(a){this._list.push(a)},b.prototype.create=function(a,b,c,d){void 0===d&&(d=null),this._bgRender=b,this._baseRender=c,this._customRenderAry=d},b.prototype.render=function(a){},b.prototype.refreshDraw=function(){},b.prototype.setSelect=function(){this.parentTarget.setSelect(this)},b.prototype.unSetSelect=function(){this.selected=!1},Object.defineProperty(b.prototype,"selected",{get:function(){return this._selected},set:function(a){this._selected=a},enumerable:!0,configurable:!0}),b.prototype.creatSUI=function(a,b,c,d,e,f,g){var h=b.getLayoutData(c),i=c+this.index;this.uiAtlas.addConfig(i,this.index,h.rect);var j=a.creatBaseComponent(i),h=new Object;return j.name=c,j.x=h.x=d,j.y=h.y=e,j.width=h.width=f,j.height=h.height=g,j.baseRec=h,this._list.push(j),j},b.prototype.creatGrid9Component=function(b,c,d,e){var f=new a.Grid9Compenent,g=this.uiAtlas.getGridRec(c);return g.ogw=d,g.ogh=e,f.tr.setRec(g),f.ogw=g.ogw,f.ogh=g.ogh,f.gw=f.ogw/g.pixelWitdh,f.gh=f.ogh/g.pixelHeight,f.tr.setRec(g),f.skinName=c,f.uiRender=b,f},b.prototype.creatGrid9SUI=function(a,b,c,d,e,f,g,h,i){void 0===h&&(h=5),void 0===i&&(i=5);var j=b.getLayoutData(c),k=c+this.index;this.uiAtlas.addConfig(k,this.index,j.rect);var l=this.creatGrid9Component(a,k,h,i),j=new Object;return l.name=c,l.x=j.x=d,l.y=j.y=e,l.width=j.width=f,l.height=j.height=g,l.baseRec=j,this._list.push(l),l},b.prototype.getHeight=function(){return this._height},b.prototype.setItemUiX=function(a,b){a.baseRec.x=b,this.setY(this._sy)},b.prototype.setY=function(a){this._sy=a;for(var b=a+this.baseY,c=0;c<this._list.length;c++)this._list[c].y=this._list[c].baseRec.y+b,this._list[c].x=this._list[c].baseRec.x+this.baseX},b.prototype.setX=function(a){this._sx=a;for(var b=a+this.baseX,c=0;c<this._list.length;c++)this._list[c].y=this._list[c].baseRec.y+this.baseY,this._list[c].x=this._list[c].baseRec.x+b},b}();a.SListItem=c;var d=function(){function a(){this.selected=!1}return a}();a.SListItemData=d;var e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.interactiveEvent=function(b){a.prototype.interactiveEvent.call(this,b);var c=this.slist.interactiveEvent(b);return c},b}(a.UIRenderComponent);a.SListBgRender=e;var f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.interactiveEvent=function(b){return a.prototype.interactiveEvent.call(this,b)},b}(a.UIRenderComponent);a.SlistFrontRender=f;var g=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.setData=function(b,c,d,e){this.ctx=a.UIManager.getInstance().getContext2D(b,c,!1),this.width=b,this.height=c,this.textureRes=a.TextureManager.getInstance().getCanvasTexture(this.ctx),this.xNum=d,this.yNum=e,this.itemWidth=b/this.xNum,this.itemHeight=c/this.yNum,this.configData=new Array},c.prototype.addConfig=function(a,b,c){var d=new Object,e=b%this.xNum*this.itemWidth,f=float2int(b/this.xNum)*this.itemHeight;d.ox=e+c.x,d.oy=f+c.y,d.ow=c.width,d.oh=c.height,d.x=d.ox/this.width,d.y=d.oy/this.height,d.width=d.ow/this.width,d.height=d.oh/this.height,d.name=a,this.configData.push(d)},c}(a.UIAtlas);a.SListAtlas=g;var h=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c._effRender=new a.FrameUIRender,c}return __extends(c,b),c.prototype.setEffectUrl=function(a,b,c,d){var e=this;void 0===d&&(d=1),this.effList&&this.effList.length>0?this.effectComplte():this._effRender.setImg(getEffectUIUrl(a),b,c,function(a){1==d?(e.effList=new Array,e.effList.push(a)):e.effList=a,e.effectComplte()},d)},c.prototype.initComplte=function(){this.addRender(this._effRender),this._effRender.mask=this.bgMask},c.prototype.effectComplte=function(){},c.prototype.refreshResultPos=function(){if(b.prototype.refreshResultPos.call(this),this.effList)for(var a=0;a<this.effList.length;a++)this.effList[a].y=this.effList[a].baseRec.y+this.p_scrollY,this.effList[a].x=this.effList[a].baseRec.x+this.p_scrollX},c.prototype.playEffect=function(a,b,c,d,e,f){void 0===f&&(f=3),this.effList&&this.effList.length>0&&(this.effList[a].x=b,this.effList[a].baseRec.y=c,this.effList[a].baseRec.x=b,this.effList[a].y=c+this.p_scrollY,this.effList[a].width=this.effList[a].baseRec.width*d,this.effList[a].height=this.effList[a].baseRec.height*e,this.effList[a].speed=f,this.effList[a].playOne(this))},c.prototype.effplay=function(a){a.parent||(this.addChild(a),a.play())},c.prototype.showEffect=function(a,b,c,d,e,f){void 0===f&&(f=3),this.effList&&this.effList.length>0&&(this.effList[a].x=b,this.effList[a].baseRec.y=c,this.effList[a].baseRec.x=b,this.effList[a].y=c+this.p_scrollY,this.effList[a].width=this.effList[a].baseRec.width*d,this.effList[a].height=this.effList[a].baseRec.height*e,this.effList[a].speed=f,this.effplay(this.effList[a]))},c.prototype.hideEffect=function(a){if(void 0===a&&(a=-1),this.effList&&this.effList.length>0)if(-1==a)for(var b=0;b<this.effList.length;b++)this.effList[b].parent&&this.effList[b].parent.removeChild(this.effList[b]);else a<this.effList.length&&a>=0&&this.effList[a].parent&&this.effList[a].parent.removeChild(this.effList[a])},c.prototype.dispose=function(){b.prototype.dispose.call(this),this._effRender.dispose()},c}(b);a.EffectSlist=h;var i=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._minScrollX=0,a._mouseX=0,a}return __extends(c,b),c.prototype.setData=function(b,c,d,h,i,j,k,l,m,n,o,p){void 0===p&&(p=0),this.width=d,this._height=h,this.p_itemWidth=i,this.p_itemHeight=j,this._showIndexList=new Array,this._dataAry=b,this._showItemNum=k,this._allItemNum=n*o,this._contentX=n,this._contentY=o,this._outSize=(n-this._showItemNum)*i,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._sAtlas=new g,this._sAtlas.setData(l,m,n,o),this.bgMask=new a.UIMask,this.bgMask.x=0,this.bgMask.y=0,this.bgMask.width=d,this.bgMask.height=h,this.bgMask.level=this._maskLevel,this.addMask(this.bgMask),this._bgRender=new e,this._bgRender.uiAtlas=this._sAtlas,this._bgRender.slist=this,this.addRender(this._bgRender),this._baseRender=new f,this._baseRender.uiAtlas=this._sAtlas,this.addRender(this._baseRender),this._bgRender.mask=this.bgMask,this._baseRender.mask=this.bgMask;var q;if(0!=p){q=new Array;for(var r=0;p>r;r++){var s=new f;s.uiAtlas=this._sAtlas,this.addRender(s),s.mask=this.bgMask,q.push(s)}}this._itemList=new Array;for(var r=0;r<this._allItemNum;r++){var t=new c;t.baseX=float2int(r/o)*i,t.baseY=r%o*j,t.uiAtlas=this._sAtlas,t.index=r,t.parentTarget=this,t.create(this,this._bgRender,this._baseRender,q),t.render(this._dataAry[r]),this._itemList.push(t),this._showIndexList.push(r)}this._minScrollX=this.width-float2int(this._dataAry.length/this._contentY)*this.p_itemWidth,this.scrollX(0),this.initComplte()},c.prototype.changeMinScrollX=function(){this._minScrollX=this.width-float2int(this._dataAry.length/this._contentY)*this.p_itemWidth},c.prototype.refreshData=function(a){this._dataAry=a,this._showIndexList=new Array;for(var b=0;b<this._itemList.length;b++)this._itemList[b].render(this._dataAry[b]),this._itemList[b].baseX=float2int(b/this._contentY)*this.p_itemWidth,this._showIndexList.push(b);this._outSize=(this._contentX-this._showItemNum)*this.p_itemWidth,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._minScrollX=this.width-float2int(this._dataAry.length/this._contentY)*this.p_itemWidth,this.scrollX(0),Math.ceil(a.length/this._contentY)<=this._showItemNum?this.scrollLock=!0:this.scrollLock=!1},c.prototype.interactiveEvent=function(b){return b.type==a.InteractiveEvent.Down&&this.bgMask.testPoint(b.x,b.y)?(this._mouseX=b.x,this.scrollLock||(a.Scene_data.uiStage.addEventListener(a.InteractiveEvent.Move,this.onMove,this),a.Scene_data.uiStage.addEventListener(a.InteractiveEvent.Up,this.onUp,this)),!0):!1},c.prototype.onMove=function(a){var b=a.x-this._mouseX;this._mouseX=a.x,0>b&&this.scrollLock||this.scrollX(b)},c.prototype.onUp=function(b){a.Scene_data.uiStage.removeEventListener(a.InteractiveEvent.Move,this.onMove,this),a.Scene_data.uiStage.removeEventListener(a.InteractiveEvent.Up,this.onUp,this)},c.prototype.scrollX=function(a){if(this._topSize-=a,this._bottomSize+=a,this._topSize<=0)if(this._bottomflag=!0,0==this._showDataIndex)this._topSize=0,this._bottomSize=this._outSize,this.p_scrollX=0,this._topflag=!1;else{for(var b=this._showIndexList[0],c=this._itemList[b].baseX-this.p_itemWidth,d=0;d<this._contentY;d++){var e=this._showIndexList.pop();this._showIndexList.unshift(e),this._itemList[e].baseX=c,this._itemList[e].render(this._dataAry[this._showDataIndex-1]),this._itemList[e].selected=this.getCurrentSelectIndex()==this._showDataIndex-1,this._showDataIndex--}this._bottomSize-=this.p_itemWidth,this._topSize+=this.p_itemWidth,this.p_scrollX+=a,this._topflag=!0}else if(this._bottomSize<=0)if(this._topflag=!0,this._showDataIndex+this._allItemNum>=this._dataAry.length)this._bottomSize=0,this._topSize=this._outSize,this.p_scrollX=-(Math.ceil(this._dataAry.length/this._contentY)-this._showItemNum)*this.p_itemWidth,this._bottomflag=!1;else{this._bottomflag=!0;for(var f=this._showIndexList[this._showIndexList.length-1],g=this._itemList[f].baseX+this.p_itemWidth,d=0;d<this._contentY;d++){var e=this._showIndexList.shift();this._showIndexList.push(e),this._itemList[e].baseX=g,this._itemList[e].render(this._dataAry[this._showDataIndex+this._allItemNum]),this._itemList[e].selected=this.getCurrentSelectIndex()==this._showDataIndex+this._allItemNum,this._showDataIndex++}this._bottomSize+=this.p_itemWidth,this._topSize-=this.p_itemWidth,this.p_scrollX+=a}else this._showItemNum>=this._dataAry.length?(this._topflag=!1,this._bottomflag=!1,this.p_scrollX=0):(this._topflag=!0,this._bottomflag=!0,this.p_scrollX+=a);this.p_scrollX<=this._minScrollX&&this._minScrollX<0&&(this.p_scrollX=this._minScrollX,this._topSize+=a,this._bottomSize-=a,this._topflag=!0,this._bottomflag=!1),this.refreshResultPos(),this.backFun&&this.backFun(this._topflag,this._bottomflag,a)},c.prototype.scrollIdx=function(a){var b=-this.p_itemWidth*a,c=b-this.p_scrollX,d=Math.ceil(Math.abs(c)/this.p_itemWidth);c/=d;for(var e=0;d>e;e++)this.scrollX(c)},c.prototype.refreshResultPos=function(){for(var a=0;a<this._itemList.length;a++)this._itemList[a].setX(this.p_scrollX);if(this.effList)for(var a=0;a<this.effList.length;a++)this.effList[a].x=this.effList[a].baseRec.x+this.p_scrollX},c}(h);a.TransverseSList=i}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function d(){return b.call(this)||this}return __extends(d,b),d.prototype.testPoint=function(b,c){return b>this.absoluteX&&b<this.absoluteX+this._showWidth*a.UIData.Scale&&c>this.absoluteY&&c<this.absoluteY+this._oHeight*a.UIData.Scale?!0:!1},d.prototype.setGridData=function(a,b,d,e,f,g,h,i,j){void 0===i&&(i=256),void 0===j&&(j=300),this.uiRender.uiAtlas&&this.uiRender.uiAtlas.dispose(),this.width=g,this.height=h,this._showWidth=i,this._showHeight=j,this.data=a,this.wNum=d,this._itemWidth=e,this._itemHeight=f;var k=new c;this.uiRender.setAtlas(k),k.setGridData(g,h,e,f,d,a.length),this._itemRenderAry=new Array;for(var l=0;l<a.length;l++){var m=new b;m.setData(a[l],k,k.configData[l]),this._itemRenderAry.push(m)}this._oHeight=f*Math.ceil(this._itemRenderAry.length/this.wNum),this._oHeight>this._showHeight?this._needScoller=!0:this._needScoller=!1,this.uiRender.applyObjData()},d.prototype.setGridItemData=function(a,b){var c=this._itemRenderAry[b].listItemData.data?!0:!1;return this._itemRenderAry[b].setNewData(a),c},d.prototype.setGridItemFun=function(a,b){this._itemRenderAry[b].listItemData.clickFun=a},d.prototype.clearItemByIndex=function(a){for(var b=0;b<this._itemRenderAry.length;b++)this._itemRenderAry[b].listItemData.data&&this._itemRenderAry[b].listItemData.data.dataIndex==a&&(this._itemRenderAry[b].setNewData(null),this._itemRenderAry[b].listItemData.clickFun=null)},d.prototype.clearItemByPos=function(a){this._itemRenderAry[a].setNewData(null),this._itemRenderAry[a].listItemData.clickFun=null},d.prototype.redraw=function(){for(var a=0;a<this._itemRenderAry.length;a++)this._itemRenderAry[a].redraw()},d.prototype.testItemClick=function(b,c){var d=b-this.absoluteX,e=c-this.absoluteY,f=this._itemHeight*a.UIData.Scale,g=this._itemWidth*a.UIData.Scale,h=float2int(d/g),i=float2int(e/f),j=i*this.wNum+h;j>=this._itemRenderAry.length||this._itemRenderAry[j].click(d-g*(h-1),e-f*(i-1))},d.prototype.pushVaData=function(a,b,c){if(!this._itemRenderAry)return 0;for(var d=Math.ceil(this._itemRenderAry.length/this.wNum),e=this._itemWidth/this.width,f=this._itemHeight/this.height,b=0;d+1>b;b++)for(var g=0;g<this.wNum+1;g++)a.vertices.push(g*e,-b*f,0),a.uvs.push(g*e,b*f,0);for(var h=d*this.wNum,g=0;h>g;g++){var i=g%this.wNum+float2int(g/this.wNum)*(this.wNum+1),j=i+c,k=i+1+c,l=i+this.wNum+1+c,m=i+1+this.wNum+1+c;a.indexs.push(j,k,m,j,m,l)}return c+2*(this._itemRenderAry.length+1)},d}(a.List);a.GridList=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getAlphaImg=function(a,b){for(var c=this.ctx.createImageData(a,b),d=0;d<c.data.length;d++)c.data[d]=0;return c},c.prototype.setGridData=function(b,c,d,e,f,g){this.ctx=a.UIManager.getInstance().getContext2D(b,c,!1),this.ctx.fillStyle="rgba(0,0,0,0.0)",this.ctx.fillRect(0,0,b,c),this.textureRes=a.TextureManager.getInstance().getCanvasTexture(this.ctx),this.configData=new Array;for(var h=Math.ceil(g/f),i=0,j=0;h>j;j++)for(var k=0;f>k;k++){i=j*f+k;var l=new Object;l.ox=k*d,l.oy=j*e,l.ow=d,l.oh=e,l.x=k*d/b,l.y=j*e/c,l.width=d/b,l.height=e/c,l.name=i.toString(),this.configData.push(l)}},c}(a.ListAtlas);a.GridListAtlas=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function e(){
var a=b.call(this)||this;return a.initProgram(),a}return __extends(e,b),e.prototype.setVc=function(){for(var a=0;a<this._uiList.length;a++)this._uiList[a].setVc(this.shader,a);b.prototype.setVc.call(this)},e.prototype.initProgram=function(){a.ProgrmaManager.getInstance().registe(d.CdUIShader,new d),this.shader=a.ProgrmaManager.getInstance().getProgram(d.CdUIShader),this.program=this.shader.program,this.uiProLocation=a.Scene_data.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=a.Scene_data.context3D.getLocation(this.program,"ui2"),this.dataTProLocation=a.Scene_data.context3D.getLocation(this.program,"dataT")},e.prototype.getComponent=function(a){var b=this.uiAtlas.getLayoutData(a),c=this.creatBaseComponent(b.dataItem[0]);return c.width=b.rect.width,c.height=b.rect.height,c.x=b.rect.x,c.y=b.rect.y,c.baseRec=b.rect,c.name=a,c},e.prototype.creatBaseComponent=function(a){var b=new c;b.skinName=a;var d=this.uiAtlas.getRec(a);return b.tr.setRec(d),b.width=d.pixelWitdh,b.height=d.pixelHeight,b.uiRender=this,b},e}(a.UIRenderComponent);a.CdRenderComponent=b;var c=function(b){function c(){var a=b.call(this)||this;return a.cdTotalnum=0,a.lastTime=0,a._skipNum=0,a.isRound=!1,a.visible=!0,a.clockwise=!0,a._skipNum=float2int(360*Math.random()),a}return __extends(c,b),c.prototype.setCdNum=function(a){this._skipNum=360*a},Object.defineProperty(c.prototype,"isFinish",{get:function(){return this._skipNum>=360?!0:!1},enumerable:!0,configurable:!0}),c.prototype.update=function(){if(0!=this.cdTotalnum){var c=(a.TimeUtil.getTimer()-this.lastTime)/this.cdTotalnum;1>c?this.setCdNum(c):this.setCdNum(1)}b.prototype.update.call(this)},c.prototype.setVc=function(b,c){var d=this._skipNum%360/180*Math.PI;a.Scene_data.context3D.setVc4fv(b,"dataTime["+c+"]",[d,this.clockwise?0:1,0,1])},c}(a.UICompenent),d=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[20];uniform vec4 ui2[20];uniform vec4 dataTime[20];varying vec2 v_pos;\nvarying vec2 u_pos;varying vec4 v_dataTime;void main(void){   vec4 data = ui2[int(v2uv.z)];   v_dataTime = dataTime[int(v2uv.z)];   v_pos = vec2(v3Pos.x ,v3Pos.y);   u_pos = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 u_pos;\nvarying vec2 v_pos;varying vec4 v_dataTime;\nvoid main(void)\n{\nfloat alpha =1.0;\nfloat tx =v_pos.x*2.0 - 1.0;\nfloat ty =v_pos.y*2.0 + 1.0;\nfloat atanNum =atan(tx,ty);\nvec4 infoUv = texture2D(s_texture, u_pos.xy);\ninfoUv.xyz *= infoUv.w;\nif (tx>0.0) {\nif (v_dataTime.x<atanNum) {\nalpha=0.0;\n}; \n} else {\natanNum =atanNum+6.283;\nif (v_dataTime.x<atanNum) {\nalpha=0.0;\n}; \n}; \nif (v_dataTime.y==1.0) {\nalpha=1.0-alpha;\n}; \ngl_FragColor = infoUv*alpha;\n}";return a},b.CdUIShader="CdUIShader",b}(a.Shader3D)}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(){function b(){this.dtime=-1,this.time=0,this.oldPos=new a.Vector2D}return b.prototype.needUpData=function(b){return this.oldPos.x!=b.x||this.oldPos.y!=b.y||a.Scene_data.cam3D.needChange?(this.oldPos.x=b.x,this.oldPos.y=b.y,!0):!1},Object.defineProperty(b.prototype,"rightTabInfoVo",{get:function(){return this._data},set:function(a){this._data=a,this.makeData(),this.time=0,this.update()},enumerable:!0,configurable:!0}),b.prototype.makeData=function(){},b.prototype.update=function(){},b.prototype.Vector3DToVector2D=function(b){var c=a.Scene_data.cam3D.cameraMatrix.clone();c.append(a.Scene_data.viewMatrx3D.clone());var d=c.transformVector(b),e=new a.Vector2D;return e.x=(d.x/d.w+1)*(a.Scene_data.stageWidth/2)/a.UIData.Scale-this.ui.width/2,e.y=(-d.y/d.w+1)*(a.Scene_data.stageHeight/2)/a.UIData.Scale-this.ui.height/2,e},b.prototype.isEqualLastKey=function(a){return!1},b}();a.Disp2DBaseText=b;var c=function(b){function c(c,d,e){var f=b.call(this)||this;return f.width=a.UIData.designWidth,f.height=a.UIData.designHeight,f.creatBaseRender(),f.addRender(f._baseRender),f.mathSize(d,e),f.initData(c,d,e),f}return __extends(c,b),c.prototype.creatBaseRender=function(){this._baseRender=new a.UIRenderComponent},c.prototype.initData=function(b,c,d){this._voNum=Math.floor(d),this._voRect=c;var e=Math.pow(2,Math.ceil(Math.log(c.x*c.width)/Math.log(2))),f=Math.pow(2,Math.ceil(Math.log(c.x*c.width)/Math.log(2)));this._textureRect=new a.Rectangle(0,0,e,f),this._baseRender.uiAtlas=new a.UIAtlas;var g=this._baseRender.uiAtlas;g.configData=new Array,g.ctx=a.UIManager.getInstance().getContext2D(this._textureRect.width,this._textureRect.height,!1),g.textureRes=a.TextureManager.getInstance().getCanvasTexture(g.ctx),this.makeBaseUi(b)},c.prototype.mathSize=function(a,b){for(a.x=0,a.y=0;a.x*a.y<b;)a.x*a.width>a.y*a.height?a.y++:a.x++},c.prototype.makeBaseUi=function(a){var b=this._baseRender.uiAtlas;this._uiItem=new Array,this._lostItem=new Array;for(var c=0;c<this._voRect.x;c++)for(var d=0;d<this._voRect.y;d++){var e=new a;this._uiItem.push(e),e.parent=this._baseRender,e.voRect=this._voRect,e.textureStr="id_"+c+"_"+d,b.configData.push(b.getObject(e.textureStr,c*this._voRect.width,d*this._voRect.height,this._voRect.width,this._voRect.height,this._textureRect.width,this._textureRect.height)),e.ui=this._baseRender.creatBaseComponent(e.textureStr),e.ui.baseRec=this._voRect.clone()}},c.prototype.showTemp=function(a){this.clearLostItem();for(var b,c=0;c<this._uiItem.length;c++)if(null==this._uiItem[c].rightTabInfoVo&&this._uiItem[c].isEqualLastKey(a)){b=this._uiItem[c];break}if(!b)for(var d=0;d<this._uiItem.length;d++)if(null==this._uiItem[d].rightTabInfoVo){b=this._uiItem[d];break}return b?(b.rightTabInfoVo=a,this.addChild(b.ui)):this._lostItem.push(a),b},c.prototype.clearLostItem=function(){for(var a=this._lostItem.length-1;a>0;a--)this._lostItem[a].clear&&this._lostItem.splice(a,1)},c.prototype.playLost=function(){this._lostItem.length&&this.showTemp(this._lostItem.pop())},c.prototype.clearOneTemp=function(){for(var a=0;a<this._uiItem.length;a++)if(!this._uiItem[a].rightTabInfoVo)return;this._lostItem.length=0,this.clearTemp(this._uiItem[0].rightTabInfoVo)},c.prototype.clearTemp=function(a){for(var b=0;b<this._uiItem.length;b++)if(this._uiItem[b].rightTabInfoVo==a){this._uiItem[b].rightTabInfoVo=null,this.removeChild(this._uiItem[b].ui);break}this.playLost()},c.prototype.getVoByData=function(a){for(var b=0;b<this._uiItem.length;b++)if(this._uiItem[b].rightTabInfoVo==a)return this._uiItem[b]},c.prototype.getVoByUi=function(a){for(var b=0;b<this._uiItem.length;b++)if(this._uiItem[b].rightTabInfoVo&&this._uiItem[b].ui==a)return this._uiItem[b]},c.prototype.clearAll=function(){for(var a=0;a<this._uiItem.length;a++)this._uiItem[a].rightTabInfoVo&&this.clearTemp(this._uiItem[a].rightTabInfoVo)},c.prototype.update=function(a){for(var b=0;b<this._uiItem.length;b++)this._uiItem[b].rightTabInfoVo&&this._uiItem[b].update()},c.prototype.getUiItemLen=function(){for(var a=0,b=0;b<this._uiItem.length;b++)this._uiItem[b].rightTabInfoVo&&a++;return a},c}(a.Dis2DUIContianerBase);a.Dis2DUIContianerPanel=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[40];uniform vec4 ui2[40];uniform float alpha[40];varying vec2 v_texCoord;varying float v_alpha;void main(void){   vec4 data = ui2[int(v2uv.z)];   v_texCoord = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   v_alpha = alpha[int(v2uv.z)];   data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvarying float v_alpha;void main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ninfoUv *=v_alpha;\ngl_FragColor = infoUv;\n}";return a},b.AlphaUiShader="AlphaUiShader",b}(a.Shader3D);a.AlphaUIShader=b;var c=function(c){function g(){return c.call(this)||this}return __extends(g,c),g.prototype.update=function(){if(this.visible&&0!=this._uiList.length){a.Scene_data.context3D.setBlendParticleFactors(0),a.Scene_data.context3D.setProgram(this.program);for(var b=0;b<this._uiList.length;b++)this._uiList[b].update(),this._uiList[b].setVc(this.shader,b);a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),this.uiAtlas?a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.uiAtlas.texture,0):a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},g.prototype.initData=function(){this._uiList=new Array,this.objData=new a.ObjData,a.ProgrmaManager.getInstance().registe(b.AlphaUiShader,new b),this.shader=a.ProgrmaManager.getInstance().getProgram(b.AlphaUiShader),this.program=this.shader.program,this.uiProLocation=a.Scene_data.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=a.Scene_data.context3D.getLocation(this.program,"ui2"),this.alphaLocation=a.Scene_data.context3D.getLocation(this.program,"alpha")},g.prototype.creatBaseComponent=function(a){var b=new f;b.skinName=a;var c=this.uiAtlas.getRec(a);return b.tr.setRec(c),b.width=c.pixelWitdh,b.height=c.pixelHeight,b.uiRender=this,b},g.prototype.creatGrid9Component=function(a,b,c){var d=new e;d.skinName=a;var f=this.uiAtlas.getGridRec(a);return d.tr.setRec(f),d.ogw=f.ogw,d.ogh=f.ogh,d.gw=d.ogw/f.pixelWitdh,d.gh=d.ogh/f.pixelHeight,d.width=b,d.height=c,d.uiRender=this,d},g.prototype.createFrame=function(a){var b=new d;b.skinName=a;var c=this.uiAtlas.getRec(a);return b.setFrameData(c),b.uiRender=this,b},g}(a.UIRenderComponent);a.AlphaUIRenderComponent=c;var d=function(b){function c(){var a=b.call(this)||this;return a.alpha=1,a}return __extends(c,b),c.prototype.setVc=function(b,c){a.Scene_data.context3D.setVc4fv(b,"ui["+c+"]",this.renderData),a.Scene_data.context3D.setVc4fv(b,"ui2["+c+"]",this.renderData2),a.Scene_data.context3D.setVc1fv(b,"alpha["+c+"]",[this.alpha])},c}(a.FrameCompenent);a.AlphaFrameCompenent=d;var e=function(b){function c(){var a=b.call(this)||this;return a.alpha=1,a}return __extends(c,b),c.prototype.setVc=function(b,c){a.Scene_data.context3D.setVc4fv(b,"ui["+c+"]",this.renderData),a.Scene_data.context3D.setVc4fv(b,"ui2["+c+"]",this.renderData2),a.Scene_data.context3D.setVc1fv(b,"alpha["+c+"]",[this.alpha])},c}(a.Grid9Compenent);a.AlphaGrid9UICompenent=e;var f=function(b){function c(){var a=b.call(this)||this;return a.alpha=1,a}return __extends(c,b),c.prototype.setVc=function(b,c){a.Scene_data.context3D.setVc4fv(b,"ui["+c+"]",this.renderData),a.Scene_data.context3D.setVc4fv(b,"ui2["+c+"]",this.renderData2),a.Scene_data.context3D.setVc1fv(b,"alpha["+c+"]",[this.alpha])},c}(a.UICompenent);a.AlphaUICompenent=f;var g=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}return __extends(b,a),b.prototype.creatBaseRender=function(){this._baseRender=new c},b}(a.Dis2DUIContianerPanel);a.AlphaUiContianer=g}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[40];uniform vec4 ui2[40];uniform vec2 paix[40];uniform float rotation[40];uniform float sc;varying vec2 v_texCoord;void main(void){   vec4 data = ui2[int(v2uv.z)];   v_texCoord = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   float angle = rotation[int(v2uv.z)];   data = ui[int(v2uv.z)];vec3 pos = vec3(0.0,0.0,0.0);pos.x = v3Pos.x;pos.y = v3Pos.y ;pos.x = pos.x-0.5;pos.y = pos.y+0.5 ;pos.xy =pos.xy+ paix[int(v2uv.z)].xy;pos.xy = pos.xy * data.zw * 2.0;pos.y=pos.y/sc;vec3 ptpos = pos;vec4 np = vec4(sin(angle), cos(angle), 0, 0);\npos.x = np.x * ptpos.y + np.y * ptpos.x;\npos.y = np.y * ptpos.y - np.x * ptpos.x;\npos.y=pos.y*sc;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return a},b.RoationUiShader="RoationUiShader",b}(a.Shader3D);a.RoationUIShader=b;var c=(function(d){function e(){return d.call(this)||this}return __extends(e,d),e.prototype.update=function(){if(this.visible&&0!=this._uiList.length){a.Scene_data.context3D.setBlendParticleFactors(0),a.Scene_data.context3D.setProgram(this.program);for(var b=0;b<this._uiList.length;b++)this._uiList[b].update(),this._uiList[b].setVc(this.shader,b);a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),this.uiAtlas?a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.uiAtlas.texture,0):a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},e.prototype.initData=function(){this._uiList=new Array,this.objData=new a.ObjData,a.ProgrmaManager.getInstance().registe(b.RoationUiShader,new b),this.shader=a.ProgrmaManager.getInstance().getProgram(b.RoationUiShader),this.program=this.shader.program,this.uiProLocation=a.Scene_data.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=a.Scene_data.context3D.getLocation(this.program,"ui2"),this.alphaLocation=a.Scene_data.context3D.getLocation(this.program,"rotation")},e.prototype.creatBaseComponent=function(a){var b=new c;b.skinName=a;var d=this.uiAtlas.getRec(a);return b.tr.setRec(d),b.width=d.pixelWitdh,b.height=d.pixelHeight,b.uiRender=this,b},e}(a.UIRenderComponent),function(b){function c(){var c=b.call(this)||this;return c.rotation=0,c.aotuRotation=0,c.paix=new a.Vector2D(0,0),c}return __extends(c,b),c.prototype.setVc=function(b,c){this.rotation+=this.aotuRotation,a.Scene_data.context3D.setVc4fv(b,"ui["+c+"]",this.renderData),a.Scene_data.context3D.setVc4fv(b,"ui2["+c+"]",this.renderData2),a.Scene_data.context3D.setVc2fv(b,"paix["+c+"]",[this.paix.x,this.paix.y]),a.Scene_data.context3D.setVc1fv(b,"rotation["+c+"]",[this.rotation*Math.PI/180]),a.Scene_data.context3D.setVc1fv(b,"sc",[a.Scene_data.stageWidth/a.Scene_data.stageHeight])},c}(a.UICompenent))}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function d(){return b.call(this)||this}return __extends(d,b),d.prototype.setImg=function(b,c,d,e,f){var g=this;void 0===f&&(f=1),a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+b,function(b){var h=new a.UIAtlas;if(h.textureRes=b,g.uiAtlas=h,1==f)e(g.getFrameTipComponent(c,d));else{for(var i=new Array,j=0;f>j;j++)i.push(g.getFrameTipComponent(c,d));e(i)}})},d.prototype.update=function(){b.prototype.update.call(this);for(var a=this._uiList.length-1;a>=0;a--)this._uiList[a]instanceof c&&this._uiList[a].updateEnd()},d.prototype.getFrameTipComponent=function(b,d){var e=new c,f=new a.UIRectangle;f.x=0,f.y=0,f.width=1,f.height=1,f.pixelWitdh=this.uiAtlas.textureRes.width,f.pixelHeight=this.uiAtlas.textureRes.height,f.pixelX=0,f.pixelY=0,f.type=2,f.cellX=b,f.cellY=d,e.setFrameData(f),e.uiRender=this;var g=new Object;return g.width=this.uiAtlas.textureRes.width/b,g.height=this.uiAtlas.textureRes.height/d,g.x=0,g.y=0,e.width=g.width,e.height=g.height,e.x=g.x,e.y=g.y,e.baseRec=g,e},d}(a.UIRenderComponent);a.FrameUIRender=b;var c=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.playOne=function(a){this.parent||a.addChild(this),this.endFlag=!1,this.goToAndPlay(0)},b.prototype.updateEnd=function(){this.endFlag&&this.parent.removeChild(this)},b}(a.FrameCompenent);a.FrameTipCompenent=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this._dic=new Object,this._loadDic=new Object}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a}();a.IconManager=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._scale=1}return Object.defineProperty(b.prototype,"ui",{get:function(){return this._ui},set:function(b){this._ui=b,this._baseRect=new a.Rectangle(this._ui.x,this._ui.y,this._ui.width,this._ui.height)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scale",{get:function(){return this._scale},set:function(a){this._scale=a,this._ui.width=this._baseRect.width*this._scale,this._ui.height=this._baseRect.height*this._scale,this._ui.x=this._baseRect.x+(this._baseRect.width-this._ui.width)/2,this._ui.y=this._baseRect.y+(this._baseRect.height-this._ui.height)/2},enumerable:!0,configurable:!0}),b.prototype.destory=function(){this._ui=null,this._scale=null,this._baseRect=null},b.getPosByPanel=function(b,c,d){if(void 0===c&&(c=null),void 0===d&&(d=null),this.baseUIConatiner||(this.baseUIConatiner=new a.UIConatiner),this.baseUIConatiner.width=a.UIData.designWidth,this.baseUIConatiner.height=a.UIData.designHeight,this.baseUIConatiner.middle=0,this.baseUIConatiner.center=0,c)for(var e in c)this.baseUIConatiner[e]=c[e];this.baseUIConatiner.resize();var f=new a.Vector2D;return f.x=b.x+this.baseUIConatiner.x/a.UIData.Scale,f.y=b.y+this.baseUIConatiner.y/a.UIData.Scale,d&&(f.x=f.x-d.x/a.UIData.Scale,f.y=f.y-d.y/a.UIData.Scale),f},b}();a.UiTweenVo=b;var c=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.changeButSize=function(a){var c=this;this._uiTweenVo||(this._uiTweenVo=new b,this._uiTweenVo.ui=a,this._uiTweenVo.scale=1,TweenMoveTo(this._uiTweenVo,.07,{scale:1.2,onComplete:function(){c.changeButScale()}}))},a.prototype.changeButScale=function(){var a=this;this._uiTweenVo.scale=1.2,TweenMoveTo(this._uiTweenVo,.05,{scale:1,onComplete:function(){a.changeButEnd()}})},a.prototype.changeButEnd=function(){this._uiTweenVo.destory(),this._uiTweenVo=null},a}();a.UiTweenScale=c;var d=function(){function b(){this._eventItem=new Array,this.lastTime=0,a.Scene_data.uiStage=new a.UIStage,a.Scene_data.uiBlankStage=new a.UIStage,this._canvas=document.createElement("canvas"),this._canvas.style.zIndex="3",this._canvas.width=200,this._canvas.height=200,this._canvas.style.left=200,this._canvas.style.top=300,this._ctx=this._canvas.getContext("2d"),this._ctx.textBaseline=a.TextAlign.TOP}return b.getInstance=function(){var a=this;return this._instance||(this._instance=new b,b.popClikNameFun=function(b,c){void 0===c&&(c=0),a.uiClikName(b,c)}),this._instance},b.uiClikName=function(a,b){},b.prototype.getContext2D=function(b,c,d){return void 0===d&&(d=!0),this._canvas.width=b,this._canvas.height=c,this._ctx.clearRect(0,0,b,c),d=!0,d&&(this._ctx.textBaseline=a.TextAlign.TOP,this._ctx.textAlign=a.TextAlign.LEFT),this._ctx},b.prototype.getGrayImageDatabyImg=function(a){var c=b.getInstance().getContext2D(a.width,a.height,!1);c.drawImage(a,0,0);for(var d,e=c.getImageData(0,0,a.width,a.height),f=0;f<e.data.length;f+=4)d=Math.floor(.3*e.data[f+0])+Math.floor(.59*e.data[f+1])+Math.floor(.11*e.data[f+2]),e.data[f+0]=d,e.data[f+1]=d,e.data[f+2]=d;return e},b.prototype.makeCtxToGray=function(a,b){for(var c,d=a.getImageData(b.x,b.y,b.width,b.height),e=0;e<d.data.length;e+=4)c=Math.floor(.3*d.data[e+0])+Math.floor(.59*d.data[e+1])+Math.floor(.11*d.data[e+2]),c=.5*c+.5,d.data[e+0]=c,d.data[e+1]=c,d.data[e+2]=c;a.putImageData(d,b.x,b.y)},b.prototype.showCanvas=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this._canvas.style.left=a,this._canvas.style.top=b,document.getElementById("root").appendChild(this._canvas)},b.prototype.init=function(){a.ProgrmaManager.getInstance().registe(a.UIShader.UI_SHADER,new a.UIShader),a.ProgrmaManager.getInstance().registe(a.UIImageShader.UI_IMG_SHADER,new a.UIImageShader),a.ProgrmaManager.getInstance().registe(a.UIMaskShader.UI_MASK_SHADER,new a.UIMaskShader),a.ProgrmaManager.getInstance().registe(a.Movie2DShader.MOVIE2D_SHADER,new a.Movie2DShader),a.ProgrmaManager.getInstance().registe(a.Sprite2DShader.SPRITE2D_SHADER,new a.Sprite2DShader),this._uiList=new Array,this._containerList=new Array,a.UIData.setDesignWH(960,540)},b.prototype.addUI=function(a){for(var b=0,c=this._uiList.length-1;c>=0;c--)if(this._uiList[c].sortnum<=a.sortnum){b=c+1;break}this._uiList.splice(b,0,a),a.rendering=!0},b.prototype.removeUI=function(a){var b=this._uiList.indexOf(a);a.rendering=!1,-1!=b&&this._uiList.splice(b,1)},b.prototype.addUIContainer=function(a){if(!a.hasStage){this._containerList.push(a),a.resize();for(var b=0;b<a.renderList.length;b++)this.addUI(a.renderList[b]);a.hasStage=!0}},b.prototype.removeAll=function(){for(;this._containerList.length;)this.removeUIContainer(this._containerList[this._containerList.length-1])},b.prototype.removeUIContainer=function(a){if(a.hasStage){var b=this._containerList.indexOf(a);a.hasStage=!1,-1!=b&&this._containerList.splice(b,1);for(var c=0;c<a.renderList.length;c++)this.removeUI(a.renderList[c])}},b.prototype.hasWindowUI=function(){return!1},b.prototype.removeNoInterfaceUI=function(){for(var a=this._containerList.length-1;a>=0;a--)this._containerList[a].interfaceUI||this.removeUIContainer(this._containerList[a])},b.prototype.resize=function(){if(this._uiList){a.UIData.resize();for(var b=0;b<this._uiList.length;b++)this._uiList[b].resize();for(var b=0;b<this._containerList.length;b++)this._containerList[b].resize()}},b.prototype.upBgGroundZero=function(){for(var a=0;a<this._uiList.length;a++)(-1==this._uiList[a].container.layer||-1==this._uiList[a].sortnum)&&this._uiList[a].update()},b.prototype.update=function(){for(var a=0;a<this._uiList.length;a++)this._uiList[a].container.layer>=0&&-1!=this._uiList[a].sortnum&&this._uiList[a].update()},b.prototype.regEvent=function(a){},b.prototype.onTouch=function(a){this.interactiveEvent(a)},b.prototype.onMouse=function(a){this.interactiveEvent(a)},b.prototype.interactiveEvent=function(b){var c,d=new a.Vector2D;if(b instanceof MouseEvent)b.type==a.MouseType.MouseDown?c=new a.InteractiveEvent(a.InteractiveEvent.Down):b.type==a.MouseType.MouseUp?c=new a.InteractiveEvent(a.InteractiveEvent.Up):b.type==a.MouseType.MouseMove?c=new a.InteractiveEvent(a.InteractiveEvent.Move):b.type==a.MouseType.MouseClick,d.x=b.pageX,d.y=b.pageY;else if(b.type==a.MouseType.TouchStart?(c=new a.InteractiveEvent(a.InteractiveEvent.Down),b.touches.length>1?(d.x=b.touches[b.touches.length-1].pageX,d.y=b.touches[b.touches.length-1].pageY):(d.x=b.pageX,d.y=b.pageY)):b.type==a.MouseType.TouchEnd?(c=new a.InteractiveEvent(a.InteractiveEvent.Up),d.x=b.changedTouches[0].pageX,d.y=b.changedTouches[0].pageY):b.type==a.MouseType.TouchMove&&(b.touches.length>1?(c=new a.InteractiveEvent(a.InteractiveEvent.Pinch),c.data=a.MathClass.math_distance(b.touches[0].clientX,b.touches[0].clientY,b.touches[1].clientX,b.touches[1].clientY)/this.lastSwipeDis,c.roation=180*(Math.atan2(b.touches[1].clientY-b.touches[0].clientY,b.touches[1].clientX-b.touches[0].clientX)-this.lastSwipeRot)/Math.PI):c=new a.InteractiveEvent(a.InteractiveEvent.Move),d.x=b.pageX,d.y=b.pageY),b.touches.length)for(var e=0;e<b.touches.length;e++)d.x=b.touches[e].clientX,d.y=b.touches[e].clientY;this.mouseEvetData(c,d)},b.prototype.disMoveNnum=function(b,c){return a.Vector2D.distance(b,this.lastMousePos)<c},b.prototype.mouseEvetData=function(c,d){b.cando=!0,a.Scene_data.verticalScene?(c.x=d.y,c.y=a.Scene_data.stageHeight-d.x):(c.x=d.x,c.y=d.y);var e=!1;if(!e)for(var f=this._uiList.length-1;f>=0;f--)if(this._uiList[f]&&0==this._uiList[f].container.interfaceUI&&this._uiList[f]&&this._uiList[f].interactiveEvent(c)){e=!0;break}if(!e)for(var f=this._uiList.length-1;f>=0;f--)if(this._uiList[f]&&1==this._uiList[f].container.interfaceUI&&this._uiList[f]&&this._uiList[f].interactiveEvent(c)){e=!0;break}if(c.type==a.InteractiveEvent.Down){this.lastMousePos=new a.Vector2D(c.x,c.y);var g=a.TimeUtil.getTimer()-this.lastTime;if(200>g)return!0;this.lastTime=a.TimeUtil.getTimer()}var h=a.Scene_data.uiStage.interactiveEvent(c);return e?!0:(a.Scene_data.uiBlankStage.interactiveEvent(c),h)},b.prototype.setUseMouseEventCon=function(a){this._eventItem.length=0,a&&this._eventItem.push(a)},b.prototype.getObjectsUnderPoint=function(a){for(var b=this._uiList.length-1;b>=0;b--)if(this._uiList[b]&&this._uiList[b]&&this._uiList[b].insetUi(a))return this._uiList[b].insetUi(a);return null},b.prototype.getcurrentList=function(){for(var a=new Array,b=this._uiList.length-1;b>0;b--)if(this._eventItem.length)for(var c=0;c<this._eventItem.length;c++)this._eventItem[c]!=this._uiList[b].container||(a.push(this._uiList[b]),c=this._eventItem.length);else a.push(this._uiList[b]);return a},b.cando=!0,b}();a.UIManager=d}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.width=a.UIData.designWidth,c.height=a.UIData.designHeight,c.center=0,c.middle=0,c.initData(),c}return __extends(c,b),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.initData=function(){var b=this;this.atls=new a.UIAtlas,this.atls.configData=new Array,this.atls.configData.push(this.atls.getObject("load",0,0,256,256,256,256,4,4)),this.atls.loadImgUrl("ui/load/ui_loding.png",function(){b.loadCom()})},c.prototype.loadCom=function(){this._render=new a.UIRenderComponent,this._render.uiAtlas=this.atls;var b=this._render.createFrame("load");this.addChild(b),b.speed=1,b.width=100,b.height=100,b.x=(a.UIData.designWidth-b.width)/2,b.y=(a.UIData.designHeight-b.height)/2},c.prototype.show=function(){},c.prototype.hide=function(){},c}(a.UIConatiner);a.UILoading=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.interactiveEvent=function(a){var b=a.type,c=this._eventsMap;if(!c)return!1;var d=c[b];if(!d)return!1;var e=d.length;if(0==e)return!1;for(var f=e-1;f>=0;f--){var g=d[f];g.listener.call(g.thisObject,a)}return!0},b}(a.EventDispatcher);a.UIStage=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.A_HIGHT_F="A_hight_f",a.TAB_HIGHT="Tab_hight",a.A_HIGHT_C="A_hight_c",a.A_DELETEBTN="A_deletebtn",a.A_ZHENQI="A_zhenqi",a.A_SHOULING="A_SHOULING",a.A_JINGHUA="A_JINGHUA",a.A_JIANTOU="A_jiantou",a.A_WUPINKUANG="A_wupinkuang",a.A_BLACK_C="A_black_c",a.A_BLACK_F="A_black_f",a.A_BLACK_START="A_black_start",a.A_HIGHT_START="A_hight_start",a.A_BLACK_BASE="A_black_base ",a.A_RED_POINT="A_red_point",a.A_YINBI="A_yinbi",a.A_YUANBAO="A_yuanbao",a.A_BANGGONG="A_banggong",a.A_DOUHUN="A_DOUHUN",a.A_EXP="A_EXP",a.A_HONOR="A_HONOR",a.A_BANGYUAN="A_bangyuan",a.A_RIGHT_XING="A_RIGHT_XING",a.A_SSTART="A_SSTART",a.A_LEFT_XING="A_LEFT_XING",a.A_GOODS_PURPLE="A_GOODS_PURPLE",a.A_GOODS_BLUE="A_GOODS_BLUE",a.A_GOODS_RED="A_GOODS_RED",a.A_GOODS_GREEN="A_GOODS_GREEN",a.A_GOODS_WHITE="A_GOODS_WHITE",a.A_GOODS_ORANGE="A_GOODS_ORANGE",a.A_START_BG="A_START_BG",a.A_START="A_START",a.A_CHAIN="A_CHAIN",a.A_OK="A_OK",a.A_QIANWANG="A_QIANWANG",a.T_LEFT="T_LEFT",a.T_MID="T_MID",a.T_RIGHT="T_RIGHT",a.E_LEFT="E_LEFT",a.E_MID="E_MID",a.E_RIGHT="E_RIGHT",a.F_LEFT="F_LEFT",a.F_MID="F_MID",a.F_RIGHT="F_RIGHT",a.A_F_22="A_F_22",a.A_BLACK_BASE_66="A_BLACK_BASE_66 ",a.A_HIGHR_C_66="A_HIGHR_C_66",a.A_V="A_V",a.A_GIVING_BG="A_GIVING_BG",a.B_SUB="B_SUB",a.A_FACTION_ICON="A_FACTION_ICON",a.SELECT_1="SELECT_1",a.SELECT_0="SELECT_0",a.A_JIE="A_JIE",a.A_XING="A_XING",a.T_tips_txt_bg="T_tips_txt_bg",a.ITEMBG="ITEMBG",a.A_quest_top="A_quest_top",a.A_quest_mid="A_quest_mid",a.A_quest_bottom="A_quest_bottom",a.A_quest_ion0="A_quest_ion0",a.A_quest_ion1="A_quest_ion1",a.A_quest_ion2="A_quest_ion2",a.A_quest_ion3="A_quest_ion3",a.A_quest_finish="A_quest_finish",a.S_sys_tip0="S_sys_tip0",a.S_sys_tip1="S_sys_tip1",a.A_zhanli_label="A_zhanli_label",a.A_gou="A_gou",a.A_cha="A_cha",a.TYPE3="TYPE3",a.TYPE5="TYPE5",a.TYPE9="TYPE9",a.TYPE7="TYPE7",a.B_ZHUFUZHI="B_ZHUFUZHI",a.B_DABAOJI="B_DABAOJI",a.B_XIAOBAOJI="B_XIAOBAOJI",a.B_JINGYAN="B_JINGYAN",a.NewPicBg="NewPicBg",a.Select="Select",a.CostBg="CostBg",a.BG2="BG2",a.PropBg40="PropBg40",a.PropBg60="PropBg60",a.PropBg100="PropBg100",a.REWARD_BG1="REWARD_BG1",a.SKILL_BG68="SKILL_BG68",a.SKILL_BG58="SKILL_BG58",a.BG6="BG6",a.Slist_nselect="Slist_nselect",a.Slist_select="Slist_select",a.TXTBG="TXTBG",a.ARROW_TOP="ARROW_TOP",a.ARROW_RIGHT="ARROW_RIGHT",a.MASK="MASK",a.BTNADD="BTNADD",a.BOSSBG76="BOSSBG76",a.BOSSBG64="BOSSBG64",a.CIRCL74="CIRCL74",a.LISTITEMBG="LISTITEMBG",a.ADDITEM="ADDITEM",a.HASSEL="HASSEL",a.SKILL_LEV_BG="SKILL_LEV_BG",a.TITLEBG="TITLEBG",a.TITLEHIGHT="TITLEHIGHT",a.NEWLISTITEMBG="NEWLISTITEMBG",a.CHATBG="CHATBG",a.ITEMBIGBG="ITEMBIGBG",a.I1bg_2="I1bg_2",a.I1bg_1="I1bg_1",a.ARROWUP="ARROWUP",a.ARROWDOWN="ARROWDOWN",a.A_EQULEVBG="A_EQULEVBG",a.DISABLE="DISABLE",a.EQUBG="EQUBG",a.RESLISTBG="RESLISTBG",a.A_CARD_C="A_CARD_C",a.A_CARD_G="A_CARD_G",a.A_CARD_B="A_CARD_B",a.RESBG="RESBG",a.STATEUP_LISTBG="STATEUP_LISTBG",
a.A_LEAGUELISTBG="A_LEAGUELISTBG",a.TEAMLISTBG="TEAMLISTBG",a.A_JJ0="A_JJ0",a.A_JJ1="A_JJ1",a.A_JJ2="A_JJ2",a.A_JJ3="A_JJ3",a.A_JJ4="A_JJ4",a.A_JJ5="A_JJ5",a.A_JJ6="A_JJ6",a.A_JJ7="A_JJ7",a.A_JJ8="A_JJ8",a.A_JJ9="A_JJ9",a.A_JJ10="A_JJ10",a}();a.PuiData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.destory=function(){a.Scene_data.context3D.deleteTexture(this.texture)},c}(a.ResCount);a.TextureRes=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function e(){var a=b.call(this)||this;return a._loadDic=new Object,a._resDic=new Object,a.initDefaultLightMapTexture(),a}return __extends(e,b),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.hasTexture=function(a){return this._dic[a]?!0:!1},e.prototype.getTexture=function(b,d,e,f,g,h){var i=this;if(void 0===e&&(e=0),void 0===f&&(f=null),void 0===g&&(g=0),void 0===h&&(h=0),this._dic[b])return f?d(this._dic[b],f):d(this._dic[b]),void this._dic[b].useNum++;var j=new c(d,f,b,e,g,h);if(this._loadDic[b]){var k=this._loadDic[b];return void k.push(j)}this._loadDic[b]=new Array,this._loadDic[b].push(j),this._resDic[b]?(this.loadTextureCom(this._resDic[b],j),delete this._resDic[b]):a.LoadManager.getInstance().load(b,a.LoadManager.IMG_TYPE,function(a,b){i.loadTextureCom(a,b)},j)},e.prototype.getImageData=function(b,c){a.LoadManager.getInstance().load(b,a.LoadManager.IMG_TYPE,function(b){var d=a.UIManager.getInstance().getContext2D(b.width,b.height,!1);d.drawImage(b,0,0,b.width,b.height);var e=d.getImageData(0,0,b.width,b.height);c(e)})},e.prototype.getImgResByurl=function(a){return this._resDic[a]},e.prototype.addRes=function(a,b){this._dic[a]||this._resDic[a]||(this._resDic[a]=b)},e.prototype.addImgRes=function(b,c){this._resDic[b]=c;var d=a.Scene_data.context3D.getTexture(c),e=new a.TextureRes;e.texture=d,e.width=c.width,e.height=c.height,e.useNum++,this._dic[b]=e},e.prototype.getCanvasTexture=function(b){var c=new a.TextureRes,d=a.Scene_data.context3D.getTexture(b.canvas,0,0);return c.texture=d,c},e.prototype.getImageDataTexture=function(b){var c=a.Scene_data.context3D.getTexture(b,0,0);return c},e.prototype.getTextureRes=function(b){var c=new a.TextureRes,d=a.Scene_data.context3D.getTexture(b,0,0);return c.texture=d,c},e.prototype.updateTexture=function(b,c,d,e){a.Scene_data.context3D.updateTexture(b,c,d,e.canvas)},e.prototype.loadCubeTexture=function(a,b){var c=new d;c.loadCube(a,function(a){b(a)})},e.prototype.loadTextureCom=function(b,c){var d=a.Scene_data.context3D.getTexture(b,c.wrap,c.filter,c.mipmap),e=new a.TextureRes;e.texture=d,e.width=b.width,e.height=b.height;for(var f=this._loadDic[c.url],g=0;g<f.length;g++)f[g].info?f[g].fun(e,f[g].info):f[g].fun(e),e.useNum++;delete this._loadDic[c.url],this._dic[c.url]=e},e.prototype.initDefaultLightMapTexture=function(){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=32,b.height=32,c.fillStyle="rgb(51,51,51)",c.fillRect(0,0,32,32),this.defaultLightMap=a.Scene_data.context3D.getTexture(b)},e.prototype.gc=function(){b.prototype.gc.call(this)},e}(a.ResGC);a.TextureManager=b;var c=function(){function a(a,b,c,d,e,f){this.fun=a,this.info=b,this.url=c,this.wrap=d,this.filter=e,this.mipmap=f}return a}();a.TextureLoad=c;var d=function(){function b(){this.ary=new Array(6),this.flagNum=0}return b.prototype.loadCube=function(b,c){var d=this;this.fun=c;for(var e=0;6>e;e++){var f=b+"0"+(e+1)+".jpg";console.log(f),a.LoadManager.getInstance().load(f,a.LoadManager.IMG_TYPE,function(a,b){d.loadCom(a,b)},{id:e})}},b.makeTempCubeTextture=function(b){var c=b.width/4,d=document.createElement("canvas"),e=d.getContext("2d");d.width=c,d.height=c;var f=a.Scene_data.context3D.renderContext,g=f.createTexture();return f.bindTexture(f.TEXTURE_CUBE_MAP,g),e.drawImage(b,2*c,c,c,c,0,0,c,c),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),e.drawImage(b,0,c,c,c,0,0,c,c),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_X,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),e.drawImage(b,c,0,c,c,0,0,c,c),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Y,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),e.drawImage(b,c,2*c,c,c,0,0,c,c),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),e.drawImage(b,c,c,c,c,0,0,c,c),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Z,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),e.drawImage(b,3*c,c,c,c,0,0,c,c),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),g},b.prototype.loadCom=function(a,c){this.ary[c.id]=b.makeTempCubeTextture(a),this.flagNum++,6==this.flagNum&&this.fun(this.ary)},b}();a.CubemapLoad=d}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.value=new a.Vector3D,this.offset=0}return Object.defineProperty(b.prototype,"id",{get:function(){return this._id},set:function(a){this._id=a,this.name="fc"+a,this.offset=4*a},enumerable:!0,configurable:!0}),b.prototype.creat=function(a){this.vecNum=a,this.vecNum[0+this.offset]=this.value.x,this.vecNum[1+this.offset]=this.value.y,this.vecNum[2+this.offset]=this.value.z,this.vecNum[3+this.offset]=this.value.w},b.prototype.setData=function(b){this.id=b.id,this.value=new a.Vector3D(b.value.x,b.value.y,b.value.z,b.value.w),this.paramName0=b.paramName0,this.param0Type=b.param0Type,this.param0Index=b.param0Index,this.paramName1=b.paramName1,this.param1Type=b.param1Type,this.param1Index=b.param1Index,this.paramName2=b.paramName2,this.param2Type=b.param2Type,this.param2Index=b.param2Index,this.paramName3=b.paramName3,this.param3Type=b.param3Type,this.param3Index=b.param3Index},b.prototype.setDynamicOffset=function(a){this.paramName0==a.paramName?a.targetOffset=this.param0Index+this.offset:this.paramName1==a.paramName?a.targetOffset=this.param1Index+this.offset:this.paramName2==a.paramName?a.targetOffset=this.param2Index+this.offset:this.paramName3==a.paramName&&(a.targetOffset=this.param3Index+this.offset)},b.prototype.setDynamicDirect=function(a,b){this.vecNum.set(a,b)},b.prototype.setDynamic=function(a){try{this.vecNum.set(a.currentValue,a.targetOffset)}catch(b){}},b}();a.ConstItem=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.prototype.destory=function(){this.textureRes&&this.textureRes.clearUseNum()},Object.defineProperty(a.prototype,"id",{get:function(){return this._id},set:function(a){this._id=a,this.name="fs"+a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),a.LIGHTMAP=1,a.LTUMAP=2,a.CUBEMAP=3,a.HEIGHTMAP=4,a.REFRACTIONMAP=5,a}();a.TexItem=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.TexItem);a.TextureCube=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.texList=new Array,a.constList=new Array,a.killNum=0,a.writeZbuffer=!0,a.fogMode=0,a.fcNum=0,a}return __extends(c,b),c.prototype.update=function(a){this.updateTime(a),this.updateScene()},c.prototype.updateTime=function(a){this.hasTime&&(this.fcData[1]=a)},c.prototype.updateCam=function(a,b,c){if(this.usePbr||1==this.fogMode){var d=4*this.fcIDAry[0];this.fcData[0+d]=a,this.fcData[1+d]=b,this.fcData[2+d]=c}},c.prototype.updateScene=function(){if(this.sceneNumId!=a.Scene_data.sceneNumId){if(this.sceneNumId=a.Scene_data.sceneNumId,0!=this.fogMode){var b=4*this.fcIDAry[1];this.fcData[0+b]=a.Scene_data.fogColor[0],this.fcData[1+b]=a.Scene_data.fogColor[1],this.fcData[2+b]=a.Scene_data.fogColor[2]}if(this.scaleLightMap){var b=4*this.fcIDAry[2];this.fcData[0+b]=a.Scene_data.scaleLight[0]}}},c.prototype.initFcData=function(){if(this.fcData=new Float32Array(4*this.fcNum),!(this.fcNum<=0)){if(this.sceneNumId=a.Scene_data.sceneNumId,(this.hasTime||this.useKill||0!=this.fogMode)&&(this.useKill&&(this.fcData[0]=this.killNum),0!=this.fogMode&&(this.fcData[2]=a.Scene_data.fogData[0],this.fcData[3]=a.Scene_data.fogData[1])),this.usePbr||1==this.fogMode){var b=4*this.fcIDAry[0];this.fcData[0+b]=a.Scene_data.cam3D.x/100,this.fcData[1+b]=a.Scene_data.cam3D.y/100,this.fcData[2+b]=a.Scene_data.cam3D.z/100}if(0!=this.fogMode){var b=4*this.fcIDAry[1];this.fcData[0+b]=a.Scene_data.fogColor[0],this.fcData[1+b]=a.Scene_data.fogColor[1],this.fcData[2+b]=a.Scene_data.fogColor[2]}if(this.scaleLightMap){var b=4*this.fcIDAry[2];this.fcData[0+b]=a.Scene_data.scaleLight[0]}}},c.prototype.setCompileData=function(b){if(b){if(this.shaderStr=b.shaderStr,this.hasTime=b.hasTime,this.timeSpeed=b.timeSpeed,this.blendMode=b.blendMode,this.backCull=b.backCull,this.killNum=b.killNum,this.hasVertexColor=b.hasVertexColor,this.usePbr=b.usePbr,this.useNormal=b.useNormal,this.roughness=b.roughness,this.writeZbuffer=b.writeZbuffer,this.hasFresnel=b.hasFresnel,this.useDynamicIBL=b.useDynamicIBL,this.normalScale=b.normalScale,this.lightProbe=b.lightProbe,this.useKill=b.useKill,this.directLight=b.directLight,this.noLight=b.noLight,this.scaleLightMap=b.scaleLightMap,this.fogMode=b.fogMode,this.hasParticleColor=!1,this.initFcData(),b.texList){var c=b.texList;this.texList=new Array;for(var d=0;d<c.length;d++){var e=new a.TexItem;e.id=c[d].id,e.url=c[d].url,e.isDynamic=c[d].isDynamic,e.paramName=c[d].paramName,e.isMain=c[d].isMain,e.isParticleColor=c[d].isParticleColor,e.type=c[d].type,e.wrap=c[d].wrap,e.filter=c[d].filter,e.mipmap=c[d].mipmap,this.texList.push(e),e.isParticleColor&&(this.hasParticleColor=!0)}}if(b.constList)for(c=b.constList,this.constList=new Array,d=0;d<c.length;d++){var f=new a.ConstItem;f.setData(c[d]),f.creat(this.fcData),this.constList.push(f)}}},c.prototype.setByteData=function(a){var b=a,c=b.readInt();if(this.shaderStr=b.readUTF(),this.hasTime=b.readBoolean(),this.timeSpeed=b.readFloat(),this.blendMode=b.readFloat(),this.backCull=b.readBoolean(),this.killNum=b.readFloat(),this.hasVertexColor=b.readBoolean(),this.usePbr=b.readBoolean(),this.useNormal=b.readBoolean(),this.roughness=b.readFloat(),this.writeZbuffer=b.readBoolean(),this.hasFresnel=b.readBoolean(),this.useDynamicIBL=b.readBoolean(),this.normalScale=b.readFloat(),this.lightProbe=b.readBoolean(),this.useKill=b.readBoolean(),this.directLight=b.readBoolean(),this.noLight=b.readBoolean(),this.scaleLightMap=b.readBoolean(),c>2&&(this.fogMode=b.readInt()),c>=22){this.fcNum=b.readByte();var d=b.readByte();this.fcIDAry=new Array;for(var e=0;d>e;e++)this.fcIDAry.push(b.readByte())}this.hasParticleColor=!1,this.initFcData(),this.readTexList(b),this.readConstLis(b)},c.prototype.readConstLis=function(b){var c=b.readInt();this.constList=new Array;for(var d=0;c>d;d++){var e=new a.ConstItem;e.id=b.readFloat(),e.value=new a.Vector3D(b.readFloat(),b.readFloat(),b.readFloat(),b.readFloat()),e.paramName0=b.readUTF(),e.param0Type=b.readFloat(),e.param0Index=b.readFloat(),e.paramName1=b.readUTF(),e.param1Type=b.readFloat(),e.param1Index=b.readFloat(),e.paramName2=b.readUTF(),e.param2Type=b.readFloat(),e.param2Index=b.readFloat(),e.paramName3=b.readUTF(),e.param3Type=b.readFloat(),e.param3Index=b.readFloat(),e.creat(this.fcData),this.constList.push(e)}},c.prototype.readTexList=function(b){var c=b.readInt();this.texList=new Array;for(var d=0;c>d;d++){var e=new a.TexItem;e.id=b.readFloat(),e.url=b.readUTF(),e.isDynamic=b.readBoolean(),e.paramName=b.readUTF(),e.isMain=b.readBoolean(),e.isParticleColor=b.readBoolean(),e.type=b.readFloat(),e.wrap=b.readFloat(),e.filter=b.readFloat(),e.mipmap=b.readFloat(),e.isParticleColor&&(this.hasParticleColor=!0),this.texList.push(e)}},c.prototype.destory=function(){for(var a=0;a<this.texList.length;a++)this.texList[a].destory();this.texList=null,this.constList=null,this.shader&&this.shader.clearUseNum()},c}(a.ResCount);a.Material=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function d(){var a=b.call(this)||this;return a._loadDic=new Object,a._resDic=new Object,a._regDic=new Object,a}return __extends(d,b),d.getInstance=function(){return this._instance||(this._instance=new d),this._instance},d.prototype.getMaterialByte=function(b,d,e,f,g,h){var i=this;if(void 0===e&&(e=null),void 0===f&&(f=!1),void 0===g&&(g=null),void 0===h&&(h=null),this._dic[b])return e?d(this._dic[b],e):d(this._dic[b]),void this._dic[b].useNum++;var j=new c(d,e,b,f,g,h);if(this._loadDic[b]){var k=this._loadDic[b];return void k.push(j)}this._loadDic[b]=new Array,this._loadDic[b].push(j),this._resDic[b]?(this.meshByteMaterialByt(this._resDic[b],j),this._regDic[b]&&(this._dic[b].useNum+=this._regDic[b],delete this._regDic[b]),delete this._resDic[b]):a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(a,b){i.loadMaterialByteCom(a,b)},j)},d.prototype.meshByteMaterialByt=function(b,c){var d=new a.Material;d.setByteData(b),d.url=c.url,this.loadMaterial(d),c.autoReg&&(d.shader=a.ProgrmaManager.getInstance().getMaterialProgram(c.regName,c.shader3D,d,null,!0));for(var e=this._loadDic[c.url],f=0;f<e.length;f++)e[f].info?e[f].fun(d,e[f].info):e[f].fun(d),d.useNum++;delete this._loadDic[c.url],this._dic[c.url]=d},d.prototype.loadMaterialByteCom=function(b,c){var d=new a.Pan3dByteArray(b);this.meshByteMaterialByt(d,c)},d.prototype.addResByte=function(a,b){this._dic[a]||this._resDic[a]||(this._resDic[a]=b)},d.prototype.registerUrl=function(a){a=a.replace("_byte.txt",".txt"),a=a.replace(".txt","_byte.txt"),this._dic[a]?this._dic[a].useNum++:this._regDic[a]?this._regDic[a]++:1==this._regDic[a]},d.prototype.releaseUrl=function(a){a=a.replace("_byte.txt",".txt"),a=a.replace(".txt","_byte.txt"),this._dic[a]&&this._dic[a].clearUseNum()},d.prototype.loadMaterial=function(b){for(var c=b.texList,d=0;d<c.length;d++)c[d].isParticleColor||c[d].isDynamic||0!=c[d].type||a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+c[d].url,function(a,b){b.textureRes=a},c[d].wrap,c[d],c[d].filter,c[d].mipmap)},d.prototype.loadDynamicTexUtil=function(b){for(var c=b.dynamicTexList,d=0;d<c.length;d++)c[d].isParticleColor?c[d].creatTextureByCurve():a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+c[d].url,function(a,b){b.textureRes=a},0,c[d],0,1)},d.prototype.gc=function(){b.prototype.gc.call(this)},d}(a.ResGC);a.MaterialManager=b;var c=function(){function a(a,b,c,d,e,f){this.fun=a,this.info=b,this.url=c,this.autoReg=d,this.regName=e,this.shader3D=f}return a}()}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.prototype.update=function(a){void 0===a&&(a=0),this.target&&this.target.setDynamic(this)},Object.defineProperty(a.prototype,"type",{get:function(){return this._type},set:function(a){this._type=a},enumerable:!0,configurable:!0}),a.prototype.setTargetInfo=function(a,b,c){this.target=a,this.paramName=b,this.type=c,this.target&&this.target.setDynamicOffset(this),this.currentValue=new Array(c)},a.prototype.setCurrentVal=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var c=0;c<a.length;c++)this.currentValue[c]=a[c]},a}();a.DynamicBaseConstItem=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.prototype.destory=function(){this.textureRes&&this.textureRes.useNum--,this.target=null},Object.defineProperty(a.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),a}();a.DynamicBaseTexItem=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.destory=function(){for(var a=0;a<this.dynamicTexList.length;a++)this.dynamicTexList[a].destory();this.dynamicTexList=null,this.dynamicConstList=null},c.prototype.update=function(){if(this.material&&this.dynamicConstList)for(var a=0;a<this.dynamicConstList.length;a++)this.dynamicConstList[a].update()},c.prototype.setData=function(b,c){this.material=b,this.dynamicConstList=new Array,this.dynamicTexList=new Array;for(var d=b.constList,e=b.texList,f=0;f<c.length;f++){var g=c[f];if(0==g.type){var h=new a.DynamicBaseTexItem;h.paramName=g.name;for(var i=0;i<e.length;i++)if(h.paramName==e[i].paramName){h.target=e[i];break}var j=0;h.target&&(j=h.target.mipmap),j=0,a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+g.url,function(a){h.textureRes=a},0,null,0,j),this.dynamicTexList.push(h)}else{for(var k=g.name,l=null,i=0;i<d.length;i++)if(k==d[i].paramName0||k==d[i].paramName1||k==d[i].paramName2||k==d[i].paramName3){l=d[i];break}var m=new a.DynamicBaseConstItem;m.setTargetInfo(l,k,g.type),1==g.type?m.setCurrentVal(g.x):2==g.type?m.setCurrentVal(g.x,g.y):m.setCurrentVal(g.x,g.y,g.z),this.dynamicConstList.push(m)}}},c}(a.GC);a.MaterialBaseParam=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.destory=function(){this.material.useNum--,this.shader.useNum--,b.prototype.destory.call(this)},c.prototype.setMaterial=function(a){this.material=a,this.materialUrl=a.url,this.dynamicTexList=new Array,this.dynamicConstList=new Array,this.setTexList(),this.setConstList()},c.prototype.setLife=function(a){for(var b=0;b<this.dynamicTexList.length;b++)this.dynamicTexList[b].isParticleColor&&(this.dynamicTexList[b].life=a)},c.prototype.setTexList=function(){for(var b=this.material.texList,c=0;c<b.length;c++){var d;b[c].isParticleColor?(d=new a.DynamicTexItem,d.target=b[c],d.paramName=b[c].paramName,d.initCurve(4),this.dynamicTexList.push(d),d.isParticleColor=!0):b[c].isDynamic&&(d=new a.DynamicTexItem,d.target=b[c],d.paramName=b[c].paramName,this.dynamicTexList.push(d))}},c.prototype.setConstList=function(){for(var b=this.material.constList,c=0;c<b.length;c++){var d,e=b[c];0!=e.param0Type&&(d=new a.DynamicConstItem,d.setTargetInfo(e,e.paramName0,e.param0Type),this.dynamicConstList.push(d)),0!=e.param1Type&&(d=new a.DynamicConstItem,d.setTargetInfo(e,e.paramName1,e.param1Type),this.dynamicConstList.push(d)),0!=e.param2Type&&(d=new a.DynamicConstItem,d.setTargetInfo(e,e.paramName2,e.param2Type),this.dynamicConstList.push(d)),0!=e.param3Type&&(d=new a.DynamicConstItem,d.setTargetInfo(e,e.paramName3,e.param3Type),this.dynamicConstList.push(d))}},c.prototype.setTextObj=function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<this.dynamicTexList.length;d++)if(this.dynamicTexList[d].paramName==c.paramName){this.dynamicTexList[d].isParticleColor?this.dynamicTexList[d].curve.setData(c.curve):this.dynamicTexList[d].url=c.url;break}},c.prototype.setConstObj=function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<this.dynamicConstList.length;d++)if(this.dynamicConstList[d].paramName==c.paramName){this.dynamicConstList[d].curve.setData(c.curve);break}},c}(a.MaterialBaseParam);a.MaterialParam=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.update=function(a){void 0===a&&(a=0),this.currentValue=this.curve.getValue(a),this.target.setDynamic(this)},Object.defineProperty(c.prototype,"type",{set:function(b){this._type=b,this.curve=new a.Curve,this.curve.type=b},enumerable:!0,configurable:!0}),c}(a.DynamicBaseConstItem);a.DynamicConstItem=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.destory=function(){b.prototype.destory.call(this),this._textureDynamic&&a.Scene_data.context3D.deleteTexture(this._textureDynamic),this.target=null},c.prototype.initCurve=function(b){this.curve=new a.Curve,this.curve.type=b},Object.defineProperty(c.prototype,"texture",{get:function(){return this._textureDynamic?this._textureDynamic:this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),c.prototype.creatTextureByCurve=function(){for(var b=0,c=this.curve.valueVec.length-1,d=new Array,b=0;b<this.life;b++)if(b<this.curve.begintFrame)d.push(255*this.curve.valueVec[0][0],255*this.curve.valueVec[0][1],255*this.curve.valueVec[0][2],255*this.curve.valueVec[0][3]);else if(b>this.curve.maxFrame)0==this.curve.maxFrame&&this.curve.begintFrame<0?d.push(255,255,255,255):d.push(255*this.curve.valueVec[c][0],255*this.curve.valueVec[c][1],255*this.curve.valueVec[c][2],255*this.curve.valueVec[c][3]);else if(this.curve.begintFrame<0)d.push(255,255,255,255);else{var e=b-this.curve.begintFrame;d.push(255*this.curve.valueVec[e][0],255*this.curve.valueVec[e][1],255*this.curve.valueVec[e][2],255*this.curve.valueVec[e][3])}var f=a.ColorTransition.getInstance().getImageDataByVec(d,this.life);this._textureDynamic=a.Scene_data.context3D.getTexture(f)},Object.defineProperty(c.prototype,"life",{get:function(){return this._life},set:function(a){this._life=a},enumerable:!0,configurable:!0}),c}(a.DynamicBaseTexItem);a.DynamicTexItem=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(a,b,c,d,e,f){this.x=a,this.y=b,this.z=c,this.width=d,this.height=e,this.depth=f}return b.prototype.testViewFrustum=function(a,b){if(this.sun&&1==this.sun.length)return void this.sun[0].testViewFrustum(a,b);if(this.testViewFrustumResult(a)&&(this.target&&(this.target.isPerspective?this.testRay(b)||(this.target.sceneVisible=!0):this.target.sceneVisible=!0),this.sun))for(var c=0;c<this.sun.length;c++)this.sun[c].testViewFrustum(a,b)},b.prototype.testViewFrustumResult=function(b){for(var c=new a.Vector3D(this.x,this.y,this.z),d=new a.Vector3D(this.width,this.height,this.depth),e=!0,f=0;f<b.length;f++){var g=c,h=c.add(d),i=new a.Vector3D;b[f].x>0?i.x=h.x:i.x=g.x,b[f].y>0?i.y=h.y:i.y=g.y,b[f].z>0?i.z=h.z:i.z=g.z;var j=b[f].dot(i)+b[f].w;if(0>j){e=!1;break}}return e},b.prototype.testRay=function(a){var b,c,d,e,f,g,h=a.o.x,i=a.o.y,j=a.o.z,k=a.d.x,l=a.d.y,m=a.d.z,n=this.x,o=this.y,p=this.z,q=this.x+this.width,r=this.y+this.height,s=this.z+this.depth,t=1/k;t>=0?(b=(n-h)*t,e=(q-h)*t):(b=(q-h)*t,e=(n-h)*t);var u=1/l;u>=0?(c=(o-i)*u,f=(r-i)*u):(c=(r-i)*u,f=(o-i)*u);var v=1/m;v>=0?(d=(p-j)*v,g=(s-j)*v):(d=(s-j)*v,g=(p-j)*v);var w,x;w=b>c?b:c,d>w&&(w=d),x=f>e?e:f,x>g&&(x=g);var y=1e-4,z=0;return x>w&&x>y?(z=w>y?w:x,z<a.baseT?!0:void 0):!1},b}();a.QuadTreeNode=b;var c=function(){function b(){this.o=new a.Vector3D,this.d=new a.Vector3D,this.baseT=500}return b.prototype.setPos=function(a,b,c){this.o.x=a,this.o.y=b,this.o.z=c},b.prototype.setTarget=function(a,b,c){this.d.x=a-this.o.x,this.d.y=b-this.o.y,this.d.z=c-this.o.z,this.d.normalize()},b}();a.Ray=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.needUpdata=!1,this.panleAry=new Array}return b.prototype.init=function(b,c){this._circle=new a.Circle(1e4,1e4),this._sceneDic=c,this._rootNode=this.getNode(b),this._ray=new a.Ray},b.prototype.getNode=function(b){var c=new a.QuadTreeNode(b.x,b.y,b.z,b.width,b.height,b.depth);if(b.data){c.sun||(c.sun=new Array);for(var d=0;d<b.data.length;d++){var e,f=new a.QuadTreeNode(b.data[d].x,b.data[d].y,b.data[d].z,b.data[d].width,b.data[d].height,b.data[d].depth);1==b.data[d].type?e="build"+b.data[d].id:11==b.data[d].type?e="particle"+b.data[d].id:14==b.data[d].type&&(e="ground"+b.data[d].id),f.target=this._sceneDic[e],f.target.aabb=f,c.sun.push(f)}}if(b.sun){c.sun||(c.sun=new Array);for(var d=0;d<b.sun.length;d++)c.sun.push(this.getNode(b.sun[d]))}return c},b.prototype.setCircle=function(a,b,c){var d=a-this._circle.x,e=b-this._circle.y;Math.sqrt(d*d+e*e)<10?this.needUpdata=!1:(this._circle.setData(a,b,c),this.needUpdata=!0)},b.prototype.update=function(){a.MathClass.GetViewHitBoxDataCopy(a.Scene_data.cam3D.distance);var b=new a.Vector3D(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z),c=a.MathClass.viewBoxVecItem;this.panleAry.length=0,this.panleAry.push(this.getPanelByVec(b,c[0],c[1])),this.panleAry.push(this.getPanelByVec(b,c[1],c[2])),this.panleAry.push(this.getPanelByVec(b,c[2],c[3])),this.panleAry.push(this.getPanelByVec(b,c[3],c[0])),this._ray.setPos(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z),this._ray.setTarget(a.Scene_data.focus3D.x,a.Scene_data.focus3D.y,a.Scene_data.focus3D.z),this._ray.baseT=a.Scene_data.cam3D.distance,this._rootNode.testViewFrustum(this.panleAry,this._ray)},b.prototype.getPanelByVec=function(a,b,c){var d=b.subtract(a),e=c.subtract(a);return d=d.cross(e),d.normalize(),d.w=-d.dot(a),d},b.prototype.updateDraw=function(){this.capsuleLineSprite?(this.capsuleLineSprite.x=a.Scene_data.focus3D.x,this.capsuleLineSprite.y=a.Scene_data.focus3D.y+50,this.capsuleLineSprite.z=a.Scene_data.focus3D.z,this.capsuleLineSprite.update()):(this.capsuleLineSprite=new a.LineDisplaySprite,this.capsuleLineSprite.clear(),this.capsuleLineSprite.baseColor=new a.Vector3D(1,0,0,1),this.drawCylinder(this._circle.radius,10),this.capsuleLineSprite.upToGpu())},b.prototype.drawCylinder=function(b,c){var d,e,f,g=b,h=c,i=12;for(f=0;i>f;f++){var j=new a.Vector3D(g,0,0),k=new a.Vector3D(g,+h,0),l=new a.Matrix3D;l.appendRotation(f*(360/i),a.Vector3D.Y_AXIS);var m=l.transformVector(j),n=l.transformVector(k);this.capsuleLineSprite.makeLineMode(m,n),this.capsuleLineSprite.makeLineMode(n,new a.Vector3D(0,+h,0)),f==i-1&&(this.capsuleLineSprite.makeLineMode(m,j),this.capsuleLineSprite.makeLineMode(n,k)),(d||e)&&(this.capsuleLineSprite.makeLineMode(m,d),this.capsuleLineSprite.makeLineMode(n,e)),d=m.clone(),e=n.clone()}},b}();a.SceneQuadTree=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.prototype.init=function(){this.capsuleLineSprite=new a.LineDisplaySprite,a.SceneManager.getInstance().addDisplay(this.capsuleLineSprite)},b.prototype.setCam=function(){var b=a.Scene_data.cam3D.cameraMatrix.clone();b.append(a.Scene_data.viewMatrx3D);var c=b.m,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15];this.panleAry=new Array;this.getPanle(-l+p,-m+q,-n+r,-o+s),this.getPanle(h+p,i+q,j+r,k+s),this.getPanle(-h+p,-i+q,-j+r,-k+s),this.getPanle(d+p,e+q,f+r,g+s),this.getPanle(-d+p,-e+q,-f+r,-g+s)},b.prototype.getPanle=function(b,c,d,e){var f=new a.Vector3D(b,c,d,e);return f.normalize(),f},b.prototype.getPanelByVec=function(a,b,c){var d=b.subtract(a),e=c.subtract(a);return d=d.cross(e),d.normalize(),d.w=-d.dot(a),d},b.prototype.setData=function(a){this.dataAry=a},b.prototype.setViewFrustum=function(){this.capsuleLineSprite||this.init(),this.setCam(),this.capsuleLineSprite.clear(),this.capsuleLineSprite.baseColor=new a.Vector3D(0,0,1,1),a.MathClass.GetViewHitBoxDataCopy(a.Scene_data.cam3D.distance);var b=new a.Vector3D(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z),c=a.MathClass.viewBoxVecItem;this.panleAry.push(this.getPanelByVec(b,c[0],c[1])),this.panleAry.push(this.getPanelByVec(b,c[1],c[2])),this.panleAry.push(this.getPanelByVec(b,c[2],c[3])),this.panleAry.push(this.getPanelByVec(b,c[3],c[0]));for(var d=0;d<this.dataAry.length;d++){for(var e=this.dataAry[d],f=new a.Vector3D(e.x,e.y,e.z),g=new a.Vector3D(e.width,e.height,e.depth),h=!1,i=0;i<this.panleAry.length;i++){var j=f,k=f.add(g),l=new a.Vector3D;this.panleAry[i].x>0?l.x=k.x:l.x=j.x,this.panleAry[i].y>0?l.y=k.y:l.y=j.y,this.panleAry[i].z>0?l.z=k.z:l.z=j.z;var m=this.panleAry[i].dot(l)+this.panleAry[i].w;if(0>m){h=!0;break}}h?this.capsuleLineSprite.baseColor=new a.Vector3D(1,0,0,1):this.capsuleLineSprite.baseColor=new a.Vector3D(0,0,1,1),this.capsuleLineSprite.makeLineMode(f,new a.Vector3D(f.x+g.x,f.y,f.z)),this.capsuleLineSprite.makeLineMode(f,new a.Vector3D(f.x,f.y,f.z+g.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x+g.x,f.y,f.z),new a.Vector3D(f.x+g.x,f.y,f.z+g.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x,f.y,f.z+g.z),new a.Vector3D(f.x+g.x,f.y,f.z+g.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x,f.y+g.y,f.z),new a.Vector3D(f.x+g.x,f.y+g.y,f.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x,f.y+g.y,f.z),new a.Vector3D(f.x,f.y+g.y,f.z+g.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x+g.x,f.y+g.y,f.z),new a.Vector3D(f.x+g.x,f.y+g.y,f.z+g.z)),
this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x,f.y+g.y,f.z+g.z),new a.Vector3D(f.x+g.x,f.y+g.y,f.z+g.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x,f.y,f.z),new a.Vector3D(f.x,f.y+g.y,f.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x+g.x,f.y,f.z),new a.Vector3D(f.x+g.x,f.y+g.y,f.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x,f.y,f.z+g.z),new a.Vector3D(f.x,f.y+g.y,f.z+g.z)),this.capsuleLineSprite.makeLineMode(new a.Vector3D(f.x+g.x,f.y,f.z+g.z),new a.Vector3D(f.x+g.x,f.y+g.y,f.z+g.z))}this.capsuleLineSprite.upToGpu()},b}();a.ViewFrustum=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._ready=!1,this.render=!0,this.test=!1,this.cam3D=new a.Camera3D,this.focus3D=new a.Object3D,this.viewMatrx3D=new a.Matrix3D,this._displayList=new Array,this._displaySpriteList=new Array,this._displayRoleList=new Array,this._display2DList=new Array,this._sceneParticleList=new Array,this._time=a.TimeUtil.getTimer(),this._sceneDic=new Object,this.initScene(),this.viewFrustum=new a.ViewFrustum}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},Object.defineProperty(b.prototype,"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"displayRoleList",{get:function(){return this._displayRoleList},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"displaySpriteList",{get:function(){return this._displaySpriteList},enumerable:!0,configurable:!0}),b.prototype.clearScene=function(){this._displayRoleList.length=0},b.prototype.clearStaticScene=function(){for(var b in this._sceneDic){var c=this._sceneDic[b];c instanceof a.CombineParticle?(a.ParticleManager.getInstance().removeParticle(c),c.destory()):c instanceof a.Display3DSprite&&(c.removeStage(),c.destory())}this._ready=!1,this._sceneDic=null,this._sceneQuadTree=null,this._displayList.length=0,this._sceneParticleList.length=0,a.AstarUtil.porcessBak(!1)},b.prototype.testUrl=function(a){return this._currentUrl==a},b.prototype.loadScene=function(b,c,d,e){var f=this;return this._currentUrl==b?(a.AstarUtil.porcessBak(!0),this._ready=!0,c(),void e()):(this.clearStaticScene(),this._ready=!1,a.ResManager.getInstance().loadSceneRes(b,c,d,function(a){f.loadSceneConfigCom(a),e()}),void(this._currentUrl=b))},b.prototype.addSceneImgBg=function(b){var c=new a.Display3dBg;c.setImgInfo(b.url,b.width,b.height),this.addDisplay(c)},b.prototype.getDisplayByID=function(a,b){return 0==a?this._sceneDic["build"+b]:1==a?this._sceneDic["particle"+b]:void 0},b.prototype.fixAstart=function(a){for(var b=0;b<this._displayRoleList.length;b++)this._displayRoleList[b].fixAstartData(a)},b.prototype.loadSceneConfigCom=function(b){this._sceneDic=new Object;var c=b.groundItem,d=b.buildItem;a.Scene_data.fogColor=[b.fogColor.x/255,b.fogColor.y/255,b.fogColor.z/255];var e=1*b.fogDistance,f=b.fogAttenuation;a.Scene_data.gameAngle=isNaN(b.gameAngle)?0:b.gameAngle,a.Scene_data.focus3D.rotationY=a.Scene_data.gameAngle,a.Scene_data.fogData=[e*f,1/((1-f)*e)],a.Scene_data.sceneNumId++;for(var g=0;c&&g<c.length;g++){var h=this.getGroundSprite(c[g],b.terrain);this.addDisplay(h)}for(var i=0;i<d.length;i++){var j=d[i];if(j.type==a.BaseRes.PREFAB_TYPE){var k=this.getBuildSprite(j);this.addDisplay(k)}else if(j.type==a.BaseRes.SCENE_PARTICLE_TYPE){var l=this.getParticleSprite(j);a.ParticleManager.getInstance().addParticle(l),this._sceneParticleList.push(l)}}a.Scene_data.light.setData(b.SunNrm,b.SunLigth,b.AmbientLight),a.LightProbeManager.getInstance().setLightProbeData(b.lightProbeItem),a.AstarUtil.setData(b.astar),this._ready=!0,b.quadTreeData?(this._sceneQuadTree=new a.SceneQuadTree,this._sceneQuadTree.init(b.quadTreeData,this._sceneDic)):this._sceneQuadTree=null,a.Scene_data.cam3D.astarRect=a.AstarUtil.areaRect},b.prototype.getGroundSprite=function(b,c){var d=new a.TerrainDisplay3DSprite;return d.setObjUrl(b.objsurl),d.setMaterialUrl(b.materialurl,b.materialInfoArr),d.materialInfoArr=b.materialInfoArr,d.setLightMapUrl(b.lighturl),d.scaleX=b.scaleX,d.scaleY=b.scaleY,d.scaleZ=b.scaleZ,d.x=b.x,d.y=b.y,d.z=b.z,d.rotationX=b.rotationX,d.rotationY=b.rotationY,d.rotationZ=b.rotationZ,d.objData.lightuvsOffsets=d.objData.uvsOffsets,c&&d.setGrounDataMesh(c[b.id]),this._sceneDic["ground"+b.id]=d,d},b.prototype.makeCollisioin=function(a){},Object.defineProperty(b.prototype,"ready",{get:function(){return this._ready},set:function(a){this._ready=a},enumerable:!0,configurable:!0}),b.prototype.getBuildSprite=function(b){var c=new a.Display3DSprite;return c.setObjUrl(b.objsurl),c.setMaterialUrl(b.materialurl,b.materialInfoArr),c.materialInfoArr=b.materialInfoArr,c.setLightMapUrl(b.lighturl),c.scaleX=b.scaleX,c.scaleY=b.scaleY,c.scaleZ=b.scaleZ,c.x=b.x,c.y=b.y,c.z=b.z,c.rotationX=b.rotationX,c.rotationY=b.rotationY,c.rotationZ=b.rotationZ,c.isPerspective=b.isPerspective,c.type=0,c.id=b.id,this._sceneDic["build"+b.id]=c,c},b.prototype.getParticleSprite=function(b){var c;return c=a.ParticleManager.getInstance().getParticleByte(a.Scene_data.fileRoot+b.url),c.scaleX=b.scaleX,c.scaleY=b.scaleY,c.scaleZ=b.scaleZ,c.x=b.x,c.y=b.y,c.z=b.z,c.rotationX=b.rotationX,c.rotationY=b.rotationY,c.rotationZ=b.rotationZ,c.type=0,this._sceneDic["particle"+b.id]=c,c},b.prototype.initScene=function(){},b.prototype.addDisplay=function(a,b){void 0===b&&(b=-1),-1==this._displayList.indexOf(a)&&(b>=0?this._displayList.splice(b,0,a):this._displayList.push(a),a._scene=this,a.addStage())},b.prototype.removeDisplay=function(a){var b=this._displayList.indexOf(a);-1!=b&&this._displayList.splice(b,1),a.removeStage()},b.prototype.addSpriteDisplay=function(a){if(-1==this._displaySpriteList.indexOf(a)){a._scene=this,a.addStage();for(var b=0;b<this._displaySpriteList.length;b++)if(this._displaySpriteList[b].materialUrl==a.materialUrl)return void this._displaySpriteList.splice(b,0,a);this._displaySpriteList.push(a)}},b.prototype.removeSpriteDisplay=function(a){var b=this._displaySpriteList.indexOf(a);-1!=b&&this._displaySpriteList.splice(b,1),a.removeStage()},b.prototype.addMovieDisplay=function(a){this._displayRoleList.push(a),a.addStage()},b.prototype.addMovieDisplayTop=function(a){this._displayRoleList.unshift(a),a.addStage()},b.prototype.removeMovieDisplay=function(a){var b=this._displayRoleList.indexOf(a);-1!=b&&this._displayRoleList.splice(b,1),a.removeStage()},b.prototype.setParticleVisible=function(){for(var b=a.ParticleManager.getInstance().particleList,c=0;b&&c<b.length;c++)if(!b[c].dynamic&&b[c].bindVecter3d){var d=a.Vector3D.distance(new a.Vector3D(a.Scene_data.focus3D.x,a.Scene_data.focus3D.y,a.Scene_data.focus3D.z),new a.Vector3D(b[c].x,b[c].y,b[c].z));b[c].sceneVisible=1e3>d}},b.prototype.update=function(){if(!this.test){if(this._sceneQuadTree&&(this._sceneQuadTree.setCircle(a.Scene_data.focus3D.x,a.Scene_data.focus3D.z,b.mapQudaTreeDistance),this._sceneQuadTree.needUpdata)){for(var c=0;c<this._displayList.length;c++)this._displayList[c].sceneVisible=!1,this._displayList[c].sceneVisible=!0;this.setParticleVisible(),this._sceneQuadTree.update(),this.mathCamFar()}a.Scene_data.context3D.update(),a.Scene_data.context3D.setDepthTest(!1),a.UIManager.getInstance().upBgGroundZero(),a.Scene_data.context3D.setDepthTest(!0),this.updateMovieFrame(),a.MathClass.getCamView(a.Scene_data.cam3D,a.Scene_data.focus3D),this._ready&&(a.ParticleManager.getInstance().updateTime(),a.SkillManager.getInstance().update(),this.render&&(this.updateStaticDiplay(),this.updateSpriteDisplay(),a.Scene_data.context3D.setWriteDepth(!0),a.Scene_data.context3D.clearTest(),this.updateMovieDisplay(),a.ShadowManager.getInstance().update(),a.Scene_data.context3D.setWriteDepth(!1),a.ParticleManager.getInstance().update(),a.BloodManager.getInstance().update())),a.Scene_data.context3D.setDepthTest(!1),a.UIManager.getInstance().update();for(var c=0;c<this._display2DList.length;c++)this._display2DList[c].update()}},b.prototype.addDisplay2DList=function(a){this._display2DList.push(a)},b.prototype.mathCamFar=function(){for(var b=new a.Vector3D,c=0,d=0;d<this._displayList.length;d++){var e=this._displayList[d];if(e.sceneVisible&&e.aabb){var f=e.posMatrix.clone();f.append(a.Scene_data.cam3D.cameraMatrix);for(var g=e.aabbVect,h=0;h<g.length;h++)b=a.Scene_data.cam3D.cameraMatrix.transformVector(g[h]),b.z>c&&(c=b.z)}}a.Scene_data.camFar=Math.max(500,c+100),a.Engine.resetViewMatrx3D()},b.prototype.updateStaticDiplay=function(){for(var a=0;a<this._displayList.length;a++)this._displayList[a].update()},b.prototype.updateStaticBind=function(){},b.prototype.updateSpriteDisplay=function(){for(var a=0;a<this._displaySpriteList.length;a++)this._displaySpriteList[a].update()},b.prototype.updateMovieDisplay=function(){for(var b=0;b<this._displayRoleList.length;b++)this._displayRoleList[b].update();this._displayRoleList.length&&a.Scene_data.context3D.setVa(1,3,null)},b.prototype.updateMovieFrame=function(){var b=a.TimeUtil.getTimer(),c=b-this._time;this._time=b;for(var d=0;d<this._displayRoleList.length;d++)this._displayRoleList[d].updateFrame(c)},b.mapQudaTreeDistance=200,b}();a.SceneManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._time=0,a._skillDic=new Object,a._loadDic=new Object,a._skillAry=new Array,a._preLoadDic=new Object,a}return __extends(c,b),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.update=function(){for(var b=a.TimeUtil.getTimer(),c=b-this._time,d=0;d<this._skillAry.length;d++)this._skillAry[d].update(c);this._time=b},c.prototype.preLoadSkill=function(b){var c=this;this._dic[b]||this._preLoadDic[b]||(a.ResManager.getInstance().loadSkillRes(a.Scene_data.fileRoot+b,function(d){var e=new a.SkillData;e.data=d.data,e.useNum++,c._dic[b]=e,c.addSrc(b,e)}),this._preLoadDic[b]=!0)},c.prototype.getSkill=function(b,c,d){var e=this;void 0===d&&(d=null);var f,g=b+c,h=this._skillDic[g];if(h)for(var i=0;i<h.length;i++)if(f=h[i],f.isDeath&&0==f.useNum)return f.reset(),f.isDeath=!1,f;if(f=new a.Skill,f.name=c,f.isDeath=!1,this._skillDic[g]||(this._skillDic[g]=new Array),this._skillDic[g].push(f),this._dic[b])return f.setData(this._dic[b].data[f.name],this._dic[b]),f.key=g,this._dic[b].useNum++,f;if(this._loadDic[b]){var j=new Object;return j.name=c,j.skill=f,j.callback=d,this._loadDic[b].push(j),f}this._loadDic[b]=new Array;var j=new Object;return j.name=c,j.skill=f,j.callback=d,this._loadDic[b].push(j),a.ResManager.getInstance().loadSkillRes(a.Scene_data.fileRoot+b,function(a){e.loadSkillCom(b,a)}),f},c.prototype.loadSkillCom=function(b,c){var d=new a.SkillData;d.data=c.data;for(var e=0;e<this._loadDic[b].length;e++){var f=this._loadDic[b][e];f.skill.hasDestory||(f.skill.setData(d.data[f.name],d),f.skill.key=b+f.name,d.useNum++)}this._dic[b]=d,this.addSrc(b,d);for(var e=0;e<this._loadDic[b].length;e++){var f=this._loadDic[b][e];f.callback&&f.callback()}this._loadDic[b].length=0,this._loadDic[b]=null},c.prototype.addSrc=function(b,c){for(var d in c.data){var e=new a.Skill;e.name=d,e.isDeath=!0,e.src=!0,e.setData(c.data[d],c),c.addSrcSkill(e);var f=b+d;this._skillDic[f]||(this._skillDic[f]=new Array),this._skillDic[f].push(e)}},c.prototype.playSkill=function(a){this._skillAry.push(a),a.play()},c.prototype.removeSkill=function(a){var b=this._skillAry.indexOf(a);-1!=b&&this._skillAry.splice(b,1)},c.prototype.gcSkill=function(a){for(var b in this._skillDic){var c=this._skillDic[b],d=c.indexOf(a);-1!=d&&c.splice(d,1)}},c.prototype.gc=function(){for(var b in this._dic){var c=this._dic[b];c.useNum<=0&&(c.idleTime++,c.idleTime>=a.ResCount.GCTime&&c.testDestory()&&(c.destory(),delete this._dic[b]))}for(var b in this._skillDic){for(var d=this._skillDic[b],e=d.length-1;e>=0;e--)d[e].isDeath&&d[e].useNum<=0&&(d[e].idleTime++,d[e].idleTime>=a.ResCount.GCTime&&(d[e].src||(d[e].destory(),d.splice(e,1))));0==d.length&&delete this._skillDic[b]}},c}(a.ResGC);a.SkillManager=b;var c=function(){function b(){var a=this;this.upFun=function(b){a.update(b)}}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.update=function(b){if(this.ctime+=b,this.ctime>this.time)return a.TimeUtil.removeFrameTick(this.upFun),void a.Scene_data.cam3D.offset.setTo(0,0,0);var c=(Math.random()-.5)*this.amp,d=(Math.random()-.5)*this.amp,e=(Math.random()-.5)*this.amp;a.Scene_data.cam3D.offset.setTo(c,d,e)},b.prototype.shock=function(b,c){this.time=b,this.ctime=0,this.amp=c,a.TimeUtil.addFrameTick(this.upFun)},b}();a.ShockUtil=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.isDeath=!0,a.src=!1,a.time=0,a.targetFlag=0,a.targetShockFlag=0,a.needSound=!1,a.hasDestory=!1,a.actionEnd=!1,a}return __extends(c,b),c.prototype.setData=function(b,c){this.hasDestory||(this.skillVo=new a.SkillVo,this.skillVo.setData(b),this.setKeyAry(),this.trajectoryAry=new Array,this._skillData=c)},c.prototype.getBloodTime=function(){return this.skillVo?this.skillVo.bloodTime:a.SkillVo.defaultBloodTime},c.prototype.play=function(){if(!this.skillVo)return void this.skillComplete();if(this.active&&this.active instanceof a.Display3dMovie){var b=this.active;b.play(this.skillVo.action,this.actionEnd?1:2,!1)}},c.prototype.setKeyAry=function(){var b=this;if(this.keyAry=new Array,this.skillVo.types==a.SkillType.FixEffect)for(var c=0;c<this.skillVo.keyAry.length;c++){var d=new a.SkillFixEffect;d.setInfo(this.skillVo.keyAry[c]),d.removeCallFun=function(a){b.removeKey(a)},d.active=this.active,this.keyAry.push(d)}else if(this.skillVo.types==a.SkillType.TrajectoryDynamicTarget||this.skillVo.types==a.SkillType.TrajectoryDynamicPoint)for(var c=0;c<this.skillVo.keyAry.length;c++){var e,f=this.skillVo.keyAry[c];e=1==f.multype?new a.SkillMulTrajectory:new a.SkillTrajectory,e.setInfo(this.skillVo.keyAry[c]),this.keyAry.push(e)}},c.prototype.setendParticleRoation=function(b){for(var c=0;this.keyAry&&c<this.keyAry.length;c++)this.keyAry[c]instanceof a.SkillTrajectory&&this.keyAry[c].endParticle&&(this.keyAry[c].endParticle.rotationX=b.x,this.keyAry[c].endParticle.rotationY=b.y,this.keyAry[c].endParticle.rotationZ=b.z)},c.prototype.removeKey=function(a){this.completeNum++,this.completeNum==this.keyAry.length&&this.skillComplete()},c.prototype.removeSkillForce=function(){if(this.keyAry)for(var a=0;a<this.keyAry.length;a++)this.keyAry[a].reset();this.skillComplete(),this.reset()},c.prototype.skillComplete=function(){a.SkillManager.getInstance().removeSkill(this),this.isDeath=!0,this.completeFun&&this.completeFun(),this.idleTime=0},c.prototype.reset=function(){this.time=0,this.completeNum=0,this.active=null,this.completeFun=null,this.targetFlag=0,this.targetShockFlag=0,this.soundPlay=!1,this.needSound=!1},c.prototype.update=function(a){this.time+=a,this.time>c.MaxTime&&this.skillComplete(),this.getKeyTarget(),this.getShockTarget(),this.updateTrajector(a)},c.prototype.updateTrajector=function(a){for(var b=0;b<this.trajectoryAry.length;b++)this.trajectoryAry[b].update(a)},c.prototype.getKeyTarget=function(){if(this.keyAry){for(var b=this.targetFlag;b<this.keyAry.length&&this.keyAry[b].time<this.time;b++){if(this.keyAry[b].addToRender(),this.skillVo.types==a.SkillType.TrajectoryDynamicTarget||this.skillVo.types==a.SkillType.TrajectoryDynamicPoint){var c=this.keyAry[b];this.trajectoryAry.push(c)}b++,this.targetFlag=b}this.getSound()}},c.prototype.getShockTarget=function(){if(this.skillVo.shockAry&&this.needSound)for(var b=this.targetShockFlag;b<this.skillVo.shockAry.length&&this.skillVo.shockAry[b].time<this.time;b++)a.ShockUtil.getInstance().shock(this.skillVo.shockAry[b].lasttime,this.skillVo.shockAry[b].amp),b++,this.targetShockFlag=b},c.prototype.getSound=function(){this.skillVo.sound&&!this.soundPlay&&this.needSound&&this.skillVo.sound.frame<this.time&&(a.SoundManager.getInstance().playSkillSound(this.skillVo.sound.url),this.soundPlay=!0)},c.prototype.configFixEffect=function(b,c,d){if(void 0===c&&(c=null),void 0===d&&(d=null),this.active=b,this.completeFun=c,this.keyAry)for(var e=0;e<this.keyAry.length;e++)if(this.skillVo.types==a.SkillType.FixEffect){var f=this.keyAry[e];f.active=b,d&&d.length?e>d.length-1?f.outPos=d[d.length-1]:f.outPos=d[e]:f.outPos=null}},c.prototype.configTrajectory=function(b,c,d,e,f){var g=this;if(void 0===d&&(d=null),void 0===e&&(e=0),void 0===f&&(f=null),this.active=b,this.completeFun=d,this.completeNum=0,this.keyAry)for(var h=0;h<this.keyAry.length;h++)if(this.skillVo.types==a.SkillType.TrajectoryDynamicTarget||this.skillVo.types==a.SkillType.TrajectoryDynamicPoint){var i=this.keyAry[h];i.setPlayData(b,c,function(a){g.removeTrajectory(a)},e,0==h?f:null)}},c.prototype.configMulTrajectory=function(b,c,d,e){var f=this;if(void 0===e&&(e=null),this.active=c,this.completeFun=e,this.completeNum=0,this.keyAry)for(var g=0;g<this.keyAry.length;g++)if(this.skillVo.types==a.SkillType.TrajectoryDynamicTarget){var h=this.keyAry[g];h.setMulPlayData(b,d,function(a){f.removeTrajectory(a)},2)}},c.prototype.removeTrajectory=function(a){var b=this.trajectoryAry.indexOf(a);-1!=b&&this.trajectoryAry.splice(b,1),this.completeNum++,this.completeNum==this.keyAry.length&&this.skillComplete()},c.prototype.destory=function(){if(this.skillVo=null,this.name=null,this.keyAry){for(var a=0;a<this.keyAry.length;a++)this.keyAry[a].destory();this.keyAry.length=0,this.keyAry=null}if(this.active=null,this.completeFun=null,this.trajectoryAry){for(var a=0;a<this.trajectoryAry.length;a++)this.trajectoryAry[a].destory();this.trajectoryAry.length=0,this.trajectoryAry=null}this._skillData&&this._skillData.useNum--,this._skillData=null,this.hasDestory=!0},c.MaxTime=5e3,c}(a.ResCount);a.Skill=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.srcList=new Array,a}return __extends(c,b),c.prototype.addSrcSkill=function(a){this.srcList.push(a)},c.prototype.destory=function(){for(var b=0;b<this.srcList.length;b++)this.srcList[b].destory(),a.SkillManager.getInstance().gcSkill(this.srcList[b])},c.prototype.testDestory=function(){for(var b=0;b<this.srcList.length;b++)if(!(this.srcList[b].isDeath&&this.srcList[b].idleTime>=a.ResCount.GCTime))return!1;return!0},c}(a.ResCount);a.SkillData=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.prototype.setData=function(b){this.keyAry=new Array,this.action=b.action,this.skillname=b.skillname,this.bloodTime=b.blood,this.types=b.type,this.types==c.FixEffect?this.keyAry=this.getFixEffect(b.data):(this.types==c.TrajectoryDynamicTarget||this.types==c.TrajectoryDynamicPoint)&&(this.keyAry=this.getTrajectoryDynamicTarget(b.data)),b.sound&&(this.sound=new a.SkillKeyVo,this.sound.frame=b.sound.time*a.Scene_data.frameTime,this.sound.url=b.sound.name),b.shock&&(this.shockAry=this.getShockAry(b.shock))},b.prototype.getShockAry=function(b){for(var c=new Array,d=0;d<b.length;d++){var e=new a.SkillShockVo;e.setData(b[d]),c.push(e)}return c},b.prototype.getFixEffect=function(b){for(var c=new Array,d=0;d<b.length;d++){var e=new a.SkillFixEffectKeyVo;e.setData(b[d]),c.push(e)}return c},b.prototype.getTrajectoryDynamicTarget=function(b){for(var c=new Array,d=0;d<b.length;d++){var e=new a.SkillTrajectoryTargetKeyVo;e.setData(b[d]),c.push(e)}return c},b.defaultBloodTime=250,b}();a.SkillVo=b;var c=function(){function a(){}return a.TrajectoryDynamicTarget=1,a.FixEffect=4,a.TrajectoryDynamicPoint=3,a}();a.SkillType=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(){function a(){this.frame=0}return a.prototype.setData=function(a){this.frame=a.frame,this.url=a.url},a}();a.SkillKeyVo=b;var c=function(){function b(){}return b.prototype.setData=function(b){this.time=b.time*a.Scene_data.frameTime,this.lasttime=b.lasttime*a.Scene_data.frameTime,this.amp=b.amp},b}();a.SkillShockVo=c;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.setData=function(c){b.prototype.setData.call(this,c),this.hasSocket=c.hasSocket,this.hasSocket?this.socket=c.socket:(this.pos=new a.Vector3D(c.pos.x,c.pos.y,c.pos.z),this.rotation=new a.Vector3D(c.rotation.x,c.rotation.y,c.rotation.z))},c}(b);a.SkillFixEffectKeyVo=d;var e=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.setData=function(c){b.prototype.setData.call(this,c),this.beginType=c.beginType,0==this.beginType?this.beginPos=new a.Vector3D(c.beginPos.x,c.beginPos.y,c.beginPos.z):1==this.beginType&&(this.beginSocket=c.beginSocket),this.speed=c.speed,c.hitSocket&&(this.hitSocket=c.hitSocket),c.endParticle&&(this.endParticleUrl=c.endParticle),this.multype=c.multype},c}(b);a.SkillTrajectoryTargetKeyVo=e}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.time=0}return b.prototype.addToRender=function(){this.particle&&(this.particle.reset(),this.particle.sceneVisible=!0,a.ParticleManager.getInstance().addParticle(this.particle))},b.prototype.setInfo=function(b){this.time=b.frame*a.Scene_data.frameTime,this.particle=a.ParticleManager.getInstance().getParticleByte(a.Scene_data.fileRoot+b.url)},b.prototype.reset=function(){this.particle.reset(),a.ParticleManager.getInstance().removeParticle(this.particle)},b.prototype.destory=function(){this.particle.destory(),this.particle=null,this.removeCallFun=null},b}();a.SkillKey=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.addToRender=function(){b.prototype.addToRender.call(this),this.particle.addEventListener(a.BaseEvent.COMPLETE,this.onPlayCom,this)},c.prototype.onPlayCom=function(b){void 0===b&&(b=null),this.particle.removeEventListener(a.BaseEvent.COMPLETE,this.onPlayCom,this),a.ParticleManager.getInstance().removeParticle(this.particle),this.removeCallFun(this)},c}(a.SkillKey);a.SkillEffect=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(){function a(){}return a.prototype.getSocket=function(a,b){this.bindMatrix.clone(b)},a.prototype.getSunType=function(){return 1},a}();a.SkillBugBind=b;var c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.setInfo=function(a){c.prototype.setInfo.call(this,a);var b=a;this.pos=b.pos,this.rotation=b.rotation,this.hasSocket=b.hasSocket,this.socket=b.socket},d.prototype.addToRender=function(){if(c.prototype.addToRender.call(this),this.outPos)this.particle.x=this.outPos.x,this.particle.y=this.outPos.y,this.particle.z=this.outPos.z,this.particle.rotationX=this.rotation.x,this.particle.rotationY=this.rotation.y+this.active.rotationY,this.particle.rotationZ=this.rotation.z,this.particle.bindTarget=null;else if(this.hasSocket){var d=this.active;this.particle.bindTarget=d,this.particle.bindSocket=this.socket}else{var e=new a.Matrix3D;e.appendRotation(this.active.rotationY,a.Vector3D.Y_AXIS);var f=e.transformVector(this.pos);f.x+=this.active.x,f.y+=this.active.y,f.z+=this.active.z;var g=new b;g.bindMatrix=new a.Matrix3D,g.bindMatrix.appendRotation(this.rotation.x,a.Vector3D.X_AXIS),g.bindMatrix.appendRotation(this.rotation.y,a.Vector3D.Y_AXIS),g.bindMatrix.appendRotation(this.rotation.z,a.Vector3D.Z_AXIS),g.bindMatrix.appendRotation(this.active.rotationY,a.Vector3D.Y_AXIS),g.bindMatrix.appendTranslation(f.x,f.y,f.z),this.particle.bindTarget=g}},d}(a.SkillEffect);a.SkillFixEffect=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._currentPos=new a.Vector3D,c.rotationMatrix=new a.Matrix3D,c._socketMaxrix=new a.Matrix3D,c._currentTargetPos=new a.Vector3D,c}return __extends(c,b),c.prototype.update=function(a){this.path.update(a)},c.prototype.reset=function(){b.prototype.reset.call(this),this.endParticle&&(a.ParticleManager.getInstance().addParticle(this.endParticle),this.endParticle.reset(),this.endParticle.setPos(this._currentTargetPos.x,this._currentTargetPos.y,this._currentTargetPos.z)),this.removeCallFun&&this.removeCallFun(this)},c.prototype.endPlayFun=function(b){void 0===b&&(b=null),a.ParticleManager.getInstance().removeParticle(this.endParticle),this.endParticle.removeEventListener(a.BaseEvent.COMPLETE,this.endPlayFun,this)},c.prototype.setCurrentPos=function(){if(this.data.hitSocket){var a=this.target;return a&&(a.getSocket(this.data.hitSocket,this._socketMaxrix),this._currentTargetPos.setTo(this._socketMaxrix.position.x,this._socketMaxrix.position.y,this._socketMaxrix.position.z)),!0}return this._currentTargetPos.x==this.target.x&&this._currentTargetPos.y==this.target.y&&this._currentTargetPos.z==this.target.z?!1:(this._currentTargetPos.setTo(this.target.x,this.target.y,this.target.z),!0)},c.prototype.addToRender=function(){b.prototype.addToRender.call(this);var c;if(0==this.data.beginType){var d=new a.Matrix3D;d.appendRotation(this.active.rotationY,a.Vector3D.Y_AXIS),c=d.transformVector(this.data.beginPos),this._currentPos.setTo(this.active.x+c.x,this.active.y+c.y,this.active.z+c.z)}else if(1==this.data.beginType){var e=new a.Matrix3D,f=this.active;f.getSocket(this.data.beginSocket,e),c=e.position,this._currentPos.setTo(c.x,c.y,c.z)}this.particle.setPos(this._currentPos.x,this._currentPos.y,this._currentPos.z),this.path.add()},c.prototype.getSocket=function(a,b){b.identity(),b.append(this.rotationMatrix),b.appendTranslation(this._currentPos.x,this._currentPos.y,this._currentPos.z)},c.prototype.getSunType=function(){return 0},c.prototype.setInfo=function(c){b.prototype.setInfo.call(this,c),this.particle.bindTarget=this,this.data=c,this.data.endParticleUrl&&(this.endParticle=a.ParticleManager.getInstance().getParticleByte(a.Scene_data.fileRoot+this.data.endParticleUrl),this.endParticle.addEventListener(a.BaseEvent.COMPLETE,this.endPlayFun,this))},c.prototype.setPlayData=function(b,c,d,e,f){var g=this;void 0===e&&(e=0),void 0===f&&(f=null),this.active=b,this.target=c,this.removeCallFun=d,this._currentPos.setTo(0,0,0),this.rotationMatrix.identity(),this._socketMaxrix.identity(),this._currentTargetPos.setTo(0,0,0),this.path||(this.path=a.PathManager.getNewPath(2),this.path.setData(this,function(){g.reset()},this._currentPos,this.rotationMatrix,this._currentTargetPos,f),this.path.speed=this.data.speed),this.path.reset()},c.prototype.destory=function(){b.prototype.destory.call(this),this.active=null,this.target=null,this.data=null,this._currentPos=null,this.rotationMatrix=null,this._socketMaxrix=null,this._currentTargetPos=null,this.path=null},c}(a.SkillKey);a.SkillTrajectory=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.update=function(a){this.pathMul.update(a)},c.prototype.getSunType=function(){return 1},c.prototype.addToRender=function(){if(this.particle){if(this.particle.reset(),a.ParticleManager.getInstance().addParticle(this.particle),this.currentPosList)for(var b=0;b<this.activeList.length;b++)this.currentPosList[b].setTo(this.activeList[b].x,this.activeList[b].y+10,this.activeList[b].z+5),this.currentPosList[b].w=0;else{this.currentPosList=new Array;for(var b=0;b<this.activeList.length;b++)this.currentPosList.push(new a.Vector3D(this.activeList[b].x,this.activeList[b].y+10,this.activeList[b].z+5));this.pathMul.setInitCurrentPos(this.currentPosList)}this.pathMul.add(),this.particle.setMulPos(this.pathMul.resultAry)}},c.prototype.setMulPlayData=function(b,c,d,e){var f=this;void 0===e&&(e=0),this.activeList=b,this.active=this.activeList[0],this.target=c,this.removeCallFun=d,this._currentPos.setTo(0,0,0),this.rotationMatrix.identity(),this._socketMaxrix.identity(),this._currentTargetPos.setTo(0,0,0),this.pathMul||(this.pathMul=a.PathManager.getNewPath(e),this.pathMul.setData(this,function(){f.reset()},this._currentPos,this.rotationMatrix,this._currentTargetPos),this.pathMul.speed=this.data.speed),this.pathMul.reset()},c.prototype.getMulSocket=function(a){a&&this.pathMul.applyData(a)},c}(a.SkillTrajectory);a.SkillMulTrajectory=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._currentDirect=new a.Vector3D}return b.prototype.update=function(b){if(this.time=b,this.hasReached)return this.endTime+=b,void(this.endTime>200&&this.applyArrive());if(this.skillTrajectory.setCurrentPos()&&(this._currentDirect.x=this.currentTargetPos.x-this.currentPos.x,this._currentDirect.y=this.currentTargetPos.y-this.currentPos.y,this._currentDirect.z=this.currentTargetPos.z-this.currentPos.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.setRotationMatrix(this.currentTargetPos.subtract(this.currentPos)),0==this._currentDirect.length))return void this.arrive();var c=this._currentDirect.length*this.time;if(!this.hasReached){var d=a.Vector3D.distance(this.currentPos,this.currentTargetPos);this.currentPos.x+=this._currentDirect.x*this.time,this.currentPos.y+=this._currentDirect.y*this.time,this.currentPos.z+=this._currentDirect.z*this.time}c>d&&this.arrive()},b.prototype.setRotationMatrix=function(b){b.normalize();var c=new a.Vector3D(0,0,1),d=c.cross(b);
d.normalize();var e=Math.acos(b.dot(c)),f=new a.Quaternion;f.fromAxisAngle(d,e),f.toMatrix3D(this.rotationMatrix)},b.prototype.arrive=function(){this.hasReached=!0},b.prototype.applyArrive=function(){this.endFun(),this.bloodFun&&this.bloodFun()},b.prototype.reset=function(){this.hasReached=!1,this._currentDirect.setTo(0,0,0),this.endTime=0},b.prototype.add=function(){},b.prototype.setData=function(a,b,c,d,e,f){this.skillTrajectory=a,this.currentPos=c,this.rotationMatrix=d,this.currentTargetPos=e,this.endFun=b,this.bloodFun=f},b}();a.SkillPath=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c.basePos=new a.Vector3D,c}return __extends(c,b),c.prototype.add=function(){this.skillTrajectory.setCurrentPos();var b=new a.Vector3D;b.x=this.currentTargetPos.x-this.currentPos.x,b.y=this.currentTargetPos.y-this.currentPos.y,b.z=this.currentTargetPos.z-this.currentPos.z,this.basePos.setTo(this.currentPos.x,this.currentPos.y,this.currentPos.z),this.alltime=b.length/this.speed},c.prototype.update=function(b){if(this.time=b,this.lastTime+=b,this.hasReached)return this.endTime+=b,void(this.endTime>200&&this.applyArrive());this.skillTrajectory.setCurrentPos();var c=this.lastTime/this.alltime;c>1&&(c=1);var d=this.getOffset(c);if(this._currentDirect.x=this.currentTargetPos.x-this.basePos.x,this._currentDirect.y=this.currentTargetPos.y-this.basePos.y,this._currentDirect.z=this.currentTargetPos.z-this.basePos.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.setRotationMatrix(this.currentTargetPos.subtract(this.basePos)),0==this._currentDirect.length)return void this.arrive();var e=this._currentDirect.length*this.time;if(!this.hasReached){var f=a.Vector3D.distance(this.basePos,this.currentTargetPos);this.basePos.x+=this._currentDirect.x*this.time,this.basePos.y+=this._currentDirect.y*this.time,this.basePos.z+=this._currentDirect.z*this.time,this.setApplyPos(d)}e>f&&this.arrive()},c.prototype.setApplyPos=function(a){this.currentPos.x=this.basePos.x+a.x,this.currentPos.y=this.basePos.y+a.y,this.currentPos.z=this.basePos.z+a.z},c.prototype.getOffset=function(b){b=100*Math.sin(b*Math.PI);var c=this._currentDirect.cross(new a.Vector3D(0,1,0));return c.scaleBy(b),new a.Vector3D},c.prototype.reset=function(){b.prototype.reset.call(this),this.lastTime=0},c}(a.SkillPath);a.SkillSinPath=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getOffset=function(b){b=300*(b-b*b);var c=this._currentDirect.cross(new a.Vector3D(0,-1,0));return c.scaleBy(b),new a.Vector3D},c}(b);a.SkillCosPath=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.lastTime=0,a}return __extends(c,b),c.prototype.setInitCurrentPos=function(a){this.currentPosAry=a,this.allTimeList=new Array;for(var b=0;b<a.length;b++)this.allTimeList.push(0)},c.prototype.add=function(){this.skillTrajectory.setCurrentPos(),this.directAry=new Array;for(var b=0,c=0;c<this.currentPosAry.length;c++){var d=new a.Vector3D;d.x=this.currentTargetPos.x-this.currentPosAry[c].x,d.y=this.currentTargetPos.y-this.currentPosAry[c].y,d.z=this.currentTargetPos.z-this.currentPosAry[c].z;var e=d.length;e>b&&(b=e,this.maxV3d=this.currentPosAry[c]),this.allTimeList[c]=e/this.speed,d.normalize(),d.scaleBy(this.speed),this.directAry.push(d)}this.alltime=b/this.speed,this.setAllData()},c.prototype.setAllData=function(){var a=float2int(this.alltime/33)+8;this.resultAry=new Array;for(var b=0;b<this.currentPosAry.length;b++){var c=new Array;this.resultAry.push(c);for(var d=this.directAry[b],e=0;6>e;e++)c.push([this.currentPosAry[b].x,this.currentPosAry[b].y,this.currentPosAry[b].z]);for(var f=0;a>f;f++){this.lastTime=33*f;var g,h=this.lastTime/this.allTimeList[b],i=h;h>=1?(i=0,g=[this.currentTargetPos.x,this.currentTargetPos.y,this.currentTargetPos.z]):(i-=i*i,i*=250,g=[d.x*this.lastTime+this.currentPosAry[b].x,d.y*this.lastTime+i+this.currentPosAry[b].y,d.z*this.lastTime+this.currentPosAry[b].z]);var j;if(0==f)j=[0,1,0];else{var k=c[2*f-2];j=[g[0]-k[0],g[1]-k[1],g[2]-k[2]];var l=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]);j[0]/=l,j[1]/=l,j[2]/=l}c.push(g,j)}}},c.prototype.update=function(b){if(this.time=b,this.lastTime+=b,this.hasReached)return this.endTime+=b,void(this.endTime>200&&this.applyArrive());this.skillTrajectory.setCurrentPos();for(var c=0;c<this.currentPosAry.length;c++){var d=this.lastTime/this.allTimeList[c];d-=d*d,d*=250;var e=this.currentPosAry[c];if(this._currentDirect.x=this.currentTargetPos.x-e.x,this._currentDirect.y=this.currentTargetPos.y-e.y,this._currentDirect.z=this.currentTargetPos.z-e.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.maxV3d==e&&(this.setRotationMatrix(this.currentTargetPos.subtract(e)),0==this._currentDirect.length))return void this.arrive();var f=this._currentDirect.length*this.time;if(!this.hasReached){var g=a.Vector3D.distance(e,this.currentTargetPos);e.x+=this._currentDirect.x*this.time,e.y+=this._currentDirect.y*this.time,e.z+=this._currentDirect.z*this.time,e.w=d}this.maxV3d==e&&f>g&&this.arrive()}this.currentPos.setTo(this.currentPosAry[0].x,this.currentPosAry[0].y+this.currentPosAry[0].w,this.currentPosAry[0].z)},c.prototype.setData=function(a,c,d,e,f){b.prototype.setData.call(this,a,c,d,e,f,null),this.skillMul=a},c.prototype.applyData=function(a){for(var b=0;b<a.length;b++)a[b].setTo(this.currentPosAry[b].x,this.currentPosAry[b].y+this.currentPosAry[b].w,this.currentPosAry[b].z)},c.prototype.reset=function(){b.prototype.reset.call(this),this.lastTime=0},c}(a.SkillPath);a.SkillMulPath=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.reg=function(a,b){this.dic[a]=b},b.getNewPath=function(a){var b=this.dic[a];return new b},b.init=function(){this.dic[0]=a.SkillPath,this.dic[1]=a.SkillSinPath,this.dic[2]=a.SkillCosPath},b.dic=new Object,b}();a.PathManager=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a.encode=function(a){var b,c=new Uint8Array(a),d=c.length,e="";for(b=0;d>b;b+=3)e+=this.chars[c[b]>>2],e+=this.chars[(3&c[b])<<4|c[b+1]>>4],e+=this.chars[(15&c[b+1])<<2|c[b+2]>>6],e+=this.chars[63&c[b+2]];return d%3===2?e=e.substring(0,e.length-1)+"=":d%3===1&&(e=e.substring(0,e.length-2)+"=="),e},a.decode=function(a){var b,c,d,e,f,g=.75*a.length,h=a.length,i=0;"="===a[a.length-1]&&(g--,"="===a[a.length-2]&&g--);var j=new ArrayBuffer(g),k=new Uint8Array(j);for(b=0;h>b;b+=4)c=this.chars.indexOf(a[b]),d=this.chars.indexOf(a[b+1]),e=this.chars.indexOf(a[b+2]),f=this.chars.indexOf(a[b+3]),k[i++]=c<<2|d>>4,k[i++]=(15&d)<<4|e>>2,k[i++]=(3&e)<<6|63&f;return j},a}();a.Base64=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this._loadThreadList=new Array,this._waitLoadList=new Array;for(var a=0;10>a;a++)this._loadThreadList.push(new c)}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.getVersion=function(a){return""},a.prototype.load=function(a,b,c,e,f){if(void 0===e&&(e=null),void 0===f&&(f=null),a&&!(a.length<1)&&-1==a.search("undefined")){var g="0",h=new d(a,b,c,e,f);h.version=g;for(var i=0;i<this._loadThreadList.length;i++)if(this._loadThreadList[i].idle)return void this._loadThreadList[i].load(h);this._waitLoadList.push(h)}},a.prototype.loadWaitList=function(){if(!(this._waitLoadList.length<=0))for(var a=0;a<this._loadThreadList.length;a++)if(this._loadThreadList[a].idle)return void this._loadThreadList[a].load(this._waitLoadList.shift())},a.BYTE_TYPE="BYTE_TYPE",a.IMG_TYPE="IMG_TYPE",a.XML_TYPE="XML_TYPE",a}();a.LoadManager=b;var c=function(){function c(){var a=this;this._xhr=new XMLHttpRequest,this._xhr.onreadystatechange=function(){return a._xhr&&4===a._xhr.readyState?0!==a._xhr.status&&200!==a._xhr.status?void a.loadError():void a.loadByteXML():void 0},this._xhr.onprogress=function(b){a._loadInfo.progressFun&&a._loadInfo.progressFun(b.loaded/b.total)},this._xhr.onerror=function(){a.loadError()},this._img=makeImage(),this._img.onload=function(){a.loadImg()},this._img.onerror=function(){a.loadError()},this.idle=!0}return c.prototype.load=function(a){this._loadInfo=a,this.idle=!1,this._url=a.url,this._loadInfo.type==b.BYTE_TYPE?(this._xhr.open("GET",a.vurl,!0),this._xhr.responseType="arraybuffer",this._xhr.send()):this._loadInfo.type==b.XML_TYPE?(this._xhr.open("GET",a.vurl,!0),this._xhr.responseType="text",this._xhr.send()):this._loadInfo.type==b.IMG_TYPE&&(this._img.url==a.vurl?this.loadImg():(this._img.url=a.vurl,this._img.src=a.vurl))},c.prototype.loadError=function(){this.idle=!0,this._loadInfo.info&&this._loadInfo.info.errorFun&&this._loadInfo.info.errorFun(),this._loadInfo=null,b.getInstance().loadWaitList()},c.prototype.loadByteXML=function(){this._loadInfo.info?this._loadInfo.fun(this._xhr.response,this._loadInfo.info):this._loadInfo.fun(this._xhr.response),this.idle=!0,this._loadInfo=null,b.getInstance().loadWaitList()},c.prototype.loadByteImg=function(){this._img.src="data:image/png;base64,"+a.Base64.encode(this._xhr.response)},c.prototype.loadImg=function(){this._loadInfo.info?this._loadInfo.fun(this._img,this._loadInfo.info):this._loadInfo.fun(this._img),this.idle=!0,this._loadInfo=null,b.getInstance().loadWaitList()},c}();a.LoaderThread=c;var d=function(){function a(a,b,c,d,e){void 0===d&&(d=null),void 0===e&&(e=null),this.url=a,this.type=b,this.fun=c,this.info=d,this.progressFun=e}return Object.defineProperty(a.prototype,"vurl",{get:function(){return this.url},enumerable:!0,configurable:!0}),a}();a.LoadInfo=d}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._loadList=new Object,a}return __extends(c,b),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.getObjData=function(b,c){var d=this;if(this._dic[b])return c(this._dic[b]),void this._dic[b].useNum++;var e;this._loadList[b]||(this._loadList[b]=new Array,a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(a){d.loadObjCom(a,b)})),e=this._loadList[b],e.push(c)},c.prototype.registerUrl=function(a){this._dic[a]&&this._dic[a].useNum++},c.prototype.releaseUrl=function(a){this._dic[a]&&this._dic[a].clearUseNum()},c.prototype.gc=function(){b.prototype.gc.call(this)},c.prototype.readFloatNrm=function(a,b){var c=a.readInt();if(c>0)for(var d=0;c>d;d++)b.push(a.readFloat())},c.prototype.readcollisionItem=function(b,c){var d=b.readInt();if(d>0){c.collision=new a.CollisionItemVo,c.collision.collisionItem=new Array;for(var e=0;d>e;e++){var f=JSON.parse(b.readUTF()),g=new a.CollisionVo;g.scaleX=f.scale_x,g.scaleY=f.scale_y,g.scaleZ=f.scale_z,g.x=f.x,g.y=f.y,g.z=f.z,g.rotationX=f.rotationX,g.rotationY=f.rotationY,g.rotationZ=f.rotationZ,g.scaleX=this.getFloadNum(g.scaleX),g.scaleY=this.getFloadNum(g.scaleY),g.scaleZ=this.getFloadNum(g.scaleZ),g.rotationX=this.getFloadNum(g.rotationX),g.rotationY=this.getFloadNum(g.rotationY),g.rotationZ=this.getFloadNum(g.rotationZ),g.type=f.type,g.data=f.data,c.collision.collisionItem.push(g)}}},c.prototype.getFloadNum=function(a){return Math.floor(1e3*a)/1e3},c.prototype.loadObjCom=function(b,c){if(!this._dic[c]){var d=new a.ObjData,e=new a.Pan3dByteArray(b),f=e.readInt();e.readUTF();f>=20?(this.readObj2OneBuffer(e,d),f>=37&&e.position<e.length&&this.readcollisionItem(e,d)):(a.BaseRes.readFloatTwoByte(e,d.vertices),a.BaseRes.readFloatTwoByte(e,d.uvs),a.BaseRes.readFloatOneByte(e,d.lightuvs),a.BaseRes.readFloatTwoByte(e,d.normals),a.BaseRes.readIntForTwoByte(e,d.indexs),a.BaseRes.readFloatTwoByte(e,d.tangents),a.BaseRes.readFloatTwoByte(e,d.bitangents),d.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(d.vertices),d.uvBuffer=a.Scene_data.context3D.uploadBuff3D(d.uvs),d.lightUvBuffer=a.Scene_data.context3D.uploadBuff3D(d.lightuvs),d.normalsBuffer=a.Scene_data.context3D.uploadBuff3D(d.normals)),d.treNum=d.indexs.length,d.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(d.indexs),this._dic[c]=d;var g=this._loadList[c];if(g){for(var h=0;h<g.length;h++)g[h](d);delete this._loadList[c]}return d}},c.prototype.readObj2OneBuffer=function(b,c){for(var d,e=new Array,e=new Array,f=0,g=0;6>g;g++){var h=b.readBoolean();if(e.push(h),h)switch(g){case 1:f+=2;break;case 2:f+=2;break;default:f+=3}}d=b.readFloat();d*=4*f;var i=new ArrayBuffer(d),j=new DataView(i),k=3,l=k+2,m=e[2]?l+2:k+2,n=m+3,o=n+3;a.BaseRes.readBytes2ArrayBuffer(b,j,3,0,f),a.BaseRes.readBytes2ArrayBuffer(b,j,2,k,f),a.BaseRes.readBytes2ArrayBuffer(b,j,2,l,f,1),a.BaseRes.readBytes2ArrayBuffer(b,j,3,m,f),a.BaseRes.readBytes2ArrayBuffer(b,j,3,n,f),a.BaseRes.readBytes2ArrayBuffer(b,j,3,o,f),c.dataView=j,a.BaseRes.readIntForTwoByte(b,c.indexs),c.vertexBuffer=a.Scene_data.context3D.uploadBuff3DArrayBuffer(i),c.compressBuffer=!0,c.uvsOffsets=4*k,c.lightuvsOffsets=4*l,c.normalsOffsets=4*m,c.tangentsOffsets=4*n,c.bitangentsOffsets=4*o,c.stride=4*f,console.log("$objData.stride ",c.stride)},c.prototype.creatTBNBuffer=function(b){b.tangentBuffer=a.Scene_data.context3D.uploadBuff3D(b.tangents),b.bitangentBuffer=a.Scene_data.context3D.uploadBuff3D(b.bitangents)},c}(a.ResGC);a.ObjDataManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._loadDic=new Object,a}return __extends(c,b),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.getMeshDataByLocalUrl=function(a){return this._dic[a]},c.prototype.getMeshData=function(b,c,d){var e=this;return void 0===d&&(d=1),this._dic[b]&&this._dic[b].ready?(c(this._dic[b]),void this._dic[b].useNum++):this._loadDic[b]?void this._loadDic[b].push(c):(this._loadDic[b]=new Array,this._loadDic[b].push(c),void a.ResManager.getInstance().loadRoleRes(a.Scene_data.fileRoot+b,function(a){e.roleResCom(a,c)},d))},c.prototype.roleResCom=function(a,b){var c=a.roleUrl,d=this._dic[c];d.loadMaterial(),d.setAction(a.actionAry,c),d.url=c,a.ambientLightColor&&(d.lightData=[[a.ambientLightColor.x,a.ambientLightColor.y,a.ambientLightColor.z],[a.nrmDircet.x,a.nrmDircet.y,a.nrmDircet.z],[a.sunLigthColor.x,a.sunLigthColor.y,a.sunLigthColor.z]]);for(var e=0;e<this._loadDic[c].length;e++)this._loadDic[c][e](d),d.useNum++;delete this._loadDic[c],d.ready=!0},c.prototype.gc=function(){b.prototype.gc.call(this)},c.prototype.readData=function(b,c,d,e){var f=new a.SkinMesh;f.fileScale=b.readFloat(),e>=19?f.tittleHeight=b.readFloat():f.tittleHeight=50,f.hitBox=new a.Vector2D(20,20),e>=23&&(f.hitBox.x=b.readFloat(),f.hitBox.y=b.readFloat()),f.makeHitBoxItem();for(var g=b.readInt(),h=new Object,i=0;g>i;i++){var j=new a.MeshData;e>=35&&(j.bindPosAry=this.readBindPosByte(b),j.getBindPosMatrix()),e>=21?this.readMesh2OneBuffer(b,j):(a.BaseRes.readFloatTwoByte(b,j.vertices),a.BaseRes.readFloatTwoByte(b,j.tangents),a.BaseRes.readFloatTwoByte(b,j.bitangents),a.BaseRes.readFloatTwoByte(b,j.normals),a.BaseRes.readFloatTwoByte(b,j.uvs),a.BaseRes.readIntForOneByte(b,j.boneIDAry),a.BaseRes.readFloatOneByte(b,j.boneWeightAry),a.BaseRes.readIntForTwoByte(b,j.indexs),a.BaseRes.readIntForTwoByte(b,j.boneNewIDAry),this.uploadMesh(j)),j.treNum=j.indexs.length,j.materialUrl=b.readUTF(),j.materialParamData=a.BaseRes.readMaterialParamData(b);for(var k=b.readInt(),l=0;k>l;l++){var m=new a.BindParticle(b.readUTF(),b.readUTF());j.particleAry.push(m),h[m.url]=!0}f.addMesh(j)}for(var n in h)a.ParticleManager.getInstance().registerUrl(n);if(f.allParticleDic=h,35>e)for(var o=this.readBindPosByte(b),p=0;p<f.meshAry.length;p++)f.meshAry[p].bindPosAry=o,f.meshAry[p].getBindPosMatrix();var q=b.readInt();f.boneSocketDic=new Object;for(var l=0;q>l;l++){var r=new a.BoneSocketData;r.name=b.readUTF(),r.boneName=b.readUTF(),r.index=b.readInt(),r.x=b.readFloat(),r.y=b.readFloat(),r.z=b.readFloat(),r.rotationX=b.readFloat(),r.rotationY=b.readFloat(),r.rotationZ=b.readFloat(),f.boneSocketDic[r.name]=r}return this._dic[d]=f,f},c.prototype.readBindPosByte=function(a){for(var b=a.readInt(),c=new Array,d=0;b>d;d++){var e=new Array(a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat());c.push(e)}return c},c.prototype.readMesh2OneBuffer=function(b,c){for(var d=b.readInt(),e=new Array,f=0,g=0;5>g;g++){var h=b.readBoolean();e.push(h),h&&(f+=1==g?2:3)}f+=8,d*=4*f;var i,j=3,k=j+2,l=k+3,m=l+3;i=e[2]?e[4]?m+3:k+3:j+2;var n=i+4,o=new ArrayBuffer(d),p=new DataView(o);a.BaseRes.readBytes2ArrayBuffer(b,p,3,0,f),a.BaseRes.readBytes2ArrayBuffer(b,p,2,j,f),a.BaseRes.readBytes2ArrayBuffer(b,p,3,k,f),a.BaseRes.readBytes2ArrayBuffer(b,p,3,l,f),a.BaseRes.readBytes2ArrayBuffer(b,p,3,m,f),a.BaseRes.readBytes2ArrayBuffer(b,p,4,i,f,2),a.BaseRes.readBytes2ArrayBuffer(b,p,4,n,f,1),a.BaseRes.readIntForTwoByte(b,c.indexs),a.BaseRes.readIntForTwoByte(b,c.boneNewIDAry),c.compressBuffer=!0,c.uvsOffsets=4*j,c.normalsOffsets=4*k,c.tangentsOffsets=4*l,c.bitangentsOffsets=4*m,c.boneIDOffsets=4*i,c.boneWeightOffsets=4*n,c.stride=4*f,c.vertexBuffer=a.Scene_data.context3D.uploadBuff3DArrayBuffer(o),c.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(c.indexs)},c.prototype.uploadMesh=function(b){b.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(b.vertices),b.uvBuffer=a.Scene_data.context3D.uploadBuff3D(b.uvs),b.boneIdBuffer=a.Scene_data.context3D.uploadBuff3D(b.boneIDAry),b.boneWeightBuffer=a.Scene_data.context3D.uploadBuff3D(b.boneWeightAry),b.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(b.indexs)},c.prototype.uploadPbrMesh=function(b,c){b.normalsBuffer=a.Scene_data.context3D.uploadBuff3D(b.normals),c&&(b.tangentBuffer=a.Scene_data.context3D.uploadBuff3D(b.tangents),b.bitangentBuffer=a.Scene_data.context3D.uploadBuff3D(b.bitangents))},c.prototype.preLoad=function(a){this.getMeshData(a,function(a){a.loadMaterial()})},c}(a.ResGC);a.MeshDataManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(){function b(){this._dic=new Object}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.getAnimData=function(b,c){var d=this;return this._dic[b]?void c(this._dic[b]):void a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(c,e){var f=d.readData(new a.Pan3dByteArray(c),b);e(f)},c)},b.prototype.getAnimDataImmediate=function(a){return this._dic[a]},b.prototype.clearAnim=function(a){delete this._dic[a]},b.prototype.readData=function(b,c){var e=new Array,f=new Array,g=new a.AnimData;g.inLoop=b.readInt();for(var h=b.readInt(),i=0;h>i;i++)g.inter.push(b.readInt());h=b.readInt();for(var i=0;h>i;i++)g.bounds.push(b.readVector3D());g.nameHeight=b.readInt(),h=b.readInt();for(var i=0;h>i;i++){var j=new d;j.father=b.readInt(),j.changtype=b.readInt(),j.startIndex=b.readInt(),j.tx=b.readFloat(),j.ty=b.readFloat(),j.tz=b.readFloat(),j.qx=b.readFloat(),j.qy=b.readFloat(),j.qz=b.readFloat(),e.push(j)}this.readFrameData(b,f),h=b.readInt();for(var i=0;h>i;i++)g.posAry.push(b.readVector3D());return g.matrixAry=this.processFrame(f,e),this._dic[c]=g,g},b.prototype.readFrameData=function(a,b){for(var c=this.readFrameTypeData(a),d=a.readBoolean(),e=a.readFloat(),f=a.readInt(),g=0;f>g;g++){var h=a.readInt(),i=new Array;b.push(i);for(var j=0;h>j;j++)c[j]?i.push(a.readFloatTwoByte(e)):d?i.push(a.readFloat()):i.push(a.readShort()/32767)}},b.prototype.readFrameTypeData=function(a){for(var b=new Array,c=a.readInt(),d=0;c>d;d++)b.push(a.readBoolean());return b},b.prototype.processFrame=function(a,b){for(var c=new Array,d=0;d<a.length;d++)c.push(this.frameToBone(a[d],b));return this.setFrameToMatrix(c)},b.prototype.frameToBone=function(a,b){for(var d=new Array,e=0;e<b.length;e++){var f=new c;f.father=b[e].father;var g=0;1&b[e].changtype?(f.tx=a[b[e].startIndex+g],++g):f.tx=b[e].tx,2&b[e].changtype?(f.ty=a[b[e].startIndex+g],++g):f.ty=b[e].ty,4&b[e].changtype?(f.tz=a[b[e].startIndex+g],++g):f.tz=b[e].tz,8&b[e].changtype?(f.qx=a[b[e].startIndex+g],++g):f.qx=b[e].qx,16&b[e].changtype?(f.qy=a[b[e].startIndex+g],++g):f.qy=b[e].qy,32&b[e].changtype?(f.qz=a[b[e].startIndex+g],++g):f.qz=b[e].qz,d.push(f)}return d},b.prototype.setFrameToMatrix=function(b){for(var c=new Array,d=0;d<b.length;d++){var e=b[d],f=new a.Quaternion,g=new a.Matrix3D,h=new Array;c.push(h);for(var i=0;i<e.length;i++){var j=e[i];if(f=new a.Quaternion(j.qx,j.qy,j.qz),f.w=this.getW(f.x,f.y,f.z),-1==j.father)g=f.toMatrix3D(),g.appendTranslation(j.tx,j.ty,j.tz),g.appendRotation(-90,a.Vector3D.X_AXIS),h.push(g);else{e[j.father];g=f.toMatrix3D(),g.appendTranslation(j.tx,j.ty,j.tz),g.append(h[j.father]),h.push(g)}}for(i=0;i<h.length;i++)h[i].appendScale(-1,1,1)}return c},b.prototype.getW=function(a,b,c){var d=1-(a*a+b*b+c*c);return d=0>d?0:-Math.sqrt(d)},b}();a.AnimManager=b;var c=function(){function a(){}return a}();a.ObjectBaseBone=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.clone=function(){var a=new b;return a.tx=this.tx,a.ty=this.ty,a.tz=this.tz,a.tw=this.tw,a.qx=this.qx,a.qy=this.qy,a.qz=this.qz,a.qw=this.qw,a.changtype=this.changtype,a.name=this.name,a.father=this.father,a.startIndex=this.startIndex,a.matrix=this.matrix,a},b}(c);a.ObjectBone=d}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._defaultVec=new Array;for(var b=[.4444730390920146,-.3834955622240026,-.33124467509627725,.09365654209093091,-.05673310882817577,.2120523322966496,.02945768486978205,-.04965996229802928,-.1136529129285836],c=0;9>c;c++)this._defaultVec.push(new a.Vector3D(b[c],b[c],b[c]))}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.setLightProbeData=function(a){this._dataAry=a},b.prototype.clear=function(){this._dataAry=null},b.prototype.getData=function(a){if(!this._dataAry)return this._defaultVec;for(var b=0;b<this._dataAry.length;b++){var c=this._dataAry[b];if(this.testPoint(c,a)){var d=c.postion,e=a.subtract(d);return this.getResultData(c.posItem,float2int(e.x/c.betweenNum),float2int(e.z/c.betweenNum),float2int(e.y/c.betweenNum),c.betweenNum,e)}}return this._defaultVec},b.prototype.testPoint=function(a,b){var c=(a.cubeVec.x-1)*a.betweenNum,d=(a.cubeVec.y-1)*a.betweenNum,e=(a.cubeVec.z-1)*a.betweenNum,f=b.x-a.postion.x,g=b.y-a.postion.y,h=b.z-a.postion.z;return f>=0&&c>f&&g>=0&&d>g&&h>=0&&e>h?!0:!1},b.prototype.getResultData=function(b,d,e,f,g,h){var i=new Array;i.push(new c(b[d][e][f],h)),i.push(new c(b[d+1][e][f],h)),i.push(new c(b[d][e+1][f],h)),i.push(new c(b[d+1][e+1][f],h)),i.push(new c(b[d][e][f+1],h)),i.push(new c(b[d+1][e][f+1],h)),i.push(new c(b[d][e+1][f+1],h)),i.push(new c(b[d+1][e+1][f+1],h));for(var j=0,k=0;k<i.length;k++)j+=i[k].dis;for(k=0;k<i.length;k++)i[k].setBais(j);var l=0;for(k=0;k<i.length;k++)l+=i[k].bais;for(k=0;k<i.length;k++)i[k].bais=i[k].bais/l;var m=new Array;for(k=0;9>k;k++){for(var n=new a.Vector3D,o=0;o<i.length;o++){var p=new a.Vector3D(i[o].vecNum[k].x,i[o].vecNum[k].y,i[o].vecNum[k].z);p.scaleBy(i[o].bais),n=n.add(p)}m.push(n)}return m},b}();a.LightProbeManager=b;var c=function(){function b(b,c){this.pos=new a.Vector3D(b.x,b.y,b.z),this.vecNum=b.resultSHVec,this.dis=a.Vector3D.distance(this.pos,c)}return b.prototype.setBais=function(a){this.bais=this.dis/a*(this.dis/a),this.bais=1/this.bais},b}()}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._loadDic=new Object,a}return __extends(c,b),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.getGroupData=function(b,c){var d=this;if(this._dic[b]){var e=this._dic[b];return e.useNum++,void c(e)}if(this._loadDic[b])return void this._loadDic[b].push(c);this._loadDic[b]=new Array,this._loadDic[b].push(c);var f=new a.GroupRes;f.load(b,function(){for(var a=d._loadDic[b],c=0;c<a.length;c++){var e=a[c];e(f)}d._dic[b]=f,delete d._loadDic[b],f.initReg()})},c}(a.ResGC);a.GroupDataManager=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.setData=function(b){this.navmeshData=b,this.heightItem=this.navmeshData.heightItem,this.jumpItem=this.navmeshData.jumpItem,this.midu=this.navmeshData.midu,this.aPos=new a.Vector3D(this.navmeshData.aPos.x,this.navmeshData.aPos.y,this.navmeshData.aPos.z),this.makeStarGraph(this.navmeshData.astarItem),this.astarWidth=this.heightItem[0].length,this.astarHeight=this.heightItem.length,a.SceneManager.getInstance().fixAstart(new a.Vector2D(this.aPos.x,this.midu*this.astarHeight+this.aPos.z)),this.mathAreaRect(),this.mathMinMapRect()},Object.defineProperty(b,"sceneVectList",{set:function(a){this._sceneVectList=a,this._frist=!0},enumerable:!0,configurable:!0}),b.getJumpDataByV2d=function(a,b){return this.jumpItem&&this.jumpItem.length&&this.jumpItem[b]&&1==this.jumpItem[b][a]?!0:!1},b.mathMinMapRect=function(){var c=(b.navmeshData.midu,b.navmeshData.astarItem[0].length),d=b.navmeshData.astarItem.length,e=b.navmeshData.aPos.x+c*b.navmeshData.midu,f=b.navmeshData.aPos.z+d*b.navmeshData.midu;e=Math.max(Math.abs(b.navmeshData.aPos.x),Math.abs(e)),f=Math.max(Math.abs(b.navmeshData.aPos.z),Math.abs(f));var g=Math.max(e,f);g+=100,g=Math.round(g);var h=new a.Rectangle;h.x=-g,h.y=-g,h.width=2*g,h.height=2*g,h.x-=1,h.y-=1,h.width+=2,h.height+=2,h.width/=2,h.height/=2,this.minMapRect=h},b.mathAreaRect=function(){this.areaRect=new a.Rectangle,this.areaRect.x=this.aPos.x,this.areaRect.y=this.aPos.z,this.areaRect.width=this.astarWidth*this.midu,this.areaRect.height=this.astarHeight*this.midu},b.clear=function(){this.navmeshData&&(this._bakData=this.navmeshData,this.aPos.setTo(0,0,0),this.navmeshData=null)},b.porcessBak=function(a){a&&this.setData(this._bakData)},b.getHeightByPos=function(b){if(this.heightItem){var c=b.subtract(this.aPos).add(new a.Vector3D(this.midu/2,0,this.midu/2)),d=(this.astarWidth-1)*this.midu,e=(this.astarHeight-1)*this.midu;if(c.x>0&&c.x<=d&&c.z>0&&c.z<=e)return this.getBaseHeightByBitmapdata(c.x/this.midu,c.z/this.midu)}return-500},b.getBaseHeightByBitmapdata=function(a,b){var c=a-float2int(a),d=b-float2int(b),e=this.getBitmapDataHight(float2int(a),float2int(b)),f=this.getBitmapDataHight(float2int(a),Math.ceil(b)),g=this.getBitmapDataHight(Math.ceil(a),float2int(b)),h=this.getBitmapDataHight(Math.ceil(a),Math.ceil(b)),i=(1-c)*(1-d),j=(1-c)*d,k=c*(1-d),l=c*d,m=i*e+j*f+k*g+l*h;return m},b.getBitmapDataHight=function(a,b){return this.heightItem[this.heightItem.length-1-b][a]},b.findPath=function(a,b){return null},b.Path2dTo3d=function(a){for(var b=new Array,c=0;c<a.length;c++)b.push(this.getWorldPosByStart2D(a[c]));return b},b.getWorldPosByStart2D=function(b){if(this.navmeshData){var c=new a.Vector3D(b.x*this.midu,3,b.y*this.midu);return c.x=c.x+this.aPos.x+this.midu/2,c.z=this.aPos.z+this.midu*this.astarHeight-c.z-this.midu/2,c}return new a.Vector3D(10*b.x+this.midu/2,0,10*b.y-this.midu/2)},b.findPath3D=function(a,c){if(this.navmeshData){b.getPosIsCanMove(c)||(c=this.findNearLinePoint(a,c));var d=this.getGrapIndexByPos(a),e=this.getGrapIndexByPos(c);return this.getJumpDataByV2d(e.x,e.y)?null:this.isGridCanWalk(e)&&d?this.findStraightLine(d,e)?[d,e]:this.findPath2D(d,e):null}return[this.getGrapIndexByPos(a),this.getGrapIndexByPos(c)]},b.findStraightLine=function(b,c){var d=new a.Vector2D(c.x-b.x,c.y-b.y);d.normalize();for(var e=Math.round(a.Vector2D.distance(b,c)),f=new a.Vector2D,g=0;e>g;g++){if(f.x=Math.floor(b.x+g*d.x),f.y=Math.floor(b.y+g*d.y),!this.isGridCanWalk(f))return!1;if(f.x=Math.ceil(b.x+g*d.x),f.y=Math.ceil(b.y+g*d.y),!this.isGridCanWalk(f))return!1;if(f.x=Math.round(b.x+g*d.x),f.y=Math.round(b.y+g*d.y),!this.isGridCanWalk(f))return!1}return!0},b.isGridCanWalk=function(a){return a&&this.graphData.grid[a.y]&&this.graphData.grid[a.y][a.x]?0==this.graphData.grid[a.y][a.x].weight?!1:!0:!1},b.findPath2D=function(a,b){return null},b.turnLineAstar=function(a){if(a.length<2)return a;for(var b=[a[0]],c=2;c<a.length;c++)this.findStraightLine(b[b.length-1],a[c])||b.push(a[c-1]);return b.push(a[a.length-1]),a.length!=b.length?this.turnLineAstar(b):b},b.simplifyAstar=function(a){var b=0;if(a.length>1,a.length>2){var c=new Array;c.push(a[0]);for(var d=2;d<a.length;d++){var e=c[c.length-1],f=a[d-1],g=a[d];Math.atan2(f.y-e.y,f.x-e.x)!=Math.atan2(g.y-e.y,g.x-e.x)||b>126?c.push(f):b++}return c.push(a[a.length-1]),c}return a},b.findNearLinePoint=function(c,d){for(;a.Vector3D.distance(c,d)>5;)if(d=this.moveA2B(d,c,1),b.getPosIsCanMove(d))return d;return d},b.moveA2B=function(a,b,c){var d=b.subtract(a);return d.normalize(),d.scaleBy(c),d=d.add(a)},b.getPosIsCanMove=function(a){if(!this.graphData||!this.graphData.grid)return!1;var b=this.getGrapIndexByPos(a);return this.isGridCanWalk(b)},b.makeStarGraph=function(a){},b.blockAry=function(b){for(var c=new Array,d=0;d<b.length;d++)c.push([new a.Vector2D(b[d][0],b[d][1]),new a.Vector2D(b[d][2],b[d][3])]);this.blockList(c)},b.blockList=function(a){this.blockBakData&&this.unblock(),this.blockBakData=new Array;for(var b=0;b<a.length;b++)this.blockPoint(a[b][0],a[b][1])},b.blockPoint=function(b,c){var d=new a.Rectangle;d.y=Math.min(b.x,c.x),d.x=Math.min(b.y,c.y),d.height=Math.abs(b.x-c.x),d.width=Math.abs(b.y-c.y),this.blockRec(d)},b.blockRec=function(a){for(var b=0;b<a.width;b++){for(var c=new Array,d=0;d<a.height;d++){var e=b+a.x,f=d+a.y,g=this.graphData.grid[e][f];c.push({i:e,j:f,w:g.weight}),g.weight=0}this.blockBakData.push(c)}},b.unblock=function(){if(this.blockBakData){for(var a=0;a<this.blockBakData.length;a++)for(var b=0;b<this.blockBakData[a].length;b++){var c=this.blockBakData[a][b];this.graphData.grid[c.i][c.j].weight=c.w}this.blockBakData=null}},b.getGrapIndexByPos=function(b){if(!this.navmeshData)return new a.Vector2D(float2int(b.x/this.midu),float2int(b.z/this.midu));var c=b.subtract(this.aPos).add(new a.Vector3D(0,0,this.midu/2)),d=this.astarWidth*this.midu,e=this.astarHeight*this.midu;
return c.x>0&&c.x<d&&c.z>0&&c.z<e?new a.Vector2D(float2int(c.x/this.midu),float2int(this.astarHeight-c.z/this.midu)):null},b.getScenePos=function(b,c){var d=a.Groundposition.getGroundPos(b,c);return this.getLookAtPos(d)},b.getLookAtPos=function(c){var d=new a.Vector3D(a.Scene_data.cam3D.x,a.Scene_data.cam3D.y,a.Scene_data.cam3D.z),e=c.subtract(d);e.normalize();for(var f,g=0;;){g+=2;var h=e.clone();h.scaleBy(g);var i=d.add(h),j=b.getHeightByPos(i);if(j>i.y){f=i;break}if(g>1e3){f=null;break}}return f},b.aPos=new a.Vector3D,b.midu=10,b.astarWidth=0,b.astarHeight=0,b._frist=!1,b.canwalkItem=[],b}();a.AstarUtil=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.A=65,a.B=66,a.C=67,a.D=68,a.E=69,a.F=70,a.G=71,a.H=72,a.I=73,a.J=74,a.K=75,a.L=76,a.M=77,a.N=78,a.O=79,a.P=80,a.Q=81,a.R=82,a.S=83,a.T=84,a.U=85,a.V=86,a.W=87,a.X=88,a.Y=89,a.Z=90,a.Left=37,a.Up=38,a.Right=39,a.Down=40,a.Delete=46,a.F1=112,a.F2=113,a}();a.KeyboardType=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.MouseDown="mousedown",a.MouseUp="mouseup",a.MouseMove="mousemove",a.MouseClick="mouseclick",a.KeyDown="keydown",a.KeyUp="keyup",a.MouseWheel="mousewheel",a.TouchStart="touchstart",a.TouchMove="touchmove",a.TouchEnd="touchend",a.TouchClick="touchstart",a}();a.MouseType=b;var c=function(){function c(){var b=this;this._isUpData=!0,this.speedNum=10,this._keyDic=new Object,this._lostMousePos=new a.Object3D,this._lastFousce=new a.Object3D,this._isMouseDown=!1,setInterval(function(){b.upData()},1e3/60)}return Object.defineProperty(c,"instance",{get:function(){return this._instance||(this._instance=new c),this._instance},enumerable:!0,configurable:!0}),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.init=function(){document.addEventListener(b.MouseDown,this.onMouseDown),document.addEventListener(b.MouseUp,this.onMouseUp),document.addEventListener(b.MouseMove,this.onMouseMove),document.addEventListener(b.KeyDown,this.onKeyDown),document.addEventListener(b.KeyUp,this.onKeyUp)},c.prototype.clearAllEvet=function(){document.removeEventListener(b.MouseDown,this.onMouseDown),document.removeEventListener(b.MouseUp,this.onMouseUp),document.removeEventListener(b.MouseMove,this.onMouseMove),document.removeEventListener(b.KeyDown,this.onKeyDown),document.removeEventListener(b.KeyUp,this.onKeyUp)},c.prototype.clearMouseEvent=function(){document.removeEventListener(b.MouseDown,this.onMouseDown),document.removeEventListener(b.MouseUp,this.onMouseUp),document.removeEventListener(b.MouseMove,this.onMouseMove),this._isUpData=!1},c.prototype.onMouseMove=function(b){var d=c.instance,e=new a.Object3D;e.x=b.pageX,e.y=b.pageY,d._isMouseDown&&(a.Scene_data.cam3D.rotationY=d._lastFousce.rotationY-(e.x-d._lostMousePos.x)/10,a.Scene_data.cam3D.rotationX=d._lastFousce.rotationX-(e.y-d._lostMousePos.y)/10)},c.prototype.onMouseDown=function(b){var d=c.instance;d._isMouseDown=!0,d._lostMousePos.x=b.pageX,d._lostMousePos.y=b.pageY,d._lastFousce.rotationX=a.Scene_data.cam3D.rotationX,d._lastFousce.rotationY=a.Scene_data.cam3D.rotationY},c.prototype.onMouseUp=function(a){var b=c.instance;b._isMouseDown=!1},c.prototype.upData=function(){if(this._isUpData){var b=this._keyDic;b[65]&&this.tureLeft(),b[83]&&this.tureDown(),b[68]&&this.tureRight(),b[87]&&this.tureUp(),b[81]&&(a.Scene_data.cam3D.y-=this.speedNum),b[69]&&(a.Scene_data.cam3D.y+=this.speedNum),a.MathClass.MathCam(a.Scene_data.cam3D)}},c.prototype.tureLeft=function(){var b=new a.Vector3D(-this.speedNum,0,0,1);new a.Matrix3D;this.mathFocus3D(b)},c.prototype.tureRight=function(){var b=new a.Vector3D(this.speedNum,0,0,1);this.mathFocus3D(b)},c.prototype.tureUp=function(){var b=new a.Vector3D(0,0,this.speedNum,1);this.mathFocus3D(b)},c.prototype.tureDown=function(){var b=new a.Vector3D(0,0,-this.speedNum,1);this.mathFocus3D(b)},c.prototype.mathFocus3D=function(b){var c=new a.Matrix3D;c.prependRotation(-a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),c.prependRotation(-a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS),b=c.transformVector(b),a.Scene_data.cam3D.x+=b.x,a.Scene_data.cam3D.y+=b.y,a.Scene_data.cam3D.z+=b.z},c.prototype.onKeyDown=function(a){var b=c.instance._keyDic;b[a.keyCode]=!0,0==a.keyCode},c.prototype.onKeyUp=function(a){var b=c.instance._keyDic;b[a.keyCode]=!1},c}();a.KeyControl=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.getTimer=function(){return Date.now()-a.START_TIME},a.getTimerSecond=function(){return a.getTimer()/1e3},a.saveNowTime=function(){this.lastTime=this.getTimer()},a.getUseTime=function(){return this.getTimer()-this.lastTime},a.getZeroTime=function(a){var b=new Date(1e3*a);return b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.getTime()/1e3},a.getLocalTime=function(a){var b=new Date(1e3*a);return b.toLocaleDateString().replace(/\//g,"-")+" "+b.toTimeString().substr(0,5)},a.getLocalTime0=function(a){var b=new Date(1e3*a);return b.toLocaleDateString().replace(/\//g,"-")},a.getLocalTime1=function(a){var b=new Date(1e3*a);return b.toLocaleDateString().replace(/\//g,"-")+" "+b.toTimeString().substr(0,8)},a.getLocalTime2=function(a){var b=new Date(1e3*a);return b.toTimeString().substr(0,8)},a.getLocalTime6=function(a){var b=new Date(1e3*a);return b.toTimeString().substr(0,5)},a.getLocalTime3=function(a){var b=new Date(1e3*a);return b.toTimeString().substr(3,5)},a.getLocalTime4=function(a){return float2int(a/60)+"分"+a%60+"秒"},a.getLocalTime5=function(a){var b=new Date(1e3*a),c=b.toTimeString().substr(0,8),d=c.split(":");return d[0]+"时"+d[1]+"分"+d[2]+"秒"},a.getDiffTime1=function(a){var b=float2int(a/this.dayTime);a-=b*this.dayTime;var c=float2int(a/this.HourTime);a-=c*this.HourTime;var d=float2int(a/this.MinuteTime);return a-=d*this.MinuteTime,b+"天"+c+"时"+d+"分"+a+"秒"},a.getDiffTime2=function(a){var b=float2int(a/this.HourTime);a-=b*this.HourTime;var c=float2int(a/this.MinuteTime);return a-=c*this.MinuteTime,this.zeroStr(b)+":"+this.zeroStr(c)+":"+this.zeroStr(a)},a.zeroStr=function(a){return a>9?String(a):"0"+a},a.getDelayTimeStr=function(a){var b=Math.floor(a/3600),c="";return c=b>24?Math.floor(b/24)+"天前":b>=1?b+"小时前":"刚刚"},a.compareTime=function(a,b){return!1},a.init=function(){a.START_TIME=Date.now()},a.addTimeTick=function(b,d,e){void 0===e&&(e=0);var f=new c;f.alltime=b,f.fun=d,f.time=b-e,a.timefunAry.push(f)},a.removeTimeTick=function(b){for(var c=0;c<a.timefunAry.length;c++)if(a.timefunAry[c]&&a.timefunAry[c].fun==b){a.timefunAry[c]=null;break}},a.addTimeOut=function(b,c){if(!this.hasTimeOut(c)){var e=new d;e.alltime=b,e.fun=c,e.time=0,a.outTimeFunAry.push(e)}},a.removeTimeOut=function(b){for(var c=0;c<a.outTimeFunAry.length;c++)if(a.outTimeFunAry[c]&&a.outTimeFunAry[c].fun==b){a.outTimeFunAry[c]=null;break}},a.hasTimeOut=function(b){for(var c=0;c<a.outTimeFunAry.length;c++)if(a.outTimeFunAry[c]&&a.outTimeFunAry[c].fun==b)return!0;return!1},a.addFrameTick=function(b){-1==a.funAry.indexOf(b)&&a.funAry.push(b)},a.hasFrameTick=function(b){var c=a.funAry.indexOf(b);return-1!=c?!0:!1},a.removeFrameTick=function(b){var c=a.funAry.indexOf(b);-1!=c&&(a.funAry[c]=null)},a.update=function(){for(var b=a.getTimer()-a.time,c=0;c<a.funAry.length;c++)a.funAry[c]&&a.funAry[c](b);for(var c=0;c<a.timefunAry.length;c++)a.timefunAry[c]&&a.timefunAry[c].update(b);for(var c=a.outTimeFunAry.length-1;c>=0;c--)a.outTimeFunAry[c]&&a.outTimeFunAry[c].update(b)&&(a.outTimeFunAry[c]=null);for(var c=a.funAry.length-1;c>=0;c--)a.funAry[c]||a.funAry.splice(c,1);for(var c=a.timefunAry.length-1;c>=0;c--)a.timefunAry[c]||a.timefunAry.splice(c,1);for(var c=a.outTimeFunAry.length-1;c>=0;c--)a.outTimeFunAry[c]||a.outTimeFunAry.splice(c,1);a.time=a.getTimer()},a.funAry=new Array,a.timefunAry=new Array,a.outTimeFunAry=new Array,a.time=0,a.lastTime=0,a.dayTime=86400,a.HourTime=3600,a.MinuteTime=60,a}();a.TimeUtil=b;var c=function(){function a(){this.alltime=0,this.time=0}return a.prototype.update=function(a){this.time+=a,this.time>=this.alltime&&(this.fun(),this.time=0)},a}(),d=function(){function a(){this.alltime=0,this.time=0}return a.prototype.update=function(a){return this.time+=a,this.time>=this.alltime?(this.fun(),!0):!1},a}()}(Pan3d||(Pan3d={}));var keyChi=["零","一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五"],Pan3d;!function(a){var b=function(){function b(){this._canvas=document.createElement("canvas"),this._cxt=this._canvas.getContext("2d"),this._gnt=this._cxt.createLinearGradient(0,0,128,0),this._canvas.style.zIndex="1"}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.getImageData=function(b){for(var c=b.pos.length,d=new a.Vector3D,e=0;c>e;e++)hexToArgb(b.color[e],!1,d),this._gnt.addColorStop(b.pos[e]/255,"rgba("+d.x+","+d.y+","+d.z+","+b.alpha[e]+")");return this._cxt.fillStyle=this._gnt,this._cxt.fillRect(0,0,128,2),this._cxt.getImageData(0,0,128,2)},b.prototype.getImageDataByVec=function(a,b){for(var c,d,e=this._cxt.createImageData(64,1),f=0;64>f;f++)c=4*f,d=4*float2int(f/64*b),e.data[c]=a[d],e.data[c+1]=a[d+1],e.data[c+2]=a[d+2],e.data[c+3]=a[d+3];return e},b.prototype.setData=function(){},b}();a.ColorTransition=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.fontData=new a.Dictionary([]),this.fontData_Unit=new a.Dictionary([]),this.makeFontRect()}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.makeFontRect=function(){this.fontData.Red=this.makeBase12pxNum(new a.Vector2D(0,0)),this.fontData.Green=this.makeBase12pxNum(new a.Vector2D(0,15)),this.fontData.Blue=this.makeBase12pxNum(new a.Vector2D(0,30)),this.fontData.White=this.makeBase12pxNum(new a.Vector2D(0,45)),this.fontData.Yellow=this.makeBase12pxNum(new a.Vector2D(0,75)),this.getXmlData()},b.prototype.getXmlData=function(){for(var b=a.UIData.getUiArrByKey(a.UIData.textlist),c=0;c<b.length;c++){var d=String(b[c].name);if(-1!=d.search("A_")){var e=Number(d.substring(5,d.length)),f=new a.UIRectangle;f.pixelX=Number(b[c].ox),f.pixelY=Number(b[c].oy),f.pixelWitdh=Number(b[c].ow),f.pixelHeight=Number(b[c].oh),f.cellX=Number(b[c].cellX),f.cellY=Number(b[c].cellY);for(var g=new a.Rectangle(0,0,f.pixelWitdh/f.cellX,f.pixelHeight),h=new Array,i=0;i<f.cellX;i++)h.push(new a.Rectangle(f.pixelX+i*g.width,f.pixelY,g.width,g.height));this.fontData["NUM"+e]=h}if(-1!=d.search("B_")){var e=Number(d.substring(5,d.length)),f=new a.UIRectangle;f.pixelX=Number(b[c].ox),f.pixelY=Number(b[c].oy),f.pixelWitdh=Number(b[c].ow),f.pixelHeight=Number(b[c].oh),f.cellX=Number(b[c].cellX),f.cellY=Number(b[c].cellY);for(var g=new a.Rectangle(0,0,f.pixelWitdh/f.cellX,f.pixelHeight),h=new Array,i=0;i<f.cellX;i++)h.push(new a.Rectangle(f.pixelX+i*g.width,f.pixelY,g.width,g.height));this.fontData_Unit["BNUM"+e]=h}}},b.prototype.makeBase12pxNum=function(b){var c=new Array;c.push(new a.Rectangle(3,0,9,14)),c.push(new a.Rectangle(14,0,9,14)),c.push(new a.Rectangle(25,0,9,14)),c.push(new a.Rectangle(36,0,9,14)),c.push(new a.Rectangle(47,0,9,14)),c.push(new a.Rectangle(59,0,9,14)),c.push(new a.Rectangle(70,0,9,14)),c.push(new a.Rectangle(81,0,9,14)),c.push(new a.Rectangle(92.5,0,9,14)),c.push(new a.Rectangle(104,0,9,14)),c.push(new a.Rectangle(116,0,9,14)),c.push(new a.Rectangle(126,0,9,14)),c.push(new a.Rectangle(136,0,9,14)),c.push(new a.Rectangle(144,0,9,13)),c.push(new a.Rectangle(154,0,9,13));for(var d=0;d<c.length;d++)c[d].x=c[d].x+b.x,c[d].y=c[d].y+b.y;return c},b.prototype.writeFontToCtxLeft=function(c,d,e,f,g,h){void 0===e&&(e=b.num1),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=0);for(var i,j=this.fontData[e],k=0,l=0;l<d.length;l++){i=this.getCharId(d[l]);var m=this.getRect(i,e,j);if(!m)return;c.drawImage(a.UIData.textImg,m.x,m.y,m.width,m.height,k+f,g,m.width,m.height),k+=m.width-h}return k},b.prototype.writeFontToCtxRight=function(c,d,e,f,g,h){void 0===e&&(e=b.White),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=0);for(var i,j=this.fontData[e],k=0,l=this.getAirFontWidth(c,d,e,h),m=0;m<d.length;m++){i=this.getCharId(d[m]);var n=this.getRect(i,e,j);c.drawImage(a.UIData.textImg,n.x,n.y,n.width,n.height,k+f-l,g,n.width,n.height),k+=n.width-h}return l},b.prototype.writeFontToCtxCenten=function(c,d,e,f,g,h){void 0===e&&(e=b.White),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=0);for(var i,j=this.fontData[e],k=0,l=this.getAirFontWidth(c,d,e,h)/2,m=0;m<d.length;m++){i=this.getCharId(d[m]);var n=this.getRect(i,e,j);c.drawImage(a.UIData.textImg,n.x,n.y,n.width,n.height,k+f-l,g,n.width,n.height),k+=n.width-h}return l},b.prototype.writeFontToSkinName=function(c,d,e,f,g,h){void 0===f&&(f=b.ORANGE_TXT),void 0===g&&(g=a.TextAlign.LEFT),void 0===h&&(h=0);var i=c.getRec(d);c.ctx=a.UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1);var j;return g==a.TextAlign.LEFT?j=this.writeFontToCtxLeft(c.ctx,e,f,0,0,h):g==a.TextAlign.RIGHT?j=this.writeFontToCtxRight(c.ctx,e,f,i.pixelWitdh,0,h):g==a.TextAlign.CENTER&&(j=this.writeFontToCtxCenten(c.ctx,e,f,i.pixelWitdh/2,0,h)),a.TextureManager.getInstance().updateTexture(c.texture,i.pixelX,i.pixelY,c.ctx),j},b.prototype.writeFontToSkinNameCenter=function(c,d,e,f,g){void 0===f&&(f=b.ORANGE_TXT),void 0===g&&(g=0);var h=c.getRec(d);c.ctx=a.UIManager.getInstance().getContext2D(h.pixelWitdh,h.pixelHeight,!1);for(var i,j=h.pixelWitdh/2,k=h.pixelHeight/2,l=this.fontData[f],m=0,n=this.getAirFontWidth(c.ctx,e,f,g)/2,o=0;o<e.length;o++){i=this.getCharId(e[o]);var p=this.getRect(i,f,l);c.ctx.drawImage(a.UIData.textImg,p.x,p.y,p.width,p.height,m+j-n,k-p.height/2,p.width,p.height),m+=p.width-g}a.TextureManager.getInstance().updateTexture(c.texture,h.pixelX,h.pixelY,c.ctx)},b.prototype.getAirFontWidth=function(a,c,d,e){if(void 0===d&&(d=b.White),void 0===e&&(e=0),void 0==c)return 0;for(var f,g=this.fontData[d],h=0,i=0;i<c.length;i++){f=this.getCharId(c[i]);var j=this.getRect(f,d,g);h+=j.width-e}return h},b.prototype.getRect=function(a,b,c){var d;return d=a>15?this.fontData_Unit["B"+b][a-16]:c[a]},b.prototype.upArtFont=function(c,d,e,f,g,h){void 0===f&&(f=12),void 0===g&&(g=b.White),void 0===h&&(h=a.TextAlign.LEFT);var i=f/12,j=this.fontData[g],k=c.getRec(d);c.ctx=a.UIManager.getInstance().getContext2D(k.pixelWitdh,k.pixelHeight,!1);var l=this.getTotalWandDraw(k,e,j,i,c.ctx,!1),m=this.getXpos(h,l,new a.Rectangle(0,0,k.pixelWitdh,k.pixelHeight));this.getTotalWandDraw(k,e,j,i,c.ctx,!0,m),a.TextureManager.getInstance().updateTexture(c.texture,k.pixelX,k.pixelY,c.ctx)},b.prototype.upArtBase=function(c,d,e,f,g){void 0===f&&(f=b.White),void 0===g&&(g=a.TextAlign.LEFT);var h=1,i=this.fontData[f],j=c.getRec(d);c.ctx=a.UIManager.getInstance().getContext2D(j.pixelWitdh,j.pixelHeight,!1);var k=this.getTotalWandDraw(j,e,i,h,c.ctx,!1),l=this.getXpos(g,k,new a.Rectangle(0,0,j.pixelWitdh,j.pixelHeight));this.getTotalWandDraw(j,e,i,h,c.ctx,!0,l),a.TextureManager.getInstance().updateTexture(c.texture,j.pixelX,j.pixelY,c.ctx)},b.prototype.getXpos=function(b,c,d){var e=0;return b==a.TextAlign.LEFT?e=0:b==a.TextAlign.RIGHT?e=c-d.width:b==a.TextAlign.CENTER&&(e=(d.width-c)/2),e},b.prototype.getTotalWandDraw=function(b,c,d,e,f,g,h,i){void 0===h&&(h=0),void 0===i&&(i=0);for(var j,k=0,l=0;l<c.length;l++){j=this.getCharId(c[l]);var m=d[j];g&&f.drawImage(a.UIData.textImg,m.x,m.y,m.width,m.height,b.x+k+h,b.y,m.width*e,m.height*e),k+=(m.width-i)*e}return k},b.prototype.getCharId=function(a){return"+"==a||"x"==a||"X"==a?10:"-"==a?11:"/"==a?12:":"==a?13:"."==a?14:"%"==a?15:"万"==a?16:"亿"==a?17:"["==a?18:"]"==a?19:(NaN==Number(a)&&alert("MeshVo,GetCharId error:"+a),Number(a))},b.Red="Red",b.Green="Green",b.Blue="Blue",b.White="White",b.Yellow="Yellow",b.BOSSBIGTXT="NUM99",b.CN1="NUM100",b.num101="NUM101",b.num102="NUM102",b.BigYellow="NUM12",b.num99="NUM99",b.GARY_TXT="NUM1",b.ORANGE_TXT="NUM19",b.num1="NUM1",b.num2="NUM2",b.num3="NUM3",b.num4="NUM4",b.num5="NUM5",b.num6="NUM6",b.num7="NUM7",b.num10="NUM10",b.num8="NUM8",b.num9="NUM9",b.num11="NUM11",b.num12="NUM12",b.num13="NUM13",b.num14="NUM14",b.num15="NUM15",b.num16="NUM16",b.num17="NUM17",b.num18="NUM18",b.num19="NUM19",b.num20="NUM20",b.num21="NUM21",b.num22="NUM22",b.num23="NUM23",b.num24="NUM24",b.num25="NUM24",b.num26="NUM26",b.num27="NUM27",b.num28="NUM28",b.num30="NUM30",b.num51="NUM51",b.num52="NUM52",b.num53="NUM53",b.num54="NUM54",b.num55="NUM55",b.num56="NUM56",b.num57="NUM57",b.num58="NUM58",b.num59="NUM59",b.num60="NUM60",b.num61="NUM61",b.numVip="NUM62",b.num63="NUM63",b.num64="NUM64",b.num65="NUM65",b.num66="NUM66",b}();a.ArtFont=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a}();a.TextRegVo=b;var c=function(){function c(){}return c.pushStr=function(a){this.item=new Array;for(var d,e=/\[\]|\[[A-Za-z0-9]{6}\]/g;null!=(d=e.exec(a));){var f=new b;f.begin=d.index,f.end=e.lastIndex,f.color=d.toString(),f.color=f.color.replace("[",""),f.color=f.color.replace("]",""),f.color.length<5?f.color=c.defaultColor:f.color="#"+f.color,this.item.push(f)}},c.pushStrCopy=function(a){this.item=new Array;for(var d,e=/\[\]|\[[A-Za-z0-9]{6}\]/g,f=a;null!=(d=e.exec(a));){var g=new b;g.begin=d.index,g.end=e.lastIndex,g.color=d.toString(),f=f.replace(g.color,"#"),g.color=g.color.replace("[",""),g.color=g.color.replace("]",""),g.color.length<5?g.color=c.defaultColor:(a.replace("["+g.color+"]","#"),g.color="#"+g.color),this.item.push(g)}return f},c.isColor=function(a,b){for(var c=0;c<this.item.length;c++)if(a>=this.item[c].begin&&a<this.item[c].end)return b&&(b.fillStyle=this.item[c].color),!0;return!1},c.getTextMetrics=function(a,b){b||(b=""),this.pushStr(b);for(var c=b,d="",e=0;e<c.length;e++)this.isColor(e,a)||(d+=c[e]);var f=a.measureText(d);return f},c.getTextOnlyTxt=function(a,b){b||(b=""),this.pushStr(b);for(var c=b,d="",e=0;e<c.length;e++)this.isColor(e,a)||(d+=c[e]);return d},c.getNextWords=function(b,c){var d=-1;if("/"==b[c]&&b.length>c+2)for(var e=b[c+0]+b[c+1]+b[c+2],f=0;f<a.UIData.faceItem.length;f++)if(a.UIData.faceItem[f]==e)return f+1;return d},c.wrapText=function(b,d,e,f,g,h,i,j,k,l,m){void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=500),void 0===i&&(i=10),void 0===j&&(j=12),void 0===k&&(k=""),void 0===l&&(l=4),void 0===m&&(m=1),c.defaultColor=e,h=.98*h,""!=k&&(-1!=k.indexOf("[")&&(k="#"+k.substr(1,6)),b.strokeStyle=k,b.lineWidth=l),this.pushStr(d);for(var n=d,o="",p=0,q=1,r=0;n&&r<n.length;r++)if(!this.isColor(r,b)){var s=b.measureText(o.replace("\n","")),t=this.getNextWords(n,r);if(-1==t)s.width>h||"\n"==n[r]?(p+=i,o="",q++,"\n"!=n[r]&&(""!=k&&b.strokeText(n[r],f,g+p),b.fillText(n[r],f,g+p))):(""!=k&&b.strokeText(n[r],f+s.width*m,g+p),b.fillText(n[r],f+s.width*m,g+p)),"\n"!=n[r]&&(o+=n[r]);else{var u=1.4*j,v=new a.Rectangle(f+1*s.width+0,g+p-u/10,u,u);s.width>h&&(p+=i,o="",q++,v=new a.Rectangle(f+0,g+p-u/10,u,u)),this.drawFaceIcon(b,v,t),r+=2,o+="脸1"}}return q},c.wrapTextVertical=function(a,b,d,e,f,g,h,i,j,k,l){void 0===e&&(e=0),void 0===f&&(f=0),void 0===g&&(g=500),void 0===h&&(h=10),void 0===i&&(i=12),void 0===j&&(j=""),void 0===k&&(k=4),void 0===l&&(l=1),c.defaultColor=d,""!=j&&(-1!=j.indexOf("[")&&(j="#"+j.substr(1,6)),a.strokeStyle=j,a.lineWidth=k),this.pushStr(b);for(var m=b,n="",o=2,p=1,q=0,r=0;m&&r<m.length;r++)if(!this.isColor(r,a)){var s=this.getNextWords(m,r);-1==s&&(q>g||"\n"==m[r]?(o+=h,n="",q=0,"\n"!=m[r]&&(""!=j&&a.strokeText(m[r],e+o,q),a.fillText(m[r],e+o,q)),p++):(q+=i+5,""!=j&&a.strokeText(m[r],e+o,q),a.fillText(m[r],e+o,q)),n+=m[r])}return p},c.drawText=function(a,b,e,f,g,h){void 0===f&&(f=500),void 0===g&&(g=10),void 0===h&&(h=12),c.defaultColor=e;for(var i=this.pushStrCopy(b),j=0,k=0,l="",m=0,n=new Array,o=i.split("#"),p=0;p<o.length;p++){var q=o[p];if(""!=q){a.fillStyle=p>0?this.item[p-1].color:e;for(var r=0;r<q.length;r++)if("\n"==q[r]){var s=new d(l,k,a.measureText(l).width,a.fillStyle,f);n.push(s),m=0,l="",k+=g}else{var t=l+q[r],u=a.measureText(t),v=u.width+m;if(j=Math.min(f,v),v>f){var s=new d(l,k,a.measureText(l).width,a.fillStyle,f);n.push(s),l=q[r]+"",k+=g,m=0}else l=t}var w=a.measureText(l).width;m+=w;var s=new d(l,k,a.measureText(l).width,a.fillStyle,f);n.push(s),l=""}}for(var x,y=-1e4,z=0;z<n.length;z++)y!=n[z].posy&&(y=n[z].posy,x=this.getStartPoint(n[z],n),x=Math.max(x,0)),a.fillStyle=n[z].color,a.fillText(n[z].str,x,y),x+=n[z].width;return k+=g,[j,k]},c.getStartPoint=function(a,b){for(var c=new Array,d=0;d<b.length;d++){var e=b[d];a.posy==e.posy&&c.push(e)}for(var f=0,g=0;g<c.length;g++)f+=c[g].width;return(a.maxwidth-f)/2},c.drawFaceIcon=function(b,c,d){a.UiDraw.cxtDrawImg(b,"F_FACE_"+d,c,a.UIData.publicUi)},c.defaultColor="#000000",c}();a.TextRegExp=c;var d=function(){function a(a,b,c,d,e){this.str=a,this.posy=b,this.width=c,this.color=d,this.maxwidth=e}return a}();a.TextCell=d;var e=function(){function b(){}return b.writeSingleLabel=function(b,d,e,f,g,h,i,j,k,l){void 0===f&&(f=12),void 0===g&&(g=a.TextAlign.CENTER),void 0===h&&(h="#ffffff"),void 0===i&&(i=""),void 0===j&&(j=0),void 0===k&&(k=4),void 0===l&&(l=!0),-1!=h.indexOf("[")&&(h="#"+h.substr(1,6));var m=b.getRec(d),n=a.UIManager.getInstance().getContext2D(m.pixelWitdh,m.pixelHeight,!1);n.fillStyle=h,n.font=(l?"bolder ":"")+" "+f+"px "+a.UIData.font;var o=c.getTextMetrics(n,e),p=0;return g==a.TextAlign.CENTER?p=(m.pixelWitdh-o.width)/2:g==a.TextAlign.RIGHT&&(p=m.pixelWitdh-o.width),c.wrapText(n,e,h,p,j,m.pixelWitdh-f/2,20,f,i,k),b.updateCtx(n,m.pixelX,m.pixelY),o.width},b.writeTextLabel=function(b,d,e,f,g,h,i,j,k,l,m){void 0===f&&(f=12),void 0===g&&(g=a.TextAlign.CENTER),void 0===h&&(h=500),void 0===i&&(i="#ffffff"),void 0===j&&(j=""),void 0===k&&(k=0),void 0===l&&(l=4),void 0===m&&(m=!0),-1!=i.indexOf("[")&&(i="#"+i.substr(1,6));var n=f+4,o=b.getRec(d),p=a.UIManager.getInstance().getContext2D(o.pixelWitdh,o.pixelHeight,!1);p.fillStyle=i,p.textAlign=g,p.font=(m?"bolder ":"")+" "+f+"px "+a.UIData.font;var q=c.getTextMetrics(p,e),r=c.wrapText(p,e,i,0,k,h,n,f,j,l);return b.updateCtx(p,o.pixelX,o.pixelY),[q.width,r*n]},b.writeSingleLabelToCtx=function(b,d,e,f,g,h,i,j,k){void 0===e&&(e=12),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=a.TextAlign.CENTER),void 0===i&&(i="#ffffff"),void 0===j&&(j=""),void 0===k&&(k=!0),-1!=i.indexOf("[")&&(i="#"+i.substr(1,6)),b.fillStyle=i,b.font=(k?"bolder ":"")+" "+e+"px "+a.UIData.font;var l=c.getTextMetrics(b,d);return h==a.TextAlign.CENTER?f+=(b.canvas.width-l.width)/2:h==a.TextAlign.RIGHT&&(f+=b.canvas.width-l.width),c.wrapText(b,d,i,f,g,9999,20,e,j),l.width},b.writeSingleLabelToCtxByVertical=function(b,d,e,f,g,h,i,j){void 0===e&&(e=12),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h="#ffffff"),void 0===i&&(i=""),void 0===j&&(j=!0),-1!=h.indexOf("[")&&(h="#"+h.substr(1,6)),b.fillStyle=h,b.font=(j?"bolder ":"")+" "+e+"px "+a.UIData.font,c.wrapTextVertical(b,d,h,f,g,9999,20,e,i)},b.writeSingleLabelToCtxSetAnchor=function(b,d,e,f,g,h,i,j,k){void 0===e&&(e=12),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=a.TextAlign.CENTER),void 0===i&&(i="#ffffff"),void 0===j&&(j=""),void 0===k&&(k=!0),-1!=i.indexOf("[")&&(i="#"+i.substr(1,6)),b.fillStyle=i,b.font=(k?"bolder ":"")+" "+e+"px "+a.UIData.font;var l=c.getTextMetrics(b,d);return h==a.TextAlign.CENTER?f-=l.width/2:h==a.TextAlign.RIGHT&&(f-=l.width),c.wrapText(b,d,i,f,g,9999,20,e,j),l.width},b.writeText=function(b,c,d,e,f,g,h,i,j,k){void 0===i&&(i=0),void 0===j&&(j=!1),void 0===k&&(k=a.TextAlign.LEFT),-1!=h.indexOf("[")&&(h="#"+h.substr(1,6));var l=[10,10],m=b.getRec(c),n=a.UIManager.getInstance().getContext2D(m.pixelWitdh,m.pixelHeight,!1);n.fillStyle=h,n.font=(j?"bolder ":"")+g+"px "+a.UIData.font,n.textAlign=k;this.getTextxpos(k,n);return l=this.wrapText(n,f,d,e,i,g+5),b.updateCtx(n,m.pixelX,m.pixelY),l},b.writeTextAutoCenterByAnchor=function(b,d,e,f,g,h,i,j){void 0===i&&(i=!0),void 0===j&&(j=""),-1!=g.indexOf("[")&&(g="#"+g.substr(1,6));var k=b.getRec(d),l=a.UIManager.getInstance().getContext2D(k.pixelWitdh,k.pixelHeight,!1);l.fillStyle=g,l.font=(i?"bolder ":"")+f+"px "+a.UIData.font,l.textAlign=a.TextAlign.LEFT;var m=c.drawText(l,e,g,h,f+5,f);return b.updateCtx(l,k.pixelX,k.pixelY),m},b.writeTextAutoVerticalCenter=function(b,d,e,f,g,h,i,j){void 0===i&&(i=""),void 0===j&&(j=!1),-1!=g.indexOf("[")&&(g="#"+g.substr(1,6));var k=b.getRec(d),l=a.UIManager.getInstance().getContext2D(k.pixelWitdh,k.pixelHeight,!1);l.fillStyle=g,l.font=(j?"bolder ":"")+f+"px "+a.UIData.font;var m=0,n=0;this.getTextxpos(a.TextAlign.LEFT,l);h>0&&(this.isNewline(l,e,h)||(n=k.pixelHeight/2-f/2),c.wrapText(l,e,g,m,n,h,f+3,f,i)),b.updateCtx(l,k.pixelX,k.pixelY)},b.writeTextAutoCenter=function(b,d,e,f,g,h,i){void 0===i&&(i=!1),-1!=g.indexOf("[")&&(g="#"+g.substr(1,6));var j=b.getRec(d),k=a.UIManager.getInstance().getContext2D(j.pixelWitdh,j.pixelHeight,!1);k.fillStyle=g,k.font=(i?"bolder ":"")+f+"px "+a.UIData.font;var l=0,m=0;this.getTextxpos(a.TextAlign.LEFT,k);if(h>0){if(!this.isNewline(k,e,h)){var n=k.measureText(e);m=j.pixelHeight/2-f/2,l=j.pixelWitdh/2-n.width/2}c.wrapText(k,e,g,l,m,h,f+3)}b.updateCtx(k,j.pixelX,j.pixelY)},b.isNewline=function(a,b,c){var d=b,e=a.measureText(d),f=e.width;return f>c?!0:!1},b.getTextxpos=function(b,c){var d=0;return b==a.TextAlign.LEFT?d=0:b==a.TextAlign.RIGHT?d=c.canvas.width:b==a.TextAlign.CENTER&&(d=c.canvas.width/2),d},b.wrapText=function(a,b,c,d,e,f){for(var g=0,h=d,i=b,j="",k=0;k<i.length;k++)if("\n"==i[k])a.fillText(j,c,h),j="",h+=f;else{var l=j+i[k],m=a.measureText(l),n=m.width;g=Math.max(g,n),n>e?(a.fillText(j,c,h),j=i[k]+"",h+=f):j=l}return a.fillText(j,c,h),h=h-d+f,[g,h]},b.clearLabel=function(b,c){var d=b.getRec(c),e=a.UIManager.getInstance().getContext2D(d.pixelWitdh,d.pixelHeight,!1);b.updateCtx(e,d.pixelX,d.pixelY)},b}();a.LabelTextFont=e}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.init=!1,this._volume=1,this._skillSoundDic=new Object,this._skillVolume=1}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.playSound=function(){this.initSound(),this.audio.play()},b.prototype.initSound=function(){this.init||(this.audio=new Audio(a.Scene_data.fileRoot+"sound/sound_3521.mp3"),this.audio.loop=!0,this.audio.volume=this._volume,this.audio.play(),this.init=!0)},b.prototype.stopSound=function(){this.audio&&this.audio.pause()},b.prototype.setVolume=function(a){this._volume=a,this._volume>0?this.playSound():this.stopSound(),this.audio&&(this.audio.volume=this._volume)},b.prototype.setSkillVolume=function(a){this._skillVolume=a;for(var b in this._skillSoundDic)this._skillSoundDic[b].volume=this._skillVolume},b.prototype.playSkillSound=function(b){if(!(this._skillVolume<=0))if(this._skillSoundDic[b])this._skillSoundDic[b].play();else{var c=new Audio(a.Scene_data.fileRoot+"skill/sound/"+b);c.loop=!1,c.volume=this._skillVolume,c.play(),this._skillSoundDic[b]=c}},b}();a.SoundManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(){function a(){}return a.NORMALDAMAGE=1,a.CRIT=2,a.DODGE=3,a.TREATMENT=4,a.VERTIGO=5,a.FREEZE=6,a.ATTACKADD=7,a.ATTACKREDUCE=8,a.EXPERIENCE=9,a.NORMALDAMAGEUP=11,a.CRITUP=12,a.MYNORMALDAMAGE=13,a.MYNORMALDAMAGEUP=14,a.MISS=15,a}();a.TextJumpType=b;var c=function(){function a(){}return a}();a.TextJumpUiVo=c;var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.makeData=function(){if(this._data){var a=this._data;switch(this.dtime=a.endtime,this.pos=a.pos,a.type){case b.EXPERIENCE:this._width=this.drawTxtBydigitalAndtext(a)}}},d.prototype.drawTxtBydigitalAndtext=function(c){var d,e=this.parent.uiAtlas.getRec(this.textureStr),f=a.UIManager.getInstance().getContext2D(e.pixelWitdh,e.pixelHeight,!1),g=c.type,h=50,i=25;c.type==b.EXPERIENCE&&(d=a.ArtFont.num54);var j=a.ArtFont.getInstance().getAirFontWidth(f,String(this._data.str),d);return j+=h,a.UiDraw.cxtDrawImg(f,"TYPE"+g,new a.Rectangle(e.pixelWitdh-j,e.pixelHeight-i,h,i),a.UIData.publicUi),a.ArtFont.getInstance().writeFontToCtxLeft(f,String(this._data.str),d,e.pixelWitdh-j+h+2,e.pixelHeight-i),a.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,e.pixelX,e.pixelY,f),j},d.prototype.update=function(){if(this._data){if(this.time=a.TimeUtil.getTimer(),this.time>=this.dtime)return this.ui&&this.ui.parent&&this.ui.parent.removeChild(this.ui),void(this._data=null);var b=(this._data,this.changerules(this.time));this.ui.width=256*b[2],this.ui.height=50*b[3],this.ui.y=b[1]-this.ui.height,this.ui.x=b[0]-this.ui.width/2+25,this.ui.alpha=b[4]}},d.prototype.changerules=function(b){var c=new Array,d=this._data;b=(b-d.starttime)/1e3*60;var e=0,f=0,g=0,h=0,i=0;if(d.type==a.TextJumpType.EXPERIENCE){var j=new a.Vector2D;0>b?j.x=-9999:(j.x=300/a.UIData.Scale,j.y=a.Scene_data.stageHeight/a.UIData.Scale-50),f=j.y-=15,f-=.5*b,40>b?(e=j.x,g=1.8,h=1.8,i=1):60>b&&(e=j.x,g=1.8,h=1.8,i=1-(b-39)/20)}return c.push(e),c.push(f),c.push(g),c.push(h),c.push(i),c.push(j.x),c.push(j.y),this._lastchange=c,c},d}(a.Disp2DBaseText);a.ExpTextJumpUiDrawAndRefreash=d;var e=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.makeData=function(){if(this._data){var c=this._data;switch(this.dtime=c.endtime,this.pos=c.pos,c.type){case b.NORMALDAMAGE:case b.TREATMENT:a.ArtFont.getInstance().writeFontToSkinName(this.parent.uiAtlas,this.textureStr,String(c.str),"NUM"+(c.type+50),a.TextAlign.RIGHT);break;case b.MYNORMALDAMAGEUP:case b.MYNORMALDAMAGE:a.ArtFont.getInstance().writeFontToSkinName(this.parent.uiAtlas,this.textureStr,String(c.str),a.ArtFont.num53,a.TextAlign.RIGHT);break;case b.NORMALDAMAGEUP:a.ArtFont.getInstance().writeFontToSkinName(this.parent.uiAtlas,this.textureStr,String(c.str),"NUM"+(c.type+40),a.TextAlign.RIGHT);break;case b.DODGE:case b.VERTIGO:case b.FREEZE:case b.MISS:this.drawTxtBytext(c);break;case b.ATTACKADD:case b.ATTACKREDUCE:case b.EXPERIENCE:case b.CRIT:case b.CRITUP:this._width=this.drawTxtBydigitalAndtext(c)}}},d.prototype.drawTxtBytext=function(c){var d=this.parent.uiAtlas.getRec(this.textureStr),e=a.UIManager.getInstance().getContext2D(d.pixelWitdh,d.pixelHeight,!1),f=50;return c.type==b.MISS&&(f=67),a.UiDraw.cxtDrawImg(e,"TYPE"+c.type,new a.Rectangle(d.pixelWitdh-f,d.pixelHeight-25,f,25),a.UIData.publicUi),a.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,d.pixelX,d.pixelY,e),50},d.prototype.drawTxtBydigitalAndtext=function(c){var d,e=this.parent.uiAtlas.getRec(this.textureStr),f=a.UIManager.getInstance().getContext2D(e.pixelWitdh,e.pixelHeight,!1),g=c.type,h=50,i=25;c.type==b.ATTACKREDUCE?(g=b.ATTACKADD,d=a.ArtFont.num53):c.type==b.ATTACKADD?d=a.ArtFont.num54:c.type==b.EXPERIENCE?d=a.ArtFont.num54:c.type==b.CRIT?(d=a.ArtFont.num55,h=78,i=50):c.type==b.CRITUP&&(g-=10,h=78,i=50,d=a.ArtFont.num55);var j=a.ArtFont.getInstance().getAirFontWidth(f,String(this._data.str),d);return j+=h,a.UiDraw.cxtDrawImg(f,"TYPE"+g,new a.Rectangle(e.pixelWitdh-j,e.pixelHeight-i,h,i),a.UIData.publicUi),a.ArtFont.getInstance().writeFontToCtxLeft(f,String(this._data.str),d,e.pixelWitdh-j+h+2,e.pixelHeight-i),a.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,e.pixelX,e.pixelY,f),j},d.prototype.update=function(){if(this._data){if(this.time=a.TimeUtil.getTimer(),this.time>=this.dtime)return this.ui&&this.ui.parent&&this.ui.parent.removeChild(this.ui),void(this._data=null);var b=(this._data,this.changerules(this.time));this.ui.width=256*b[2],this.ui.height=50*b[3],this.ui.y=b[1]-this.ui.height,this.ui.x=b[0]-this.ui.width/2+25,this.ui.alpha=b[4]}},d.prototype.changerules=function(b){var c=this._data;b=(b-c.starttime)/1e3*60;var d=new Array,e=this.Vector3DToVector2D(new a.Vector3D(this.pos.x,this.pos.y,this.pos.z));0>b&&(e.x=-9999),
c.type==a.TextJumpType.EXPERIENCE&&(e.x=300/a.UIData.Scale,e.y=a.Scene_data.stageHeight/a.UIData.Scale-50);var f,g,h,i,j;switch(c.type){case a.TextJumpType.NORMALDAMAGE:case a.TextJumpType.MYNORMALDAMAGE:f=e.x,4>b?(g=e.y-4*b,h=b/4*1.3+.2,h>1.5&&(h=1.5),i=h,j=b/3*.8+.2,j>1&&(j=1)):8>b?(g=this._lastchange[1]-2,h=this._lastchange[2]-1/6,i=h,j=b/3*.8+.2,j>1&&(j=1)):15>b?(g=this._lastchange[1]-2,h=this._lastchange[2]+1/6,i=h,j=b/3*.8+.2,j>1&&(j=1)):30>b?(g=this._lastchange[1]-2,h=this._lastchange[2]-.05,i=h,j=b/3*.8+.2,j>1&&(j=1)):72>b&&(g=50>b?this._lastchange[1]-2:this._lastchange[1]+2,f=this._lastchange[0]-1.5,h=this._lastchange[2],i=h,j=this._lastchange[4]-.01,0>j&&(j=0));break;case a.TextJumpType.CRIT:f=e.x,4>b?(g=e.y-4*b,h=b/4*1.3+.2,h>1.5&&(h=1.5),i=h,j=b/3*.8+.2,j>1&&(j=1)):8>b?(g=this._lastchange[1]-2,h=this._lastchange[2]-1/6,i=h,j=b/3*.8+.2,j>1&&(j=1)):15>b?(g=this._lastchange[1]-2,h=this._lastchange[2]+.25,i=h,j=b/3*.8+.2,j>1&&(j=1)):30>b?(g=this._lastchange[1]-2,h=this._lastchange[2]-.05,i=h,j=b/3*.8+.2,j>1&&(j=1)):100>b&&(g=50>b?this._lastchange[1]-2:this._lastchange[1]+2,f=this._lastchange[0]-1.5,h=this._lastchange[2],i=h,j=this._lastchange[4]-.01,0>j&&(j=0));break;case a.TextJumpType.NORMALDAMAGEUP:case a.TextJumpType.CRITUP:case a.TextJumpType.MYNORMALDAMAGEUP:f=e.x,4>b?(g=e.y-4*b,h=b/4*1.5+.2,h>1.7&&(h=1.7),i=h,j=b/3*.3+.2,j>.5&&(j=.5)):8>b?(g=this._lastchange[1]-2,h=this._lastchange[2]-.25,i=h,j=b/3*.3+.2,j>.5&&(j=.5)):15>b?(g=this._lastchange[1]-2,h=this._lastchange[2]+.25,i=h,j=b/3*.3+.2,j>.5&&(j=.5)):30>b&&(g=this._lastchange[1]-2,h=this._lastchange[2]-1/15,i=h,j=this._lastchange[4]-1/80,0>j&&(j=0));break;case a.TextJumpType.TREATMENT:f=e.x,g=e.y-1.5*b,12>b?(h=Math.ceil(b)/12*.8+.2,i=h,j=Math.ceil(b)/12*.8+.2):60>b&&(h=1,i=h,j=1-(b-11)/48);break;case a.TextJumpType.EXPERIENCE:g=e.y-=15,g-=.5*b,40>b?(f=e.x,h=1.3,i=1.3,j=1):60>b&&(f=e.x,h=1.3,i=1.3,j=1-(b-39)/20);break;case a.TextJumpType.ATTACKADD:case a.TextJumpType.ATTACKREDUCE:f=e.x+=110,g=e.y-1.8*b,12>b?(h=Math.ceil(b)/12*1.3+.1,i=h,j=Math.ceil(b)/12*.8+.2):24>b?(h=1.4-(b-11)/12*.4,i=h,j=1):60>b&&(h=1,i=h,j=1-(b-23)/36);break;case a.TextJumpType.DODGE:case a.TextJumpType.MISS:case a.TextJumpType.VERTIGO:case a.TextJumpType.FREEZE:f=e.x-=50,12>b?(g=e.y-3*b,h=1,i=h,j=Math.ceil(b)/12):36>b?(g=e.y-33,h=1,i=h,j=1):72>b&&(g=e.y-33-1.5*(b-36),h=1,i=h,j=1-(b-35)/36)}return d.push(f),d.push(g),d.push(h),d.push(i),d.push(j),d.push(e.x),d.push(e.y),this._lastchange=d,d},d}(a.Disp2DBaseText);a.TextJumpUiDrawAndRefreash=e;var f=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c.tempMatrix=new a.Matrix3D,c}return __extends(c,b),c.prototype.makeData=function(){this._data&&(this.charNameMeshVo=this.rightTabInfoVo,this.lastKey!=this.charNameMeshVo.name&&(this.ui.width=179.2,this.ui.height=22*.7,this.lastKey=this.charNameMeshVo.name,a.LabelTextFont.writeSingleLabel(this.parent.uiAtlas,this.textureStr,this.charNameMeshVo.name,20,a.TextAlign.CENTER,"#ffffff","#27262e")),this.charNameMeshVo.needDraw=!1)},c.prototype.update=function(){if(this.charNameMeshVo){if(this.charNameMeshVo.needDraw&&this.makeData(),this.charNameMeshVo.pos)if(this.charNameMeshVo.visible){if(this.needUpData(this.charNameMeshVo.pos)||this.charNameMeshVo.visibleChange){var b=a.Scene_data.cam3D.cameraMatrix.clone(this.tempMatrix);b.append(a.Scene_data.viewMatrx3D);var c=b.transformVector(this.charNameMeshVo.pos);this.ui.x=(c.x/c.w+1)*(a.Scene_data.stageWidth/2)/a.UIData.Scale-this.ui.width/2,this.ui.y=(-c.y/c.w+1)*(a.Scene_data.stageHeight/2)/a.UIData.Scale-this.ui.height/2,this.oldPos.x=this.charNameMeshVo.pos.x,this.oldPos.y=this.charNameMeshVo.pos.y,this.charNameMeshVo.visibleChange=!1}}else this.ui.x=1e4;this.charNameMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null)}},c}(a.Disp2DBaseText);a.CharNameUiVo=f;var g=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c.tempMatrix=new a.Matrix3D,c}return __extends(c,b),c.prototype.makeData=function(){var b=this;this._data&&(this._charTitleMeshVo=this.rightTabInfoVo,a.LoadManager.getInstance().load(a.Scene_data.fileRoot+getUItittleUrl(String(this._charTitleMeshVo.num)),a.LoadManager.IMG_TYPE,function(c){var d=b.parent.uiAtlas.getRec(b.textureStr);b.parent.uiAtlas.ctx=a.UIManager.getInstance().getContext2D(d.pixelWitdh,d.pixelHeight,!1);var e=Math.min(d.pixelWitdh/c.width,d.pixelHeight/c.height);e=Math.min(e,1);var f=c.width*e,g=c.height*e;b.parent.uiAtlas.ctx.drawImage(c,(d.pixelWitdh-f)/2,(d.pixelHeight-g)/2,f,g),a.TextureManager.getInstance().updateTexture(b.parent.uiAtlas.texture,d.pixelX,d.pixelY,b.parent.uiAtlas.ctx)}))},c.prototype.update=function(){if(this._charTitleMeshVo){if(this._charTitleMeshVo.needDraw&&(this.makeData(),this._charTitleMeshVo.needDraw=!1),this._charTitleMeshVo.pos)if(this._charTitleMeshVo.visible){if(this.needUpData(this._charTitleMeshVo.pos)){var b=a.Scene_data.cam3D.cameraMatrix.clone(this.tempMatrix);b.append(a.Scene_data.viewMatrx3D);var c=b.transformVector(this._charTitleMeshVo.pos);this.ui.x=(c.x/c.w+1)*(a.Scene_data.stageWidth/2)/a.UIData.Scale-this.ui.width/2,this.ui.y=(-c.y/c.w+1)*(a.Scene_data.stageHeight/2)/a.UIData.Scale-this.ui.height/2,this.oldPos.x=this._charTitleMeshVo.pos.x,this.oldPos.y=this._charTitleMeshVo.pos.y}}else this.ui.x=1e4;this._charTitleMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null)}},c}(a.Disp2DBaseText);a.CharTitleUiVo=g;var h=function(){function a(){this._visible=!0,this.visibleChange=!1,this.clear=!1,this.uiScale=1}return Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a,this.visibleChange=!0},enumerable:!0,configurable:!0}),a}();a.baseMeshVo=h}(Pan3d||(Pan3d={})),function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[30];uniform vec4 lifenum[30];varying vec2 v_texCoord;\nvarying vec4 v_lifenum;\nvoid main(void){ v_lifenum = lifenum[int(v2uv.z)]; v_texCoord = vec2(v2uv.x , v2uv.y ); vec4  data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy *data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvarying vec4 v_lifenum;\nvoid main(void)\n{\nvec2  v_uv = v_texCoord;if(v_texCoord.x<v_lifenum.x){;\nv_uv.y = v_uv.y+v_lifenum.y;};\nvec4 infoUv = texture2D(s_texture, v_uv.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return a},b.BloodUIShader="BloodUIShader",b}(a.Shader3D);a.BloodUIShader=b;var c=function(a){function b(){var b=a.call(this)||this;return b.lifeNum=100,b.colortype=0,b}return __extends(b,a),b.prototype.pushVaData=function(a,b,c){return a.vertices.push(0,0,0,1,0,0,1,-1,0,0,-1,0),a.uvs.push(0,0,b,1,0,b,1,.25,b,0,.25,b),a.indexs.push(c,1+c,2+c,c,2+c,3+c),c+4},b}(a.UICompenent);a.BloodUICompenent=c;var d=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c.tempMatrix=new a.Matrix3D,c}return __extends(c,b),c.prototype.makeData=function(){this._data&&(this.bloodLineMeshVo=this.rightTabInfoVo)},c.prototype.update=function(){if(this.bloodLineMeshVo){if(this.bloodLineMeshVo.pos)if(this.bloodLineMeshVo.visible){if(this.needUpData(this.bloodLineMeshVo.pos)||this.bloodLineMeshVo.visibleChange){var b=a.Scene_data.cam3D.cameraMatrix.clone(this.tempMatrix);b.append(a.Scene_data.viewMatrx3D);var c=b.transformVector(new a.Vector3D(this.bloodLineMeshVo.pos.x,this.bloodLineMeshVo.pos.y,this.bloodLineMeshVo.pos.z));this.ui.x=(c.x/c.w+1)*(a.Scene_data.stageWidth/2)/a.UIData.Scale-this.ui.width/2,this.ui.y=(-c.y/c.w+1)*(a.Scene_data.stageHeight/2)/a.UIData.Scale-this.ui.height/2,this.bloodLineMeshVo.visibleChange=!1}this.ui.lifeNum=this.bloodLineMeshVo.num,this.ui.colortype=this.bloodLineMeshVo.colortype}else this.ui.x=1e4;this.bloodLineMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null)}},c}(a.Disp2DBaseText);a.BloodDisp2DBaseText=d;var e=function(d){function e(){var a=d.call(this)||this;return a.nextTime=0,a}return __extends(e,d),e.prototype.initData=function(){this._uiList=new Array,this.objData=new a.ObjData,a.ProgrmaManager.getInstance().registe(b.BloodUIShader,new b),this.shader=a.ProgrmaManager.getInstance().getProgram(b.BloodUIShader),this.program=this.shader.program,this.uiProLocation=a.Scene_data.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=a.Scene_data.context3D.getLocation(this.program,"lifenum")},e.prototype.update=function(){if(this.visible&&0!=this._uiList.length){if(a.Scene_data.context3D.setBlendParticleFactors(this.blenderMode),a.Scene_data.context3D.setProgram(this.program),this.nextTime<a.TimeUtil.getTimer()||this.renderData2.length!=4*this._uiList.length){this.renderData2.length!=4*this._uiList.length&&(this.renderData2=new Float32Array(4*this._uiList.length));for(var b=0;b<this._uiList.length;b++){var c=this._uiList[b],d=c.lifeNum/100,e=8*(c.colortype+1)/32;this.renderData2[4*b+0]=d,this.renderData2[4*b+1]=e}this.nextTime=a.TimeUtil.getTimer()+300}if(a.Scene_data.context3D.setVc4fvLocation(this.uiProLocation,this.renderData),a.Scene_data.context3D.setVc4fvLocation(this.ui2ProLocation,this.renderData2),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),this.uiAtlas&&a.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.uiAtlas.texture,0),a.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum),this.modelRenderList)for(var b=0;b<this.modelRenderList.length;b++)this.modelRenderList[b].update()}},e.prototype.creatBaseComponent=function(b){var d=new c;return d.tr.setRec(new a.UIRectangle(0,0,1,1)),d.width=64,d.height=8,d.uiRender=this,d.lifeNum=100,d},e.prototype.makeRenderDataVc=function(a){if((!this.renderData||this.renderData&&this.renderData.length!=4*this._uiList.length)&&(this.renderData=new Float32Array(4*this._uiList.length)),-1==a)for(var b=0;this._uiList&&b<this._uiList.length;b++)this._uiList[b].vcId=b,this.renderData[4*b+0]=this._uiList[b].renderData[0],this.renderData[4*b+1]=this._uiList[b].renderData[1],this.renderData[4*b+2]=this._uiList[b].renderData[2],this.renderData[4*b+3]=this._uiList[b].renderData[3];else a<this._uiList.length&&(this.renderData[4*a+0]=this._uiList[a].renderData[0],this.renderData[4*a+1]=this._uiList[a].renderData[1],this.renderData[4*a+2]=this._uiList[a].renderData[2],this.renderData[4*a+3]=this._uiList[a].renderData[3])},e}(a.UIRenderComponent);a.BloodUIRenderComponent=e;var f=function(b){function c(){var c=b.call(this)||this;return c.width=a.UIData.designWidth,c.height=a.UIData.designHeight,c._baseRender=new e,c.addRender(c._baseRender),c._baseRender.uiAtlas=new a.UIAtlas,c._baseRender.uiAtlas.configData=new Array,c._uiItem=new Array,c}return __extends(c,b),c.prototype.loadBloodTexture=function(){},c.prototype.update=function(a){if(this._baseRender.uiAtlas.textureRes)for(var b=0;b<this._uiItem.length;b++)this._uiItem[b].rightTabInfoVo&&this._uiItem[b].update()},c.prototype.removeChild=function(a){for(var c=0;c<this._uiItem.length;c++)if(this._uiItem[c].ui==a){this._uiItem.splice(c,1);break}b.prototype.removeChild.call(this,a)},c.prototype.clearOneTemp=function(){for(;this._uiItem.length>25;)this.removeChild(this._uiItem[0].ui)},c.prototype.showTemp=function(a){if(!(this._uiItem.length>=40)){var b=new d;b.parent=this._baseRender,b.ui=this._baseRender.creatBaseComponent("test"),b.rightTabInfoVo=a,this.addChild(b.ui),this._uiItem.push(b)}},c}(a.UIConatiner);a.BloodLineUIConatiner=f}(Pan3d||(Pan3d={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.destory=function(){this.pos=null,this._num=null,this.clear=!0},Object.defineProperty(b.prototype,"num",{get:function(){return this._num},set:function(a){this._num=a,this.needDraw=!0},enumerable:!0,configurable:!0}),b}(a.baseMeshVo);a.CharTitleMeshVo=b;var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a,this.needDraw=!0},enumerable:!0,configurable:!0}),b.prototype.destory=function(){this.pos=null,this._name=null,this.needDraw=null,this.clear=!0},b}(a.baseMeshVo);a.CharNameMeshVo=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.destory=function(){this.pos=null,this.num=null,this.colortype=null,this.clear=!0},b}(a.baseMeshVo);a.BloodLineMeshVo=d;var e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.destory=function(){this.pos=null,this.clear=!0},b}(a.baseMeshVo);a.JumpTextMeshVo=e;var f=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}return __extends(b,a),b}(a.Dis2DUIContianerPanel);a.JumpTxtContianerPanel=f;var g=function(){function e(){this.uiContianerItem=new Array,this._charTitleContianerPanel=new a.Dis2DUIContianerPanel(a.CharTitleUiVo,new a.Rectangle(0,0,131,69),10),this._charNameContianerPanel=new a.Dis2DUIContianerPanel(a.CharNameUiVo,new a.Rectangle(0,0,256,24),50),this._jumpTxtContianerPanel=new a.AlphaUiContianer(a.TextJumpUiDrawAndRefreash,new a.Rectangle(0,0,256,50),10),this._expjumpTxtContianerPanel=new a.AlphaUiContianer(a.ExpTextJumpUiDrawAndRefreash,new a.Rectangle(0,0,512,100),5),this._bloodLineUIConatiner=new a.BloodLineUIConatiner,this.uiContianerItem.push(this._charTitleContianerPanel),this.uiContianerItem.push(this._charNameContianerPanel),this.uiContianerItem.push(this._jumpTxtContianerPanel),this.uiContianerItem.push(this._expjumpTxtContianerPanel),this.uiContianerItem.push(this._bloodLineUIConatiner)}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.clearOneTemp=function(){for(var a=0;a<this.uiContianerItem.length;a++)this.uiContianerItem[a].clearOneTemp()},e.prototype.getCharTitleMeshVo=function(c){void 0===c&&(c=0);var d=new b;return d.num=c,d.pos=new a.Vector3D(0,50,0),this._charTitleContianerPanel.showTemp(d),d},e.prototype.getCharNameMeshVo=function(b){void 0===b&&(b="测试名");var d=new c;return d.name=b,d.pos=new a.Vector3D(0,50,0),this._charNameContianerPanel.showTemp(d),d},e.prototype.getBloodLineMeshVo=function(){var b=new d;return b.num=100,b.colortype=0,b.pos=new a.Vector3D(0,50,0),this._bloodLineUIConatiner.showTemp(b),b},e.prototype.setJumpNum=function(a){this._jumpTxtContianerPanel.showTemp(a)},e.prototype.setExpJumpNum=function(a){this._expjumpTxtContianerPanel.showTemp(a)},e.prototype.update=function(){for(var a=0;a<this.uiContianerItem.length;a++){this.uiContianerItem[a].update(0);for(var b=0;b<this._bloodLineUIConatiner.renderList.length;b++)this.uiContianerItem[a].renderList[b].update()}},e.prototype.resize=function(){this._jumpTxtContianerPanel.resize();for(var b=0;b<this.uiContianerItem.length;b++)this.uiContianerItem[b].resize();a.Scene_data.cam3D.needChange=!0},e}();a.BloodManager=g}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.valueV3d=[1,1,1,1]}return b.prototype.getValue=function(b){if(!this.valueVec||-1==this.begintFrame)return this.valueV3d;var c=float2int(b/a.Scene_data.frameTime-this.begintFrame);return 0>c?c=0:c>this.maxFrame-this.begintFrame&&(c=this.maxFrame-this.begintFrame),this.valueVec[c]},b.prototype.setData=function(a){this.type=a.type,this.maxFrame=a.maxFrame,a.items.length?this.begintFrame=a.items[0].frame:this.begintFrame=-1;for(var b=a.values[0].length,c=new Array,d=0;b>d;d++){var e=new Array;if(1==this.type)e.push(a.values[0][d]);else if(2==this.type)e.push(a.values[0][d],a.values[1][d]);else if(3==this.type)e.push(a.values[0][d],a.values[1][d],a.values[2][d]);else if(4==this.type){var f=a.values[3][d];e.push(a.values[0][d]*f,a.values[1][d]*f,a.values[2][d]*f,f)}c.push(e)}this.valueVec=c},b}();a.Curve=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this._visible=!1,this.data=[0,0,0,5]}return Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a,this.display.stateChage()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"x",{get:function(){return this.data[0]},set:function(a){this.data[0]=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this.data[1]},set:function(a){this.data[1]=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"z",{get:function(){return this.data[2]},set:function(a){this.data[2]=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){return this.data[3]},set:function(a){this.data[3]=a},enumerable:!0,configurable:!0}),a}();a.Shadow=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._displayList=new Array,a.ProgrmaManager.getInstance().registe(a.Display3DShadowShader.Display3DShadowShader,new a.Display3DShadowShader)}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.addShadow=function(){var b=this.getIdleShadow(),c=new a.Shadow;return b.addShadow(c),c},b.prototype.removeShadow=function(a){a.display.removeShadow(a)},b.prototype.update=function(){if(this._displayList.length){a.Scene_data.context3D.setWriteDepth(!1);for(var b=0;b<this._displayList.length;b++)this._displayList[b].update();a.Scene_data.context3D.setWriteDepth(!0)}},b.prototype.getIdleShadow=function(){for(var b=0;b<this._displayList.length;b++)if(this._displayList[b].hasIdle())return this._displayList[b];var c=new a.Display3dShadow;return this._displayList.push(c),c},b}();a.ShadowManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.allImgBytes=1e7,a}return __extends(c,b),c.prototype.read=function(b){void 0===b&&(b=null),this._imgFun=b;var d=this._byte.readInt();d==c.IMG_TYPE?a.Scene_data.supportBlob?this.readImg():this.readImgLow():d==c.OBJS_TYPE?this.readObj(this._byte):d==c.MATERIAL_TYPE?this.readMaterial():d==c.PARTICLE_TYPE?this.readParticle():d==c.ZIP_OBJS_TYPE&&this.readZipObj()},c.prototype.readZipObj=function(){var b=this._byte.readInt(),c=this._byte.buffer.slice(this._byte.position,this._byte.position+b);this._byte.position+=b;var d=unZip(c),e=new a.Pan3dByteArray(d);this.readObj(e)},c.prototype.readImg=function(){var b=this;this.imgNum=this._byte.readInt(),this.imgLoadNum=0;for(var c=(a.TimeUtil.getTimer(),new Array),d=new Array,e=0;e<this.imgNum;e++){var f=a.Scene_data.fileRoot+this._byte.readUTF(),g=this._byte.readInt();if(-1==f.search(".jpng")){var h=this._byte.buffer.slice(this._byte.position,this._byte.position+g);this._byte.position+=g;var i=new Blob([h],{type:"application/octet-binary"});c.push(i),d.push(f)}else this.readJpngImg(f)}for(var e=0;e<c.length;e++){var j=new Image;j.url=d[e],j.onload=function(a){b.loadImg(a.target);var c=a.target;URL.revokeObjectURL(c.src)},j.src=URL.createObjectURL(c[e])}},c.prototype.readJpngImg=function(b){var c=this,d=this._byte.readInt();this._byte.buffer.slice(this._byte.position,this._byte.position+d);this._byte.position+=d;var e=this._byte.readInt();this._byte.buffer.slice(this._byte.position,this._byte.position+e);this._byte.position+=e;var f=makeImage(),g=makeImage(),h=0,i=function(d){if(h++,!(2>h)){var e=a.UIManager.getInstance().getContext2D(f.width,f.height);e.drawImage(f,0,0);var i=e.getImageData(0,0,f.width,f.height);e.clearRect(0,0,f.width,f.height),e.drawImage(g,0,0);for(var j=e.getImageData(0,0,f.width,f.height),k=0;k<i.data.length;k+=4){j.data[k]/255;i.data[k+3]=j.data[k]}c.addImg(b.replace(".jpng",".png"),i)}};f.onload=i,g.onload=i},c.prototype.readImgLow=function(){var b=this;this.imgNum=this._byte.readInt(),this.imgLoadNum=0;for(var c=(a.TimeUtil.getTimer(),0),d=0;d<this.imgNum;d++){var e=a.Scene_data.fileRoot+this._byte.readUTF(),f=this._byte.readInt();c+=f;var g=makeImage();g.url=e,g.onload=function(a){b.loadImg(a.target)},g.src=e}this.allImgBytes=c},c.prototype.loadImg=function(b){a.TextureManager.getInstance().addRes(b.url,b),this.countImg()},c.prototype.addImg=function(b,c){a.TextureManager.getInstance().addRes(b,c),this.countImg()},c.prototype.countImg=function(){this.imgLoadNum++,this.imgLoadNum==this.imgNum&&(this._imgComplete=!0,this.allResCom())},c.prototype.readObj=function(b){for(var c=b.readInt(),d=0;c>d;d++){var e=a.Scene_data.fileRoot+b.readUTF(),f=b.readInt(),g=new a.Pan3dByteArray;g.length=f,b.readBytes(g,0,f);a.ObjDataManager.getInstance().loadObjCom(g.buffer,e)}this._imgFun&&this._imgFun()},c.prototype.readMaterial=function(){for(var b=this._byte.readInt(),c=(a.TimeUtil.getTimer(),0);b>c;c++){var d=a.Scene_data.fileRoot+this._byte.readUTF(),e=this._byte.readInt(),f=new a.Pan3dByteArray;f.length=e,this._byte.readBytes(f,0,e),a.MaterialManager.getInstance().addResByte(d,f)}},c.prototype.readParticle=function(){for(var b=this._byte.readInt(),c=(a.TimeUtil.getTimer(),0);b>c;c++){var d=a.Scene_data.fileRoot+this._byte.readUTF(),e=this._byte.readInt(),f=new a.Pan3dByteArray;f.length=e,this._byte.readBytes(f,0,e),a.ParticleManager.getInstance().addResByte(d,f)}},c.prototype.readMaterialInfo=function(){var a=this._byte.readInt();if(a>0){for(var b=new Array,c=0;a>c;c++){var d=new Object;d.type=this._byte.readInt(),d.name=this._byte.readUTF(),0==d.type&&(d.url=this._byte.readUTF()),1==d.type&&(d.x=this._byte.readFloat()),2==d.type&&(d.x=this._byte.readFloat(),d.y=this._byte.readFloat()),3==d.type&&(d.x=this._byte.readFloat(),d.y=this._byte.readFloat(),d.z=this._byte.readFloat()),b.push(d)}return b}return null},c.readFloatTwoByte=function(a,b){var c=a.readInt();if(c>0){var d=a.readFloat();b.length=0;for(var e=0;c>e;e++)b.push(a.readFloatTwoByte(d))}},c.readFloatOneByte=function(a,b){var c=a.readInt();if(c>0)for(var d=0;c>d;d++)b.push((a.readByte()+128)/256)},c.readIntForTwoByte=function(a,b){for(var c=a.readInt(),d=0;c>d;d++)b.push(a.readShort())},c.readIntForOneByte=function(a,b){for(var c=a.readInt(),d=0;c>d;d++)b.push(a.readByte())},c.readBytes2ArrayBuffer=function(a,b,c,d,e,f){void 0===f&&(f=0);var g=a.readInt();if(!(0>=g)){var h;0==f&&(h=a.readFloat());for(var i=g/c,j=0;i>j;j++)for(var k=e*j+d,l=0;c>l;l++)0==f?b.setFloat32(4*(k+l),a.readFloatTwoByte(h),!0):1==f?b.setFloat32(4*(k+l),a.readFloatOneByte(),!0):2==f?b.setFloat32(4*(k+l),a.readByte(),!0):3==f?b.setFloat32(4*(k+l),(a.readByte()+128)/255,!0):4==f&&b.setFloat32(4*(k+l),a.readFloat(),!0)}},c.readMaterialParamData=function(a){var b=a.readInt();if(b>0){for(var c=new Array,d=0;b>d;d++){var e=new Object;e.name=a.readUTF(),e.type=a.readByte(),0==e.type?e.url=a.readUTF():1==e.type?e.x=a.readFloat():2==e.type?(e.x=a.readFloat(),e.y=a.readFloat()):3==e.type&&(e.x=a.readFloat(),e.y=a.readFloat(),e.z=a.readFloat()),c.push(e)}return c}return null},c.prototype.allResCom=function(){this._imgFun&&this._imgFun()},c.IMG_TYPE=1,c.OBJS_TYPE=2,c.MATERIAL_TYPE=3,c.PARTICLE_TYPE=4,c.SCENE_TYPE=5,c.ZIP_OBJS_TYPE=6,c.PREFAB_TYPE=1,c.SCENE_PARTICLE_TYPE=11,c}(a.ResCount);a.BaseRes=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.loadRoleRes=function(b,c,d){var e=new a.RoleRes;e.meshBatchNum=d,e.load(b,function(){c(e)})},c.prototype.loadSkillRes=function(b,c){var d=new a.SkillRes;d.load(b,function(){c(d)})},c.prototype.loadSceneRes=function(b,c,d,e){var f;return this._dic[b]?f=this._dic[b]:(f=new a.SceneRes,this._dic[b]=f),f.load(b,c,d,e),this.clearSceneUse(f),f},c.prototype.clearSceneUse=function(a){for(var b in this._dic){var c=this._dic[b];c.useNum>0&&c!=a&&(c.useNum=0)}a.useNum=1},c.prototype.gc=function(){for(var b in this._dic){var c=this._dic[b];c.useNum<=0&&(c.idleTime++,c.idleTime>=a.ResCount.GCTime&&(c.destory(),delete this._dic[b]))}},c}(a.ResGC);a.ResManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.meshBatchNum=1,a}return __extends(c,b),c.prototype.load=function(b,c){var d=this;this._fun=c,a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(a){d.loadComplete(a)})},c.prototype.loadComplete=function(b){this._byte=new a.Pan3dByteArray(b),this._byte.position=0,this.version=this._byte.readInt(),this.readMesh()},c.prototype.readMesh=function(){this.roleUrl=this._byte.readUTF(),this.version>=16&&(this.ambientLightColor=new a.Vector3D,this.sunLigthColor=new a.Vector3D,this.nrmDircet=new a.Vector3D,this.ambientLightColor.x=this._byte.readFloat(),this.ambientLightColor.y=this._byte.readFloat(),this.ambientLightColor.z=this._byte.readFloat(),this.ambientLightIntensity=this._byte.readFloat(),this.ambientLightColor.scaleBy(this.ambientLightIntensity),this.sunLigthColor.x=this._byte.readFloat(),this.sunLigthColor.y=this._byte.readFloat(),this.sunLigthColor.z=this._byte.readFloat(),this.sunLigthIntensity=this._byte.readFloat(),this.sunLigthColor.scaleBy(this.sunLigthIntensity),this.nrmDircet.x=this._byte.readFloat(),this.nrmDircet.y=this._byte.readFloat(),this.nrmDircet.z=this._byte.readFloat()),a.MeshDataManager.getInstance().readData(this._byte,this.meshBatchNum,this.roleUrl,this.version),this.readAction()},c.prototype.readAction=function(){var b,c=this;b=this.version>=30?getZipByte(this._byte):this._byte,this.actionAry=new Array;for(var d=b.readInt(),e=0;d>e;e++){var f=b.readUTF();a.AnimManager.getInstance().readData(b,this.roleUrl+f),this.actionAry.push(f)}this.read(function(){c.readNext()})},c.prototype.readNext=function(){this.read(),this.read(),this._fun()},c}(a.BaseRes);a.RoleRes=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.meshBatchNum=1,a}return __extends(c,b),c.prototype.load=function(b,c){var d=this;this._fun=c,a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(a){d.loadComplete(a)})},c.prototype.loadComplete=function(b){var c=this;this._byte=new a.Pan3dByteArray(b),this._byte.position=0,this.version=this._byte.readInt(),this.skillUrl=this._byte.readUTF(),this.read(function(){c.readNext()})},c.prototype.readNext=function(){if(this.read(),this.read(),this.version<27){this._byte.readUTF()}this.data=this.readData(this._byte),this._fun()},c.prototype.readData=function(b){for(var c=b.readInt(),d=new Object,e=0;c>e;e++){var f=new Object,g=b.readUTF(),h=b.readUTF();if(f.skillname=g,f.action=h,f.type=b.readFloat(),this.version>=26?(f.blood=b.readInt(),0==f.blood&&(f.blood=a.SkillVo.defaultBloodTime)):f.blood=a.SkillVo.defaultBloodTime,this.version>=32){var i=b.readInt();if(i>0){var j=b.readUTF();f.sound={time:i,name:j}}}if(this.version>=33){var k=b.readInt();if(k){for(var l=new Array,m=0;k>m;m++){var n=new Object;n.time=b.readInt(),n.lasttime=b.readInt(),n.amp=b.readFloat(),l.push(n)}f.shock=l}}f.data=new Array;for(var o=b.readInt(),p=0;o>p;p++){var q=new Object;switch(q.url=b.readUTF(),q.frame=b.readFloat(),f.type){case 1:q.beginType=b.readInt(),0==q.beginType?(q.beginPos=new a.Vector3D,q.beginPos.x=b.readFloat(),q.beginPos.y=b.readFloat(),q.beginPos.z=b.readFloat()):1==q.beginType&&(q.beginSocket=b.readUTF()),q.hitSocket=b.readUTF(),q.endParticle=b.readUTF(),q.multype=b.readInt(),q.speed=b.readFloat();break;case 3:q.beginSocket=b.readUTF(),q.beginType=b.readFloat(),q.multype=b.readFloat(),q.speed=b.readFloat();break;case 4:if(this.version>=27){var r=b.readBoolean();q.hasSocket=r,r?q.socket=b.readUTF():(q.pos=this.readV3d(b),q.rotation=this.readV3d(b))}else q.hasSocket=!1,q.pos=this.readV3d(b),q.rotation=this.readV3d(b);break;default:alert("没有类型readData")}f.data.push(q)}d[g]=f}return d},c.prototype.readV3d=function(b){var c=new a.Vector3D;return c.x=b.readFloat(),c.y=b.readFloat(),c.z=b.readFloat(),c.w=b.readFloat(),c},c}(a.BaseRes);a.SkillRes=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.load=function(b,c){var d=this;this._fun=c,a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(a){d.loadComplete(a)})},c.prototype.loadComplete=function(b){var c=this;this._byte=new a.Pan3dByteArray(b),this._byte.position=0,this.read(function(){c.readNexte()})},c.prototype.readNexte=function(){this.read(),this.read(),this.objUrl=this._byte.readUTF(),this.materialUrl=this._byte.readUTF(),this._byte.readBoolean()&&(this.light=new a.LightVo,this.light.ambientColor[0]=this._byte.readFloat(),this.light.ambientColor[1]=this._byte.readFloat(),this.light.ambientColor[2]=this._byte.readFloat(),this.light.sunColor[0]=this._byte.readFloat(),this.light.sunColor[1]=this._byte.readFloat(),this.light.sunColor[2]=this._byte.readFloat(),this.light.sunDirect[0]=this._byte.readFloat(),this.light.sunDirect[1]=this._byte.readFloat(),this.light.sunDirect[2]=this._byte.readFloat()),this._fun()},c}(a.BaseRes);a.ModelRes=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return __extends(d,b),d.prototype.load=function(b,c){var d=this;this._fun=c,a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(a){d.loadComplete(a)})},d.prototype.loadComplete=function(b){var c=this;this.dataAry=new Array,this._byte=new a.Pan3dByteArray(b),this._byte.position=0,this.version=this._byte.readInt(),this.read(function(){c.readNext()})},d.prototype.readNext=function(){
this.read(),this.read(),this.read();var a=this._byte.readBoolean();if(a)for(var b=this._byte.readInt(),c=0;b>c;c++)this.readItem(!0);else this.readItem(!1);this._fun(),this._fun=null,this._byte=null},d.prototype.readItem=function(b){var d=this._byte.readInt(),e=new c;e.isGroup=b,b&&(e.x=this._byte.readFloat(),e.y=this._byte.readFloat(),e.z=this._byte.readFloat(),e.scaleX=this._byte.readFloat(),e.scaleY=this._byte.readFloat(),e.scaleZ=this._byte.readFloat(),e.rotationX=this._byte.readFloat(),e.rotationY=this._byte.readFloat(),e.rotationZ=this._byte.readFloat()),d==a.BaseRes.PREFAB_TYPE?(e.objUrl=this._byte.readUTF(),e.materialUrl=this._byte.readUTF(),this.version>=4&&(e.materialInfoArr=this.readMaterialInfo()),e.types=a.BaseRes.PREFAB_TYPE):d==a.BaseRes.SCENE_PARTICLE_TYPE&&(e.particleUrl=this._byte.readUTF(),e.types=a.BaseRes.SCENE_PARTICLE_TYPE),this.dataAry.push(e)},d.prototype.initReg=function(){this._objDic=new Object,this._materialDic=new Object,this._particleDic=new Object;for(var b=0;b<this.dataAry.length;b++){var c=this.dataAry[b];c.objUrl&&(this._objDic[a.Scene_data.fileRoot+c.objUrl]=!0),c.materialUrl&&(this._materialDic[a.Scene_data.fileRoot+c.materialUrl]=!0),c.particleUrl&&(this._particleDic[a.Scene_data.fileRoot+c.particleUrl]=!0)}for(var d in this._objDic)a.ObjDataManager.getInstance().registerUrl(d);for(var d in this._materialDic)a.MaterialManager.getInstance().registerUrl(d);for(var d in this._particleDic)a.ParticleManager.getInstance().registerUrl(d)},d.prototype.destory=function(){b.prototype.destory.call(this);for(var c in this._objDic)a.ObjDataManager.getInstance().releaseUrl(c);for(var c in this._materialDic)a.MaterialManager.getInstance().releaseUrl(c);for(var c in this._particleDic)a.ParticleManager.getInstance().releaseUrl(c);this.dataAry=null,this._objDic=null,this._particleDic=null,this._materialDic=null},d}(a.BaseRes);a.GroupRes=b;var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.Object3D);a.GroupItem=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return __extends(d,b),d.prototype.load=function(b,c,e,f){var g=this;if(this.sceneData)return void(this.isNeedReload()?(c(),e(1),this.applyByteArray()):(c(),e(1),f(this.sceneData)));this._completeFun=c,this._readDataFun=f,this._progressFun=e;var h=d.sceneConfigData;h&&h[b]?this.loadZipMap(b,h[b].len):(b=a.Scene_data.fileRoot+getMapUrl(b),a.LoadManager.getInstance().load(b,a.LoadManager.BYTE_TYPE,function(a){g.loadComplete(a)},null,e))},d.prototype.loadZipMap=function(b,c){for(var d=this,e=new Array,f=new Array,g=0,h=new Array,i=0;c>i;i++)h[i]=0;for(var j=function(a){var b=a.response,c=e.indexOf(a);if(f[c]=b,g++,g==e.length){for(var h=0,i=0;i<f.length;i++)h+=f[i].byteLength;for(var j=new Uint8Array(h),k=0,i=0;i<f.length;i++)j.set(new Uint8Array(f[i]),k),k+=f[i].byteLength;d.loadComplete(j.buffer)}},k=function(a,b){var f=e.indexOf(a);h[f]=b;for(var g=0,i=0;c>i;i++)g+=h[i];g/=c,d._progressFun(g)},i=0;c>i;i++){var l=new XMLHttpRequest;l.onreadystatechange=function(a){var b=a.target;200==b.status&&4==b.readyState&&j(b)},l.onprogress=function(a){var b=a.target;k(b,a.loaded/a.total)};var m=a.Scene_data.fileRoot+getZipMapUrl(b)+i+".txt";e.push(l),l.open("GET",m,!0),l.responseType="arraybuffer",l.send()}},d.prototype.isNeedReload=function(){for(var b=this.sceneData.buildItem,c=0;c<b.length;c++)if(b[c].type==a.BaseRes.PREFAB_TYPE&&b[c].lighturl){var d=a.Scene_data.fileRoot+b[c].lighturl;return a.TextureManager.getInstance().hasTexture(d)?!1:!0}return a.ResCount.GCTime-this.idleTime<10},d.prototype.loadComplete=function(b){this._byte=new a.Pan3dByteArray(b),this._completeFun&&this._completeFun(),this.applyByteArray()},d.prototype.applyByteArray=function(){var a=this;this._byte.position=0,this.version=this._byte.readInt(),this.read(function(){a.readNext()})},d.prototype.readNext=function(){this.read(),this.read(),this.read(),this.readScene(),this._readDataFun&&this._readDataFun(this.sceneData)},d.prototype.readScene=function(){this._byte.readInt();this.readAstat(),this.version>=28&&this.readTerrainIdInfoBitmapData(this._byte);var a=this._byte.readInt();this.sceneData=JSON.parse(this._byte.readUTFBytes(a)),this.sceneData.astar=this._astarDataMesh,this.sceneData.terrain=this._terrainDataItem},d.prototype.readTerrainIdInfoBitmapData=function(b){var c=b.readInt();if(c){var d=c,e=b.buffer.slice(b.position,b.position+d);b.position+=d;var f=unZip(e),g=new a.Pan3dByteArray(f);this._terrainDataItem=a.GroundDataMesh.meshAllgroundData(g)}},d.prototype.readAstat=function(){var b=this._byte.readBoolean();if(b){this._astarDataMesh=new c,this._astarDataMesh.aPos=new a.Vector3D,this._astarDataMesh.astarItem=new Array,this._astarDataMesh.heightItem=new Array,this._astarDataMesh.jumpItem=new Array,this._astarDataMesh.midu=this._byte.readFloat(),this._astarDataMesh.aPos.x=this._byte.readFloat(),this._astarDataMesh.aPos.y=this._byte.readFloat(),this._astarDataMesh.aPos.z=this._byte.readFloat();var d,e,f=this._byte.readInt(),g=this._byte.readInt();if(this._astarDataMesh.width=f,this._astarDataMesh.height=g,this.version<25){for(d=0;g>d;d++){var h=new Array;for(e=0;f>e;e++)h.push(this._byte.readFloat());this._astarDataMesh.astarItem.push(h)}for(d=0;g>d;d++){var i=new Array;for(e=0;f>e;e++)i.push(this._byte.readFloat());this._astarDataMesh.heightItem.push(i)}}else{var j=this._byte.readFloat(),k=this.readAstarFromByte(this._byte),l=this.readAstarFromByte(this._byte),m=0,n=0;for(d=0;g>d;d++){var h=new Array,o=new Array;for(e=0;f>e;e++){var p=k[m++];if(h.push(p),1==p){var q=l[n++];o.push(q)}else o.push(0)}this._astarDataMesh.astarItem.push(h),this._astarDataMesh.jumpItem.push(o)}for(this._astarDataMesh.jumpItem,d=0;g>d;d++){var i=new Array;for(e=0;f>e;e++)i.push(this._byte.readShort()/j);this._astarDataMesh.heightItem.push(i)}}}},d.prototype.readAstarFromByte=function(a){for(var b=a.readUnsignedInt(),c=Math.ceil(b/32),d=new Array,e=0;c>e;e++)for(var f=a.readUnsignedInt(),g=0;32>g;g++){var h=1&f;d.length<b&&d.push(h),f>>=1}return d},d}(a.BaseRes);a.SceneRes=b;var c=function(){function a(){}return a}()}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(b){void 0===b&&(b=0),this._callback_index=0,this._event_key_type=b,b==a.KEY_TYPE_STRING?this._event_id_str=new Array:b==a.KEY_TYPE_INT?this._event_id_int=new Array:b==a.KEY_TYPE_INT_MASK&&(this._event_id_int_mask=new Array),this._event_callback=new Array,this._event_index=new Array}return a.prototype.DispatchIndex=function(b){var c;if(this._event_key_type==a.KEY_TYPE_STRING)for(c in this._event_index)this._event_callback[this._event_index[c]](b);else if(this._event_key_type==a.KEY_TYPE_INT)for(c in this._event_index)this._event_callback[this._event_index[c]](b);else if(this._event_key_type==a.KEY_TYPE_INT_MASK)for(c in this._event_index)this._event_callback[this._event_index[c]](b)},a.prototype.DispatchString=function(b,c){if(this._event_key_type!=a.KEY_TYPE_STRING)throw new Error("this.DispatchIndex/this._event_key_type != NetEventDispatcher.KEY_TYPE_STRING");this._event_index.length=0;for(var d=this._event_callback.length,e=0;d>e;e++)b==this._event_id_str[e]&&this._event_index.unshift(e);this._event_index.length&&this.DispatchIndex(c)},a.prototype.DispatchInt=function(b,c){if(this._event_key_type!=a.KEY_TYPE_INT)throw new Error("this.DispatchIndex/this._event_key_type != NetEventDispatcher.KEY_TYPE_INT");this._event_index.length=0;for(var d=this._event_callback.length,e=0;d>e;e++)b==this._event_id_int[e]&&this._event_index.unshift(e);this._event_index.length&&this.DispatchIndex(c)},a.prototype.DispatchIntMask=function(b,c){if(this._event_key_type!=a.KEY_TYPE_INT_MASK)throw new Error("this.DispatchIndex/this._event_key_type != NetEventDispatcher.KEY_TYPE_INT_MASK");this._event_index.length=0;for(var d=this._event_callback.length,e=0;d>e;e++)this._event_id_int_mask[e].test(b)&&this._event_index.unshift(e);this._event_index.length&&this.DispatchIndex(c)},a.prototype.Dispatch=function(a,b){this._event_index.length=0;for(var c=this._event_callback.length,d=0;c>d;d++)b(this._event_id_int[d],a)&&this._event_index.unshift(d);this._event_index.length&&this.DispatchIndex(a)},a.prototype.AddListenInt=function(b,c){if(this._event_key_type!=a.KEY_TYPE_INT)throw new Error("AddListenInt but (this._event_key_type != NetEventDispatcher.KEY_TYPE_INT)");for(var d=0;d<this._event_id_int.length;d++)if(this._event_id_int[d]==b&&this._event_callback[d]==c)return;this._event_id_int.push(b),this._event_callback.push(c)},a.prototype.AddListenString=function(b,c){if(this._event_key_type!=a.KEY_TYPE_STRING)throw new Error("AddListenString but (this._event_key_type != NetEventDispatcher.KEY_TYPE_STRING)");for(var d=0;d<this._event_id_str.length;d++)if(this._event_id_str[d]==b&&this._event_callback[d]==c)return;this._event_id_str.push(b),this._event_callback.push(c)},a.prototype.AddListenIntMask=function(b,c){if(this._event_key_type!=a.KEY_TYPE_INT_MASK)throw new Error("AddListenString but (this._event_key_type != NetEventDispatcher.KEY_TYPE_INT_MASK)");for(var d=0;d<this._event_id_int_mask.length;d++)if(this._event_id_int_mask[d].equals(b)&&this._event_callback[d]==c)return;this._event_id_int_mask.push(b.clone()),this._event_callback.push(c)},a.prototype.removeListenerInt=function(b,c){if(void 0===c&&(c=null),this._event_key_type!=a.KEY_TYPE_INT)throw new Error("removeListenerInt but (this._event_key_type != NetEventDispatcher.KEY_TYPE_INT)");for(var d=0;d<this._event_id_int.length;)this._event_id_int[d]!=b||null!=c&&this._event_callback[d]!=c?d++:(this._event_id_int.splice(d,1),this._event_callback.splice(d,1))},a.prototype.removeListenerString=function(b,c){if(void 0===c&&(c=null),this._event_key_type!=a.KEY_TYPE_STRING)throw new Error("removeListenerString but (this._event_key_type != NetEventDispatcher.KEY_TYPE_STRING)");for(var d=0;d<this._event_id_str.length;)this._event_id_str[d]!=b||null!=c&&this._event_callback[d]!=c?d++:(this._event_id_str.splice(d,1),this._event_callback.splice(d,1))},a.prototype.removeListenerUpdateMask=function(b,c){if(void 0===c&&(c=null),this._event_key_type!=a.KEY_TYPE_INT_MASK)throw new Error("removeListenerUpdateMask but ()");for(var d=0;d<this._event_id_int_mask.length;)!this._event_id_int_mask[d].equals(b)||null!=c&&this._event_callback[d]!=c?d++:(this._event_id_int_mask.splice(d,1),this._event_callback.splice(d,1))},a.prototype.AddCallback=function(b){if(this._event_key_type==a.KEY_TYPE_STRING)throw new Error("AddCallback but (this._event_key_type == NetEventDispatcher.KEY_TYPE_STRING)");var c=this._callback_index+1;do{c=this._callback_index+1;for(var d in this._event_id_int)0!=c&&c!=Number(d);this._callback_index=c}while(!1);return this.AddListenInt(c,b),c},a.prototype.Clear=function(){this._event_callback&&(this._event_callback.length=0),this._event_id_int&&(this._event_id_int.length=0),this._event_id_str&&(this._event_id_str.length=0),this._event_index&&(this._event_index.length=0),this._event_id_int_mask&&(this._event_id_int_mask.length=0)},a.KEY_TYPE_INT=0,a.KEY_TYPE_STRING=1,a.KEY_TYPE_INT_MASK=2,a}();a.NetEventDispatcher=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this._bytes=new a.Pan3dByteArray,this._bytes.endian=a.Endian.LITTLE_ENDIAN}return Object.defineProperty(b.prototype,"baseByteArray",{get:function(){return this._bytes},enumerable:!0,configurable:!0}),b.prototype.Clear=function(){this._bytes.clear()},b.prototype.GetBits=function(a,b){void 0===b&&(b=1);for(var c=0;b>c;c++)if(this.GetBit(a+c))return!0;return!1},b.prototype.GetBit=function(a){return a>>3<this._bytes.length?0!=(this._bytes.getByte(a>>3)&1<<(7&a)):!1},b.prototype.SetBit=function(a){a>>3>=this._bytes.length&&(this._bytes.length=(a>>3)+1),this._bytes.setByte(a>>3,this._bytes.getByte(a>>3)|1<<(7&a))},b.prototype.WriteTo=function(a){return this._bytes.position=0,a.writeShort(this._bytes.length),this._bytes.length&&a.writeBytes(this._bytes),!0},b.prototype.ReadFrom=function(a){this._bytes.clear();var b=a.readUnsignedShort();return this._bytes.length=b,b&&a.readBytes(this._bytes,0,b),!0},b.prototype.GetCount=function(){return this._bytes.length<<3},b.prototype.SetCount=function(a){this._bytes.length=a+7>>3},b.prototype.empty=function(){for(var a=0;a<this._bytes.length;a++)if(0!=this._bytes.getByte(a))return!1;return!0},b.prototype.or=function(a){var b=a._bytes.length;this._bytes.length<b&&(this._bytes.length=b);for(var c=0;b>c;c++)this._bytes[c]|=a._bytes[c]},b.prototype.test=function(a){for(var b=this._bytes.length>a._bytes.length?a._bytes.length:this._bytes.length,c=0;b>c;c++)if(this._bytes[c]&a._bytes[c])return!0;return!1},b.prototype.condense=function(){for(var a=this._bytes.length;a>0&&(a--,0==this._bytes[a]);)this._bytes.length--},b.prototype.equals=function(a){if(this.condense(),a.condense(),this._bytes.length!=a._bytes.length)return!1;for(var b=0;b<this._bytes.length;b++)if(this._bytes[b]!=a._bytes[b])return!1;return!0},b.prototype.clone=function(){for(var a=new b,c=0;c<this._bytes.length;c++)a._bytes[c]=this._bytes[c];return a},b}();a.UpdateMask=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this._indexerExp=new Array,this._objs=new Array,this._evFilter=new Array}return a.prototype.createIndex=function(a){var b=this.getIndex(a);return-1==b&&(b=this._indexerExp.length,this._indexerExp[b]=new RegExp(a,"g"),this._objs[b]=new Array,this._evFilter[b]=null),b},a.prototype.getIndex=function(a){var b=-1;for(var c in this._indexerExp){b++;var d=this._indexerExp[c];if(d.source==a)return b}return-1},a.prototype.releaseIndex=function(a){var b=this.getIndex(a);-1!=b&&(this._indexerExp.splice(b,1),this._objs.splice(b,1),this._evFilter.splice(b,1))},a.prototype.test=function(a){for(var b=0;b<this._indexerExp.length;b++)if(this._indexerExp[b].lastIndex=0,this._indexerExp[b].test(a))return b;return-1},a.prototype.insert=function(a){var b=this.test(a.guid);b>=0&&this._objs[b]&&-1==this._objs[b].indexOf(a)&&(this._objs[b][this._objs[b].length]=a)},a.prototype.remove=function(a){var b=this.test(a);if(-1!=b)for(var c=0;c<this._objs[b].length;c++)if(this._objs[b][c].guid==a)return void this._objs[b].splice(c,1)},a.prototype.query=function(a){var b=this.getIndex(a);return-1==b?null:this._objs[b]},a.prototype.get=function(a){return 0>a||a>=this._objs.length?null:this._objs[a]},a.prototype.matchObject=function(a){if(!a)return null;var b=this.test(a.guid);return b>=0?this._evFilter[b]:null},a.prototype.filter=function(a,b){var c=this.getIndex(a);if(0>c||c>=this._objs.length)throw new Error("indexTyp < 0 || indexTyp >= this._objs.length");if(c>=this._evFilter.length)throw new Error("indexTyp >= this._evFilter.length");this._evFilter[c]=b},a.prototype.Clear=function(){if(this._indexerExp&&(this._indexerExp.length=0,this._indexerExp=null),this._objs&&(this._objs.length=0,this._objs=null),this._evFilter)for(;this._evFilter.length;){var a=this._evFilter.shift();a&&a.Clear()}},a}();a.StringIndexer=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.init=function(){b.tmpValueBytes=new a.Pan3dByteArray,b.tmpValueBytes.endian=a.Endian.LITTLE_ENDIAN},b.OBJ_OPT_NEW=1,b.OBJ_OPT_DELETE=2,b.OBJ_OPT_UPDATE=4,b.OBJ_OPT_BINLOG=8,b.OBJ_OPT_U_GUID=16,b.OPT_SET=1,b.OPT_UNSET=2,b.OPT_ADD=4,b.OPT_SUB=8,b.TYPE_UINT32=0,b.TYPE_UINT16=1,b.TYPE_UINT8=2,b.TYPE_BIT=3,b.TYPE_UINT64=4,b.TYPE_INT32=5,b.TYPE_STRING=6,b.TYPE_INT16=7,b.TYPE_FLOAT=9,b.TYPE_DOUBLE=10,b.ATOMIC_OPT_RESULT_NO=0,b.ATOMIC_OPT_RESULT_TRY=1,b.ATOMIC_OPT_RESULT_OK=2,b.ATOMIC_OPT_RESULT_FAILED=-1,b}();a.SyncEvent=b,b.init()}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._value_u32_buffer=new DataView(new ArrayBuffer(4)),a._old_value_u32_buffer=new DataView(new ArrayBuffer(4)),a}return __extends(c,b),c.malloc=function(){return 0==c._pool.length?new c:c._pool.pop()},c.free=function(a){a.Clear(),c._pool[c._pool.length]=a},c.prototype.BinLogStru=function(){this.Clear()},Object.defineProperty(c.prototype,"opt",{get:function(){return this._opt},set:function(a){this._opt=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"index",{get:function(){return this._index},set:function(a){this._index=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"offset",{get:function(){return this._value_u32_buffer.getUint8(0)},set:function(a){this._value_u32_buffer.setUint8(0,a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"typ",{get:function(){return this._typ},set:function(a){this._typ=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"atomic_opt",{get:function(){return this._atomic_opt},set:function(a){this._atomic_opt=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"callback_idx",{get:function(){return this._callback_index},set:function(a){this._callback_index=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uint32",{get:function(){return this._value_u32_buffer.getUint32(0,!0)},set:function(b){this._typ=a.SyncEvent.TYPE_UINT32,this._value_u32_buffer.setUint32(0,b,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"int32",{get:function(){if(this._typ!=a.SyncEvent.TYPE_INT32)throw new Error("get int32 but _typ != SyncEvent.TYPE_INT32!");return this._value_u32_buffer.getInt32(0,!0)},set:function(b){this._typ=a.SyncEvent.TYPE_INT32,this._value_u32_buffer.setInt32(0,b,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bit",{get:function(){if(this._typ!=a.SyncEvent.TYPE_BIT)throw new Error("get bit but _typ != SyncEvent.TYPE_BIT");return this._value_u32_buffer.getUint32(0,!0)},set:function(b){this._typ=a.SyncEvent.TYPE_BIT,this._value_u32_buffer.setUint32(0,b,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"old_int32",{get:function(){if(this._typ!=a.SyncEvent.TYPE_INT32)throw new Error("get int32 but _typ != SyncEvent.TYPE_INT32!");return this._old_value_u32_buffer.getInt32(0,!0)},set:function(b){if(this._typ!=a.SyncEvent.TYPE_INT32)throw new Error("get int32 but _typ != SyncEvent.TYPE_INT32!");this._old_value_u32_buffer.setInt32(0,b,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uint16",{get:function(){if(this._typ!=a.SyncEvent.TYPE_UINT16)throw new Error("get uint16 but _typ != SyncEvent.TYPE_UINT16!");return this._value_u32_buffer.getUint16(2,!0)},set:function(b){this._typ=a.SyncEvent.TYPE_UINT16,this._value_u32_buffer.setUint16(2,b,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"int16",{get:function(){if(this._typ!=a.SyncEvent.TYPE_INT16)throw new Error("get int16 but _typ != SyncEvent.TYPE_INT16!");return this._value_u32_buffer.getInt16(2,!0)},set:function(b){this._typ=a.SyncEvent.TYPE_INT16,this._value_u32_buffer.setInt16(2,b,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"byte",{get:function(){if(this._typ!=a.SyncEvent.TYPE_UINT8)throw new Error("get uint8 but _typ != SyncEvent.TYPE_UINT8!");return this._value_u32_buffer.getInt8(2)},set:function(b){this._typ=a.SyncEvent.TYPE_UINT8,this._value_u32_buffer.setInt8(2,b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"double",{get:function(){return this._value_dbe},set:function(a){this._value_dbe=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"float",{get:function(){return this._value_u32_buffer.getFloat32(0,!0)},set:function(a){this._value_u32_buffer.setFloat32(0,a,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"str",{get:function(){if(this._typ!=a.SyncEvent.TYPE_STRING)throw new Error("get str but _typ != SyncEvent.TYPE_STRING!");return this._value_str},set:function(b){this._typ=a.SyncEvent.TYPE_STRING,this._value_str=b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"old_str",{get:function(){if(this._typ!=a.SyncEvent.TYPE_STRING)throw new Error("get old_str but _typ != SyncEvent.TYPE_STRING!");return this._old_value_str},set:function(b){if(this._typ!=a.SyncEvent.TYPE_STRING)throw new Error("set old_str but _typ != SyncEvent.TYPE_STRING!");this._old_value_str=b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"value",{get:function(){return this._value_u32_buffer.getUint32(0,!0)},set:function(a){this._value_u32_buffer.setUint32(0,a,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"old_value",{get:function(){return this._old_value_u32_buffer.getUint32(0,!0)},set:function(a){this._old_value_u32_buffer.setUint32(0,a,!0)},enumerable:!0,configurable:!0}),c.prototype.Clear=function(){this._opt=0,this._typ=0,this._index=0,this._atomic_opt=a.SyncEvent.ATOMIC_OPT_RESULT_NO,this._value_u32_buffer.setUint32(0,0,!0),this._value_dbe=0,this._value_str="",this._callback_index=0,this._old_value_u32_buffer.setUint32(0,0,!0),this._old_value_dbe=0,this._old_value_str=""},c.prototype.ReadFrom=function(b){return this._opt=b.readUnsignedByte(),this._typ=b.readUnsignedByte(),this._index=b.readShort(),this._atomic_opt=b.readByte(),this._typ==a.SyncEvent.TYPE_STRING?this._value_str=b.readUTF():this._typ==a.SyncEvent.TYPE_DOUBLE?this._value_dbe=b.readDouble():this.value=b.readUnsignedInt(),this._atomic_opt&&(this._callback_index=b.readUnsignedInt(),this._typ==a.SyncEvent.TYPE_STRING?this._old_value_str=b.readUTF():this._typ==a.SyncEvent.TYPE_DOUBLE?this._old_value_dbe=b.readDouble():this.old_value=b.readUnsignedInt()),!0},c.prototype.WriteTo=function(b){b.writeByte(this._opt),b.writeByte(this._typ),b.writeShort(this._index),b.writeByte(this._atomic_opt),this._typ==a.SyncEvent.TYPE_STRING?b.writeUTF(this._value_str?this._value_str:""):this._typ==a.SyncEvent.TYPE_DOUBLE?b.writeDouble(this._value_dbe):b.writeUnsignedInt(this.value),this._atomic_opt&&(b.writeUnsignedInt(this._callback_index),this._typ==a.SyncEvent.TYPE_STRING?b.writeUTF(this._old_value_str?this._old_value_str:""):this._typ==a.SyncEvent.TYPE_DOUBLE?b.writeDouble(this._old_value_dbe):b.writeUnsignedInt(this.old_value))},c.prototype.clone=function(){var a=c.malloc();return a._opt=this._opt,a._typ=this._typ,a._index=this._index,a._atomic_opt=this._atomic_opt,a.value=this.value,a._value_dbe=this._value_dbe,a._value_str=this._value_str,a._callback_index=this._callback_index,a.old_value=this.old_value,a._old_value_dbe=this._old_value_dbe,a._old_value_str=this._old_value_str,a},c._pool=new Array,c}(a.SyncEvent);a.BinLogStru=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._events_value=new a.NetEventDispatcher,c._events_str_values=new a.NetEventDispatcher,c._events_mask=new a.NetEventDispatcher(a.NetEventDispatcher.KEY_TYPE_INT_MASK),c._events_callback=new a.NetEventDispatcher,c._uint32_values_len=0,c._str_values_len=0,c._str_values=new Array,c._guid="",c._tmpBinlog=new a.BinLogStru,c._afterUpdateIntObj=new Object,c._afterUpdateStrObj=new Object,c._uint32_values_buffer=new DataView(new ArrayBuffer(0)),c}return __extends(c,b),Object.defineProperty(c.prototype,"guid",{get:function(){return this._guid},set:function(a){this._guid=a},enumerable:!0,configurable:!0}),c.prototype.Reset=function(){this._events_value.Clear(),this._events_str_values.Clear(),this._events_callback.Clear(),this.clearValues()},c.prototype.clearValues=function(){this._uint32_values_len=0,this._uint32_values_buffer=new DataView(new ArrayBuffer(0)),this._str_values_len=0,this._str_values.length=this._str_values_len},c.prototype.checkIntSize=function(a){for(var b=!1;a>=this._uint32_values_len;)this._uint32_values_len+=8,b=!0;if(b){var c=new Uint8Array(new ArrayBuffer(this._uint32_values_len<<2));c.set(new Uint8Array(this._uint32_values_buffer.buffer,0,this._uint32_values_buffer.buffer.byteLength)),this._uint32_values_buffer=new DataView(c.buffer)}},c.prototype.checkStrSize=function(a){for(;a>=this._str_values_len;)this._str_values_len+=8,this._str_values.length=this._str_values_len},c.prototype.OnEventSyncBinLog=function(b){this._after_update&&(b.typ==a.SyncEvent.TYPE_STRING?this._afterUpdateStrObj[b.index]=!0:this._afterUpdateIntObj[b.index]=!0),b.atomic_opt?this._events_callback.DispatchInt(b.callback_idx,b):b.typ==a.SyncEvent.TYPE_STRING?this._events_str_values.DispatchInt(b.index,b):this._events_value.DispatchInt(b.index,b)},c.prototype.AddListen=function(a,b){this._events_value.AddListenInt(a,b)},c.prototype.AddListens=function(a,b){void 0===b&&(b=null);for(var d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];c.addListens_mask.Clear();for(var f=0;f<d.length;f++)c.addListens_mask.SetBit(a+d[f]);this._events_mask.AddListenIntMask(c.addListens_mask,b)},c.prototype.removeListene=function(a,b){void 0===b&&(b=null),this._events_value.removeListenerInt(a,b)},c.prototype.removeListenes=function(a,b){void 0===b&&(b=null);for(var d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];c.addListens_mask.Clear();for(var f=0;f<d.length;f++)c.addListens_mask.SetBit(a+d[f]);this._events_mask.removeListenerUpdateMask(c.addListens_mask,b)},c.prototype.AddListenString=function(a,b){this._events_str_values.AddListenInt(a,b)},c.prototype.removeListeneString=function(a,b){void 0===b&&(b=null),this._events_str_values.removeListenerInt(a,b)},c.prototype.GetDouble=function(a){return a+1<this._uint32_values_len?this._uint32_values_buffer.getFloat64(a<<2,!0):0},c.prototype.GetUInt32=function(a){return a<this._uint32_values_len?this._uint32_values_buffer.getUint32(a<<2,!0):0},c.prototype.GetInt32=function(a){return a<this._uint32_values_len?this._uint32_values_buffer.getInt32(a<<2,!0):0},c.prototype.GetUInt16=function(a,b){return a<this._uint32_values_len?this._uint32_values_buffer.getUint16((a<<2)+(b<<1),!0):0},c.prototype.GetInt16=function(a,b){return a<this._uint32_values_len?this._uint32_values_buffer.getInt16((a<<2)+(b<<1),!0):0},c.prototype.GetFloat=function(a){return a<this._uint32_values_len?this._uint32_values_buffer.getFloat32(a<<2,!0):0},c.prototype.GetByte=function(a,b){return a<this._uint32_values_len?this._uint32_values_buffer.getInt8((a<<2)+b):0},c.prototype.GetUInt8=function(a,b){return a<this._uint32_values_len?this._uint32_values_buffer.getUint8((a<<2)+b):0},c.prototype.GetBit=function(a,b){return a+=b>>5,a<this._uint32_values_len?Boolean(this._uint32_values_buffer.getUint32(a<<2,!0)>>(31&b)&1):!1},c.prototype.SetBit=function(a,b,c){var d=this._uint32_values_buffer.getUint32(a<<2,!0);d=d&(4294967295^1<<b)|(c?1:0)<<b,this._uint32_values_buffer.setUint32(a<<2,d,!0)},c.prototype.GetStr=function(a){return a<this._str_values_len&&this._str_values[a]?this._str_values[a]:""},c.prototype.SetDouble=function(a,b){this.checkIntSize(a+1),this._uint32_values_buffer.setFloat64(a<<2,b,!0)},c.prototype.AddDouble=function(a,b){this.checkIntSize(a+1),this.SetDouble(a,this.GetDouble(a)+b)},c.prototype.SubDouble=function(a,b){this.checkIntSize(a+1),this.SetDouble(a,this.GetDouble(a)-b)},c.prototype.SetUInt32=function(a,b){this.checkIntSize(a),this._uint32_values_buffer.setUint32(a<<2,b,!0)},c.prototype.AddUInt32=function(a,b){this.SetUInt32(a,this.GetUInt32(a)+b)},c.prototype.SubUInt32=function(a,b){this.SetUInt32(a,this.GetUInt32(a)-b)},c.prototype.SetInt32=function(a,b){this.checkIntSize(a),this._uint32_values_buffer.setInt32(a<<2,b,!0)},c.prototype.AddInt32=function(a,b){this.SetInt32(a,this.GetInt32(a)+b)},c.prototype.SubInt32=function(a,b){this.SetInt32(a,this.GetInt32(a)-b)},c.prototype.SetUInt16=function(a,b,c){this.checkIntSize(a),this._uint32_values_buffer.setUint16((a<<2)+(b<<1),c,!0)},c.prototype.AddUInt16=function(a,b,c){this.checkIntSize(a),this.SetUInt16(a,b,this.GetUInt16(a,b)+c)},c.prototype.SubUInt16=function(a,b,c){this.checkIntSize(a),this.SetUInt16(a,b,this.GetUInt16(a,b)-c)},c.prototype.SetInt16=function(a,b,c){this.checkIntSize(a),this._uint32_values_buffer.setInt16((a<<2)+(b<<1),c,!0)},c.prototype.AddInt16=function(a,b,c){this.SetInt16(a,b,this.GetInt16(a,b)+c)},c.prototype.SubInt16=function(a,b,c){this.SetInt16(a,b,this.GetInt16(a,b)-c)},c.prototype.SetFloat=function(a,b){this.checkIntSize(a),this._uint32_values_buffer.setFloat32(a<<2,b,!0)},c.prototype.SetByte=function(a,b,c){this.checkIntSize(a),this._uint32_values_buffer.setInt8((a<<2)+b,c)},c.prototype.AddByte=function(a,b,c){this.SetByte(a,b,this.GetByte(a,b)+c)},c.prototype.SubByte=function(a,b,c){this.SetByte(a,b,this.GetByte(a,b)-c)},c.prototype.SetStr=function(a,b){this.checkStrSize(a),this._str_values[a]=b},c.prototype.ReadValues=function(b,c,d){for(var e=b.GetCount(),f=0;e>f;f++)if(b.GetBit(f)){this.checkIntSize(f);var g=d?null:a.BinLogStru.malloc();g&&(g.typ=a.SyncEvent.TYPE_UINT32,g.index=f,g.old_value=this.GetUInt32(f)),this.SetUInt32(f,c.readUnsignedInt()),g&&(g.value=this.GetUInt32(f),this._events_value.DispatchInt(g.index,g),a.BinLogStru.free(g),this._after_update&&(this._afterUpdateIntObj[f]=!0))}return!0},c.prototype.ReadStringValues=function(b,c,d){for(var e=b.GetCount(),f=0;e>f;f++)if(b.GetBit(f)){this.checkStrSize(f);var g=d?null:a.BinLogStru.malloc();g&&(g.index=f,g.typ=a.SyncEvent.TYPE_STRING,g.old_str=this._str_values[f]),this._str_values[f]=c.readUTF(),g&&(g.str=this._str_values[f],this._events_str_values.DispatchInt(g.index,g),a.BinLogStru.free(g),this._after_update&&(this._afterUpdateStrObj[f]=!0))}return!0},c.prototype.GetCreateMask=function(a){a.Clear();for(var b=0;b<this._uint32_values_len;b++)this.GetUInt32(b)&&a.SetBit(b)},c.prototype.GetCreateStringMask=function(a){a.Clear();for(var b=0;b<this._str_values_len;b++)this._str_values[b]&&this._str_values[b].length>0&&a.SetBit(b)},c.prototype.ApplyAtomicBinLog=function(b){if(b.atomic_opt==a.SyncEvent.ATOMIC_OPT_RESULT_FAILED||b.atomic_opt==a.SyncEvent.ATOMIC_OPT_RESULT_OK)return void this._events_callback.DispatchInt(b.callback_idx,b);if(b._typ==a.SyncEvent.TYPE_STRING)return this.checkStrSize(b._index),void(b._old_value_str!=this._str_values[b._index]?(b._old_value_str=b._value_str,b._value_str=this._str_values[b._index],b._atomic_opt=a.SyncEvent.ATOMIC_OPT_RESULT_FAILED):(b._atomic_opt=a.SyncEvent.ATOMIC_OPT_RESULT_OK,this.ApplyBinLog(b)));this.checkIntSize(b._index);var c=this.GetUInt32(b.index);b.old_value!=c?(b.old_value=b.value,b.value=c,b._atomic_opt=a.SyncEvent.ATOMIC_OPT_RESULT_FAILED):(b._atomic_opt=a.SyncEvent.ATOMIC_OPT_RESULT_OK,this.ApplyBinLog(b))},c.prototype.ApplyBinLog=function(b){var c=b.index;if(b._typ==a.SyncEvent.TYPE_STRING)return this.checkStrSize(c),b.old_str=this._str_values[c]?this._str_values[c]:"",void(this._str_values[c]=b._value_str);if(b.typ==a.SyncEvent.TYPE_DOUBLE?(this._uint32_values_len>c+1&&(b._old_value_dbe=this.GetDouble(c)),this.checkIntSize(c+1)):(b.typ!=a.SyncEvent.TYPE_BIT&&this._uint32_values_len>c&&(b.old_value=this.GetUInt32(c)),this.checkIntSize(c)),b.typ==a.SyncEvent.TYPE_UINT32||b.typ==a.SyncEvent.TYPE_INT32||b.typ==a.SyncEvent.TYPE_FLOAT)switch(b.opt){case a.SyncEvent.OPT_SET:this.SetUInt32(c,b.uint32);
break;case a.SyncEvent.OPT_ADD:this.AddUInt32(c,b.uint32);break;case a.SyncEvent.OPT_SUB:this.SubUInt32(c,b.uint32)}else if(b.typ==a.SyncEvent.TYPE_DOUBLE)switch(b.opt){case a.SyncEvent.OPT_SET:this.SetDouble(c,b["double"]);break;case a.SyncEvent.OPT_ADD:this.AddDouble(c,b["double"]);break;case a.SyncEvent.OPT_SUB:this.SubDouble(c,b["double"])}else if(b.typ==a.SyncEvent.TYPE_BIT)switch(b.opt){case a.SyncEvent.OPT_SET:this.SetBit(c,b.uint32,!0);break;case a.SyncEvent.OPT_UNSET:this.SetBit(c,b.uint32,!1);break;default:throw"JLC_BinLogObject_BIT:op type is error."}else{var d=0;switch(b.typ){case a.SyncEvent.TYPE_UINT16:switch(b.opt){case a.SyncEvent.OPT_SET:this.SetUInt16(c,b.offset,b.uint16);break;case a.SyncEvent.OPT_ADD:this.AddUInt16(c,b.offset,b.uint16);break;case a.SyncEvent.OPT_SUB:this.SubUInt16(c,b.offset,b.uint16);break;default:throw"JLC_BinLogObject_UINT16:unknow OP type"}break;case a.SyncEvent.TYPE_INT16:switch(b.opt){case a.SyncEvent.OPT_SET:this.SetInt16(c,b.offset,b.int16);break;case a.SyncEvent.OPT_ADD:this.AddInt16(c,b.offset,b.int16);break;case a.SyncEvent.OPT_SUB:this.SubInt16(c,b.offset,b.int16);break;default:throw"JLC_BinLogObject_UINT16:unknow OP type"}break;case a.SyncEvent.TYPE_UINT8:switch(d=0,b.opt){case a.SyncEvent.OPT_SET:this.SetByte(c,b.offset,b["byte"]);break;case a.SyncEvent.OPT_ADD:this.AddByte(c,b.offset,b["byte"]);break;case a.SyncEvent.OPT_SUB:this.SubByte(c,b.offset,b["byte"]);break;default:throw"JLC_BinLogObject_UINT8:op type is error."}break;default:throw"JLC_BinLogObject:op type is error."}}},c.prototype.clearAfterUpdateObj=function(){if(this._after_update){for(var a in this._afterUpdateIntObj)delete this._afterUpdateIntObj[a];for(var a in this._afterUpdateStrObj)delete this._afterUpdateStrObj[a]}},c.prototype.ReadFrom=function(b,d,e,f){void 0===e&&(e=null),void 0===f&&(f=!0);var g=Boolean(b&a.SyncEvent.OBJ_OPT_NEW);if(g&&this.clearValues(),(g||b&a.SyncEvent.OBJ_OPT_UPDATE)&&(e&&e.pushNew(),this.clearAfterUpdateObj(),c.tmpIntMask.ReadFrom(d),c.tmpStrMask.ReadFrom(d),this.ReadValues(c.tmpIntMask,d,g),this.ReadStringValues(c.tmpStrMask,d,g),null!=this._after_update&&f&&this._after_update(b,this._afterUpdateIntObj,this._afterUpdateStrObj)),b&a.SyncEvent.OBJ_OPT_BINLOG){c.tmpIntMask.Clear(),c.tmpStrMask.Clear(),this.clearAfterUpdateObj();for(var h=d.readUnsignedShort(),i=0;h>i;i++)this._tmpBinlog.ReadFrom(d),this._tmpBinlog._atomic_opt?this.ApplyAtomicBinLog(this._tmpBinlog):(e&&e.pushBinlog(this._tmpBinlog),this.ApplyBinLog(this._tmpBinlog)),this.OnEventSyncBinLog(this._tmpBinlog);null!=this._after_update&&this._after_update(b,this._afterUpdateIntObj,this._afterUpdateStrObj)}return g&&this.onBaseCreated(),!0},c.prototype.onBaseCreated=function(){},c.prototype.GetHashCode=function(){for(var b=2166136261,c=16777619,d=b,e=0;e<this._uint32_values_len;e++){var f=this.GetUInt32(e);d^=f,d*=c}var g=new a.Pan3dByteArray;g.endian=a.Endian.LITTLE_ENDIAN;var h=b;g.writeUTFBytes(this._guid);for(var e=0;e<g.length;e++)h^=g.getByte(e),h*=c;for(var i in this._str_values)for(g.clear(),g.writeUTFBytes(i?i:""),e=0;e<g.length;e++)h^=g[e],h*=c;return d^h<<1},c.prototype.Equals=function(a){return this._uint32_values_len>a._uint32_values_len?a.checkIntSize(this._uint32_values_len):this._uint32_values_len<a._uint32_values_len&&this.checkIntSize(a._uint32_values_len),this._str_values_len>a._str_values_len?a.checkStrSize(this._str_values_len):this._str_values_len>a._str_values_len&&this.checkStrSize(a._str_values_len),this.GetHashCode()==a.GetHashCode()},c.prototype.DeleteThis=function(){},c.prototype.dispose=function(){this.clearValues(),this._events_value.Clear(),this._events_str_values.Clear(),this._events_mask.Clear(),this._events_callback.Clear(),this._after_update=null},c.addListens_mask=new a.UpdateMask,c.tmpIntMask=new a.UpdateMask,c.tmpStrMask=new a.UpdateMask,c}(a.SyncEvent);a.SyncEventRecorder=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(b){void 0===b&&(b="");var c=a.call(this)||this;return c._ref=0,c.guid=b,c}return __extends(b,a),b.prototype.add_ref=function(a){this._ref=this._ref+a},Object.defineProperty(b.prototype,"ref",{get:function(){return this._ref},enumerable:!0,configurable:!0}),b.prototype.getName=function(){return"ccav"},b.prototype.getGuid=function(){return"991199"},b}(a.SyncEventRecorder);a.GuidObject=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._objs=new Object,c._hashGUID=null,c._u_2_guid=new Object,c._packet_pool=new Array,c._newEvent=new a.NetEventDispatcher(a.NetEventDispatcher.KEY_TYPE_STRING),c._delEvent=new a.NetEventDispatcher(a.NetEventDispatcher.KEY_TYPE_STRING),c._indexer=new a.StringIndexer,c}return __extends(c,b),c.prototype.Get=function(a){return this._objs[a]},Object.defineProperty(c.prototype,"indexer",{get:function(){return this._indexer},enumerable:!0,configurable:!0}),c.prototype.CreateObject=function(b){var c=this._objs[b];return c||(c=new a.GuidObject,c.guid=b,this.AttachObject(c)),c},c.prototype.ReleaseObject=function(a){var b=a.guid,c=this._objs[b];c&&this.DetachObject(c)},c.prototype.ReleaseKey=function(a){var b=this._objs[a];b&&this.DetachObject(b)},c.prototype.AttachObject=function(a){if(null==a)throw new Error("AttachObject,o==null");a.add_ref(1),this._objs[a.guid]=a,this._indexer.insert(a);var b=0;null!=this._hashGUID&&(b=this._hashGUID(a.guid),0!=b&&(this._u_2_guid[b]=a.guid))},c.prototype.DetachObject=function(a){if(a.add_ref(-1),a.ref<=0){this._indexer.remove(a.guid),delete this._objs[a.guid];var b=0;null!=this._hashGUID&&(b=this._hashGUID(a.guid),0!=b&&delete this._u_2_guid[b])}},c.prototype.msgClientsubscription=function(a){},c.prototype.ApplyBlock=function(b){for(;b.bytesAvailable;){var d,e=b.readUnsignedByte();if(e&a.SyncEvent.OBJ_OPT_U_GUID){var f=b.readUnsignedInt();d=this._u_2_guid[f]?this._u_2_guid[f]:"",0==d.length}else d=b.readUTF();if(0==d.length)return!1;var g,h=this.Get(d);if(e&a.SyncEvent.OBJ_OPT_DELETE)this._delEvent.DispatchString(d,h),this.ReleaseKey(d),g=this._indexer.matchObject(h),null!=g&&(g.beginPush(h),g.pushDelete(),g.endPush()),h.dispose();else{var i=0==(e&a.SyncEvent.OBJ_OPT_NEW);h||(e&a.SyncEvent.OBJ_OPT_NEW?(i=!this._objs[d],h=this.CreateObject(d)):h=c.applyBlock_tmp_obj),e&a.SyncEvent.OBJ_OPT_UPDATE,g=this._indexer.matchObject(h),g&&g.beginPush(h),h.ReadFrom(e,b,g,i),g&&g.endPush(),e&a.SyncEvent.OBJ_OPT_NEW&&this._newEvent.DispatchString(h.guid.charAt(0),h)}}return!0},c.prototype.SearchObject=function(a,b){var c=new RegExp(a);b.length=0;for(var d in this._objs)c.test(d)&&b.push(d)},c.prototype.ForEachObject=function(a){for(var b in this._objs)a(this._objs[b])},c.prototype.RegisterCreateEvent=function(a,b){this._newEvent.AddListenString(a,b)},c.prototype.RegisterReleaseEvent=function(a,b){this._delEvent.AddListenString(a,b)},c.prototype.newPacket=function(b){void 0===b&&(b=0);var c=null;return 0==this._packet_pool.length?(c=new a.Pan3dByteArray,c.endian=a.Endian.LITTLE_ENDIAN):(c=this._packet_pool.shift(),c.clear()),b&&c.writeShort(b),c},c.prototype.freePacket=function(a){a.clear(),this._packet_pool.push(a)},c.prototype.clearObjs=function(){for(var b in this._objs){if(this._objs[b]instanceof a.GuidObject){var c=this._objs[b];this.removeObject(c.guid,c),c.dispose()}delete this._objs[b]}},c.prototype.removeObject=function(a,b){this._delEvent.DispatchString(a,b),this.ReleaseKey(a);var c=this._indexer.matchObject(b);null!=c&&(c.beginPush(b),c.pushDelete(),c.endPush())},c.prototype.dispose=function(){this._newEvent.Clear(),this._delEvent.Clear();for(var a in this._objs){var b=this._objs[a];b&&b.dispose()}this._objs=new Object},c.applyBlock_tmp_obj=new a.GuidObject,c}(a.SyncEvent);a.GuidObjectTable=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.open=function(){this._opening||(this._opening=!0)},c.prototype.close=function(){this._opening&&(this._opening=!1,this._curObj=null,this._curEventCount=0,this._eventObjs.length=0,this._eventParams.clear())},c.prototype.SyncEventFilter=function(){this._opening=!1,this._curObj=null,this._curEventCount=0,this._eventParams=new a.Pan3dByteArray,this._eventParams.endian=a.Endian.LITTLE_ENDIAN,this._eventObjs=new Array},c.prototype.beginPush=function(a){return this._curObj&&this.endPush(),this._curObj=a,this._eventObjs.push(a.guid),this._eventParams.writeShort(0),!0},c.prototype.endPush=function(){if(this._curEventCount){var a=this._eventParams.position;this._eventParams.position-=8*this._curEventCount,this._eventParams.position-=2,this._eventParams.writeShort(this._curEventCount),this._curEventCount=0,this._eventParams.position=a}else this._eventObjs.splice(this._eventObjs.length-1,1),this._eventParams.position-=2;this._curObj=null},c.prototype.writeParam=function(a,b,c){this._eventParams.writeShort(a),this._eventParams.writeShort(b),this._eventParams.writeInt(c),this._curEventCount++},c.prototype.pushDelete=function(){this.writeParam(c.EV_DEL,0,0)},c.prototype.pushNew=function(){this.writeParam(c.EV_NEW,0,0)},c.prototype.pushUpdateMask=function(b,d){var e,f=d.GetCount();if(b==a.SyncEvent.TYPE_STRING)for(e=0;f>e;e++)d.GetBit(e)&&this.writeParam(c.EV_UPDATE_S,e,0);else for(e=0;f>e;e++)d.GetBit(e)&&this.writeParam(c.EV_UPDATE_I,e,this._curObj.GetInt32(e))},c.prototype.pushBinlog=function(b){if(0==b._atomic_opt){var d=b._typ==a.SyncEvent.TYPE_STRING?c.EV_UPDATE_S:c.EV_UPDATE_I;this.writeParam(d,b.index,this._curObj.GetInt32(b.index))}},c.prototype.beginPop=function(){this._eventParams.position=0},c.prototype.pop=function(a){if(0==this._eventObjs.length)return"";a.length=0;for(var b=this._eventParams.readShort(),c=0;b>c;c++)a.push(this._eventParams.readShort()),a.push(this._eventParams.readShort()),a.push(this._eventParams.readInt());return this._eventObjs.shift()},c.prototype.endPop=function(){0==this._eventObjs.length&&this._eventParams.clear()},c.prototype.Clear=function(){this._curObj=null,this._eventObjs=null,this._eventParams&&(this._eventParams.clear(),this._eventParams=null)},c.EV_NEW=0,c.EV_DEL=1,c.EV_UPDATE_I=2,c.EV_UPDATE_S=3,c}(a.SyncEvent);a.SyncEventFilter=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.getPrefix=function(a){return a.charAt(0)},a.getGUIDIndex=function(a){var b=a.indexOf(".");return b=b>0?b-1:Number.MAX_VALUE,Number(a.substr(1,b))},a.testUG=function(a,b){var c=a.indexOf(".");if(-1!=c){var d=a.substr(c+1);return d==b}return!1},a.MAP="M",a.UNIT="U",a.STRENGTH="B",a.PLAYER="p",a.BAG="I",a.FACTION="L",a.GROW="X",a.INSTANCE="C",a.SOCIAL="s",a.EMAIL="g",a.GLOBEL="G",a.QUEST="Q",a.LOOT="O",a.TEAM="T",a.GLOBAL_VALUE="G.globalvalue",a.GAME_CONFIG="G.gameconfig",a}();a.ObjectDef=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.optcode=0}return b.read=function(b,c){null==this.input&&(this.input=new a.Pan3dByteArray),this.input=c,b.mstime_now=this.input.readUint32(),b.time_now=this.input.readUint32(),b.open_time=this.input.readUint32()},b.param_count=3,b.optname="onSync_mstime",b}();a.both_sync_mstime=b;var c=function(){function b(){this.optcode=0}return b.read=function(b,c){null==this.input&&(this.input=new a.Pan3dByteArray),this.input=c,b.mstime_now=this.input.readUint32(),b.time_now=this.input.readUint32(),b.open_time=this.input.readUint32()},b.param_count=3,b.optname="onSync_mstime_app",b}();a.both_sync_mstime_app=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(b){this._stream=new a.Pan3dByteArray,this._FUNCS=new Object,this._send_func=b,this._stream.endian=a.Endian.LITTLE_ENDIAN}return b.prototype.getFuncName=function(a){return this._FUNCS[a]?this._FUNCS[a]:null},b}();a.Protocols=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a.prototype.read=function(a){this.pos_x=a.readFloat(),this.pos_y=a.readFloat()},a.prototype.write=function(a){a.writeFloat(this.pos_x),a.writeFloat(this.pos_y)},a}();a.point=b;var c=function(){function a(){this.taxi_text=""}return a.prototype.read=function(a){this.id=a.readInt32(),this.taxi_text=a.readStringByLen(50),this.map_id=a.readUint32(),this.pos_x=a.readUint16(),this.pos_y=a.readUint16()},a.prototype.write=function(a){a.writeInt32(this.id),a.writeStringByLen(this.taxi_text,50),a.writeUint32(this.map_id),a.writeUint16(this.pos_x),a.writeUint16(this.pos_y)},a}();a.taxi_menu_info=c;var d=function(){function a(){this.name="",this.guid="",this.inviteGuid="",this.faction_name=""}return a.prototype.read=function(a){this.name=a.readStringByLen(50),this.faction=a.readUint8(),this.gender=a.readUint8(),this.level=a.readUint16(),this.guid=a.readStringByLen(50),this.head_id=a.readUint32(),this.hair_id=a.readUint32(),this.race=a.readUint8(),this.inviteGuid=a.readStringByLen(50),this.faction_name=a.readStringByLen(50),this.icon=a.readUint8()},a.prototype.write=function(a){a.writeStringByLen(this.name,50),a.writeUint8(this.faction),a.writeUint8(this.gender),a.writeUint16(this.level),a.writeStringByLen(this.guid,50),a.writeUint32(this.head_id),a.writeUint32(this.hair_id),a.writeUint8(this.race),a.writeStringByLen(this.inviteGuid,50),a.writeStringByLen(this.faction_name,50),a.writeUint8(this.icon)},a}();a.char_create_info=d;var e=function(){function a(){this.quest_title=""}return a.prototype.read=function(a){this.quest_id=a.readUint32(),this.quest_icon=a.readUint32(),this.quest_level=a.readUint16(),this.quest_title=a.readStringByLen(50),this.flags=a.readUint32()},a.prototype.write=function(a){a.writeUint32(this.quest_id),a.writeUint32(this.quest_icon),a.writeUint16(this.quest_level),a.writeStringByLen(this.quest_title,50),a.writeUint32(this.flags)},a}();a.quest_option=e;var f=function(){function a(){this.title=""}return a.prototype.read=function(a){this.quest_id=a.readUint32(),this.quest_type=a.readUint8(),this.title=a.readStringByLen(50),this.npc_id=a.readUint32(),this.quest_level=a.readUint32()},a.prototype.write=function(a){a.writeUint32(this.quest_id),a.writeUint8(this.quest_type),a.writeStringByLen(this.title,50),a.writeUint32(this.npc_id),a.writeUint32(this.quest_level)},a}();a.quest_canaccept_info=f;var g=function(){function a(){this.option_title=""}return a.prototype.read=function(a){this.id=a.readInt32(),this.option_icon=a.readInt32(),this.option_title=a.readStringByLen(200)},a.prototype.write=function(a){a.writeInt32(this.id),a.writeInt32(this.option_icon),a.writeStringByLen(this.option_title,200)},a}();a.gossip_menu_option_info=g;var h=function(){function a(){}return a.prototype.read=function(a){this.item=a.readUint32(),this.cooldown=a.readUint32()},a.prototype.write=function(a){a.writeUint32(this.item),a.writeUint32(this.cooldown)},a}();a.item_cooldown_info=h;var i=function(){function a(){}return a.prototype.read=function(a){this.quest_id=a.readUint16(),this.status=a.readUint8()},a.prototype.write=function(a){a.writeUint16(this.quest_id),a.writeUint8(this.status)},a}();a.quest_status=i;var j=function(){function a(){}return a.prototype.read=function(a){this.item_id=a.readUint16(),this.num=a.readUint32()},a.prototype.write=function(a){a.writeUint16(this.item_id),a.writeUint32(this.num)},a}();a.item_reward_info=j;var k=function(){function a(){this.guid="",this.name="",this.faction=""}return a.prototype.read=function(a){this.guid=a.readStringByLen(50),this.name=a.readStringByLen(50),this.faction=a.readStringByLen(50),this.level=a.readUint16(),this.icon=a.readUint16(),this.vip=a.readUint16()},a.prototype.write=function(a){a.writeStringByLen(this.guid,50),a.writeStringByLen(this.name,50),a.writeStringByLen(this.faction,50),a.writeUint16(this.level),a.writeUint16(this.icon),a.writeUint16(this.vip)},a}();a.social_friend_info=k;var l=function(){function a(){this.faction_guid="",this.faction_name="",this.faction_bz="",this.faction_gg=""}return a.prototype.read=function(a){this.faction_guid=a.readStringByLen(50),this.faction_name=a.readStringByLen(50),this.faction_bz=a.readStringByLen(50),this.faction_gg=a.readStringByLen(108),this.level=a.readUint16(),this.icon=a.readUint8(),this.player_count=a.readUint16(),this.minlev=a.readUint16()},a.prototype.write=function(a){a.writeStringByLen(this.faction_guid,50),a.writeStringByLen(this.faction_name,50),a.writeStringByLen(this.faction_bz,50),a.writeStringByLen(this.faction_gg,108),a.writeUint16(this.level),a.writeUint8(this.icon),a.writeUint16(this.player_count),a.writeUint16(this.minlev)},a}();a.faction_info=l;var m=function(){function a(){this.name=""}return a.prototype.read=function(a){this.name=a.readStringByLen(50),this.value=a.readFloat()},a.prototype.write=function(a){a.writeStringByLen(this.name,50),a.writeFloat(this.value)},a}();a.rank_info=m;var n=function(){function a(){}return a.prototype.read=function(a){this.lineNo=a.readUint16(),this.rate=a.readUint8()},a.prototype.write=function(a){a.writeUint16(this.lineNo),a.writeUint8(this.rate)},a}();a.line_info=n;var o=function(){function a(){this.name=""}return a.prototype.read=function(a){this.name=a.readStringByLen(50),this.state=a.readInt8()},a.prototype.write=function(a){a.writeStringByLen(this.name,50),a.writeInt8(this.state)},a}();a.wait_info=o;var p=function(){function a(){this.name=""}return a.prototype.read=function(a){this.index=a.readUint32(),this.name=a.readStringByLen(50),this.level=a.readUint32(),this.weapon=a.readUint32(),this.avatar=a.readUint32(),this.divine=a.readUint32(),this.force=a.readUint32(),this.chest=a.readUint32(),this.gender=a.readUint32()},a.prototype.write=function(a){a.writeUint32(this.index),a.writeStringByLen(this.name,50),a.writeUint32(this.level),a.writeUint32(this.weapon),a.writeUint32(this.avatar),a.writeUint32(this.divine),a.writeUint32(this.force),a.writeUint32(this.chest),a.writeUint32(this.gender)},a}();a.cultivation_rivals_info=p;var q=function(){function a(){this.guid="",this.msg="",this.item_list="",this.reply_list=""}return a.prototype.read=function(a){this.rank=a.readUint32(),this.id=a.readUint32(),this.point=a.readUint32(),this.thank=a.readUint32(),this.reply=a.readUint32(),this.time=a.readUint32(),this.count_id=a.readUint32(),this.guid=a.readStringByLen(50),this.msg=a.readStringByLen(50),this.item_list=a.readStringByLen(150),this.reply_list=a.readStringByLen(100)},a.prototype.write=function(a){a.writeUint32(this.rank),a.writeUint32(this.id),a.writeUint32(this.point),a.writeUint32(this.thank),a.writeUint32(this.reply),a.writeUint32(this.time),a.writeUint32(this.count_id),a.writeStringByLen(this.guid,50),a.writeStringByLen(this.msg,50),a.writeStringByLen(this.item_list,150),a.writeStringByLen(this.reply_list,100)},a}();a.faction_gift_info=q;var r=function(){function a(){this.queen_name="",this.faction_name="",this.guard_name=""}return a.prototype.read=function(a){this.rank=a.readUint32(),this.point=a.readUint32(),this.queen_name=a.readStringByLen(50),this.faction_name=a.readStringByLen(50),this.guard_name=a.readStringByLen(50),this.faction_flag=a.readUint32(),this.queen_vip=a.readUint32(),this.guard_vip=a.readUint32()},a.prototype.write=function(a){a.writeUint32(this.rank),a.writeUint32(this.point),a.writeStringByLen(this.queen_name,50),a.writeStringByLen(this.faction_name,50),a.writeStringByLen(this.guard_name,50),a.writeUint32(this.faction_flag),a.writeUint32(this.queen_vip),a.writeUint32(this.guard_vip)},a}();a.faction_gift_rank_info=r;var s=function(){function a(){}return a.prototype.read=function(a){this.id=a.readUint8(),this.state=a.readUint8(),this.time=a.readUint32(),this.percent=a.readUint8(),this.count=a.readUint16()},a.prototype.write=function(a){a.writeUint8(this.id),a.writeUint8(this.state),a.writeUint32(this.time),a.writeUint8(this.percent),a.writeUint16(this.count)},a}();a.mass_boss_info=s;var t=function(){function a(){this.name=""}return a.prototype.read=function(a){this.name=a.readStringByLen(50),this.dam=a.readDouble()},a.prototype.write=function(a){a.writeStringByLen(this.name,50),a.writeDouble(this.dam)},a}();a.mass_boss_rank_info=t;var u=function(){function a(){this.equip=""}return a.prototype.read=function(a){this.equip=a.readStringByLen(50),this.strength_lv=a.readUint32(),this.refine_rank=a.readUint32(),this.refine_star=a.readUint32(),this.gem1_lv=a.readUint32(),this.gem2_lv=a.readUint32(),this.gem3_lv=a.readUint32()},a.prototype.write=function(a){a.writeStringByLen(this.equip,50),a.writeUint32(this.strength_lv),a.writeUint32(this.refine_rank),a.writeUint32(this.refine_star),a.writeUint32(this.gem1_lv),a.writeUint32(this.gem2_lv),a.writeUint32(this.gem3_lv)},a}();a.equip_info=u;var v=function(){function a(){this.name=""}return a.prototype.read=function(a){this.name=a.readStringByLen(50),this.value=a.readUint32()},a.prototype.write=function(a){a.writeStringByLen(this.name,50),a.writeUint32(this.value)},a}();a.act_rank_info=v;var w=function(){function a(){this.name="",this.guid=""}return a.prototype.read=function(a){this.name=a.readStringByLen(50),this.result=a.readUint32(),this.rank=a.readUint32(),this.guid=a.readStringByLen(50)},a.prototype.write=function(a){a.writeStringByLen(this.name,50),a.writeUint32(this.result),a.writeUint32(this.rank),a.writeStringByLen(this.guid,50)},a}();a.faction_match_info=w;var x=function(){function a(){this.guid="",this.cap_guid="",this.cap_name=""}return a.prototype.read=function(a){this.guid=a.readStringByLen(50),this.cap_guid=a.readStringByLen(50),this.cap_name=a.readStringByLen(50),this.members=a.readUint32()},a.prototype.write=function(a){a.writeStringByLen(this.guid,50),a.writeStringByLen(this.cap_guid,50),a.writeStringByLen(this.cap_name,50),a.writeUint32(this.members)},a}();a.group_search_info=x}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){var b=this;this.connectState=0,this._handlerMap=new Object,this.protocolos=new a.Protocols(function(a){b.send(a)})}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.connect=function(a,b,c){var d=this;this._socket=new WebSocket("ws://"+a+":"+b),this._socket.binaryType="arraybuffer",this._socket.onopen=function(a){d.onopenEvent(a)},this._socket.onmessage=function(a){d.onmessageEvent(a)},this._socket.onclose=function(a){d.oncloseEvent(a)},this._socket.onerror=function(a){d.onErrorEvent(a)},this._connetFun=c,this.connectState=1},b.prototype.onErrorEvent=function(a){console.log("socket error",a),this.connectState=0},b.prototype.onopenEvent=function(a){this._connetFun(),this.connectState=2},b.prototype.onmessageEvent=function(b){var c=new a.Pan3dByteArray(b.data);c.endian=a.Endian.LITTLE_ENDIAN;var d=c.readUnsignedShort();this._handlerMap[d]?this._handlerMap[d](c):console.log("未注册的消息号:"+d+":"+this.protocolos.getFuncName(d))},b.prototype.oncloseEvent=function(a){this.connectState=2,console.log("服务器断开")},b.prototype.reg=function(a){var b=a.getHanderMap();for(var c in b)this._handlerMap[c]=b[c]},b.prototype.unReg=function(a){delete this._handlerMap[a]},b.prototype.send=function(a){this._socket.send(a.buffer)},b.prototype.close=function(){this._socket.close()},b}();a.NetManager=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a}();a.DualQuatFloat32Array=b;var c=function(){function c(){this.inLoop=0,this.inter=new Array,this.bounds=new Array,this.nameHeight=0,this.posAry=new Array,this.hasProcess=!1}return c.prototype.processMesh=function(a){this.hasProcess||(this.makeArrBoneQPAry(a),this.hasProcess=!0)},c.prototype.makeArrBoneQPAry=function(b){this.meshBoneQPAryDic=new a.Dictionary([]);for(var c=0;c<b.meshAry.length;c++){for(var d=this.conleMatrixArr(),e=0;e<d.length;e++)for(var f=d[e],g=0;g<f.length;g++)b.meshAry[c].bindPosMatrixAry[g]&&f[g].prepend(b.meshAry[c].bindPosMatrixAry[g]);var h=this.makeFrameDualQuatFloatArray(b,d);this.meshBoneQPAryDic[b.meshAry[c].uid]=h,this.boneQPAry=h}this.matrixAry=d},c.prototype.getBoneQPAryByMesh=function(a){return this.meshBoneQPAryDic[a.uid]},c.prototype.conleMatrixArr=function(){for(var a=new Array,b=0;b<this.matrixAry.length;b++){for(var c=this.matrixAry[b],d=new Array,e=0;e<c.length;e++)d.push(c[e].clone());a.push(d)}return a},c.prototype.makeFrameDualQuatFloatArray=function(c,d){for(var e=new Array,f=new a.Matrix3D,g=0;g<c.meshAry.length;g++){for(var h=new Array,i=c.meshAry[g].boneNewIDAry,j=0;j<d.length;j++){var k=d[j],l=new b;l.quat=new Float32Array(4*i.length),l.pos=new Float32Array(3*i.length);for(var m=0;m<i.length;m++){var n=k[i[m]].clone(f);n.appendScale(-1,1,1);var o=new a.Quaternion;o.fromMatrix(n);var p=n.position;l.quat[4*m+0]=o.x,l.quat[4*m+1]=o.y,l.quat[4*m+2]=o.z,l.quat[4*m+3]=o.w,l.pos[3*m+0]=p.x,l.pos[3*m+1]=p.y,l.pos[3*m+2]=p.z}h.push(l)}e.push(h)}return e},c}();a.AnimData=c}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c.meshAry=new Array,c.fileScale=1,c.tittleHeight=0,c.hitBox=new a.Vector2D(0,0),c.type=0,c.animDic=new Object,c.ready=!1,c.hasDestory=!1,c}return __extends(c,b),c.prototype.makeHitBoxItem=function(){this.hitPosItem=new Array;var b=this.hitBox.x,c=this.hitBox.y,d=new a.Vector3D(-b,0,-b),e=new a.Vector3D(b,0,-b),f=new a.Vector3D(b,0,b),g=new a.Vector3D(-b,0,b);this.hitPosItem.push(d),this.hitPosItem.push(e),this.hitPosItem.push(f),this.hitPosItem.push(g);var h=new a.Vector3D(-b,c,-b),i=new a.Vector3D(b,c,-b),j=new a.Vector3D(b,c,b),k=new a.Vector3D(-b,c,b);this.hitPosItem.push(h),this.hitPosItem.push(i),this.hitPosItem.push(j),this.hitPosItem.push(k)},c.prototype.addMesh=function(a){a.uid=this.meshAry.length,this.meshAry.push(a)},c.prototype.loadParticle=function(){},c.prototype.loadMaterial=function(a){void 0===a&&(a=null);for(var b=0;b<this.meshAry.length;b++)this.loadByteMeshDataMaterial(this.meshAry[b],a)},c.prototype.loadByteMeshDataMaterial=function(b,c){void 0===c&&(c=null);var d=a.Scene_data.fileRoot+b.materialUrl;d=d.replace("_byte.txt",".txt"),d=d.replace(".txt","_byte.txt"),a.MaterialManager.getInstance().getMaterialByte(d,function(d){b.material=d,d.usePbr?a.MeshDataManager.getInstance().uploadPbrMesh(b,d.useNormal):(d.lightProbe||d.directLight)&&a.MeshDataManager.getInstance().uploadPbrMesh(b,!1),b.materialParamData&&(b.materialParam=new a.MaterialBaseParam,b.materialParam.setData(b.material,b.materialParamData)),c&&c(d)},null,!0,a.MaterialAnimShader.MATERIAL_ANIM_SHADER,a.MaterialAnimShader)},c.prototype.setAction=function(b,c){this.animUrlAry=new Array;for(var d=0;d<b.length;d++){var e=b[d],f=c+b[d],g=a.AnimManager.getInstance().getAnimDataImmediate(f);g.processMesh(this),this.animDic[e]=g,this.animUrlAry.push(f)}},c.prototype.destory=function(){if(this.allParticleDic){for(var b in this.allParticleDic)a.ParticleManager.getInstance().releaseUrl(b);this.allParticleDic=null}for(var c=0;c<this.meshAry.length;c++)this.meshAry[c].destory();this.meshAry.length=0,this.meshAry=null,this.boneSocketDic=null;for(var c=0;c<this.animUrlAry.length;c++)a.AnimManager.getInstance().clearAnim(this.animUrlAry[c]);for(var b in this.animDic)delete this.animDic[b];this.animDic=null,this.hasDestory=!0},c.prototype.clone=function(){var a=new c;for(var b in this)a[b]=this[b];a.meshAry=[];for(var d=0;d<this.meshAry.length;d++)a.meshAry.push(this.meshAry[d].clone());return a},c}(a.ResCount);a.SkinMesh=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){}return a}();a.BoneSocketData=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(b,c,d){return void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),a.call(this)||this}return __extends(b,a),b}(a.Object3D);a.CollisionVo=b;var c=function(){function a(){}return a}();a.CollisionItemVo=c;var d=function(){function a(){}return a.Polygon=0,a.BOX=1,a.BALL=2,a.Cylinder=3,a.Cone=4,a}();a.CollisionType=d}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(a,b){this.radius=a,this.height=b}return a}();a.CapsuleVo=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this.sunDirect=new Array(0,1,0),this.sunColor=new Array(2,0,0),this.ambientColor=new Array(0,0,0)}return a.prototype.setData=function(a,b,c){this.sunDirect[0]=a.x,this.sunDirect[1]=a.y,this.sunDirect[2]=a.z,this.sunColor[0]=b.x,this.sunColor[1]=b.y,this.sunColor[2]=b.z,this.ambientColor[0]=c.x,this.ambientColor[1]=c.y,this.ambientColor[2]=c.z},a}();a.LightVo=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v3Color")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec3 v3Color;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec4 colorData;void main(void){   vec4 vt0= vec4(v3Position, 1.0);   colorData =vec4(v3Color,1) ;   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a=" precision mediump float;\nvarying vec4 colorData;\nvoid main(void)\n{\ngl_FragColor =colorData;\n}";return a},b.LineShader="LineShader",b}(a.Shader3D);a.LineDisplayShader=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.baseColor=new a.Vector3D(1,0,0),c.objData=new a.ObjData,c.shader=a.ProgrmaManager.getInstance().getProgram(a.LineDisplayShader.LineShader),c.program=c.shader.program,c.makeLineMode(new a.Vector3D(0,0,0),new a.Vector3D(100,0,0),new a.Vector3D),
c.makeLineMode(new a.Vector3D(0,0,0),new a.Vector3D(100,0,100),new a.Vector3D),c.makeLineMode(new a.Vector3D(100,0,0),new a.Vector3D(100,0,100),new a.Vector3D),c.upToGpu(),c}return __extends(c,b),c.prototype.makeLineMode=function(a,b,c){void 0===c&&(c=null),this.lineVecPos&&this.lineIndex||this.clear(),c&&(this.baseColor=c),this.lineVecPos.push(a.x,a.y,a.z),this.lineVecPos.push(b.x,b.y,b.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineIndex.push(this.lineIndex.length+0,this.lineIndex.length+1)},c.prototype.clear=function(){this.lineVecPos=new Array,this.lineIndex=new Array,this.lineColor=new Array,this.objData.indexBuffer&&(this.objData.indexBuffer=null)},c.prototype.upToGpu=function(){this.lineIndex.length&&(this.objData.treNum=this.lineIndex.length,this.objData.vertexBuffer=a.Scene_data.context3D.uploadBuff3D(this.lineVecPos),this.objData.normalsBuffer=a.Scene_data.context3D.uploadBuff3D(this.lineColor),this.objData.indexBuffer=a.Scene_data.context3D.uploadIndexBuff3D(this.lineIndex))},c.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(a.Scene_data.context3D.setProgram(this.program),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",a.Scene_data.viewMatrx3D.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",a.Scene_data.cam3D.cameraMatrix.m),a.Scene_data.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),a.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),a.Scene_data.context3D.setVa(1,3,this.objData.normalsBuffer),a.Scene_data.context3D.drawLine(this.objData.indexBuffer,this.objData.treNum))},c}(a.Display3D);a.LineDisplaySprite=b;var c=function(a){function c(){var b=a.call(this)||this;return b.itemSprite||(b.itemSprite=new Array),b}return __extends(c,a),c.prototype.makeLineMode=function(b,c,d){void 0===d&&(d=null),a.prototype.makeLineMode.call(this,b,c,d);var e=this.getSprite();e.makeLineMode(b,c,d)},c.prototype.getSprite=function(){var a=Math.floor(this.lineIndex.length/1e4);if(!this.itemSprite[a]){var c=new b;c.clear(),c.baseColor=this.baseColor,this.itemSprite.push(c)}return this.itemSprite[a]},c.prototype.update=function(){for(var a=0;a<this.itemSprite.length;a++)this.itemSprite[a].posMatrix=this.posMatrix,this.itemSprite[a].update()},c.prototype.upToGpu=function(){for(var a=0;a<this.itemSprite.length;a++)this.itemSprite[a].upToGpu()},c.prototype.clear=function(){a.prototype.clear.call(this),this.itemSprite||(this.itemSprite=new Array);for(var b=0;this.itemSprite&&b<this.itemSprite.length;b++)this.itemSprite[b].clear()},c}(b);a.MulLineSprite=c;var d=function(b){function c(){var a=b.call(this)||this;return a.makeGridData(),a}return __extends(c,b),c.prototype.makeGridData=function(){var b=100,c=10,d=b/c;this.clear();var e,f;e=new a.Vector3D(0,0,+b),f=new a.Vector3D(0,0,-b),this.makeLineMode(e,f,new a.Vector3D(0,0,1,1)),e=new a.Vector3D(+b,0,0),f=new a.Vector3D(-b,0,0),this.makeLineMode(e,f,new a.Vector3D(1,0,0,1)),this.baseColor=new a.Vector3D(128/255,128/255,128/255,1);for(var g=1;c>=g;g++)e=new a.Vector3D(+g*d,0,+b),f=new a.Vector3D(+g*d,0,-b),this.makeLineMode(e,f),e=new a.Vector3D(-g*d,0,+b),f=new a.Vector3D(-g*d,0,-b),this.makeLineMode(e,f),e=new a.Vector3D(+b,0,+g*d),f=new a.Vector3D(-b,0,+g*d),this.makeLineMode(e,f),e=new a.Vector3D(+b,0,-g*d),f=new a.Vector3D(-b,0,-g*d),this.makeLineMode(e,f);this.upToGpu()},c}(b);a.GridLineSprite=d}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function a(){this.drawNum=0,this.fpsStr=""}return a.update=function(){},a.prototype.getStr=function(){return a.fpsNowNum=Math.min(this.drawNum,600),this.fpsStr="Fps:"+String(a.fpsNowNum)+"-"+a.tipStr,this.fpsStr},a.addFps=0,a.fpsNowNum=0,a.tipStr="",a}();a.FpsMc=b;var c=function(){function c(){this.lastTime=0,this.cPos=new a.Vector2D(150,100)}return c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.init=function(c,d){var e=this;this.canvas2D=c,this.loadCav=d,this.fps=new b,this.canvasUi=this.canvas2D.getContext("2d"),this.loadCtx=this.loadCav.getContext("2d"),a.TimeUtil.addFrameTick(function(){e.upData()})},c.prototype.showLoadInfo=function(a){},c.prototype.removeShowLoad=function(){this.loadCav.parentElement&&this.loadCav.parentElement.removeChild(this.loadCav),c.showFps=!0},c.prototype.upData=function(){if(this.fps.drawNum++,!(this.lastTime>=a.TimeUtil.getTimer()-1e3)){if(this.lastTime=a.TimeUtil.getTimer(),!c.showFps)return void this.canvasUi.clearRect(0,0,this.canvas2D.width,this.canvas2D.height);this.canvasUi.font="40px Helvetica";var b=this.canvasUi.measureText(this.fps.getStr()).width;this.canvas2D.width=b,this.canvas2D.height=30,this.canvasUi.clearRect(50,0,this.canvas2D.width-50,this.canvas2D.height),this.canvasUi.fillStyle="#000000",this.canvasUi.fillRect(50,0,this.canvas2D.width-50,this.canvas2D.height),this.canvasUi.font="30px Helvetica",this.canvasUi.fillStyle="#ffffff",this.canvasUi.fillText(this.fps.getStr(),50,0),this.fps.drawNum=0}},c.prototype.makeXyzLine=function(){var b=new a.Vector3D(80,0,0),c=new a.Vector3D(0,70,0),d=new a.Vector3D(0,0,80),e=new a.Matrix3D;e.appendRotation(a.Scene_data.cam3D.rotationY,a.Vector3D.Y_AXIS),e.appendRotation(a.Scene_data.cam3D.rotationX,a.Vector3D.X_AXIS),b=e.transformVector(b),c=e.transformVector(c),d=e.transformVector(d),this.drawLine(new a.Vector2D(0,0),new a.Vector2D(b.x,-b.y),"#ff0000"),this.drawLine(new a.Vector2D(0,0),new a.Vector2D(c.x,-c.y),"#00ff00"),this.drawLine(new a.Vector2D(0,0),new a.Vector2D(d.x,-d.y),"#0000ff"),this.canvasUi.font="12px Helvetica",this.canvasUi.fillStyle="#ff0000",this.canvasUi.fillText("x",b.x+this.cPos.x,-b.y+this.cPos.y),this.canvasUi.fillStyle="#00ff00",this.canvasUi.fillText("y",c.x+this.cPos.x,-c.y+this.cPos.y),this.canvasUi.fillStyle="#0000ff",this.canvasUi.fillText("z",d.x+this.cPos.x,-d.y+this.cPos.y)},c.prototype.drawLine=function(a,b,c){void 0===c&&(c="red"),this.canvasUi.beginPath(),this.canvasUi.lineWidth=2,this.canvasUi.strokeStyle=c,this.canvasUi.moveTo(a.x+this.cPos.x,a.y+this.cPos.y),this.canvasUi.lineTo(b.x+this.cPos.x,b.y+this.cPos.y),this.canvasUi.stroke()},c.prototype.resetSize=function(){this.cPos=new a.Vector2D(150,a.Scene_data.stageHeight-100)},c.showFps=!1,c}();a.FpsStage=c}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.processorMap=new Object}return b.prototype.getModuleName=function(){throw new Error("module必须复写命名")},b.prototype.listProcessors=function(){return null},b.prototype.registerProcessors=function(){var a=this.listProcessors();if(null!=a&&a.length>0)for(var b=0;b<a.length;b++)this.registerProcessor(a[b])},b.prototype.registerProcessor=function(b){if(null!=this.processorMap[b.getName()])throw new Error("同一Module不能注册两个相同的Processor");this.processorMap[b.getName()]=b,b.registerEvents(),a.NetManager.getInstance().reg(b)},b.registerModule=function(a){if(null!=b.moduleMap[a.getModuleName()])throw new Error("不能注册两个相同的Module");b.moduleMap[a.getModuleName()]=a,a.registerProcessors()},b.moduleMap=new Object,b}();a.Module=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.prototype.getName=function(){throw new Error("process必须复写命名")},b.prototype.receivedModuleEvent=function(a){},b.prototype.listenModuleEvents=function(){return null},b.prototype.registerEvents=function(){var b=this.listenModuleEvents();null!=b&&b.length>0&&a.ModuleEventManager.addEvents(b,this.receivedModuleEvent,this)},b.prototype.getHanderMap=function(){var a=new Object;return a},b}();a.Processor=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){}return b.addEvents=function(a,c,d){for(var e=0;e<a.length;e++)b._instance.addEventListener(a[e].type,c,d)},b.dispatchEvent=function(a,c){void 0===c&&(c=null),c&&(a.data=c),b._instance.dispatchEvent(a)},b._instance=new a.EventDispatcher,b}();a.ModuleEventManager=b}(Pan3d||(Pan3d={}));var GameVersion=function(){function a(){}return a.init=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++){var d=b[c].split("	");2==d.length&&(this._dic[d[0]]=d[1])}},a.getVersion=function(a){return this._dic[a]},a._dic=new Object,a}(),Pan3d;!function(a){var b=function(){function a(){}return a.STANAD="stand",a.WALK="walk",a.DEATH="death",a.JUMP="jump",a.SIT="sit",a.ATTACK_01="attack_01",a.ATTACK_02="attack_02",a.ATTACK_03="attack_03",a.ATTACK_04="attack_04",a.ATTACK_05="attack_05",a.ATTACK_06="attack_06",a.ATTACK_010="attack_010",a.ATTACK_020="attack_020",a.STAND_MOUNT="stand_mount_01",a.WALK_MOUNT="walk_mount_01",a.s_attack_01="s_attack_01",a}();a.CharAction=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.path=new Array,b.isMain=!1,b.originalRotation=0,b}return __extends(b,a),b}(a.GuidObject);a.Unit=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._avatar=-1,b._visible=!0,b}return __extends(b,a),Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0}),b.prototype.setAvatar=function(a){this._avatar!=a&&(this._avatar=a,this.setRoleUrl(this.getSceneCharAvatarUrl(a)))},b.prototype.update=function(){this.visible&&a.prototype.update.call(this),this._shadow&&(this._shadow._visible=this.visible)},b.prototype.getSceneCharAvatarUrl=function(a){getRoleUrl(String(a));return getRoleUrl(String(a))},b.prototype.getSceneCharWeaponUrl=function(a,b){return void 0===b&&(b=""),getModelUrl(String(a+b))},b}(a.Display3dMovie);a.SceneBaseChar=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.speedTX=.075,a.life=0,a.isMount=!1,a._px=0,a._py=0,a._pz=0,a._pRotationY=0,a._isBoss=!1,a._optimization=!1,a._weaponNum=-1,a._wingID=-1,a.lastBloodcolorType=0,a.tittleHeight=50,a.toRotationY=0,a._resultVisible=!0,a._showHitBox=!1,a.triIndex=[0,1,2,0,2,3,4,5,6,4,6,7,0,4,5,0,5,1,1,5,6,1,6,2,2,6,7,2,7,3,3,7,4,3,4,0],a.shadow=!0,a.skillitem=new Array,a}return __extends(c,b),Object.defineProperty(c.prototype,"isDeath",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isBoss",{get:function(){return this._isBoss},set:function(a){this._isBoss=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"px",{get:function(){return this._px},set:function(a){this._px=a,this.isMount?(this.mountChar.x=a,this._shadow&&(this._shadow.x=a)):this.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"py",{get:function(){return this._py},set:function(a){this._py=a,this.isMount?(this.mountChar.y=a,this._shadow&&(this._shadow.y=a)):this.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pz",{get:function(){return this._pz},set:function(a){this._pz=a,this.isMount?(this.mountChar.z=a,this._shadow&&(this._shadow.z=a)):this.z=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"forceRotationY",{set:function(a){this.pRotationY=a,this.rotationY=a,this.toRotationY=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pRotationY",{get:function(){return this._pRotationY},set:function(a){this._pRotationY=a,this.isMount?this.mountChar.rotationY=a:this.rotationY=a},enumerable:!0,configurable:!0}),c.prototype.play=function(c,d,e){return void 0===d&&(d=0),void 0===e&&(e=!0),this.isSinging&&(d=0,c==a.CharAction.WALK||c==a.CharAction.STANAD)?!0:this.isMount?(this.mountChar.visible=Boolean(c!=a.CharAction.JUMP),c==a.CharAction.STANAD?b.prototype.play.call(this,a.CharAction.STAND_MOUNT):c==a.CharAction.WALK?b.prototype.play.call(this,a.CharAction.WALK_MOUNT):this.mountChar.visible?b.prototype.play.call(this,a.CharAction.STAND_MOUNT):b.prototype.play.call(this,a.CharAction.JUMP),this.mountChar.play(c,d,e)):b.prototype.play.call(this,c,d,e)},c.prototype.getCurrentAction=function(){return this.isMount?this.mountChar.curentAction:this.curentAction},c.prototype.getSceneCharAvatarUrl=function(a){var b=String(a);if(0==a)throw new Error("衣服为getSceneCharAvatarUrl");var c=getRoleUrl(b);return c},c.prototype.setMount=function(){},c.prototype.setWeapon=function(a){this._weaponNum!=a&&(this._weaponNum=a,0>=a&&this.removePart(c.WEAPON_PART))},c.prototype.setWeaponByAvatar=function(a,b){void 0===b&&(b="")},c.prototype.addTestWeapon=function(){this.addPart("test"+Math.random(),c.WEAPON_DEFAULT_SLOT,this.getSceneCharWeaponUrl(Math.random()>.5?5202:5201))},c.prototype.refreshTittle=function(){this.refreshPos()},c.prototype.showName=function(b){void 0===b&&(b=null);var c=this.unit.getName().split(","),d=c[c.length-1];b="[00ff00]";var e=b+d;this._charNameVo?this._charNameVo.name=e:this._charNameVo=a.BloodManager.getInstance().getCharNameMeshVo(e),this.refreshPos()},c.prototype.showBlood=function(b){void 0===b&&(b=0),this.lastBloodcolorType=b,this._charBloodVo?this._charBloodVo.colortype=b:(this._charBloodVo=a.BloodManager.getInstance().getBloodLineMeshVo(),this._charBloodVo.colortype=b),this.refreshPos()},c.prototype.onMeshLoaded=function(){this._skinMesh&&(this.tittleHeight=this._skinMesh.tittleHeight)},c.prototype.refreshPos=function(){this._charBloodVo&&(this._charBloodVo.pos.x=this.px,this.isMount?this._charBloodVo.pos.y=this.py+this.tittleHeight-6+20:this._charBloodVo.pos.y=this.py+this.tittleHeight-6,this._charBloodVo.pos.z=this.pz,this._charBloodVo.visible=this._resultVisible),this._charNameVo&&(this._charNameVo.pos.x=this.px,this.isMount?this._charNameVo.pos.y=this.py+this.tittleHeight+20:this._charNameVo.pos.y=this.py+this.tittleHeight,this._charNameVo.pos.z=this.pz,this._charNameVo.visible=this._resultVisible),this._charTitleVo&&(this._charTitleVo.pos.x=this.px,this.isMount?this._charTitleVo.pos.y=this.py+this.tittleHeight+20+10:this._charTitleVo.pos.y=this.py+this.tittleHeight+10,this._charTitleVo.pos.z=this.pz,this._charTitleVo.visible=this._resultVisible)},Object.defineProperty(c.prototype,"walkPath",{set:function(b){0!=b.length&&((this.curentAction==a.CharAction.STANAD||this.curentAction==a.CharAction.STAND_MOUNT)&&this.play(a.CharAction.WALK),this._walkPath=b,this.setTarget(),this._speedDirect=null)},enumerable:!0,configurable:!0}),c.prototype.fixAstartData=function(b){if(this._walkPath)for(var c=0;c<this._walkPath.length;c++)this._walkPath[c].x+=b.x,this._walkPath[c].z=b.y-this._walkPath[c].z,this._walkPath[c].y=a.AstarUtil.getHeightByPos(this._walkPath[c]);this.px+=b.x,this.pz=b.y-this.pz,this._astatTopos&&(this._astatTopos.x+=b.x,this._astatTopos.z=b.y-this._astatTopos.z,this.setAstarNrmAndRotation()),this.refreshY()},c.prototype.applyWalk=function(b){if(b&&2==b.length&&b[0].x==b[1].x&&b[0].y==b[1].y){this._speedDirect=null,this._walkPath=null,this.curentAction==a.CharAction.WALK&&this.play(a.CharAction.STANAD);var c=a.AstarUtil.getWorldPosByStart2D(b[0]);return this.px=c.x,void(this.pz=c.z)}this.walkPath=a.AstarUtil.Path2dTo3d(b)},Object.defineProperty(c.prototype,"moveToPos2D",{set:function(b){this._walkPath=null,this.play(this._defaultAction);var c=a.AstarUtil.getWorldPosByStart2D(b);this.px=c.x,this.pz=c.z,this.refreshY()},enumerable:!0,configurable:!0}),c.prototype.stopToPos=function(b){var c=a.AstarUtil.getWorldPosByStart2D(b),d=new Array;d.push(c),this.walkPath=d},c.prototype.moveTile=function(b,c){this.moveToPos2D=new a.Vector2D(b,c)},c.prototype.updateFrame=function(a){b.prototype.updateFrame.call(this,a)},c.prototype.refreshY=function(){this.py=a.AstarUtil.getHeightByPos(this.getCurrentPos()),this.refreshPos()},c.prototype.refreshHP=function(){},c.prototype.rotationToNew=function(a,b){void 0===b&&(b=1);var c=a-this.pRotationY;if(0!=c){if(1>c)return void(this.pRotationY=a);var d=((a-this.pRotationY)%360+360)%360;d>180?this.pRotationY-=(360-d)/b:this.pRotationY+=d/b}},Object.defineProperty(c.prototype,"speedUseTime",{set:function(a){this.speedTX=.01*(a/10)},enumerable:!0,configurable:!0}),c.prototype.refreshSpeed=function(){this.speedUseTime=1},c.prototype.walkAstar=function(b){this.unit&&this.unit.isMain;var c=Math.min(b,50),d=a.Vector3D.distance(new a.Vector3D(this.px,0,this.pz),this._astatTopos);if(d>5){var e=c*this.speedTX;if(e>d){this.px=this._astatTopos.x,this.pz=this._astatTopos.z;var f=(e-d)/this.speedTX;this.walkAstar(f)}else this.px+=this._astarDirect.x*e,this.pz+=this._astarDirect.z*e}else this.setTarget(),this._walkPath?this.walkAstar(b):(this.px=this._astatTopos.x,this.pz=this._astatTopos.z,this.walkComplete())},c.prototype.walkComplete=function(){this.walkCompleteBackFun&&this.walkCompleteBackFun()},c.prototype.setTarget=function(){if(this._walkPath){if(0==this._walkPath.length)return this._walkPath=null,void this.play(a.CharAction.STANAD);this._astatTopos=this._walkPath.shift(),this.setAstarNrmAndRotation()}},c.prototype.setAstarNrmAndRotation=function(){this._astatTopos&&(this._astarDirect=this._astatTopos.subtract(this.getCurrentPos()),this._astarDirect.y=0,this._astarDirect.normalize(),a.Vector3D.distance(this.getCurrentPos(),this._astatTopos)>10&&(this.toRotationY=this.mathAngle(this._astatTopos.z,this._astatTopos.x,this.pz,this.px)+180))},c.prototype.mathAngle=function(a,b,c,d){return 180*Math.atan2(d-b,c-a)/Math.PI},c.prototype.setSpeedDirect=function(b){this.isDeath||(this._speedDirect=b,(this.curentAction==a.CharAction.STANAD||this.curentAction==a.CharAction.STAND_MOUNT)&&this.play(a.CharAction.WALK),this._walkPath=null)},c.prototype.stopMove=function(){this._speedDirect=null,this._walkPath=null,this.play(a.CharAction.STANAD)},c.prototype.getEndWalkPathPos=function(){return this._walkPath?this._walkPath[this._walkPath.length-1]:null},c.prototype.watch=function(a,b){if(void 0===b&&(b=!1),a){var c=a.x-this.px,d=a.z-this.pz,e=Math.sqrt(c*c+d*d);c/=e,d/=e;var f=Math.asin(c)/Math.PI*180;0>=d&&(f=180-f),isNaN(f)||(this.forceRotationY=f)}},c.prototype.getCurrentPos=function(){return new a.Vector3D(this.px,this.py,this.pz)},c.prototype.getAstarPos=function(){return a.AstarUtil.getGrapIndexByPos(this.getCurrentPos())},c.prototype.changeAction=function(c){if(this.unit&&this.unit.isMain)switch(c){case a.CharAction.ATTACK_01:this.play(a.CharAction.ATTACK_010,2);break;case a.CharAction.ATTACK_02:this.play(a.CharAction.ATTACK_020,2);break;default:b.prototype.changeAction.call(this,c)}else b.prototype.changeAction.call(this,c)},c.prototype.playSkill=function(b){this._walkPath=null,a.SkillManager.getInstance().playSkill(b),this.skillVo=b},c.prototype.msgSpellStop=function(){this.skillVo&&(this.skillVo.removeSkillForce(),this.changeAction(this._defaultAction),this.skillVo=null),this.isSinging=!1},c.prototype.destory=function(){this._hasDestory||(b.prototype.destory.call(this),this.destoryName(),this._isBoss,this.skillVo&&(this.skillVo.removeSkillForce(),this.skillVo=null),this._wingDisplay&&this._wingDisplay.destory(),this._hasDestory=!0)},c.prototype.destoryName=function(){this._charNameVo&&(this._charNameVo.destory(),this._charNameVo=null),this._charBloodVo&&(this._charBloodVo.destory(),this._charBloodVo=null),this._charTitleVo&&(this._charTitleVo.destory(),this._charTitleVo=null)},c.prototype.removeStage=function(){b.prototype.removeStage.call(this),this._charNameVo&&(this._charNameVo.visible=!1),this._charBloodVo&&(this._charBloodVo.visible=!1),this.mountChar&&a.SceneManager.getInstance().removeMovieDisplay(this.mountChar),this._wingDisplay&&a.SceneManager.getInstance().removeMovieDisplay(this._wingDisplay)},c.prototype.addStage=function(){b.prototype.addStage.call(this),this._charNameVo&&(this._charNameVo.visible=!0),this._charBloodVo&&(this._charBloodVo.visible=!0),this.mountChar&&a.SceneManager.getInstance().addMovieDisplay(this.mountChar),this._wingDisplay&&a.SceneManager.getInstance().addMovieDisplay(this._wingDisplay)},c.prototype.math_distance=function(b){return a.MathClass.math_distance(this.px,this.pz,b.x,b.z)},Object.defineProperty(c.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a,this.applyVisible()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"optimization",{get:function(){return this._optimization},set:function(a){this._optimization=a,this.applyVisible()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"resultVisible",{get:function(){return this._resultVisible},enumerable:!0,configurable:!0}),c.prototype.applyVisible=function(){var a=this._visible;if(a=this._visible?this._optimization?!1:!0:!1,this._partDic&&this._partDic[c.WEAPON_PART])for(var b=0,d=this._partDic[c.WEAPON_PART];b<d.length;b++){var e=d[b];e.sceneVisible=a}this._wingDisplay&&(this._wingDisplay.visible=a),a||this.destoryName(),this.shadow=a,this._resultVisible=a},c.prototype.update=function(){if(this._skinMesh&&!this._optimization&&(b.prototype.update.call(this),this._showHitBox)){if(!this.lineSprite){a.ProgrmaManager.getInstance().registe(a.LineDisplayShader.LineShader,new a.LineDisplayShader),this.lineSprite=new a.LineDisplaySprite,this.lineSprite.clear();for(var c=0;c<this.triIndex.length/3;c++){var d=this._skinMesh.hitPosItem[this.triIndex[3*c+0]],e=this._skinMesh.hitPosItem[this.triIndex[3*c+1]],f=this._skinMesh.hitPosItem[this.triIndex[3*c+2]];this.lineSprite.makeLineMode(d,e),this.lineSprite.makeLineMode(e,f),this.lineSprite.makeLineMode(f,d)}this.lineSprite.upToGpu()}this.lineSprite.posMatrix=this.posMatrix.clone(),this.lineSprite.update()}},c.prototype.mouseClik=function(b,c){var d=a.Scene_data.cam3D.cameraMatrix.transformVector(this.getCurrentPos());if(d.z<a.Scene_data.cam3D.distance/3)return null;var e=a.MathUtil.math3DWorldtoDisplay2DPos(c);if(this._skinMesh){this.hitBox2DItem||(this.hitBox2DItem=new Array),this.hitBox2DItem.length=0;for(var f=0;f<this._skinMesh.hitPosItem.length;f++){var g=this.posMatrix.transformVector(this._skinMesh.hitPosItem[f]);this.hitBox2DItem.push(a.MathUtil.math3DWorldtoDisplay2DPos(g))}for(var h=0;h<this.triIndex.length/3;h++)if(a.TestTriangle.baseTri.p1=this.hitBox2DItem[this.triIndex[3*h+0]],a.TestTriangle.baseTri.p2=this.hitBox2DItem[this.triIndex[3*h+1]],a.TestTriangle.baseTri.p3=this.hitBox2DItem[this.triIndex[3*h+2]],a.TestTriangle.baseTri.checkPointIn(e))return!0}else if(a.Vector2D.distance(e,a.MathUtil.math3DWorldtoDisplay2DPos(this.posMatrix.position))<20)return!0;return!1},c.WEAPON_PART="weapon",c.WEAPON_DEFAULT_SLOT="w_01",c.MOUNT_SLOT="mount_01",c.WING_SLOT="wing_01",c.SEL_PART="select",c.QUEST_ICON="questicon",c.NONE_SLOT="none",c.Defaul_Man_Avatar=2002,c.Defaul_WoMan_Avater=2012,c}(a.SceneBaseChar);a.SceneChar=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.setData=function(a,b){if(b>0){var c={},d=c.mountID;return void this.setAvatar(d)}if(a>0){var c={},d=c.mountID;this.setAvatar(d)}},b}(a.SceneBaseChar);a.MountChar=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Pan3d;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.Processor);a.BaseProcessor=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.dataReady=!1,this.uiReadyNum=0,this.uiAllNum=0}return b.prototype.init=function(){var c=this;a.TextureManager.getInstance().getTexture(a.Scene_data.fileRoot+"ui/load/001.jpg",function(a){}),b.outNet&&(b.GM=!1);var d=new Array;d.push({xmlurl:"ui/arpgui/textlist.txt",picurl:"ui/arpgui/textlist.png",name:a.UIData.textlist}),d.push({xmlurl:"ui/uidata/public/public.txt",picurl:"ui/uidata/public/public.png",name:a.UIData.publicUi}),this.uiAllNum=a.UIData.init(d,function(){c.loadAll()},function(b){c.uiReadyNum=b,c.dataReady&&a.FpsStage.getInstance().showLoadInfo("读取UI数据："+c.uiReadyNum+"/"+c.uiAllNum)})},b.prototype.loadAll=function(){this.uiReadyNum==this.uiAllNum&&this.dataReady&&(this.loadDataComplet(),a.FpsStage.getInstance().showLoadInfo("正在连接服务器"),b.ready=!0)},b.prototype.loadDataComplet=function(){b.outNet&&(b.GM=!1)},b.outNet=!1,b.GM=!0,b.ready=!1,b.appVersion=0,b}();a.GameStart=b}(Pan3d||(Pan3d={}));var Pan3d;!function(a){var b=function(){function b(){this.ready=!1,this.resetPos=new a.Vector2D(150,400),this.bindPos=new a.Vector2D,this.useMouseEvent=!0,this.lastMouseEvetTime=0,this.nextSendTime=0,this.skipNum=0,this.isFristTouchMove=!0,this.yaoganIdentifier=-1}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.setBtn=function(a,b){this.b_yaogan_bar=a,this.b_yaogan_bg=b,this.ready=!0},b.prototype.addMouseEvent=function(){var b=this;a.Scene_data.isPc?(document.addEventListener(a.MouseType.MouseDown,function(a){b.onMouse(a)}),document.addEventListener(a.MouseType.MouseUp,function(a){b.onMouse(a)}),document.addEventListener(a.MouseType.MouseMove,function(a){b.onMouse(a)}),document.addEventListener(a.MouseType.MouseWheel,function(a){b.onMouseWheel(a)})):(document.addEventListener(a.MouseType.TouchMove,function(a){b.onTouchMove(a)}),document.addEventListener(a.MouseType.TouchEnd,function(a){b.onTouchEnd(a)}),document.addEventListener(a.MouseType.TouchStart,function(a){b.onTouchStart(a)})),this.bindPos.x=this.resetPos.x,this.bindPos.y=this.resetPos.y,this.updataFun=function(a){b.updata(a)}},b.prototype.onMouseWheel=function(b){a.AstarUtil.sceneVectList=null,a.Scene_data.gameAngle+=b.wheelDelta/100},b.prototype.isCanUseMouseEvent=function(){return this.useMouseEvent},b.prototype.onMouse=function(b){if(this.isCanUseMouseEvent()&&2!=b.button){var c,d=new a.Vector2D;b instanceof MouseEvent&&(b.type==a.MouseType.MouseDown?c=new a.InteractiveEvent(a.InteractiveEvent.Down):b.type==a.MouseType.MouseUp?c=new a.InteractiveEvent(a.InteractiveEvent.Up):b.type==a.MouseType.MouseMove?c=new a.InteractiveEvent(a.InteractiveEvent.Move):b.type==a.MouseType.MouseClick,d.x=b.pageX,d.y=b.pageY),c&&(c.mouseEvent=b),this.makeMouseEvent(c,d)}},b.prototype.makeMouseEvent=function(b,c){this.lastMouseEvetTime=a.TimeUtil.getTimer();win.LayerManager.getInstance().mouseEvetData(b,c);b.type==a.InteractiveEvent.Move},b.prototype.mouseToEvent=function(b){var c,d=new a.Vector2D;return b.type==a.MouseType.TouchStart?c=new a.InteractiveEvent(a.InteractiveEvent.Down):b.type==a.MouseType.TouchEnd?(c=new a.InteractiveEvent(a.InteractiveEvent.Up),d.x=b.changedTouches[0].pageX,d.y=b.changedTouches[0].pageY):b.type==a.MouseType.TouchMove&&(c=new a.InteractiveEvent(a.InteractiveEvent.Move)),b.touches.length&&(d.x=b.touches[b.touches.length-1].clientX,d.y=b.touches[b.touches.length-1].clientY),this.makeMouseEvent(c,d),c},b.prototype.cantClikGround=function(b){return a.GameInstance.useYaoGan?!1:a.GameInstance.mainChar&&a.SceneManager.getInstance().render?a.GameInstance.mainChar.isDeath?!1:!0:!1},b.prototype.onSceneMouseDown=function(b){if(!this.ready){var c=new a.Vector2D;a.Scene_data.verticalScene?(c.x=b.y,c.y=a.Scene_data.stageHeight-b.x):(c.x=b.x,c.y=b.y)}},b.prototype.onTouchStart=function(a){this.isCanUseMouseEvent()&&this.mouseToEvent(a)},b.prototype.onTouchEnd=function(b){if(this.isCanUseMouseEvent()){if(a.GameInstance.useYaoGan){for(var c=!1,d=0;d<b.touches.length;d++)b.touches[d].identifier==this.yaoganIdentifier&&(c=!0);c||(this.bindPos.x=this.resetPos.x,this.bindPos.y=this.resetPos.y,a.TimeUtil.removeFrameTick(this.updataFun),this.canTestClikGroundMove=null,a.GameInstance.useYaoGan=!1,this.setBasePostion())}this.mouseToEvent(b)}},b.prototype.setBasePostion=function(){this.b_yaogan_bar.x=this.bindPos.x-this.b_yaogan_bar.width/2,this.b_yaogan_bar.y=this.bindPos.y-this.b_yaogan_bar.height/2,this.b_yaogan_bg.x=this.bindPos.x-this.b_yaogan_bg.width/2,this.b_yaogan_bg.y=this.bindPos.y-this.b_yaogan_bg.height/2},b.prototype.onTouchMove=function(a){!this.isCanUseMouseEvent()},b.prototype.updata=function(a){},b.prototype.getMouseDownPos=function(b){var c=new a.Vector2D;return a.Scene_data.verticalScene?(c.x=b.pageY/a.UIData.Scale,c.y=(a.Scene_data.stageHeight-b.pageX)/a.UIData.Scale):(c.x=b.pageX/a.UIData.Scale,c.y=b.pageY/a.UIData.Scale),c.y+=a.Scene_data.stageHeight/a.UIData.Scale-540,c},b}();a.GameMouseManager=b}(Pan3d||(Pan3d={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scenedis;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.onMeshLoaded=function(){a.prototype.onMeshLoaded.call(this),this.loadFinishFun&&this.loadFinishFun()},b.prototype.changeAction=function(a){this.curentAction=this._defaultAction,this.changeActionFun&&this.changeActionFun(a)},b.prototype.setWeaponByAvatar=function(a,b){void 0===b&&(b="")},b}(Pan3d.SceneChar);a.SkillSceneChar=b}(b=a.me||(a.me={}))}(scenedis||(scenedis={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scenedis;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.setWeaponByAvatar=function(a,b){void 0===b&&(b=""),this.addPart(Pan3d.SceneChar.WEAPON_PART,Pan3d.SceneChar.WEAPON_DEFAULT_SLOT,this.getSceneCharWeaponUrl(a,b))},b.prototype.setWingByID=function(a){this._wingDisplay||(this._wingDisplay=new Pan3d.SceneBaseChar),this._wingDisplay.setRoleUrl(getRoleUrl(a)),this._wingDisplay.setBind(this,Pan3d.SceneChar.WING_SLOT),Pan3d.SceneManager.getInstance().addMovieDisplay(this._wingDisplay)},b.prototype.setMountById=function(a){this.mountChar||(this.mountChar=new Pan3d.MountChar),this.mountChar.setRoleUrl(getRoleUrl(a)),this.setBind(this.mountChar,Pan3d.SceneChar.MOUNT_SLOT),Pan3d.SceneManager.getInstance().addMovieDisplay(this.mountChar),this.isMount=!0},b}(Pan3d.SceneChar);a.ModelSceneChar=b;
}(b=a.me||(a.me={}))}(scenedis||(scenedis={}));var scenedis;!function(a){var b;!function(a){var b=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.addMouseEvent=function(){var a=this;Pan3d.Scene_data.isPc?(document.addEventListener(Pan3d.MouseType.MouseDown,function(b){a.onMouse(b)}),document.addEventListener(Pan3d.MouseType.MouseUp,function(b){a.onMouse(b)}),document.addEventListener(Pan3d.MouseType.MouseMove,function(b){a.onMouse(b)}),document.addEventListener(Pan3d.MouseType.MouseWheel,function(b){a.onMouseWheel(b)})):(document.addEventListener(Pan3d.MouseType.TouchMove,function(b){a.mouseToEvent(b)}),document.addEventListener(Pan3d.MouseType.TouchEnd,function(b){a.mouseToEvent(b)}),document.addEventListener(Pan3d.MouseType.TouchStart,function(b){a.mouseToEvent(b)}))},a.prototype.onMouseWheel=function(a){},a.prototype.onMouse=function(a){var b,c=new Pan3d.Vector2D;a instanceof MouseEvent&&(a.type==Pan3d.MouseType.MouseDown?b=new Pan3d.InteractiveEvent(Pan3d.InteractiveEvent.Down):a.type==Pan3d.MouseType.MouseUp?b=new Pan3d.InteractiveEvent(Pan3d.InteractiveEvent.Up):a.type==Pan3d.MouseType.MouseMove?b=new Pan3d.InteractiveEvent(Pan3d.InteractiveEvent.Move):a.type==Pan3d.MouseType.MouseClick,c.x=a.pageX,c.y=a.pageY),this.makeMouseEvent(b,c)},a.prototype.mouseToEvent=function(a){var b,c=new Pan3d.Vector2D;a.type==Pan3d.MouseType.TouchStart?b=new Pan3d.InteractiveEvent(Pan3d.InteractiveEvent.Down):a.type==Pan3d.MouseType.TouchEnd?(b=new Pan3d.InteractiveEvent(Pan3d.InteractiveEvent.Up),c.x=a.changedTouches[0].pageX,c.y=a.changedTouches[0].pageY):a.type==Pan3d.MouseType.TouchMove&&(b=new Pan3d.InteractiveEvent(Pan3d.InteractiveEvent.Move)),a.touches.length&&(c.x=a.touches[a.touches.length-1].clientX,c.y=a.touches[a.touches.length-1].clientY),this.makeMouseEvent(b,c)},a.prototype.makeMouseEvent=function(a,b){var c=Pan3d.UIManager.getInstance().mouseEvetData(a,b);c||a.type==Pan3d.InteractiveEvent.Up&&this.clikSceneGround(b)},a.prototype.clikSceneGround=function(a){},a.prototype.walkPathComplete=function(){},a}();a.ModelshowMouseManager=b}(b=a.me||(a.me={}))}(scenedis||(scenedis={}));var scenedis;!function(a){var b;!function(a){var b=function(){function a(){this.lastRotationY=0,this.lastRotationX=0,this._lastMousePos=new Pan3d.Vector2D}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.initSceneFocueEvent=function(){var a=this;Pan3d.Scene_data.uiBlankStage.addEventListener(Pan3d.InteractiveEvent.Down,this.onMouseDown,this),Pan3d.Scene_data.uiBlankStage.addEventListener(Pan3d.InteractiveEvent.Up,this.onMouseUp,this),Pan3d.Scene_data.uiBlankStage.addEventListener(Pan3d.InteractiveEvent.Move,this.onMouseMove,this),document.addEventListener(Pan3d.MouseType.MouseWheel,function(b){a.onMouseWheel(b)})},a.prototype.onMouseWheel=function(a){Pan3d.Scene_data.cam3D.distance+=a.wheelDelta/10},a.prototype.onMouseMove=function(a){if(this._isMouseDown){var b=a.x-this._lastMousePos.x;Pan3d.Scene_data.focus3D.rotationY=this.lastRotationY-b;var c=a.y-this._lastMousePos.y;Pan3d.Scene_data.focus3D.rotationX=this.lastRotationX-c}},a.prototype.onMouseDown=function(a){this._lastMousePos.x=a.x,this._lastMousePos.y=a.y,this.lastRotationY=Pan3d.Scene_data.focus3D.rotationY,this.lastRotationX=Pan3d.Scene_data.focus3D.rotationX,this._isMouseDown=!0},a.prototype.onMouseUp=function(a){this._isMouseDown=!1},a}();a.SceneMouseEventModel=b}(b=a.me||(a.me={}))}(scenedis||(scenedis={}));var scenedis;!function(a){var b;!function(b){var c=function(){function b(){this.addModelChar()}return b.prototype.addModelChar=function(){var b=new a.me.ModelSceneChar;b.setRoleUrl(getRoleUrl("50003")),b.setWingByID("901"),b.setMountById("4103"),b.setWeaponByAvatar(50011),b.play(Pan3d.CharAction.STAND_MOUNT),Pan3d.SceneManager.getInstance().addMovieDisplay(b)},b}();b.CharModelShow=c}(b=a.me||(a.me={}))}(scenedis||(scenedis={}));var scenedis;!function(a){var b;!function(b){var c=function(){function b(){this.skillFileName="jichu_1",this.charIdstr="50001",this.weaponNum=50011,this.skipId=1,this.skillEffectItem=["skill_01","skill_02","skill_03","m_skill_01","m_skill_02","m_skill_03"],this.initSkillPlay()}return b.prototype.initSkillPlay=function(){getUrlParam("id")?(this.makeUrlParam(),this.makeMainChar()):window.location.href="index.html?id="+random(10)},b.prototype.makeUrlParam=function(){this.paramId=Number(getUrlParam("id")),isNaN(this.paramId)&&(this.paramId=0),this.paramId=Math.floor(this.paramId),this.paramId=this.paramId%6+1,(this.paramId<=0||this.paramId>6)&&(this.paramId=1),(3==this.paramId||4==this.paramId)&&this.makeAttackChar(),this.skillFileName="jichu_"+Math.ceil(this.paramId/2),this.charIdstr="5000"+this.paramId,this.weaponNum=50010+this.paramId},b.prototype.makeAttackChar=function(){var a=new Pan3d.SceneChar;a.z=100,a.setRoleUrl(getRoleUrl("7001")),Pan3d.SceneManager.getInstance().addMovieDisplay(a),this.attackTarget=a,this.attackTarget.x=random(50)+30,this.attackTarget.z=random(50)+30},b.prototype.makeMainChar=function(){var b=this;Pan3d.SkillManager.getInstance().preLoadSkill(getSkillUrl(this.skillFileName));var c=new a.me.SkillSceneChar;c.setRoleUrl(getRoleUrl(this.charIdstr)),Pan3d.SceneManager.getInstance().addMovieDisplay(c),c.setWeaponByAvatar(this.weaponNum),this.mainChar=c,c.changeActionFun=function(){b.playSkill()},c.loadFinishFun=function(){Pan3d.ResManager.getInstance().loadSkillRes(Pan3d.Scene_data.fileRoot+getSkillUrl(b.skillFileName),function(a){Pan3d.SkillManager.getInstance().preLoadSkill(getSkillUrl(b.skillFileName)),Pan3d.TimeUtil.addTimeOut(1e3,function(){b.playSkill()}),console.log(Pan3d.TimeUtil.getTimer())})}},b.prototype.playSkill=function(){var a=this.skillEffectItem[this.skipId%this.skillEffectItem.length],b=Pan3d.SkillManager.getInstance().getSkill(getSkillUrl(this.skillFileName),a);if(b.keyAry){if(this.textPlaySkillFun&&(Pan3d.TimeUtil.removeTimeTick(this.textPlaySkillFun),this.textPlaySkillFun=null),b&&(b.reset(),b.isDeath=!1),3==this.paramId||4==this.paramId){if("m_skill_01"==a)b.configFixEffect(this.mainChar);else{this.attackTarget.x=random(50)+30,this.attackTarget.z=random(50)+30;var c=new Pan3d.Vector3D(this.attackTarget.x,this.attackTarget.y,this.attackTarget.z),d=new Array;d.push(c),b.configFixEffect(this.mainChar,null,d)}this.mainChar.watch(this.attackTarget,!0)}else b.configFixEffect(this.mainChar);this.mainChar.playSkill(b),this.skipId++}},b}();b.CharSkillPlayModel=c}(b=a.me||(a.me={}))}(scenedis||(scenedis={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scene3d_me;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.initConfig=function(){var a=this;Pan3d.Engine.update=function(){a.update()},Pan3d.Engine.init=function(b){a.init(b)},Pan3d.Engine.resetSize=function(b,c){a.resetSize(b,c)}},b.update=function(){Pan3d.TimeUtil.update(),Pan3d.SceneManager.getInstance().update()},b.resetSize=function(a,b){Pan3d.Scene_data.stageWidth=a,Pan3d.Scene_data.stageHeight=b,Pan3d.Scene_data.canvas3D.width=Pan3d.Scene_data.stageWidth,Pan3d.Scene_data.canvas3D.height=Pan3d.Scene_data.stageHeight,Pan3d.Scene_data.context3D.resetSize(Pan3d.Scene_data.stageWidth,Pan3d.Scene_data.stageHeight),Pan3d.UIManager.getInstance().resize(),Pan3d.BloodManager.getInstance().resize(),Pan3d.Engine.resetViewMatrx3D()},b.init=function(a){var b=/ipad/i.test(navigator.userAgent),c=/iPhone/i.test(navigator.userAgent),d=/android/i.test(navigator.userAgent);/iindow/i.test(navigator.userAgent),navigator.userAgent.toLowerCase();b||c||d?Pan3d.Scene_data.isPc=!1:Pan3d.Scene_data.isPc=!0,Pan3d.Scene_data.vpMatrix=new Pan3d.Matrix3D,Pan3d.Scene_data.canvas3D=a,Pan3d.Scene_data.context3D=new Pan3d.Context3D,Pan3d.Scene_data.context3D.init(a),Pan3d.UIManager.getInstance().init(),Pan3d.Scene_data.cam3D=new Pan3d.Camera3D,Pan3d.Scene_data.focus3D=new Pan3d.Object3D,Pan3d.Scene_data.focus3D.x=0,Pan3d.Scene_data.focus3D.y=0,Pan3d.Scene_data.focus3D.z=0,Pan3d.Scene_data.focus3D.rotationY=135,Pan3d.Scene_data.focus3D.rotationX=-45,Pan3d.Scene_data.light=new Pan3d.LightVo,Pan3d.TimeUtil.init(),Pan3d.Scene_data.supportBlob=!0},b}(Pan3d.Engine);a.OverrideEngine=b}(scene3d_me||(scene3d_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scene3d_me;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.initConfig=function(){Pan3d.SceneManager._instance=new b},b.prototype.update=function(){Pan3d.MathClass.getCamView(Pan3d.Scene_data.cam3D,Pan3d.Scene_data.focus3D),Pan3d.Scene_data.context3D._contextSetTest.clear(),isNaN(this._time)&&(this._time=Pan3d.TimeUtil.getTimer()),this.updateMovieFrame(),this._ready&&(Pan3d.ParticleManager.getInstance().updateTime(),Pan3d.SkillManager.getInstance().update(),this.render&&(Pan3d.Scene_data.context3D.cullFaceBack(!1),Pan3d.Scene_data.context3D.cullFaceBack(!0),Pan3d.Scene_data.context3D.cullFaceBack(!0),Pan3d.Scene_data.context3D.setWriteDepth(!0),Pan3d.Scene_data.context3D.setDepthTest(!0),this.updateStaticDiplay(),this.updateSpriteDisplay(),this.updateMovieDisplay(),Pan3d.Scene_data.context3D.setWriteDepth(!1),Pan3d.ParticleManager.getInstance().update(),Pan3d.BloodManager.getInstance().update(),Pan3d.Scene_data.context3D.setBlendParticleFactors(0),Pan3d.Scene_data.context3D.setWriteDepth(!0)),Pan3d.Scene_data.context3D.setDepthTest(!1),Pan3d.UIManager.getInstance().update())},b}(Pan3d.SceneManager);a.OverrideSceneManager=b}(scene3d_me||(scene3d_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scene3d_me;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.drawTxtBydigitalAndtext=function(a){var b,c=this.parent.uiAtlas.getRec(this.textureStr),d=Pan3d.UIManager.getInstance().getContext2D(c.pixelWitdh,c.pixelHeight,!1),e=a.type,f=50,g=25;a.type==Pan3d.TextJumpType.EXPERIENCE&&(b=Pan3d.ArtFont.num54);var h=Pan3d.ArtFont.getInstance().getAirFontWidth(d,String(this._data.str),b);return h+=f,Pan3d.UiDraw.cxtDrawImg(d,"TYPE"+e,new Pan3d.Rectangle(c.pixelWitdh-h,c.pixelHeight-g,f,g),Pan3d.UIData.publicUi),Pan3d.ArtFont.getInstance().writeFontToCtxLeft(d,String(this._data.str),b,c.pixelWitdh-h+f+2,c.pixelHeight-g),Pan3d.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,c.pixelX,c.pixelY,d),h},b}(Pan3d.ExpTextJumpUiDrawAndRefreash);a.ExpTextJumpUiDrawAndRefreash256=b}(scene3d_me||(scene3d_me={})),function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._jumpText256_256=new Pan3d.AlphaUiContianer(a.ExpTextJumpUiDrawAndRefreash256,new Pan3d.Rectangle(0,0,256,256),2),c.uiContianerItem.push(c._jumpText256_256),c}return __extends(c,b),c.getInstance=function(){return Pan3d.BloodManager._instance||(console.log("一定要到这里--->复写飘字"),Pan3d.BloodManager._instance=new c),Pan3d.BloodManager._instance},c.prototype.setExpJump256_256Num=function(a){this._jumpText256_256.showTemp(a),console.log(a)},c}(Pan3d.BloodManager);a.OverrideBloodManager=b}(scene3d_me||(scene3d_me={}));var scene3d_me;!function(a){var b=function(){function b(){}return b.initData=function(){a.OverrideSceneManager.initConfig(),a.OverrideEngine.initConfig(),Pan3d.Engine.init(mainpan3d_me.canvas),a.OverrideBloodManager.getInstance(),Pan3d.Engine.resetSize(mainpan3d_me.canvas.width,mainpan3d_me.canvas.height),Pan3d.Engine.initPbr(),b.isConfig=!0,Pan3d.SceneManager.getInstance().ready=!0},b.isConfig=!1,b}();a.Scene3dInit=b}(scene3d_me||(scene3d_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scene2d_me;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.initConfig=function(){var a=this;Pan3d.Engine.update=function(){a.update()},Pan3d.Engine.init=function(b){a.init(b)},Pan3d.Engine.resetSize=function(b,c){a.resetSize(b,c)},Pan3d.Engine.resetViewMatrx3D=function(){a.resetViewMatrx3D()}},c.resetSize=function(b,c){isNaN(b)&&(b=document.body.clientWidth),isNaN(c)&&(c=document.body.clientHeight),Pan3d.Scene_data.stageWidth=b,Pan3d.Scene_data.stageHeight=c,Pan3d.Scene_data.context3D.resetSize(Pan3d.Scene_data.stageWidth,Pan3d.Scene_data.stageHeight),Pan3d.UIManager.getInstance().resize(),Pan3d.BloodManager.getInstance().resize(),Pan3d.Engine.resetViewMatrx3D(),a.CanvasPostionModel.getInstance().resetSize()},c.init=function(a){scene3d_me.OverrideEngine.init(a),Pan3d.Scene_data.focus3D.x=0,Pan3d.Scene_data.focus3D.y=0,Pan3d.Scene_data.focus3D.z=0,Pan3d.Scene_data.focus3D.rotationY=0,Pan3d.Scene_data.focus3D.rotationX=-45,Pan3d.Scene_data.cam3D.distance=250},c.resetViewMatrx3D=function(){Pan3d.Scene_data.viewMatrx3D?Pan3d.Scene_data.viewMatrx3D.identity():Pan3d.Scene_data.viewMatrx3D=new Pan3d.Matrix3D;var a=Pan3d.Scene_data.stageWidth,b=Pan3d.Scene_data.stageHeight;Pan3d.Scene_data.sceneViewHW=Math.max(a,b),Pan3d.Scene_data.viewMatrx3D.appendScale(1/Pan3d.Scene_data.sceneViewHW*2,1/Pan3d.Scene_data.sceneViewHW*2,.001),Pan3d.Scene_data.viewMatrx3D.appendScale(1*(Pan3d.Scene_data.sceneViewHW/a*2),a/b*(Pan3d.Scene_data.sceneViewHW/a*2),1),Pan3d.Scene_data.viewMatrx3D.appendScale(2*this.htmlScale,2*this.htmlScale,1)},c.htmlScale=.5,c}(scene3d_me.OverrideEngine);a.Override2dEngine=b}(scene2d_me||(scene2d_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scene2d_me;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.initConfig=function(){Pan3d.SceneManager._instance=new c},c.prototype.update=function(){Pan3d.MathClass.getCamView(Pan3d.Scene_data.cam3D,Pan3d.Scene_data.focus3D),Pan3d.Scene_data.context3D._contextSetTest.clear(),isNaN(this._time)&&(this._time=Pan3d.TimeUtil.getTimer()),a.GroundModel.getInstance().update(),this.updateMovieFrame(),this._ready&&(Pan3d.ParticleManager.getInstance().updateTime(),Pan3d.SkillManager.getInstance().update(),this.render&&(Pan3d.Scene_data.context3D.setWriteDepth(!0),Pan3d.Scene_data.context3D.setDepthTest(!0),this.updateStaticDiplay(),this.updateSpriteDisplay(),this.updateMovieDisplay(),Pan3d.Scene_data.context3D.setWriteDepth(!1),Pan3d.ParticleManager.getInstance().update(),Pan3d.BloodManager.getInstance().update(),Pan3d.Scene_data.context3D.setBlendParticleFactors(0),Pan3d.Scene_data.context3D.setWriteDepth(!0),Pan3d.Scene_data.context3D.setWriteDepth(!1)),Pan3d.Scene_data.context3D.setDepthTest(!1),Pan3d.UIManager.getInstance().update())},c}(scene3d_me.OverrideSceneManager);a.Override2dSceneManager=b}(scene2d_me||(scene2d_me={}));var scene2d_me;!function(a){var b=function(){function b(){this.lastPostionV2d=new Pan3d.Vector2D,this._lastMousePos=new Pan3d.Vector2D,this.tureMoveV2d=new Pan3d.Vector2D(0,0),this.initSceneFocueEvent()}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.initSceneFocueEvent=function(){Pan3d.Scene_data.uiBlankStage.addEventListener(Pan3d.InteractiveEvent.Down,this.onMouseDown,this),Pan3d.Scene_data.uiBlankStage.addEventListener(Pan3d.InteractiveEvent.Up,this.onMouseUp,this),Pan3d.Scene_data.uiBlankStage.addEventListener(Pan3d.InteractiveEvent.Move,this.onMouseMove,this)},b.prototype.onMouseMove=function(a){this._isMouseDown&&(this.tureMoveV2d.x=this.lastPostionV2d.x+a.x-this._lastMousePos.x,this.tureMoveV2d.y=this.lastPostionV2d.y+a.y-this._lastMousePos.y,this.resetSize())},b.prototype.onMouseDown=function(a){this._lastMousePos.x=a.x,this._lastMousePos.y=a.y,this.lastPostionV2d=new Pan3d.Vector2D(this.tureMoveV2d.x,this.tureMoveV2d.y),this._isMouseDown=!0},b.prototype.onMouseUp=function(a){this._isMouseDown=!1},b.prototype.resetSize=function(){var b=.25/a.Override2dEngine.htmlScale;Pan3d.Scene_data.focus3D.x=0+Pan3d.Scene_data.stageWidth/2*b,Pan3d.Scene_data.focus3D.z=0-Pan3d.Scene_data.stageHeight/2*b/Math.sin(45*Math.PI/180),Pan3d.Scene_data.focus3D.x-=this.tureMoveV2d.x*b,Pan3d.Scene_data.focus3D.z+=this.tureMoveV2d.y*b/Math.sin(45*Math.PI/180),a.Ground2dBaseSprite.perentpos=this.tureMoveV2d},b}();a.CanvasPostionModel=b}(scene2d_me||(scene2d_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scene2d_me;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.setWeaponByAvatar=function(a,b){void 0===b&&(b=""),this.addPart(Pan3d.SceneChar.WEAPON_PART,Pan3d.SceneChar.WEAPON_DEFAULT_SLOT,this.getSceneCharWeaponUrl(a,b))},c.prototype.setWingByID=function(a){this._wingDisplay||(this._wingDisplay=new Pan3d.SceneBaseChar),this._wingDisplay.setRoleUrl(getRoleUrl(a)),this._wingDisplay.setBind(this,Pan3d.SceneChar.WING_SLOT),Pan3d.SceneManager.getInstance().addMovieDisplay(this._wingDisplay)},c.prototype.setMountById=function(a){this.mountChar||(this.mountChar=new Pan3d.MountChar),this.mountChar.setRoleUrl(getRoleUrl(a)),this.setBind(this.mountChar,Pan3d.SceneChar.MOUNT_SLOT),Pan3d.SceneManager.getInstance().addMovieDisplay(this.mountChar),this.isMount=!0},c.prototype.set2dPos=function(b,c){this.x=b*a.Override2dEngine.htmlScale,this.z=c*a.Override2dEngine.htmlScale/Math.sin(45*Math.PI/180)*-1,this.mountChar&&(this.mountChar.x=this.x,this.mountChar.z=this.z)},Object.defineProperty(c.prototype,"rotationY",{set:function(a){this._rotationY=a,this.mountChar&&(this.mountChar.rotationY=this._rotationY),this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),c}(Pan3d.SceneChar);a.Scene2dChar=b}(scene2d_me||(scene2d_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),scene2d_me;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"u2Texture")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 u2Texture;varying vec2 v_texCoord;uniform vec4 movesize;void main(void){   v_texCoord = vec2(u2Texture.x, u2Texture.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0.xy*=movesize.zw;   vt0.xy+=movesize.xy;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ngl_FragColor =infoUv;\n}";return a},b.Ground2dBaseShader="Ground2dBaseShader",b}(Pan3d.Shader3D);a.Ground2dBaseShader=b;var c=function(a){function c(){var b=a.call(this)||this;return b.x=0,b.y=0,b.width=100,b.height=100,b.initData(),b}return __extends(c,a),c.prototype.initData=function(){Pan3d.ProgrmaManager.getInstance().registe(b.Ground2dBaseShader,new b),this.shader=Pan3d.ProgrmaManager.getInstance().getProgram(b.Ground2dBaseShader),this.program=this.shader.program,this.objData=new Pan3d.ObjData,this.objData.vertices=new Array,this.objData.vertices.push(0,-1,0),this.objData.vertices.push(1,-1,0),this.objData.vertices.push(1,0,0),this.objData.vertices.push(0,0,0),this.objData.uvs=new Array,this.objData.uvs.push(0,1),this.objData.uvs.push(1,1),this.objData.uvs.push(1,0),this.objData.uvs.push(0,0),this.objData.indexs=new Array,this.objData.indexs.push(0,1,2),this.objData.indexs.push(0,2,3),this.loadTexture(),this.upToGpu()},c.prototype.loadTexture=function(){var a=Pan3d.UIManager.getInstance().getContext2D(128,128,!1);a.fillStyle="rgb(255,255,255)",a.fillRect(0,0,128,128),this._uvTextureRes=Pan3d.TextureManager.getInstance().getCanvasTexture(a)},c.prototype.setPicUrl=function(a){var b=this;Pan3d.TextureManager.getInstance().getTexture(a,function(a){b._uvTextureRes=a})},c.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=Pan3d.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Pan3d.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Pan3d.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},c.prototype.update=function(){this.objData&&this.objData.indexBuffer&&this._uvTextureRes&&(Pan3d.Scene_data.context3D.setProgram(this.program),Pan3d.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Pan3d.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),Pan3d.Scene_data.context3D.setVc4fv(this.shader,"movesize",this.getMoveSizeData()),Pan3d.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this._uvTextureRes.texture,0),Pan3d.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},c.prototype.getMoveSizeData=function(){var a=(this.x+c.perentpos.x)/(Pan3d.Scene_data.stageWidth/2)-1,b=1-(this.y+c.perentpos.y)/(Pan3d.Scene_data.stageHeight/2),d=this.width/(Pan3d.Scene_data.stageWidth/2),e=this.height/(Pan3d.Scene_data.stageHeight/2);return[a,b,d,e]},c.perentpos=new Pan3d.Vector2D,c}(Pan3d.Display3D);a.Ground2dBaseSprite=c;var d=function(){function a(){this._groundItem=new Array}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.update=function(){Pan3d.Scene_data.context3D.setWriteDepth(!1),Pan3d.Scene_data.context3D.setDepthTest(!1);for(var a=0;a<this._groundItem.length;a++)this._groundItem[a].update()},a.prototype.addGroundPicByeUrl=function(a,b){void 0===a&&(a=null),void 0===b&&(b=null);var d=new c;return a&&d.setPicUrl(a),b&&(d.x=b.x,d.y=b.y,d.width=b.width,d.height=b.height),this._groundItem.push(d),d},a}();a.GroundModel=d}(scene2d_me||(scene2d_me={}));var scene2d_me;!function(a){var b=function(){function b(){}return b.initData=function(){a.Override2dSceneManager.initConfig(),a.Override2dEngine.initConfig(),Pan3d.Scene_data.fileRoot=" http://"+document.domain+"/res/",Pan3d.Engine.init(mainpan3d_me.canvas),Pan3d.Engine.resetSize(mainpan3d_me.canvas.width,mainpan3d_me.canvas.height),Pan3d.Engine.initPbr(),b.isConfig=!0,Pan3d.SceneManager.getInstance().ready=!0},b.addGridLineSprite=function(){Pan3d.ProgrmaManager.getInstance().registe(Pan3d.LineDisplayShader.LineShader,new Pan3d.LineDisplayShader),Pan3d.SceneManager.getInstance().addDisplay(new Pan3d.GridLineSprite)},b.isConfig=!1,b}();a.Scene2dInit=b}(scene2d_me||(scene2d_me={}));var scene2d_me;!function(a){var b=function(){function b(){}return b.math3dto2Darpg=function(b){var c=Pan3d.Scene_data.vpMatrix.transformVector(b),d=Pan3d.Scene_data.stageWidth/4/a.Override2dEngine.htmlScale,e=Pan3d.Scene_data.stageHeight/4/a.Override2dEngine.htmlScale,f=d+c.x*d,g=e-c.y*e;return new Pan3d.Vector2D(f,g)},b.getScene2DBy3Dpostion=function(a){var c=this.math3dto2Darpg(a);return c.x-=b.sceneStagePos.x,c.y-=b.sceneStagePos.y,c},b.math2Dto3DGroundarpg=function(a){this._vpMatrixInver=Pan3d.Scene_data.vpMatrix.clone(),this._vpMatrixInver.invert();var b=this.math2dto3Darpg(a,100),c=this.math2dto3Darpg(a,200);return this.triItem||(this.triItem=new Array,this.triItem.push(new Pan3d.Vector3D(0,0,0)),this.triItem.push(new Pan3d.Vector3D(-100,0,100)),this.triItem.push(new Pan3d.Vector3D(100,0,100))),Pan3d.MathUtil.getLinePlaneInterectPointByTri(b,c,this.triItem)},b.math2dto3Darpg=function(a,b){void 0===b&&(b=100);var c=Pan3d.Scene_data.stageWidth/4,d=Pan3d.Scene_data.stageHeight/4,e=a.x,f=a.y,g=new Pan3d.Vector3D;return g.y=(d-f)/d,g.x=(e-c)/c,g.z=b,g=this._vpMatrixInver.transformVector(g)},b.refrishPos=function(a){b.sceneStagePos.x=a.x,b.sceneStagePos.y=a.y,Pan3d.Scene_data.focus3D.x=-b.sceneStagePos.x/2,Pan3d.Scene_data.focus3D.z=b.sceneStagePos.y/2/Math.sin(45*Math.PI/180)},b.resetSelfPosCenter=function(){if(Pan3d.GameInstance.mainChar){var b=this.getScene2DBy3Dpostion(new Pan3d.Vector3D(Pan3d.GameInstance.mainChar.x,0,Pan3d.GameInstance.mainChar.z)),c=Pan3d.Scene_data.stageWidth/4/a.Override2dEngine.htmlScale,d=Pan3d.Scene_data.stageHeight/4/a.Override2dEngine.htmlScale,e=new Pan3d.Vector2D(c-b.x,d-b.y);this.refrishPos(e)}},b.sceneStagePos=new Pan3d.Vector2D,b.lockMainChar=!0,b}();a.AppDataArpg=b}(scene2d_me||(scene2d_me={}));var mainpan3d_me=function(){function a(){}return a}(),__extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.reset=function(){this.particle.reset(),this.skill.skillManager.sceneManager.particleManager.removeParticle(this.particle),this.endParticle&&(this.endParticle.reset(),this.skill.skillManager.sceneManager.particleManager.addParticle(this.endParticle),this.endParticle.setPos(this._currentTargetPos.x,this._currentTargetPos.y,this._currentTargetPos.z)),this.removeCallFun&&this.removeCallFun(this)},b.prototype.addToRender=function(){if(this.particle){this.particle.reset(),this.particle.sceneVisible=!0,this.skill.skillManager.sceneManager.particleManager.addParticle(this.particle);var a;if(0==this.data.beginType){var b=new Pan3d.Matrix3D;b.appendRotation(this.active.rotationY,Pan3d.Vector3D.Y_AXIS),a=b.transformVector(this.data.beginPos),this._currentPos.setTo(this.active.x+a.x,this.active.y+a.y,this.active.z+a.z)}else if(1==this.data.beginType){var c=new Pan3d.Matrix3D,d=this.active;d.getSocket(this.data.beginSocket,c),a=c.position,this._currentPos.setTo(a.x,a.y,a.z)}this.particle.setPos(this._currentPos.x,this._currentPos.y,this._currentPos.z),this.path.add()}},b.prototype.endPlayFun=function(a){void 0===a&&(a=null),this.skill.skillManager.sceneManager.particleManager.removeParticle(this.endParticle),this.endParticle.removeEventListener(Pan3d.BaseEvent.COMPLETE,this.endPlayFun,this)},b.prototype.setInfo=function(a){this.time=a.frame*Pan3d.Scene_data.frameTime,this.particle=this.skill.skillManager.sceneManager.particleManager.getParticleByte(Pan3d.Scene_data.fileRoot+a.url),this.particle.bindTarget=this,this.data=a,this.data.endParticleUrl&&(this.endParticle=this.skill.skillManager.sceneManager.particleManager.getParticleByte(Pan3d.Scene_data.fileRoot+this.data.endParticleUrl),this.endParticle.addEventListener(Pan3d.BaseEvent.COMPLETE,this.endPlayFun,this))},b}(Pan3d.SkillTrajectory);a.OverrideSkillTrajectory=b}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return console.log("OverrideSkillFixEffectKeyVo"),b}return __extends(b,a),b}(Pan3d.SkillFixEffectKeyVo);a.OverrideSkillFixEffectKeyVo=b}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=Pan3d.SkillType,c=Pan3d.SkillVo,d=function(d){function e(a){void 0===a&&(a=null);var b=d.call(this)||this;return b.baseName="OverrideSkill",b.skillManager=a,b}return __extends(e,d),e.prototype.skillComplete=function(){this.skillManager.removeSkill(this),this.isDeath=!0,this.completeFun&&this.completeFun(),this.idleTime=0},e.prototype.setData=function(a,b){this.hasDestory||(this.skillVo=new c,this.skillVo.setData(a),this.setKeyAry(),this.trajectoryAry=new Array,this._skillData=b)},e.prototype.setKeyAry=function(){var c=this;if(this.keyAry=new Array,this.skillVo.types==b.FixEffect)for(var d=0;d<this.skillVo.keyAry.length;d++){var e=new a.OverrideSkillFixEffect(this);e.setInfo(this.skillVo.keyAry[d]),e.removeCallFun=function(a){c.removeKey(a)},e.active=this.active,this.keyAry.push(e)}else if(this.skillVo.types==b.TrajectoryDynamicTarget||this.skillVo.types==b.TrajectoryDynamicPoint)for(var d=0;d<this.skillVo.keyAry.length;d++){var f,g=this.skillVo.keyAry[d];1==g.multype||(f=new a.OverrideSkillTrajectory,f.skill=this),f.setInfo(this.skillVo.keyAry[d]),this.keyAry.push(f)}},e}(Pan3d.Skill);a.OverrideSkill=d}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Vector3D,d=Pan3d.Matrix3D,e=function(a){function e(b){var c=a.call(this)||this;return c.skill=b,c}return __extends(e,a),e.prototype.onPlayCom=function(a){void 0===a&&(a=null),this.particle.removeEventListener(b.COMPLETE,this.onPlayCom,this),this.skill.skillManager.sceneManager.particleManager.removeParticle(this.particle),this.removeCallFun(this)},e.prototype.addToRender=function(){if(this.particle)if(this.particle.reset(),this.particle.sceneVisible=!0,this.skill.skillManager.sceneManager.particleManager.addParticle(this.particle),this.particle.addEventListener(b.COMPLETE,this.onPlayCom,this),this.outPos)this.particle.x=this.outPos.x,this.particle.y=this.outPos.y,this.particle.z=this.outPos.z,this.particle.rotationX=this.rotation.x,this.particle.rotationY=this.rotation.y+this.active.rotationY,this.particle.rotationZ=this.rotation.z,this.particle.bindTarget=null;else if(this.hasSocket){var a=this.active;this.particle.bindTarget=a,this.particle.bindSocket=this.socket}else{var e=new d;
e.appendRotation(this.active.rotationY,c.Y_AXIS);var f=e.transformVector(this.pos);f.x+=this.active.x,f.y+=this.active.y,f.z+=this.active.z;var g=new Pan3d.SkillBugBind;g.bindMatrix=new d,g.bindMatrix.appendRotation(this.rotation.x,c.X_AXIS),g.bindMatrix.appendRotation(this.rotation.y,c.Y_AXIS),g.bindMatrix.appendRotation(this.rotation.z,c.Z_AXIS),g.bindMatrix.appendRotation(this.active.rotationY,c.Y_AXIS),g.bindMatrix.appendTranslation(f.x,f.y,f.z),this.particle.bindTarget=g}},e}(Pan3d.SkillFixEffect);a.OverrideSkillFixEffect=e}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=Pan3d.ShadowManager,c=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(b);a.LayaOverrideShadowManager=c}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=Pan3d.Shader3D,c=Pan3d.Display3DParticle,d=Pan3d.CombineParticle,e=Pan3d.CombineParticleData,f=Pan3d.ParticleManager,g=Pan3d.LoadManager,h=Pan3d.TextureManager,i=Pan3d.Scene_data,j=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"u2Texture")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 u2Texture;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(u2Texture.x, u2Texture.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz =infoUv.xyz*infoUv.w;\ngl_FragColor =infoUv;\n}";return a},b.Frame3DParticleShader="Frame3DParticleShader",b}(b);a.Frame3DParticleShader=j;var k=function(a){function b(){var b=a.call(this)||this;return b.beginTime=0,Pan3d.ProgrmaManager.getInstance().registe(j.Frame3DParticleShader,new j),b.shader=Pan3d.ProgrmaManager.getInstance().getProgram(j.Frame3DParticleShader),b.initData(),b}return __extends(b,a),b.prototype.updateTime=function(a){if(this._time=a-this.beginTime,this.frameTextureItem){this.loop||this._time>this.speedTm*this.frameTextureItem.length&&(this.visible=!1);var b=Math.floor(this._time/this.speedTm);this._uvTextureRes=this.frameTextureItem[b%this.frameTextureItem.length]}},b.prototype.initData=function(){if(b.baseFrameObjData)return void(this.objData=b.baseFrameObjData);this.objData=new ObjData,this.objData.vertices=new Array;var a=100,c=100;this.objData.vertices.push(-a,-c,0),this.objData.vertices.push(a,-c,0),this.objData.vertices.push(a,c,0),this.objData.vertices.push(-a,c,0),this.objData.uvs=new Array,this.objData.uvs.push(0,1),this.objData.uvs.push(1,1),this.objData.uvs.push(1,0),this.objData.uvs.push(0,0),this.objData.indexs=new Array,this.objData.indexs.push(0,1,2),this.objData.indexs.push(0,2,3),this.upToGpu(),b.baseFrameObjData=this.objData},b.prototype.makeFrameParticle=function(a,b,c){this.speedTm=100,this.picNum=5,this.loop=!0;for(var d in c)this[d]=c[d];this.loadTexture(a,b)},b.getFrameParticle=function(a,c,e){var f=new d;f.url=a+c,f.displayAry=new Array;var g=new b;return f.displayAry.push(g),g.bindVecter3d=f.bindVecter3d,g.makeFrameParticle(a,c,e),f},b.prototype.loadTexture=function(a,b){var c=this;this.frameTextureItem=new Array;for(var d=0;d<this.picNum;d++){this.frameTextureItem.push(null);var e=a+b+d+".png";h.getInstance().getTexture(e,function(a,b){c.frameTextureItem[b.id]=a},null,{id:d})}},b.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=i.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=i.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=i.context3D.uploadIndexBuff3D(this.objData.indexs))},b.prototype.update=function(){this.visible&&this.objData&&this.objData.indexBuffer&&this._uvTextureRes&&(i.context3D.setProgram(this.shader.program),this.posMatrix=new Pan3d.Matrix3D,this.bindVecter3d&&(this.posMatrix.appendScale(2,2,1),this.posMatrix.appendTranslation(this.bindVecter3d.x,this.bindVecter3d.y,this.bindVecter3d.z)),i.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",i.viewMatrx3D.m),i.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",i.cam3D.cameraMatrix.m),i.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),i.context3D.setVa(0,3,this.objData.vertexBuffer),i.context3D.setVa(1,2,this.objData.uvBuffer),i.context3D.setRenderTexture(this.shader,"s_texture",this._uvTextureRes.texture,0),i.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},b}(c);a.Frame3DParticle=k;var l=function(){function a(){}return a.prototype.meshData=function(a){this.frame=a.frame,this.sourceSize=a.sourceSize,this.spriteSourceSize=a.spriteSourceSize},a}();a.AtlasFrameVo=l;var m=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"u2Texture")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 u2Texture;uniform vec4 uvchange;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(u2Texture.x*uvchange.z+uvchange.x, u2Texture.y*uvchange.w+uvchange.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   vt0.z =v3Position.z;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz =infoUv.xyz*infoUv.w;\ngl_FragColor =infoUv;\n}";return a},b.Frame3DAtlasShader="Frame3DAtlasShader",b}(b);a.Frame3DAtlasShader=m;var n=function(a){function b(){var b=a.call(this)||this;return b.uvchangeData=[0,0,1,1],b.beginTime=0,Pan3d.ProgrmaManager.getInstance().registe(m.Frame3DAtlasShader,new m),b.shader=Pan3d.ProgrmaManager.getInstance().getProgram(m.Frame3DAtlasShader),b.initData(),b}return __extends(b,a),b.prototype.updateTime=function(a){if(this._time=a-this.beginTime,this.frameInfoItem&&this._uvTextureRes){this.loop||this._time>this.timeLen&&(this.visible=!1);var b=Math.floor(this._time/(this.timeLen/this.frameInfoItem.length)),c=this.frameInfoItem[b%this.frameInfoItem.length];this.uvchangeData[0]=c.frame.x/this._uvTextureRes.width,this.uvchangeData[1]=c.frame.y/this._uvTextureRes.height,this.uvchangeData[2]=c.frame.w/this._uvTextureRes.width,this.uvchangeData[3]=c.frame.h/this._uvTextureRes.height,this.scaleX=c.sourceSize.w/100*this.frameScale,this.scaleY=c.sourceSize.h/100*this.frameScale}},b.prototype.initData=function(){if(b.baseFrameObjData)return void(this.objData=b.baseFrameObjData);this.objData=new ObjData,this.objData.vertices=new Array;var a=50,c=50;this.objData.vertices.push(-a,-c,.9),this.objData.vertices.push(a,-c,.9),this.objData.vertices.push(a,c,.9),this.objData.vertices.push(-a,c,.9),this.objData.uvs=new Array,this.objData.uvs.push(0,1),this.objData.uvs.push(1,1),this.objData.uvs.push(1,0),this.objData.uvs.push(0,0),this.objData.indexs=new Array,this.objData.indexs.push(0,1,2),this.objData.indexs.push(0,2,3),this.upToGpu(),b.baseFrameObjData=this.objData},b.prototype.makeFrameParticle=function(a,b,c){this.frameScale=1,this.isShow=!0;for(var d in c)this[d]=c[d];this.LoadAtlas(a,b)},b.prototype.LoadAtlas=function(a,b){var c=this;g.getInstance().load(a+b+".atlas",g.XML_TYPE,function(b){var d=Array(JSON.parse(b))[0];c.frameInfoItem=[];for(var e in d.frames){var f=new l;f.meshData(d.frames[e]),f.key=e,c.frameInfoItem.push(f)}isNaN(c.timeLen)&&(c.timeLen=100*c.frameInfoItem.length),h.getInstance().getTexture(a+d.meta.image,function(a,b){c._uvTextureRes=a})})},b.getFrameParticle=function(a,c,e){var f=new d;f.url=a+c,f.displayAry=new Array;var g=new b;return f.displayAry.push(g),g.bindVecter3d=f.bindVecter3d,g.makeFrameParticle(a,c,e),f},b.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=i.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=i.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=i.context3D.uploadIndexBuff3D(this.objData.indexs))},b.prototype.update=function(){this.visible&&this.objData&&this.objData.indexBuffer&&this._uvTextureRes&&(this.isShow?(i.context3D.setWriteDepth(!1),i.context3D.setDepthTest(!1)):(i.context3D.setWriteDepth(!1),i.context3D.setDepthTest(!0)),i.context3D.setProgram(this.shader.program),this.posMatrix=new Pan3d.Matrix3D,this.posMatrix.appendScale(this.scaleX,this.scaleY,1),this.bindVecter3d&&this.posMatrix.appendTranslation(this.bindVecter3d.x,this.bindVecter3d.y,this.bindVecter3d.z),i.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",i.viewMatrx3D.m),i.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",i.cam3D.cameraMatrix.m),i.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),i.context3D.setVc4fv(this.shader,"uvchange",this.uvchangeData),i.context3D.setVa(0,3,this.objData.vertexBuffer),i.context3D.setVa(1,2,this.objData.uvBuffer),i.context3D.setRenderTexture(this.shader,"s_texture",this._uvTextureRes.texture,0),i.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum),this.isShow&&(i.context3D.setWriteDepth(!0),i.context3D.setDepthTest(!0)))},b}(c);a.Frame3DAtlasParticle=n;var o=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.getParticleByte=function(a){a=a.replace("_byte.txt",".txt"),a=a.replace(".txt","_byte.txt");var b=new d,c=a;if(f.getInstance()._dic[c]){var e=f.getInstance()._dic[c];b=e.getCombineParticle()}return b.url=c,b},b.prototype.registerUrl=function(a){if(a=a.replace("_byte.txt",".txt"),a=a.replace(".txt","_byte.txt"),f.getInstance()._dic[a]){var b=f.getInstance()._dic[a];b.useNum++}},b.prototype.releaseUrl=function(a){if(a=a.replace("_byte.txt",".txt"),a=a.replace(".txt","_byte.txt"),f.getInstance()._dic[a]){var b=f.getInstance()._dic[a];b.clearUseNum()}},b.prototype.addResByte=function(a,b){if(!f.getInstance()._dic[a]){var c=new e;c.setDataByte(b),f.getInstance()._dic[a]=c}},b}(f);a.LayaOverride2dParticleManager=o}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.initConfig=function(){var a=this;Pan3d.UIData.resize=function(){a.uiScaleresize()},Pan3d.Engine.update=function(){a.update()},Pan3d.Engine.init=function(a){scene2d_me.Override2dEngine.init(a)},Pan3d.Engine.resetSize=function(a,b){scene2d_me.Override2dEngine.resetSize(a,b)},Pan3d.Engine.resetViewMatrx3D=function(){scene2d_me.Override2dEngine.resetViewMatrx3D()}},b.uiScaleresize=function(){console.log("重置什么也不做"),Pan3d.UIData.Scale=1},b}(scene3d_me.OverrideEngine);a.LayaOverride2dEngine=b}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=Pan3d.ResManager,c=Pan3d.Scene_data,d=Pan3d.SkillData,e=Pan3d.SkillManager,f=function(f){function g(a){var b=f.call(this)||this;return b.sceneManager=a,b}return __extends(g,f),g.prototype.addSrc=function(b,c){for(var d in c.data){var f=new a.OverrideSkill(this);f.name=d,f.isDeath=!0,f.src=!0,f.setData(c.data[d],c),c.addSrcSkill(f),e.getInstance();var g=b+d;e.getInstance()._skillDic[g]||(e.getInstance()._skillDic[g]=new Array),e.getInstance()._skillDic[g].push(f)}},g.prototype.playSkill=function(a){a.skillManager=this,f.prototype.playSkill.call(this,a)},g.prototype.getSkill=function(d,f,g){var h=this;void 0===g&&(g=null);var i,j=d+f,k=e.getInstance()._skillDic[j];if(k)for(var l=0;l<k.length;l++)if(i=k[l],i.isDeath&&0==i.useNum)return i.reset(),i.isDeath=!1,i;if(i=new a.OverrideSkill(this),i.name=f,i.isDeath=!1,e.getInstance()._skillDic[j]||(e.getInstance()._skillDic[j]=new Array),e.getInstance()._skillDic[j].push(i),this._dic[d])return i.setData(this._dic[d].data[i.name],this._dic[d]),i.key=j,this._dic[d].useNum++,i;if(e.getInstance()._loadDic[d]){var m=new Object;return m.name=f,m.skill=i,m.callback=g,e.getInstance()._loadDic[d].push(m),i}e.getInstance()._loadDic[d]=new Array;var m=new Object;return m.name=f,m.skill=i,m.callback=g,e.getInstance()._loadDic[d].push(m),b.getInstance().loadSkillRes(c.fileRoot+d,function(a){h.loadSkillCom(d,a)}),i},g.prototype.loadSkillCom=function(a,b){var c=new d;c.data=b.data;for(var f=0;f<e.getInstance()._loadDic[a].length;f++){var g=e.getInstance()._loadDic[a][f];g.skill.hasDestory||(g.skill.setData(c.data[g.name],c),g.skill.key=a+g.name,c.useNum++)}this._dic[a]=c,this.addSrc(a,c);for(var f=0;f<e.getInstance()._loadDic[a].length;f++){var g=e.getInstance()._loadDic[a][f];g.callback&&g.callback()}e.getInstance()._loadDic[a].length=0,e.getInstance()._loadDic[a]=null},g}(e);a.LayaOverride2dSkillManager=f}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.readParticle=function(){for(var a=this._byte.readInt(),b=(Pan3d.TimeUtil.getTimer(),0);a>b;b++){var c=Pan3d.Scene_data.fileRoot+this._byte.readUTF(),d=this._byte.readInt(),e=new Pan3d.Pan3dByteArray;e.length=d,this._byte.readBytes(e,0,d),this.scene.particleManager.addResByte(c,e)}},b}(Pan3d.GroupRes);a.LayaGroupRes=b;var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.getGroupData=function(a,c){var d=this;if(this._dic[a]){var e=this._dic[a];return e.useNum++,void c(e)}if(this._loadDic[a])return void this._loadDic[a].push(c);this._loadDic[a]=new Array,this._loadDic[a].push(c);var f=new b;f.scene=this.scene,f.load(a,function(){for(var b=d._loadDic[a],c=0;c<b.length;c++){var e=b[c];e(f)}d._dic[a]=f,delete d._loadDic[a],f.initReg()})},c}(Pan3d.GroupDataManager);a.LayaOverrideGroupDataManager=c}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=function(b){function c(){var d=b.call(this)||this;return d.particleManager=new a.LayaOverride2dParticleManager,d.shadowManager=new a.LayaOverrideShadowManager,d.skillManager=new a.LayaOverride2dSkillManager(d),d.groupDataManager=new a.LayaOverrideGroupDataManager,console.log("创建场景=>",c.sceneNum++),d}return __extends(c,b),c.initConfig=function(){Pan3d.SceneManager._instance=new c},c.prototype.update=function(){Pan3d.MathClass.getCamView(Pan3d.Scene_data.cam3D,Pan3d.Scene_data.focus3D),scene2d_me.GroundModel.getInstance().update(),this.upFrame()},c.prototype.changeBloodManager=function(a){},c.prototype.addMovieDisplay=function(a){a._scene=this,this._displayRoleList.push(a),a.addStage()},c.prototype.loadSceneConfigCom=function(a){var c=Pan3d.Scene_data.focus3D.rotationY;b.prototype.loadSceneConfigCom.call(this,a),Pan3d.Scene_data.focus3D.rotationY=c},c.prototype.playLyf=function(a,b,c){var d=this;void 0===c&&(c=0),this.groupDataManager.scene=this,this.groupDataManager.getGroupData(Pan3d.Scene_data.fileRoot+a,function(a){for(var e=0;e<a.dataAry.length;e++){var f=a.dataAry[e];if(f.types==Pan3d.BaseRes.SCENE_PARTICLE_TYPE){var g=d.particleManager.getParticleByte(Pan3d.Scene_data.fileRoot+f.particleUrl);g.x=b.x,g.y=b.y,g.z=b.z,g.rotationY=c,d.particleManager.addParticle(g),g.addEventListener(Pan3d.BaseEvent.COMPLETE,d.onPlayCom,d)}else console.log("播放的不是单纯特效")}})},c.prototype.charPlaySkill=function(a,b){if(a._scene.ready){var c=this.skillManager.getSkill(getSkillUrl(b),"skill_01");c.keyAry&&(c&&(c.reset(),c.isDeath=!1),c.configFixEffect(a),this.skillManager.playSkill(c))}},c.prototype.onPlayCom=function(a){this.particleManager.removeParticle(a.target)},c.prototype.upFrame=function(){Pan3d.Scene_data.context3D._contextSetTest.clear(),isNaN(this._time)&&(this._time=Pan3d.TimeUtil.getTimer()),this.updateMovieFrame(),this._ready&&(this.particleManager.updateTime(),this.skillManager.update(),this.render&&(Pan3d.Scene_data.context3D.setWriteDepth(!0),Pan3d.Scene_data.context3D.setDepthTest(!0),this.updateStaticDiplay(),this.updateSpriteDisplay(),this.updateMovieDisplay(),this.shadowManager.update(),Pan3d.Scene_data.context3D.setWriteDepth(!1),this.particleManager.update(),Pan3d.Scene_data.context3D.setBlendParticleFactors(0),Pan3d.Scene_data.context3D.setWriteDepth(!0),Pan3d.Scene_data.context3D.setWriteDepth(!1)),Pan3d.Scene_data.context3D.setDepthTest(!1),Pan3d.UIManager.getInstance().update(),this.cameraMatrix=Pan3d.Scene_data.cam3D.cameraMatrix.clone(),this.viewMatrx3D=Pan3d.Scene_data.viewMatrx3D.clone())},c.sceneNum=0,c}(scene3d_me.OverrideSceneManager);a.LayaOverride2dSceneManager=b}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=Pan3d.CombineParticle,c=Pan3d.Scene_data,d=Pan3d.ParticleManager,e=Pan3d.Vector3D,f=Pan3d.BaseRes,g=Pan3d.MaterialAnimShader,h=Pan3d.Display3DSprite,i=Pan3d.ShadowManager,j=function(a){function j(){var b=a.call(this)||this;return b._avatar=-1,b._visible=!0,b.changeColor=[1,1,1,1],b._alpha=1,b.x,b}return __extends(j,a),Object.defineProperty(j.prototype,"alpha",{get:function(){return this._alpha},set:function(a){this._alpha=a,this.changeColor[0]=1,this.changeColor[1]=1,this.changeColor[2]=1,this.changeColor[3]=a},enumerable:!0,configurable:!0}),j.prototype.updateMaterialMesh=function(b){if(1!=this.changeColor[0]||1!=this.changeColor[1]||1!=this.changeColor[2]||1!=this.changeColor[3]){j.alphaShader||(j.alphaShader=this.makeAlphaShader());var d=b.material.shader;b.material.shader=j.alphaShader,c.context3D.setProgram(j.alphaShader.program),c.context3D.cullFaceBack(!1),c.context3D.setBlendParticleFactors(-1),this.setVcMatrix(b),this.setMaterialTextureAlpha(b.material,b.materialParam),this.setVa(b),c.context3D.setVc4fv(b.material.shader,"alphadata",this.changeColor),this.setMeshVc(b),c.context3D.drawCall(b.indexBuffer,b.treNum),b.material.shader=d}else a.prototype.updateMaterialMesh.call(this,b)},j.prototype.playSkill=function(a){var b=this._scene;this._walkPath=null,b.skillManager.playSkill(a),this.skillVo=a},j.prototype.setMaterialTextureAlpha=function(a,b){void 0===b&&(b=null);for(var d=a.texList,e=0;e<d.length;e++)if(d[e].isMain){var f=d[e].texture;if(b)for(var g=0;g<b.dynamicTexList.length;g++)b.dynamicTexList[g].target&&b.dynamicTexList[g].target.name==d[e].name&&(f=b.dynamicTexList[g].texture);c.context3D.setRenderTexture(a.shader,"alphatexture",f,0)}},j.prototype.makeAlphaShader=function(){var a=new g;a.paramAry=[!1,!1,!1,!1,!1,!1,!1,0],a.fragment="precision mediump float;\nuniform sampler2D alphatexture;\nuniform vec4 alphadata;\nvarying vec2 v0;\nvoid main(void){\nvec4 ft0 = texture2D(alphatexture,v0);\ngl_FragColor =ft0*alphadata;\n}";a.encode();return a},Object.defineProperty(j.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0}),j.prototype.setAvatar=function(a){this._avatar!=a&&(this._avatar=a,this.setRoleUrl(this.getSceneCharAvatarUrl(a)))},Object.defineProperty(j.prototype,"shadow",{set:function(a){var b=this._scene;a?this._shadow||(this._shadow=b.shadowManager.addShadow()):this._shadow&&b.shadowManager.removeShadow(this._shadow)},enumerable:!0,configurable:!0}),j.prototype.update=function(){this.visible&&a.prototype.update.call(this),this._shadow&&(this._shadow._visible=this.visible)},j.prototype.getSceneCharAvatarUrl=function(a){getRoleUrl(String(a));return getRoleUrl(String(a))},j.prototype.getSceneCharWeaponUrl=function(a,b){return void 0===b&&(b=""),getModelUrl(String(a+b))},j.prototype.isPlaying=function(){return 1!=this._completeState||!this._curentFrame||this._curentFrame<this._animDic[this.curentAction].matrixAry.length-1},j.prototype.loadPartRes=function(a,b,g){if(!this._hasDestory){for(var i=0;i<b.dataAry.length;i++){var j,k,l,m=b.dataAry[i];if(m.isGroup&&(j=new e(m.x,m.y,m.z),k=new e(m.rotationX,m.rotationY,m.rotationZ),l=new e(m.scaleX,m.scaleY,m.scaleZ)),m.types==f.SCENE_PARTICLE_TYPE){var n=d.getInstance().getParticleByte(c.fileRoot+m.particleUrl);g.push(n),n.bindTarget=this,n.bindSocket=a,n.dynamic=!0,this._scene.particleManager.addParticle(n),m.isGroup&&n.setGroup(j,k,l)}else if(m.types==f.PREFAB_TYPE){var o=new h;o.setObjUrl(m.objUrl),o.setMaterialUrl(m.materialUrl,m.materialInfoArr),o.dynamic=!0,g.push(o),o.setBind(this,a),this._scene.addSpriteDisplay(o),m.isGroup&&o.setGroup(j,k,l)}}this.applyVisible()}},j.prototype.removeStage=function(){this._onStage=!1,this._shadow&&i.getInstance().removeShadow(this._shadow);for(var a in this._partDic)for(var c=this._partDic[a],d=0;d<c.length;d++)c[d]instanceof b?this._scene.particleManager.removeParticle(c[d]):c[d]instanceof h&&this._scene.removeSpriteDisplay(c[d])},Object.defineProperty(j.prototype,"px",{get:function(){return this.x},set:function(a){this.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"py",{get:function(){return this.y},set:function(a){this.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"pz",{get:function(){return this.z},set:function(a){this.z=a},enumerable:!0,configurable:!0}),j.prototype.addSkinMeshParticle=function(){if(this._skinMesh){var a=new Array;this._partDic.mesh=a;var b=this._skinMesh.meshAry;if(b)for(var e=0;e<b.length;e++)for(var f=b[e].particleAry,g=0;g<f.length;g++){var h,i=f[g];h=d.getInstance().getParticleByte(c.fileRoot+i.url),h.sourceData||console.log("particle.sourceData error"),h.dynamic=!0,h.bindSocket=i.socketName,a.push(h),h.bindTarget=this,this._scene.particleManager.addParticle(h)}}},j}(Pan3d.Display3dMovie);a.LayaSceneBaseChar=j}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),layapan_me;!function(a){var b=Pan3d.Display3DSprite,c=Pan3d.ProgrmaManager,d=Pan3d.Vector3D,e=Pan3d.Vector2D,f=Pan3d.Scene_data,g=Pan3d.MathClass,h=Pan3d.TestTriangle,i=Pan3d.LineDisplayShader,j=Pan3d.LineDisplaySprite,k=Pan3d.CombineParticle,l=Pan3d.CharAction,m=Pan3d.BaseRes,n=Pan3d.ParticleManager,o=function(o){function p(){var a=o.call(this)||this;return a.isMount=!1,a._px=0,a._py=0,a._pz=0,a._pRotationY=0,a.toRotationY=0,a._pScale=1,a.tittleHeight=50,a._optimization=!1,a._weaponNum=-1,a._resultVisible=!0,a._hpRatio=0,a._bloodEnable=!1,a._angerRatio=0,a._angerEnable=!1,a._nameEnable=!1,a._showHitBox=!1,a._triIndex=[0,1,2,0,2,3,4,5,6,4,6,7,0,4,5,0,5,1,1,5,6,1,6,2,2,6,7,2,7,3,3,7,4,3,4,0],a.skillitem=new Array,a._bloodColor=p.BLOOD_COLOR_HP,a._angerColor=p.BLOOD_COLOR_ANGER,a}return __extends(p,o),Object.defineProperty(p.prototype,"forceRotationY",{set:function(a){this.pRotationY=a,this.rotationY=a,this.toRotationY=a},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"pRotationY",{get:function(){return this._pRotationY},set:function(a){this._pRotationY=a,this.isMount?this._mountChar.rotationY=a:this.rotationY=a},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"pScale",{get:function(){return this._pScale},set:function(a){this._pScale=a,this._mountChar&&(this._mountChar.scale=a),this._wingDisplay&&(this._wingDisplay.scale=a),this.scale=a,this._skinMesh&&(this.tittleHeight=this._skinMesh.tittleHeight*a)},enumerable:!0,configurable:!0}),p.prototype.setMount=function(b){return this.isMount=b&&0!=b.length,this.isMount?(this._mountChar||(this._mountChar=new a.LayaSceneBaseChar,this._mountChar.scale=this._pScale),this._mountChar.setRoleUrl(getRoleUrl(b)),this.setBind(this._mountChar,p.MOUNT_SLOT),this._mountChar._scene=this._scene,this._scene&&this._scene.addMovieDisplay(this._mountChar)):(this.setBind(null,null),this._mountChar&&(this._mountChar=null)),this.isMount},p.prototype.setWing=function(b){b&&b.length?(this._wingDisplay||(this._wingDisplay=new a.LayaSceneBaseChar,this._wingDisplay.scale=this._pScale),this._wingDisplay.setRoleUrl(getRoleUrl(b)),this._wingDisplay.setBind(this,p.WING_SLOT),this._wingDisplay._scene=this._scene,this._scene&&this._scene.addMovieDisplay(this._wingDisplay)):this._wingDisplay&&(this._wingDisplay.setBind(null,null),this._wingDisplay=null)},p.prototype.setWeapon=function(a){this._weaponNum!=a&&(this._weaponNum=a,0>=a?this.removePart(p.WEAPON_PART):this.setWeaponByAvatar(this._weaponNum))},p.prototype.setWeaponByAvatar=function(a,b){void 0===b&&(b=""),this.addPart(p.WEAPON_PART,p.WEAPON_DEFAULT_SLOT,this.getSceneCharWeaponUrl(a,b))},p.prototype.addPart=function(a,b,c){var d=this;if(this._partUrl[a]!=c){this._partUrl[a]&&this.removePart(a),this._partDic[a]||(this._partDic[a]=new Array),this._partUrl[a]=c;var e=this._partDic[a];this._scene.groupDataManager.scene=this._scene,this._scene.groupDataManager.getGroupData(f.fileRoot+c,function(a){console.log(b,a,e),d.loadPartRes(b,a,e)})}},p.prototype.addPartToPos=function(a,b,c){var d=this;if(void 0===c&&(c=null),this._partUrl[a]!=b){this._partUrl[a]&&this.removePart(a),this._partDic[a]||(this._partDic[a]=new Array),this._partUrl[a]=b;var e=this._partDic[a];this._scene.groupDataManager.scene=this._scene,this._scene.groupDataManager.getGroupData(f.fileRoot+b,function(a){d.loadPartToPos(a,e,c)})}},p.prototype.loadPartToPos=function(a,c,e){if(!this._hasDestory){for(var g=0;g<a.dataAry.length;g++){var h=a.dataAry[g],i=new d(e.x,e.y,e.z),j=new d(0,0,0),k=new d(1,1,1);if(h.isGroup&&(i=new d(h.x+e.x,h.y+e.y,h.z+e.z),j=new d(h.rotationX,h.rotationY,h.rotationZ),k=new d(h.scaleX,h.scaleY,h.scaleZ)),h.types==m.SCENE_PARTICLE_TYPE){var l=n.getInstance().getParticleByte(f.fileRoot+h.particleUrl);c.push(l),l.bindTarget=this,l.bindSocket=Pan3d.SceneChar.NONE_SLOT,l.dynamic=!0,this._scene.particleManager.addParticle(l),l.setGroup(i,j,k)}else if(h.types==m.PREFAB_TYPE){var o=new b;o.setObjUrl(h.objUrl),o.setMaterialUrl(h.materialUrl,h.materialInfoArr),o.dynamic=!0,c.push(o),o.setBind(this,Pan3d.SceneChar.NONE_SLOT),this._scene.addSpriteDisplay(o),o.setGroup(i,j,k)}}this.applyVisible()}},p.prototype.removePart=function(a){var c=this._partDic[a];if(c){for(var d=0;d<c.length;d++)c[d]instanceof k?(this._scene.particleManager.removeParticle(c[d]),c[d].destory()):c[d]instanceof b&&(this._scene.removeSpriteDisplay(c[d]),c[d].destory());this._partDic[a]=null,this._partUrl[a]=null,delete this._partDic[a],delete this._partUrl[a]}},p.prototype.getSceneCharAvatarUrl=function(a){var b=String(a);if(0==a)throw new Error("衣服为getSceneCharAvatarUrl");var c=getRoleUrl(b);return c},p.prototype.onMeshLoaded=function(){this._skinMesh&&(this.tittleHeight=this._skinMesh.tittleHeight*this._pScale)},p.prototype.play=function(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=!0),this.isMount?(this._mountChar.visible=Boolean(a!=l.JUMP),a==l.STANAD?o.prototype.play.call(this,l.STAND_MOUNT):a==l.WALK?o.prototype.play.call(this,l.WALK_MOUNT):this._mountChar.visible?o.prototype.play.call(this,l.STAND_MOUNT):o.prototype.play.call(this,l.JUMP),this._mountChar.play(a,b,c)):o.prototype.play.call(this,a,b,c)},p.prototype.getCurrentAction=function(){return this.isMount?this._mountChar.curentAction:this.curentAction},p.prototype.rotationToNew=function(a,b){void 0===b&&(b=1);var c=a-this.pRotationY;if(0!=c){if(1>c)return void(this.pRotationY=a);var d=((a-this.pRotationY)%360+360)%360;d>180?this.pRotationY-=(360-d)/b:this.pRotationY+=d/b}},p.prototype.stopMove=function(){this.play(l.STANAD)},p.prototype.watch=function(a,b){if(void 0===b&&(b=!1),a){var c=a.x-this.px,d=a.z-this.pz,e=Math.sqrt(c*c+d*d);c/=e,d/=e;var f=Math.asin(c)/Math.PI*180;0>=d&&(f=180-f),isNaN(f)||(this.forceRotationY=f)}},p.prototype.getCurrentPos=function(){return new d(this.px,this.py,this.pz)},p.prototype.msgSpellStop=function(){this.skillVo&&(this.skillVo.removeSkillForce(),this.changeAction(this._defaultAction),this.skillVo=null),this.isSinging=!1},p.prototype.destory=function(){this._hasDestory||(this.skillVo&&(this.skillVo.removeSkillForce(),this.skillVo=null),this._mountChar&&(this._mountChar.destory(),this._mountChar=null),this._wingDisplay&&(this._wingDisplay.destory(),this._wingDisplay=null),this._charNameVo&&(this._charNameVo.destory(),this._charNameVo=null),this._charBloodVo&&(this._charBloodVo.destory(),this._charBloodVo=null),this._charAngerVo&&(this._charAngerVo.destory(),this._charAngerVo=null),this._hasDestory=!0,o.prototype.destory.call(this))},Object.defineProperty(p.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a,this.applyVisible()},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"optimization",{get:function(){return this._optimization},set:function(a){this._optimization=a,this.applyVisible()},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"resultVisible",{get:function(){return this._resultVisible},enumerable:!0,configurable:!0}),p.prototype.applyVisible=function(){var a=this._visible;if(a=this._visible?this._optimization?!1:!0:!1,this._partDic&&this._partDic[p.WEAPON_PART])for(var b=0,c=this._partDic[p.WEAPON_PART];b<c.length;b++){var d=c[b];d.sceneVisible=a}this._resultVisible=a},Object.defineProperty(p.prototype,"isCamera2D",{set:function(a){this._isCamera2D=a},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"bloodColor",{set:function(a){this._bloodColor=a,
this._charBloodVo&&(this._charBloodVo.colortype=this._bloodColor)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"hpRatio",{get:function(){return this._hpRatio},set:function(a){this._hpRatio=a,this._charBloodVo&&(this._charBloodVo.num=this._hpRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"bloodEnable",{set:function(a){this._bloodEnable=a},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angerColor",{set:function(a){this._angerColor=a,this._charAngerVo&&(this._charAngerVo.colortype=this._angerColor)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angerRatio",{get:function(){return this._angerRatio},set:function(a){this._angerRatio=a,this._charAngerVo&&(this._charAngerVo.num=this._angerRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angerEnable",{set:function(a){this._angerEnable=a},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"charName",{get:function(){return this._charName||""},set:function(a){this._charName!=a&&(this._charName=a,this._charNameVo&&(this._charNameVo.name=this._charName))},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"nameEnable",{set:function(a){this._nameEnable=a},enumerable:!0,configurable:!0}),p.prototype.updateBind=function(){o.prototype.updateBind.call(this),this.updateWeaponScale(),this.refreshPos()},p.prototype.updateWeaponScale=function(){if(this._partDic.hasOwnProperty(p.WEAPON_PART)){var a=this._partDic[p.WEAPON_PART];if(a instanceof Array)for(var c=0;c<a.length;c++){var d=a[c];d instanceof b&&(d.scale=this._pScale)}}},p.prototype.refreshPos=function(){var a=this.py+this.tittleHeight;this.isMount&&(a+=20),this._charAngerVo&&(this._charAngerVo.pos.x=this.px,this._charAngerVo.pos.y=a,this._charAngerVo.pos.z=this.pz,this._charAngerVo.visible=this._resultVisible,this._isCamera2D,a+=5),this._charBloodVo&&(this._charBloodVo.pos.x=this.px,this._charBloodVo.pos.y=a,this._charBloodVo.pos.z=this.pz,this._charBloodVo.visible=this._resultVisible,this._isCamera2D,a+=10),this._charNameVo&&(this._charNameVo.pos.x=this.px,this._charNameVo.pos.y=a,this._charNameVo.pos.z=this.pz,this._charNameVo.visible=this._resultVisible)},Object.defineProperty(p.prototype,"px",{get:function(){return this._px},set:function(a){this._px=a,this._mountChar?this._mountChar.x=this._px:this.x=this.px},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"pz",{get:function(){return this._pz},set:function(a){this._pz=a,this._mountChar?this._mountChar.z=this._pz:this.z=this.pz},enumerable:!0,configurable:!0}),p.prototype.update=function(){if(this._skinMesh&&!this._optimization&&(o.prototype.update.call(this),this._showHitBox)){if(!this.lineSprite){c.getInstance().registe(i.LineShader,new i),this.lineSprite=new j,this.lineSprite.clear();for(var a=0;a<this._triIndex.length/3;a++){var b=this._skinMesh.hitPosItem[this._triIndex[3*a+0]],d=this._skinMesh.hitPosItem[this._triIndex[3*a+1]],e=this._skinMesh.hitPosItem[this._triIndex[3*a+2]];this.lineSprite.makeLineMode(b,d),this.lineSprite.makeLineMode(d,e),this.lineSprite.makeLineMode(e,b)}this.lineSprite.upToGpu()}this.lineSprite.posMatrix=this.posMatrix.clone(),this.lineSprite.update()}},p.prototype.math_distance=function(a){return g.math_distance(this.px,this.pz,a.x,a.z)},p.prototype.get2dPos=function(){var a=new e,b=.25/scene2d_me.Override2dEngine.htmlScale;return this._mountChar?(a.x=this._mountChar.px,a.y=this._mountChar.pz):(a.x=this.px,a.y=this.pz),a.x=a.x/b,a.y=a.y/-1*Math.sin(45*Math.PI/180)/b,a},p.prototype.set2dPos=function(a,b){var c=.25/scene2d_me.Override2dEngine.htmlScale,d=a*c,e=b*c/Math.sin(45*Math.PI/180)*-1;this._px=d,this._pz=e,this._mountChar?(this._mountChar.x=d,this._mountChar.z=e):(this.x=d,this.z=e)},p.prototype.math3DWorldtoDisplay2DPos=function(a){var b=this._scene,c=b.cameraMatrix.clone();c.append(b.viewMatrx3D.clone());var d=f.stageWidth,g=f.stageHeight,h=c.transformVector(a),i=new e;return i.x=(h.x/h.w+1)*(d/2),i.y=(-h.y/h.w+1)*(g/2),i},p.prototype.mouseClik=function(a,b){var c=this._scene,d=c.cameraMatrix.transformVector(this.getCurrentPos());if(d.z<10)return!1;var f=this.math3DWorldtoDisplay2DPos(b);if(this._skinMesh){this._hitBox2DItem||(this._hitBox2DItem=new Array),this._hitBox2DItem.length=0;for(var g=0;g<this._skinMesh.hitPosItem.length;g++){var i=this.posMatrix.transformVector(this._skinMesh.hitPosItem[g]);this._hitBox2DItem.push(this.math3DWorldtoDisplay2DPos(i))}for(var j=0;j<this._triIndex.length/3;j++)if(h.baseTri.p1=this._hitBox2DItem[this._triIndex[3*j+0]],h.baseTri.p2=this._hitBox2DItem[this._triIndex[3*j+1]],h.baseTri.p3=this._hitBox2DItem[this._triIndex[3*j+2]],h.baseTri.checkPointIn(f))return console.log(this._hitBox2DItem),!0}else if(e.distance(f,this.math3DWorldtoDisplay2DPos(this.posMatrix.position))<20)return!0;return!1},p.prototype.removeStage=function(){o.prototype.removeStage.call(this),this._charNameVo&&(this._charNameVo.visible=!1),this._charBloodVo&&(this._charBloodVo.visible=!1),this._mountChar&&this._scene.removeMovieDisplay(this._mountChar),this._wingDisplay&&this._scene.removeMovieDisplay(this._wingDisplay)},p.prototype.addStage=function(){o.prototype.addStage.call(this),this._charNameVo&&(this._charNameVo.visible=!0),this._charBloodVo&&(this._charBloodVo.visible=!0),this._mountChar&&this._scene.addMovieDisplay(this._mountChar),this._wingDisplay&&this._scene.addMovieDisplay(this._wingDisplay)},p.BLOOD_COLOR_HP=0,p.BLOOD_COLOR_ANGER=1,p.Defaul_Man_Avatar=2002,p.Defaul_WoMan_Avater=2012,p.WEAPON_PART="weapon",p.WEAPON_DEFAULT_SLOT="w_01",p.MOUNT_SLOT="mount_01",p.WING_SLOT="wing_01",p.SEL_PART="select",p.QUEST_ICON="questicon",p.NONE_SLOT="none",p}(a.LayaSceneBaseChar);a.LayaSceneChar=o}(layapan_me||(layapan_me={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),pack;!function(a){var b=Pan3d.EventDispatcher,c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getName=function(){return"prefab"},b}(b);a.Prefab=c}(pack||(pack={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),pack;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return b.sunColor=new Vector3D(2,3,4,1),b}return __extends(b,a),b.prototype.getObject=function(){var a={};return a.material=this.material,a.name=this.getName(),a.objsurl=this.objsurl,a.paramInfo=this.paramInfo,a.sunColor=this.sunColor,a.textureurl=this.textureurl,a.url=this.url,a},b}(a.Prefab);a.PrefabStaticMesh=b}(pack||(pack={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),pack;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.getObject=function(){var a={};return a.name=this.getName(),a.meshAry=this.skinMesh.meshAry,a.animDic=this.animDic,a.animPlayKey=this.animPlayKey,a.version=this.version,a},b}(a.Prefab);a.RoleStaticMesh=b}(pack||(pack={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),pack;!function(a){var b=Pan3d.EventDispatcher,c=function(a){function b(){var b=a.call(this)||this;return b.actionnum=-1,b.interval=2,b}return __extends(b,a),b.prototype.getObject=function(){var a={};return a.skillUrl=this.skillUrl,a.roleUrl=this.roleUrl,a.url=this.url,a.actionnum=this.actionnum,a.interval=this.interval,a.version=this.version,a},b.prototype.getName=function(){return"skill"},b}(b);a.SkillStatcMesh=c}(pack||(pack={}));var pack;!function(a){var b=Pan3d.LoadManager,c=Pan3d.Scene_data,d=Pan3d.ConstItem,e=Pan3d.TexItem,f=Pan3d.TextureManager,g=Pan3d.TextureRes,h=function(){function a(){this.dic={},this.loadDic={}}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.replaceMaterialByUrl=function(a){var d=this;b.getInstance().load(c.fileRoot+a,b.BYTE_TYPE,function(b){var c=new Pan3d.Pan3dByteArray(b);c.position=0;var e=JSON.parse(c.readUTF());if(d.dic[a]){var f=d.dic[a];f.setData({data:e.data})}})},a.prototype.makeRoleShader=function(a,b){var c=new left.RoleMaterialShader;if(b.info.paramAry){c.paramAry=[];for(var d=0;d<b.info.paramAry.length;d++)c.paramAry.push(b.info.paramAry[d])}else c.paramAry=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];c.vertex=c.getVertexShaderString(),c.fragment=b.info.shaderStr,c.encode(),a.roleShader=c},a.prototype.outShader=function(a){var b=a.split("\n");console.log("----");for(var c=0;c<b.length;c++){var d='"';d+=b[c],c<b.length-1?(d+="\\n",d+='"',d+="+"):d+='"',console.log(d)}console.log("----")},a.prototype.makeMaterialShaderByByte=function(a,b,c){void 0===c&&(c=null),a.position=0;var d=JSON.parse(a.readUTF()),e=new left.BuildMaterialShader;if(d.info.paramAry){e.paramAry=[];for(var f=0;f<d.info.paramAry.length;f++)e.paramAry.push(d.info.paramAry[f])}else e.paramAry=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];e.vertex=e.getVertexShaderString(),e.fragment=d.info.shaderStr,e.encode();var g;return g=c?c:new materialui.MaterialTree,g.setData({data:d.data}),g.useNormal=d.info.useNormal,g.hasTime=d.info.hasTime,g.hasTime&&(g.timeValue=new Vector2D(d.info.timeValue.x,d.info.timeValue.y)),g.showurl=d.info.showurl,g.blendMode=d.info.blendMode,g.writeZbuffer=d.info.writeZbuffer,g.zbuff=d.info.zbuff,g.useLightUv=e.paramAry[2],g.texList=this.makeTextList(d.info.texList),g.constList=this.makeConstList(d.info.constList),g.fcData=this.makeFc(g.constList,d.info.fcData.split(",")),g.fcNum=Math.round(g.fcData.length/4),g.modelShader=e,g.url=b,this.makeRoleShader(g,d),g},a.prototype.getMaterialByUrl=function(a,d){var e=this;this.dic[a]&&d(this.dic[a]),this.loadDic[a]?this.loadDic[a].push(d):(this.loadDic[a]=[d],b.getInstance().load(c.fileRoot+a,b.BYTE_TYPE,function(b){var c=new Pan3d.Pan3dByteArray(b),d=e.makeMaterialShaderByByte(c,a);for(e.dic[a]||(e.dic[a]=d);e.loadDic[a].length;)e.loadDic[a].pop()(d)}))},a.prototype.makeConstList=function(a){for(var b=[],c=0;c<a.length;c++){var e=new d;for(var f in a[c])e[f]=a[c][f];e.name="fc"+c,e.offset=c,e.id=c,b.push(e)}return b},a.prototype.makeFc=function(a,b){for(var c=new Float32Array(b.length),d=0;d<b.length;d++)c[d]=Number(b[d]);for(var e=0;e<a.length;e++)a[e].creat(c);return c},a.prototype.loadTextureRes=function(a){a.type==e.CUBEMAP?b.getInstance().load(c.fileRoot+a.url,b.IMG_TYPE,function(b,c){a.textureRes=new g,a.textureRes.texture=Pan3d.CubemapLoad.makeTempCubeTextture(b)}):f.getInstance().getTexture(c.fileRoot+a.url,function(b){a.textureRes=b})},a.prototype.makeTextList=function(a){for(var b=new Array,c=0;c<a.length;c++){var d=new e;d.id=a[c]._id,d.url=a[c].url,d.name=a[c].name,d.isDynamic=a[c].isDynamic,d.paramName=a[c].paramName,d.isMain=a[c].isMain,d.type=a[c].type,this.loadTextureRes(d),b.push(d)}return b},a}();a.PackMaterialManager=h}(pack||(pack={}));var pack;!function(a){var b=Pan3d.LoadManager,c=Pan3d.Scene_data,d=function(){function a(){this.dic={},this.loadDic={}}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.getObjDataByUrl=function(a,d){var e=this;this.dic[a]&&d(this.dic[a]),this.loadDic[a]?this.loadDic[a].push(d):(this.loadDic[a]=[d],b.getInstance().load(c.fileRoot+a,b.XML_TYPE,function(b){var c=e.readTxtToModel(b);for(e.dic[a]||(e.dic[a]=c);e.loadDic[a].length;)e.loadDic[a].pop()(c)}))},a.prototype.readTxtToModel=function(a){var b=JSON.parse(a),d=new ObjData;return d.vertices=b.vertices,d.normals=b.normals,d.uvs=b.uvs,d.lightuvs=b.lightuvs,d.indexs=b.indexs,d.treNum=d.indexs.length,TBNUtils.processTBN(d),d.vertexBuffer=c.context3D.uploadBuff3D(d.vertices),d.uvBuffer=c.context3D.uploadBuff3D(d.uvs),d.lightUvBuffer=c.context3D.uploadBuff3D(d.lightuvs),d.tangentBuffer=c.context3D.uploadBuff3D(d.tangents),d.bitangentBuffer=c.context3D.uploadBuff3D(d.bitangents),d.normalsBuffer=c.context3D.uploadBuff3D(d.normals),d.indexBuffer=c.context3D.uploadIndexBuff3D(d.indexs),d},a}();a.PackObjDataManager=d}(pack||(pack={}));var pack;!function(a){var b=Pan3d.LoadManager,c=Pan3d.Scene_data,d=Pan3d.Pan3dByteArray,e=a.PrefabStaticMesh,f=Pan3d.TextureManager,g=Pan3d.DynamicBaseConstItem,h=Pan3d.DynamicBaseTexItem,i=function(){function i(){this.dic={},this.loadDic={}}return i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.playBfun=function(a,b){for(this.dic[b]||(this.dic[b]=a);this.loadDic[b].length;)this.loadDic[b].pop()(a)},i.prototype.makeMaterialBaseParam=function(a,b){a.dynamicConstList=[],a.dynamicTexList=[];for(var c=0;b&&c<b.length;c++){var d=b[c];"tex"==d.type?this.mekeParamTexture(d,a):this.makeParamValue(d,a)}},i.prototype.makeParamValue=function(a,b){for(var c=b.material.constList,d=a.paramName,e=null,f=0;f<c.length;f++)if(d==c[f].paramName0||d==c[f].paramName1||d==c[f].paramName2||d==c[f].paramName3){e=c[f];break}var h=new g;switch(h.setTargetInfo(e,d,a.type),a.type){case"vec3":h.setCurrentVal(a.data.x,a.data.y,a.data.z);break;case"vec2":h.setCurrentVal(a.data.x,a.data.y);break;case"float":h.setCurrentVal(a.data)}b.dynamicConstList.push(h)},i.prototype.mekeParamTexture=function(a,b){var d=b.material.texList,e=new h;e.paramName=a.paramName;for(var g=0;g<d.length;g++)if(e.paramName==d[g].paramName){e.target=d[g];break}f.getInstance().getTexture(c.fileRoot+a.data,function(a){e.textureRes=a}),b.dynamicTexList.push(e)},i.prototype.getPrefabByUrl=function(f,g){var h=this;this.dic[f]&&g(this.dic[f]),this.loadDic[f]?this.loadDic[f].push(g):(this.loadDic[f]=[g],b.getInstance().load(c.fileRoot+f,b.BYTE_TYPE,function(b){var c=JSON.parse(new d(b).readUTF()),g=new e;for(var i in c)g[i]=c[i];g.url=f,g.objsurl?a.PackObjDataManager.getInstance().getObjDataByUrl(g.objsurl,function(b){g.objData=b,g.textureurl&&a.PackMaterialManager.getInstance().getMaterialByUrl(g.textureurl,function(a){g.material=a,h.playBfun(g,f)})}):(console.log("没有模型地址"),g.textureurl?a.PackMaterialManager.getInstance().getMaterialByUrl(g.textureurl,function(a){g.material=a,h.playBfun(g,f)}):console.log("没有材质地址"))}))},i}();a.PackPrefabManager=i}(pack||(pack={}));var pack;!function(a){var b=Pan3d.LoadManager,c=Pan3d.Scene_data,d=a.RoleStaticMesh,e=Pan3d.MeshData,f=Pan3d.AnimData,g=Pan3d.SkinMesh,h=Pan3d.DualQuatFloat32Array,i=Pan3d.Dictionary,j=function(){function j(){this.dic={},this.loadDic={}}return j.getInstance=function(){return this._instance||(this._instance=new j),this._instance},j.prototype.playBfun=function(a,b){for(this.dic[b]||(this.dic[b]=a);this.loadDic[b].length;)this.loadDic[b].pop()(a)},j.prototype.makeBufToRole=function(a){var b=a.vertices.length/3*a.stride,d=new ArrayBuffer(b),e=new DataView(d);this.pushToBuff(e,a.vertices,3,0,a.stride),this.pushToBuff(e,a.uvs,2,a.uvsOffsets,a.stride),this.pushToBuff(e,a.tangents,3,a.tangentsOffsets,a.stride),this.pushToBuff(e,a.bitangents,3,a.bitangentsOffsets,a.stride),this.pushToBuff(e,a.normals,3,a.normalsOffsets,a.stride),this.pushToBuff(e,a.boneIDAry,4,a.boneIDOffsets,a.stride),this.pushToBuff(e,a.boneWeightAry,4,a.boneWeightOffsets,a.stride),a.vertexBuffer=c.context3D.uploadBuff3DArrayBuffer(d),a.indexBuffer=c.context3D.uploadIndexBuff3D(a.indexs)},j.prototype.pushToBuff=function(a,b,c,d,e){for(var f=a.byteLength/e,g=0,h=0;f>h;h++)for(var i=h*e+d,j=0;c>j;j++){var k=b[g++];a.setFloat32(i+4*j,k,!0)}},j.prototype.getFloat32ArrayByArr=function(a){var b=new Array;for(var c in a)b.push(a[c]);for(var d=new Float32Array(b.length),e=0;e<b.length;e++)d[e]=b[e];return d},j.prototype.getmeshBoneQPAryDic=function(a){var b=new i([]);for(var c in a){for(var d=new Array,e=0;e<a[c].length;e++){for(var f=a[c][e],g=new Array,j=0;j<f.length;j++){var k=f[j],l=new h;l.quat=this.getFloat32ArrayByArr(k.quat),l.pos=this.getFloat32ArrayByArr(k.pos),g.push(l)}d.push(g)}b[c]=d}return b},j.prototype.getRoleZzwByUrl=function(a,h){var i=this;this.dic[a]&&h(this.dic[a]),this.loadDic[a]?this.loadDic[a].push(h):(this.loadDic[a]=[h],b.getInstance().load(c.fileRoot+a,b.XML_TYPE,function(b){var c=JSON.parse(b),h=new d;h.url=a,h.animPlayKey=c.animPlayKey;var j=new g;j.meshAry=new Array;for(var k=0;k<c.meshAry.length;k++){var l=new e;for(var m in c.meshAry[k])l[m]=c.meshAry[k][m];l.material=null,i.makeBufToRole(l),l.compressBuffer=!0,j.meshAry.push(l)}var n={};for(var o in c.animDic){var p=new f;p.meshBoneQPAryDic=i.getmeshBoneQPAryDic(c.animDic[o].meshBoneQPAryDic),n[o]=p}if(h.skinMesh=j,h.animDic=n,h.skinMesh.meshAry.length)for(var k=0;k<h.skinMesh.meshAry.length;k++)i.loadMeshArrBy(h.skinMesh.meshAry,k,function(){i.playBfun(h,a)});else i.playBfun(h,a)}))},j.prototype.loadMeshArrBy=function(b,c,d){b[c].materialUrl||(b[c].materialUrl="assets/base/base.material"),a.PackMaterialManager.getInstance().getMaterialByUrl(b[c].materialUrl,function(a){a.shader=a.roleShader,b[c].material=a;for(var e=!0,f=0;f<b.length;f++)b[f].material||(e=!1);e&&d()})},j}();a.PackRoleManager=j}(pack||(pack={}));var pack;!function(a){var b=Pan3d.LoadManager,c=Pan3d.Scene_data,d=function(){function d(){this.dic={},this.loadDic={}}return d.getInstance=function(){return this._instance||(this._instance=new d),this._instance},d.prototype.playBfun=function(a,b){for(this.dic[b]||(this.dic[b]=a);this.loadDic[b].length;)this.loadDic[b].pop()(a)},d.prototype.getPrefabByUrl=function(d,e){var f=this;this.dic[d]&&e(this.dic[d]),this.loadDic[d]?this.loadDic[d].push(e):(this.loadDic[d]=[e],b.getInstance().load(c.fileRoot+d,b.XML_TYPE,function(b){var c=JSON.parse(b),e=new a.SkillStatcMesh;for(var g in c)e[g]=c[g];e.url=d,f.playBfun(e,d)}))},d}();a.PackSkillManager=d}(pack||(pack={}));var md5list;!function(a){var b=Pan3d.MeshData,c=Pan3d.Quaternion,d=Pan3d.Vector3D,e=Pan3d.Scene_data,f=function(){function f(){}return f.prototype.getObj=function(f){var g=new b;g.vertices=new Array,g.uvs=new Array,g.normals=new Array,g.indexs=new Array;for(var h=new Array,i=new Array,j=new Array,k=this.processBoneNew(f.boneItem),l=0;l<k.length;l++){var m=k[l],n=new c(m.qx,m.qy,m.qz);n.w=this.getW(n.x,n.y,n.z);var o=n.toMatrix3D();o.appendTranslation(m.tx,m.ty,m.tz),m.matrix=o,h.push(o);var p=o.clone();p.invert(),i.push(p)}for(l=0;l<f.uvItem.length;l++){for(var q=f.uvItem[l],r=new d,s=new Array,t=0;t<q.b;t++){var u=q.a+t,v=f.weightItem[u],w=k[v.boneId].matrix,x=new d(v.x,v.y,v.z);x=w.transformVector(x),x.scaleBy(v.w),r=r.add(x),s.push(v.w)}g.vertices.push(r.x,r.y,r.z),g.uvs.push(q.x,q.y);var y=new a.MeshItem;y.verts=new d(r.x,r.y,r.z),y.uvInfo=q,j.push(y)}for(l=0;l<f.triItem.length;l++)g.indexs.push(f.triItem[l].t0,f.triItem[l].t1,f.triItem[l].t2);return g.vertexBuffer=e.context3D.uploadBuff3D(g.vertices),g.uvBuffer=e.context3D.uploadBuff3D(g.uvs),g.indexBuffer=e.context3D.uploadIndexBuff3D(g.indexs),g.bindPosAry=h,g.invertAry=i,g},f.prototype.getW=function(a,b,c){var d=1-(a*a+b*b+c*c);return d=0>d?0:-Math.sqrt(d)},f.prototype.processBoneNew=function(a){for(var b=f.getStorNewTargerArr(a),c=new Array,d=0;d<a.length;d++){var e=b.indexOf(a[d]);c.push(e)}var g=new Array;for(d=0;d<b.length;d++){var h=b[d];g.push(h.clone())}for(d=0;d<g.length;d++)e=g[d].father,-1!=e&&(g[d].father=c[e]);return g},f.getStorNewTargerArr=function(a){var b,c=new Array;for(b=0;b<a.length;b++)-1==c.indexOf(a[b])&&c.push(a[b]);return c},f}();a.MeshToObjUtils=f}(md5list||(md5list={}));var md5list;!function(a){var b=Pan3d.Dictionary,c=Pan3d.ObjectBone,d=function(){function d(){}return d.prototype.addMesh=function(c){var d;if(-1!=c.indexOf("mesh")){var e=new a.Md5MeshData,f=new b([]);d=c.split(/[\n\r]{2}/);for(var g,h=!1,i=0,j=0,k=new Array,l=!1,m=0,n=0,o=new Array,p=!1,q=0,r=0,s=new Array,t=new Array,u=/\d+/,v=0;v<d.length;v++)h&&(i>j?(k.push(d[v]),j++):(f.numverts=k,h=!1)),l&&(m>n?(o.push(d[v]),n++):(f.numtris=o,l=!1)),p&&(q>r?(s.push(d[v]),r++):(f.numweights=s,p=!1)),g&&t.push(d[v]),-1!=String(d[v]).indexOf("numverts")&&(h=!0,i=Number(d[v].match(u)[0])),-1!=String(d[v]).indexOf("numtris")&&(l=!0,m=Number(d[v].match(u)[0])),-1!=String(d[v]).indexOf("numweights")&&(p=!0,q=Number(d[v].match(u)[0])),-1!=String(d[v]).indexOf("joints")&&(g=!0),-1!=String(d[v]).indexOf("mesh")&&(g=!1,f.joints=t),-1!=String(d[v]).indexOf("commandline");return e.mesh=f,this.joinTri(e),this.joinPoint(e),this.joinUV(e),this.joinJoints(e),e}return null},d.prototype.joinJoints=function(a){var b=a.mesh.joints;a.boneItem=new Array;for(var d=0;d<b.length;d++){var e=b[d];if(e.length<9)break;var f=e.match(/\".+\"/)[0];e=e.replace(f,"");var g=TpGame.getArrByStr(e);if(1==g.length)break;var h=new c;h.name=f,h.father=Number(g[0]),h.tx=Number(g[2]),h.ty=Number(g[3]),h.tz=Number(g[4]),h.qx=Number(g[7]),h.qy=Number(g[8]),h.qz=Number(g[9]),a.boneItem.push(h)}},d.prototype.joinUV=function(b){var c=b.mesh.numverts;b.uvItem=new Array;var d="",e=new Array,f=0;for(f=0;f<c.length;f++){d=this.genewStr(c[f]),e=d.split(" ");var g=new a.ObjectUv;g.id=Number(e[1]),g.x=Number(e[2]),g.y=Number(e[3]),g.a=Number(e[4]),g.b=Number(e[5]),b.uvItem.push(g)}},d.prototype.joinPoint=function(b){var c=b.mesh.numweights;b.weightItem=new Array;var d="",e=new Array,f=0;for(f=0;f<c.length;f++){d=this.genewStr(c[f]),e=d.split(" ");var g=new a.ObjectWeight;g.id=Number(e[1]),g.boneId=Number(e[2]),g.w=Number(e[3]),g.x=Number(e[4]),g.y=Number(e[5]),g.z=Number(e[6]),b.weightItem.push(g)}},d.prototype.joinTri=function(b){var c=b.mesh.numtris;b.triItem=new Array;var d="",e=new Array,f=0;for(f=0;f<c.length;f++){d=this.genewStr(c[f]),e=d.split(" ");var g=new a.ObjectTri;g.id=Number(e[1]),g.t0=Number(e[2]),g.t1=Number(e[3]),g.t2=Number(e[4]),b.triItem.push(g)}},d.prototype.genewStr=function(a){for(var b="",c="",d=" ",e=0;e<a.length;){switch(c=a.charAt(e)){case"(":break;case")":break;case'"':break;case"	":" "!=d&&(b+=" "),d=" ";break;case" ":" "!=d&&(b+=" "),d=" ";break;default:b+=c,d=c}e++}return b},d}();a.Md5Analysis=d}(md5list||(md5list={}));var md5list;!function(a){var b=Pan3d.Matrix3D,c=Pan3d.Quaternion,d=Pan3d.Vector3D,e=Pan3d.Dictionary,f=Pan3d.ObjectBone,g=function(){function a(){this.loopKey="inLoop",this.boundsKey="mybounds",this.nameHeightKey="nameheight",this.interKey="inter",this.pos="pos"}return a.prototype.addAnim=function(a){this._dir=new e([]),this.allFrames=new Array,this.framesok=!1,this._hierarchyitem=new Array,this._hierarchy=new Array,this._baseframe=new Array,this._bounds=new Array,this._frame=new Array,this.bigArr=new Array;for(var b=a.split("\r\n"),c=b.length,d="",f=!1,g=0;c>g;g++){var h=String(b[g]).indexOf("//");if(0!=h)if(-1!=h&&(b[g]=String(b[g]).substring(0,h)),-1!=String(b[g]).indexOf("{")&&(f=!0),f)d+=b[g]+"\n\r",-1!=String(b[g]).indexOf("}")&&(f=!1,this.bigArr.push(d),d="");else if(""!=b[g]){var i=String(b[g]).split(" ");this._dir[i[0]]=i[1]}}for(var j=0;j<this.bigArr.length;j++)this.handleBigWord(this.bigArr[j]);return this._pushhierarchyitem(),this.setFrameToMatrix(this.allFrames)},a.prototype.setFrameToMatrix=function(a){for(var e=new Array,f=0;f<a.length;f++){var g=a[f],h=new c,i=new b,j=new Array;e.push(j);for(var k=0;k<g.length;k++){var l=g[k];if(h=new c(l.qx,l.qy,l.qz),h.w=this.getW(h.x,h.y,h.z),-1==l.father)i=h.toMatrix3D(),i.appendTranslation(l.tx,l.ty,l.tz),i.appendRotation(-90,d.X_AXIS),j.push(i);else{g[l.father];i=h.toMatrix3D(),i.appendTranslation(l.tx,l.ty,l.tz),i.append(j[l.father]),j.push(i)}}for(k=0;k<j.length;k++)j[k].appendScale(-1,1,1)}return e},a.prototype.getW=function(a,b,c){var d=1-(a*a+b*b+c*c);return d=0>d?0:-Math.sqrt(d)},a.prototype.setRestult=function(){this.resultInfo=new Object,this.resultInfo.frames=this.allFrames,this.resultInfo.matrixAry=this.setFrameToMatrix(this.allFrames)},a.prototype._pushhierarchyitem=function(){var a=new Array,b=0;for(b=0;b<this._hierarchy.length;b++){var c=this.getBoneFilterStr(this._hierarchy[b]);a=c[1].split(" ");var d=new f;d.father=Number(a[0]),d.changtype=Number(a[1]),d.startIndex=Number(a[2]),d.name=c[0],this._hierarchyitem.push(d)}this._pushbasefamer()},a.prototype._pushbasefamer=function(){var a=0;for(a=0;a<this._baseframe.length;a++){var b=TpGame.getArrByStr(this._baseframe[a]);this._hierarchyitem[a].tx=Number(b[1]),this._hierarchyitem[a].ty=Number(b[2]),this._hierarchyitem[a].tz=Number(b[3]),this._hierarchyitem[a].qx=Number(b[6]),this._hierarchyitem[a].qy=Number(b[7]),this._hierarchyitem[a].qz=Number(b[8])}this._pushfamers()},a.prototype._pushfamers=function(){var a=0;for(a=0;a<this._frame.length;a++)this._frame[a]&&this.allFrames.push(this._getsamplefamer(this._frame[a]));this.framesok=!0},a.prototype._getsamplefamer=function(a){for(var b=0,c=new Array,d=new Array,e=0;e<a.length;e++){var g=TpGame.getArrByStr(a[e]);g.length&&""==g[g.length-1]&&g.pop(),d=d.concat(g)}for(b=0;b<this._hierarchyitem.length;b++){var h=new f;h.father=this._hierarchyitem[b].father,h.name=this._hierarchyitem[b].name,h.tx=this._hierarchyitem[b].tx,h.ty=this._hierarchyitem[b].ty,h.tz=this._hierarchyitem[b].tz,h.qx=this._hierarchyitem[b].qx,h.qy=this._hierarchyitem[b].qy,h.qz=this._hierarchyitem[b].qz;var i=0;1&this._hierarchyitem[b].changtype&&(h.tx=Number(d[this._hierarchyitem[b].startIndex+i]),i++),2&this._hierarchyitem[b].changtype&&(h.ty=Number(d[this._hierarchyitem[b].startIndex+i]),i++),4&this._hierarchyitem[b].changtype&&(h.tz=Number(d[this._hierarchyitem[b].startIndex+i]),i++),8&this._hierarchyitem[b].changtype&&(h.qx=Number(d[this._hierarchyitem[b].startIndex+i]),i++),16&this._hierarchyitem[b].changtype&&(h.qy=Number(d[this._hierarchyitem[b].startIndex+i]),i++),32&this._hierarchyitem[b].changtype&&(h.qz=Number(d[this._hierarchyitem[b].startIndex+i]),i++),c.push(h)}return c},a.prototype.getBoneFilterStr=function(a){for(var b="",c="",d=" ",e=0;e<a.length;){switch(c=a.charAt(e)){case"(":break;case")":break;case"	":" "!=d&&(b+=" "),d=" ";break;case" ":" "!=d&&(b+=" "),d=" ";break;default:b+=c,d=c}e++}var f=b.indexOf('"',1),g=b.slice(1,f),h=b.substring(f+2,b.length);return[g,h]},a.prototype.handleBigWord=function(a){var b,c=/\d+/;if(-1!=a.indexOf("hierarchy")){b=a.split("\n\r");for(var d=0;d<b.length;d++)-1==String(b[d]).indexOf("{")&&-1==String(b[d]).indexOf("}")&&""!=b[d]&&this._hierarchy.push(b[d])}if(-1!=a.indexOf("bounds")){b=a.split("\n\r");for(var e=0;e<b.length;e++)-1==String(b[e]).indexOf("{")&&-1==String(b[e]).indexOf("}")&&""!=String(b[e])&&this._bounds.push(b[e])}if(-1!=a.indexOf("baseframe")){b=a.split("\n\r");for(var f=0;f<b.length;f++)-1==String(b[f]).indexOf("{")&&-1==String(b[f]).indexOf("}")&&""!=b[f]&&this._baseframe.push(b[f])}if(-1!=a.indexOf("frame")&&-1==a.indexOf("baseframe")&&-1==a.indexOf("BoneScale")){b=a.split("\n\r");for(var g,h=new Array,i=0;i<b.length;i++)-1!=String(b[i]).indexOf("frame")&&(g=Number(b[i].match(c)[0])),-1==String(b[i]).indexOf("{")&&-1==String(b[i]).indexOf("}")&&""!=b[i]&&h.push(b[i]),this._frame[g]=h}},a}();a.Md5animAnalysis=g}(md5list||(md5list={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),md5list;!function(a){var b=Pan3d.Shader3D,c=Pan3d.Display3DSprite,d=Pan3d.ProgrmaManager,e=Pan3d.UIManager,f=Pan3d.DualQuatFloat32Array,g=Pan3d.Scene_data,h=Pan3d.LoadManager,i=Pan3d.TextureManager,j=Pan3d.Quaternion,k=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"pos"),a.bindAttribLocation(this.program,1,"v2Uv"),a.bindAttribLocation(this.program,2,"boneID"),a.bindAttribLocation(this.program,3,"boneWeight")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 pos;attribute vec2 v2Uv;attribute vec4 boneID;attribute vec4 boneWeight;varying vec2 v0;uniform vec4 boneQ[70];uniform vec3 boneD[70];uniform mat4 vpMatrix3D;uniform mat4 posMatrix3D;vec4 qdv(vec4 q, vec3 d, vec3 v ){   vec3 t = 2.0 * cross(q.xyz, v);   vec3 f = v + q.w * t + cross(q.xyz, t);   return vec4(f.x + d.x, f.y + d.y, f.z + d.z, 1.0); }vec4 getQDdata(vec3 vdata){   vec4 tempnum = qdv(boneQ[int(boneID.x)], boneD[int(boneID.x)], vdata) * boneWeight.x;   tempnum += qdv(boneQ[int(boneID.y)], boneD[int(boneID.y)], vdata) * boneWeight.y;   tempnum += qdv(boneQ[int(boneID.z)], boneD[int(boneID.z)], vdata) * boneWeight.z;   tempnum += qdv(boneQ[int(boneID.w)], boneD[int(boneID.w)], vdata) * boneWeight.w;   tempnum.x = tempnum.x * -1.0;   return tempnum; }vec4 qdvNrm(vec4 q, vec3 v ){      vec3 t = 2.0 * cross(q.xyz, v);      vec3 f = v + q.w * t + cross(q.xyz, t);      return vec4(f.x, f.y, f.z, 1.0);\n} vec4 getQDdataNrm(vec3 vdata){    vec4 tempnum = qdvNrm(boneQ[int(boneID.x)], vdata) * boneWeight.x;    tempnum += qdvNrm(boneQ[int(boneID.y)], vdata) * boneWeight.y;    tempnum += qdvNrm(boneQ[int(boneID.z)], vdata) * boneWeight.z;    tempnum += qdvNrm(boneQ[int(boneID.w)], vdata) * boneWeight.w;    tempnum.x = tempnum.x * -1.0;    tempnum.xyz = normalize(tempnum.xyz);    return tempnum;} void main(void){    v0 = v2Uv;    vec4 vt0 = getQDdata(vec3(pos.x, pos.y, pos.z));    vt0.xyz = vt0.xyz * 1.0;    vt0 = posMatrix3D * vt0;    vt0 = vpMatrix3D * vt0;    gl_Position = vt0;\n  }";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D fs0;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(fs0, v0.xy);\ngl_FragColor =infoUv;\n}";return a},b.Md5MeshShader="Md5MeshShader",b}(b);a.Md5MeshShader=k;var l=function(b){function c(){var a=b.call(this)||this;return d.getInstance().registe(k.Md5MeshShader,new k),a.md5shader=d.getInstance().getProgram(k.Md5MeshShader),a.loadTexture(),a}return __extends(c,b),c.prototype.setMd5BodyUrl=function(a){this.loadBodyMesh(a)},c.prototype.loadBodyMesh=function(b){var c=this;h.getInstance().load(g.fileRoot+b,h.XML_TYPE,function(b){var d=new a.Md5Analysis;c._md5MeshData=d.addMesh(b),(new a.MeshImportSort).processMesh(c._md5MeshData),c.md5objData=(new a.MeshToObjUtils).getObj(c._md5MeshData)})},c.prototype.loadTexture=function(){var a=this,b=e.getInstance().getContext2D(128,128,!1);b.fillStyle="rgb(255,0,0)",b.fillRect(0,0,128,128),this._uvTextureRes=i.getInstance().getCanvasTexture(b),i.getInstance().getTexture(g.fileRoot+"x_f_武当_01.jpg",function(b){a._uvTextureRes=b})},c.prototype.updateMaterialMesh=function(a){},c.prototype.update=function(){this.md5objData&&this.updateMaterialMeshCopy()},c.prototype.updateMaterialMeshCopy=function(){this.baseShder=this.md5shader,g.context3D.setProgram(this.baseShder.program),g.context3D.setVpMatrix(this.baseShder,g.vpMatrix.m),g.context3D.setVcMatrix4fv(this.baseShder,"posMatrix3D",this.posMatrix.m),g.context3D.setRenderTexture(this.baseShder,"fc0",this._uvTextureRes.texture,0),g.context3D.setVa(0,3,this.md5objData.vertexBuffer),g.context3D.setVa(1,2,this._md5MeshData.uvBuffer),g.context3D.setVa(2,4,this._md5MeshData.boneIdBuffer),g.context3D.setVa(3,4,this._md5MeshData.boneWeightBuffer);var a=this._md5MeshData.boneNewIDAry,b=this.md5objData.bindPosAry,c=new f;
c.quat=new Float32Array(4*a.length),c.pos=new Float32Array(3*a.length);for(var d=0;d<a.length;d++){var e=b[a[d]].clone(),h=this.md5objData.invertAry[a[d]].clone();e.prepend(h),e.appendScale(-1,1,1);var i=new j;i.fromMatrix(e);var k=e.position;c.quat[4*d+0]=i.x,c.quat[4*d+1]=i.y,c.quat[4*d+2]=i.z,c.quat[4*d+3]=i.w,c.pos[3*d+0]=k.x,c.pos[3*d+1]=k.y,c.pos[3*d+2]=k.z}g.context3D.setVc4fv(this.baseShder,"boneQ",c.quat),g.context3D.setVc3fv(this.baseShder,"boneD",c.pos),g.context3D.drawCall(this._md5MeshData.indexBuffer,this._md5MeshData.treNum),console.log(this._md5MeshData.treNum/3,"boid=>",a.length)},c}(c);a.Md5MeshSprite=l}(md5list||(md5list={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),md5list;!function(a){var b=Pan3d.Display3DSprite,c=Pan3d.ProgrmaManager,d=Pan3d.LoadManager,e=Pan3d.Quaternion,f=Pan3d.DualQuatFloat32Array,g=Pan3d.UIManager,h=Pan3d.TextureManager,i=Pan3d.Scene_data,j=function(b){function j(){var d=b.call(this)||this;return d.lastTm=0,d._actionTime=0,d.skipNum=0,c.getInstance().registe(a.Md5MeshShader.Md5MeshShader,new a.Md5MeshShader),d.md5shader=c.getInstance().getProgram(a.Md5MeshShader.Md5MeshShader),d.loadTexture(),d}return __extends(j,b),j.prototype.loadBodyMesh=function(){var b=this;d.getInstance().load(i.fileRoot+this.bodyUrl,d.XML_TYPE,function(c){b.md5MeshData=(new a.Md5Analysis).addMesh(c),(new a.MeshImportSort).processMesh(b.md5MeshData),b.md5objData=(new a.MeshToObjUtils).getObj(b.md5MeshData),b.loadAnimFrame()})},j.prototype.setMd5url=function(a,b,c){var d=this;void 0===c&&(c=null),this.bodyUrl=a,this.animUrl=b,c&&h.getInstance().getTexture(i.fileRoot+c,function(a){d.uvTextureRes=a}),this.loadBodyMesh()},j.prototype.loadAnimFrame=function(){var b=this;d.getInstance().load(i.fileRoot+this.animUrl,d.XML_TYPE,function(c){var d=(new a.Md5animAnalysis).addAnim(c);b.frameQuestArr=new Array;for(var e=0;e<d.length;e++){for(var f=d[e],g=0;g<f.length;g++)f[g].prepend(b.md5objData.invertAry[g]);b.frameQuestArr.push(b.makeDualQuatFloat32Array(d[e]))}})},j.prototype.makeDualQuatFloat32Array=function(a){var b=this.md5MeshData.boneNewIDAry,c=a,d=new f;d.quat=new Float32Array(4*b.length),d.pos=new Float32Array(3*b.length);for(var g=0;g<b.length;g++){var h=c[b[g]].clone();h.appendScale(-1,1,1);var i=new e;i.fromMatrix(h);var j=h.position;d.quat[4*g+0]=i.x,d.quat[4*g+1]=i.y,d.quat[4*g+2]=i.z,d.quat[4*g+3]=i.w,d.pos[3*g+0]=j.x,d.pos[3*g+1]=j.y,d.pos[3*g+2]=j.z}return d},j.prototype.loadTexture=function(){var a=g.getInstance().getContext2D(128,128,!1);a.fillStyle="rgb(255,0,0)",a.fillRect(0,0,128,128),this.uvTextureRes=h.getInstance().getCanvasTexture(a)},j.prototype.update=function(){this.md5objData&&this.frameQuestArr&&this.updateMaterialMeshCopy()},j.prototype.updateMaterialMeshCopy=function(){this.baseShder=this.md5shader,i.context3D.setProgram(this.baseShder.program),i.context3D.setVpMatrix(this.baseShder,i.vpMatrix.m),i.context3D.setVcMatrix4fv(this.baseShder,"posMatrix3D",this.posMatrix.m),i.context3D.setRenderTexture(this.baseShder,"fc0",this.uvTextureRes.texture,0),i.context3D.setVa(0,3,this.md5objData.vertexBuffer),i.context3D.setVa(1,2,this.md5MeshData.uvBuffer),i.context3D.setVa(2,4,this.md5MeshData.boneIdBuffer),i.context3D.setVa(3,4,this.md5MeshData.boneWeightBuffer);var a=Pan3d.TimeUtil.getTimer()-this.lastTm;this.lastTm=Pan3d.TimeUtil.getTimer(),this._actionTime+=a;var b=float2int(this._actionTime/(2*i.frameTime)),c=this.frameQuestArr.length,d=this.frameQuestArr[b%c];i.context3D.setVc4fv(this.baseShder,"boneQ",d.quat),i.context3D.setVc3fv(this.baseShder,"boneD",d.pos),i.context3D.drawCall(this.md5MeshData.indexBuffer,this.md5MeshData.treNum)},j}(b);a.Md5MoveSprite=j}(md5list||(md5list={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),md5list;!function(a){var b=Pan3d.Vector3D,c=Pan3d.MeshData,d=Pan3d.Scene_data,e=function(){function a(){this.id=0,this.t0=0,this.t1=0,this.t2=0}return a}();a.ObjectTri=e;var f=function(){function a(){this.x=0,this.y=0,this.z=0,this.w=0,this.weight=0,this.boneId=0,this.id=0}return a.prototype.clone=function(){var b=new a;return b.x=this.x,b.y=this.y,b.z=this.z,b.w=this.w,b.weight=this.weight,b.boneId=this.boneId,b.id=this.id,b},a}();a.ObjectWeight=f;var g=function(){function a(){this.x=0,this.y=0,this.z=0,this.a=0,this.b=0,this.w=0,this.id=0}return a}();a.ObjectUv=g;var h=function(){function a(){this.normal=new b}return a}();a.MeshItem=h;var i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(c);a.Md5MeshData=i;var j=function(){function b(){this.beginKey=20,this.bindWidth=4}return b.prototype.processMesh=function(a){var b=new Array,c=0;for(c=0;c<a.weightItem.length;c++)b.push(a.weightItem[c].clone());var d=this.getMapValue(a.boneItem);for(c=0;c<b.length;c++)b[c].boneId=d[b[c].boneId];a.weightItem=b,this.processForAgal(a)},b.prototype.processForAgal=function(a){for(var b,c,d,e=a.uvItem,f=a.weightItem,g=a.triItem,h=new Array,i=[[],[],[],[]],j=new Array,k=new Array,l=new Array,m=new Array,n=0;n<e.length;n++)for(c=e[n].a,d=e[n].b,b=0;4>b;b++)d>b?m.push(f[c+b].boneId):m.push(m[0]);for(m=this.getboneNum(m),n=0;n<e.length;n++){for(c=e[n].a,d=e[n].b,b=0;4>b;b++)d>b?(i[b].push(f[c+b].x,f[c+b].y,f[c+b].z),k.push(m.indexOf(f[c+b].boneId)),j.push(f[c+b].w)):(i[b].push(0,0,0),k.push(m.indexOf(0)),j.push(0));h.push(e[n].x),h.push(e[n].y)}for(a.boneNewIDAry=m,n=0;n<g.length;n++)l.push(g[n].t0,g[n].t1,g[n].t2);a.faceNum=l.length/3,a.treNum=l.length,this.uplodToGpu(a,h,i,j,k,l)},b.prototype.uplodToGpu=function(a,b,c,e,f,g){a.uvBuffer=d.context3D.uploadBuff3D(b),a.boneWeightAry=e,a.boneWeightBuffer=d.context3D.uploadBuff3D(e);for(var h=new Array,i=0;i<f.length;i++)h.push(Math.max(f[i],0));a.boneIDAry=h,a.boneIdBuffer=d.context3D.uploadBuff3D(h),a.indexBuffer=d.context3D.uploadIndexBuff3D(g)},b.prototype.getboneNum=function(a){for(var b=new Array,c=0;c<a.length;c++)-1==b.indexOf(a[c])&&b.push(a[c]);return b},b.prototype.getMapValue=function(b){for(var c=a.MeshToObjUtils.getStorNewTargerArr(b),d=new Array,e=0;e<b.length;e++){var f=c.indexOf(b[e]);d.push(f)}return d},b}();a.MeshImportSort=j}(md5list||(md5list={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),win;!function(a){var b=Pan3d.UIConatiner,c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.DISPOSE_PANEL_EVENT="dispose_panel_event",b}(Pan3d.BaseEvent);a.UIPanelEvent=c;var d=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.onAdd=function(){this._disposeEventFun&&Pan3d.TimeUtil.removeTimeOut(this._disposeEventFun)},b.prototype.onRemove=function(){var a=this;this._disposeEventFun||(this._disposeEventFun=function(){var b=new c(c.DISPOSE_PANEL_EVENT);b.panel=a,Pan3d.ModuleEventManager.dispatchEvent(b)}),Pan3d.TimeUtil.addTimeOut(2e7,this._disposeEventFun)},b.prototype.addRender=function(a){var b=this.renderList.indexOf(a);-1==b&&(a.container=this,a.sortnum=this.layer,this.renderList.push(a),this.hasStage&&this.perent.addUI(a))},b.prototype.removeRender=function(a){var b=this.renderList.indexOf(a);-1!=b&&(this.renderList.splice(b,1),this.hasStage&&this.perent.removeUI(a))},b}(b);a.UIPanel=d}(win||(win={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),win;!function(a){var b=Pan3d.UIRenderComponent,c=Pan3d.InteractiveEvent,d=Pan3d.Rectangle,e=Pan3d.UIManager,f=Pan3d.UIConatiner,g=Pan3d.UIMask,h=Pan3d.UIData,i=Pan3d.UIAtlas,j=Pan3d.Vector2D,k=Pan3d.TextureManager,l=Pan3d.Scene_data,m=function(a){function e(c,e){void 0===c&&(c=null),void 0===e&&(e=!0);var f=a.call(this)||this;return f.moveListTy=0,c?f.pageRect=c:f.pageRect=new d(100,100,500,500),f.contentHeight=0,f.useMoseMove=e,f._bRender=new b,f._mRender=new b,f._tRender=new b,f._baseMidRender=new b,f.addRender(f._baseMidRender),f._baseTopRender=new b,f.addRender(f._baseTopRender),f._closeRender=new b,f.addRender(f._closeRender),f._bRender.uiAtlas=new i,f._bRender.uiAtlas.setInfo("ui/window/window.txt","ui/window/window.png",function(){f.loadConfigCom()}),f}return __extends(e,a),e.prototype.mouseDown=function(a){this.mouseIsDown=!0,l.uiStage.addEventListener(c.Move,this.stageMouseMove,this)},e.prototype.stageMouseMove=function(a){this.mouseIsDown=!1},e.prototype.mouseUp=function(a){l.uiStage.removeEventListener(c.Move,this.stageMouseMove,this)},e.prototype.loadConfigCom=function(){this._tRender.uiAtlas=this._bRender.uiAtlas,this._mRender.uiAtlas=this._bRender.uiAtlas,this._closeRender.uiAtlas=this._bRender.uiAtlas,this._baseMidRender.uiAtlas=this._bRender.uiAtlas,this._baseTopRender.uiAtlas=this._bRender.uiAtlas,this._uiMask=new g,e.maskLevel++,this._uiMask.level=e.maskLevel++,this.addMask(this._uiMask),this.a_bg=this.addEvntBut("b_win_bg",this._bRender),this.a_tittle_bg=this.addChild(this._tRender.getComponent("b_tittle_bg")),this.a_left_line=this.addChild(this._tRender.getComponent("a_left_line")),this.a_rigth_line=this.addChild(this._tRender.getComponent("a_rigth_line")),this.a_bottom_line=this.addChild(this._tRender.getComponent("a_bottom_line")),this.a_scroll_bar_bg=this.addChild(this._mRender.getComponent("e_scroll_bar_bg")),this.a_scroll_bar=this.addChild(this._tRender.getComponent("e_scroll_bar")),this.b_bottom_left=this.addChild(this._tRender.getComponent("b_bottom_left")),this.b_bottom_mid=this.addChild(this._tRender.getComponent("b_bottom_mid")),this.b_bottom_right=this.addChild(this._tRender.getComponent("b_bottom_right")),this.b_bottom_line_left=this.addChild(this._tRender.getComponent("b_bottom_line")),this.b_bottom_line_right=this.addChild(this._tRender.getComponent("b_bottom_line")),this.b_win_close=this.addEvntBut("b_win_close",this._closeRender),this.setUiListVisibleByItem([this.a_left_line],!1),this.setUiListVisibleByItem([this.a_rigth_line],!1),this.setUiListVisibleByItem([this.a_bottom_line],!1),this.setUiListVisibleByItem([this.b_win_close],!1),this.a_scroll_bar.y=this.a_tittle_bg.height+2,this.c_tittle_bg=this._baseTopRender.getComponent("a_tittle_bg"),this.c_left_line=this._baseTopRender.getComponent("c_left_line"),this.c_right_line=this._baseTopRender.getComponent("c_left_line"),this.c_bottom_line=this._baseTopRender.getComponent("b_line_pixe_point"),this.c_scroll_bar_bg=this._baseTopRender.getComponent("e_scroll_bar_bg"),this.c_scroll_bar=this._closeRender.getComponent("e_scroll_bar"),this.c_scroll_bar.addEventListener(c.Down,this.tittleMouseDown,this),this.c_win_bg=this._baseMidRender.getComponent("c_win_bg"),this.e_panel_1=this._baseMidRender.getComponent("e_panel_1"),this.setUiListVisibleByItem([this.c_win_bg],!1),this.uiLoadComplete=!0,this.setHideUi(),this.setShowUi(),this.resize()},e.prototype.removeMoveEvent=function(){this.uiLoadComplete&&(this.a_tittle_bg.removeEventListener(c.Down,this.tittleMouseDown,this),this.a_rigth_line.removeEventListener(c.Down,this.tittleMouseDown,this),this.a_bottom_line.removeEventListener(c.Down,this.tittleMouseDown,this),this.c_scroll_bar.removeEventListener(c.Down,this.tittleMouseDown,this))},e.prototype.setRect=function(a){this.pageRect=a,this.resize()},e.prototype.setHideUi=function(a){if(void 0===a&&(a=null),a&&(this.hideUiItem=a),this.uiLoadComplete)for(var b=0;this.hideUiItem&&b<this.hideUiItem.length;b++){var c=this.hideUiItem[b];this.setUiListVisibleByItem([this[c]],!1)}},e.prototype.setShowUi=function(a){if(void 0===a&&(a=null),a&&(this.showUiItem=a),this.uiLoadComplete)for(var b=0;this.showUiItem&&b<this.showUiItem.length;b++){var c=this.showUiItem[b];this.setUiListVisibleByItem([this[c]],!0)}},e.prototype.resize=function(){this.uiLoadComplete&&(this.left=this.pageRect.x,this.top=this.pageRect.y,this.pageRect.width=Math.max(100,this.pageRect.width),this.pageRect.height=Math.max(100,this.pageRect.height),this.e_panel_1.x=0,this.e_panel_1.y=0,this.e_panel_1.width=this.pageRect.width,this.e_panel_1.height=this.pageRect.height,this.a_tittle_bg.x=2,this.a_tittle_bg.y=2,this.a_tittle_bg.width=this.pageRect.width-4,this.b_win_close.y=2,this.b_win_close.x=this.pageRect.width-this.b_win_close.width-5,this._uiMask.y=0,this._uiMask.x=0,this._uiMask.width=this.pageRect.width-this.a_rigth_line.width,this._uiMask.height=this.pageRect.height,this.maskRoundRect&&(this._uiMask.x+=this.maskRoundRect.x,this._uiMask.y+=this.maskRoundRect.y,this._uiMask.width-=this.maskRoundRect.width,this._uiMask.height-=this.maskRoundRect.height),this.a_bg.x=0,this.a_bg.y=0,this.a_bg.width=this.pageRect.width,this.a_bg.height=this.pageRect.height,this.a_rigth_line.x=this.pageRect.width-this.a_rigth_line.width,this.a_rigth_line.y=this.a_tittle_bg.height-1,this.a_rigth_line.height=this.pageRect.height-this.a_tittle_bg.height,this.a_left_line.x=0,this.a_left_line.y=this.a_rigth_line.y,this.a_left_line.height=this.a_rigth_line.height,this.a_bottom_line.x=0,this.a_bottom_line.y=this.pageRect.height-this.a_bottom_line.height,this.a_bottom_line.width=this.a_bg.width,this.a_scroll_bar.x=this._uiMask.x+this._uiMask.width-this.a_scroll_bar.width,this.a_scroll_bar_bg.x=this.pageRect.width-this.a_rigth_line.width-this.a_scroll_bar_bg.width+2,this.a_scroll_bar_bg.y=this.a_tittle_bg.height,this.a_scroll_bar_bg.height=this.a_left_line.height,this.setUiListVisibleByItem([this.a_scroll_bar],this.contentHeight>this._uiMask.height),this.contentHeight>this._uiMask.height&&(this.a_scroll_bar.height=this._uiMask.height*(this._uiMask.height/this.contentHeight),this.a_scroll_bar.y=Math.min(this._uiMask.y+this._uiMask.height-this.a_scroll_bar.height,this.a_scroll_bar.y)),this.b_bottom_left.x=0,this.b_bottom_left.y=this.pageRect.height-this.b_bottom_left.height,this.b_bottom_mid.y=this.b_bottom_left.y,this.b_bottom_mid.x=this.pageRect.width/2-this.b_bottom_mid.width/2,this.b_bottom_right.y=this.b_bottom_left.y,this.b_bottom_right.x=this.pageRect.width-this.b_bottom_right.width,this.b_bottom_line_left.y=this.b_bottom_left.y,this.b_bottom_line_left.x=this.b_bottom_left.x+this.b_bottom_left.width,this.b_bottom_line_left.width=this.b_bottom_mid.x-this.b_bottom_left.width,this.b_bottom_line_right.y=this.b_bottom_left.y,this.b_bottom_line_right.x=this.b_bottom_mid.x+this.b_bottom_mid.width,this.b_bottom_line_right.width=this.b_bottom_right.x-this.b_bottom_mid.width-this.b_bottom_mid.x,this._bRender.applyObjData(),this._mRender.applyObjData(),this._tRender.applyObjData(),this.c_win_bg.x=0,this.c_win_bg.y=0,this.c_win_bg.width=this.pageRect.width,this.c_win_bg.height=this.pageRect.height,this.c_tittle_bg.x=0,this.c_tittle_bg.y=0,this.c_tittle_bg.width=this.pageRect.width,this.c_left_line.x=0,this.c_left_line.y=0,this.c_left_line.height=this.pageRect.height,this.c_right_line.x=this.pageRect.width-this.c_right_line.width,this.c_right_line.y=0,this.c_right_line.height=this.pageRect.height,this.c_bottom_line.x=0,this.c_bottom_line.y=this.pageRect.height-1,this.c_bottom_line.width=this.pageRect.width,this.c_bottom_line.height=1,this.c_scroll_bar_bg.x=this.pageRect.width-this.c_scroll_bar_bg.width-2,this.c_scroll_bar_bg.y=this._uiMask.y,this.c_scroll_bar_bg.height=this._uiMask.height,this.contentHeight>this.pageRect.height?(this.setUiListVisibleByItem([this.c_scroll_bar],!0),this.c_scroll_bar.x=this.c_scroll_bar_bg.x+3,this.c_scroll_bar.height=this._uiMask.height*(this._uiMask.height/this.contentHeight),this.c_scroll_bar.y=Math.min(this._uiMask.y+this._uiMask.height-this.c_scroll_bar.height,this.c_scroll_bar.y)):this.setUiListVisibleByItem([this.c_scroll_bar],!1),this._baseMidRender.applyObjData()),a.prototype.resize.call(this)},e.prototype.tittleMouseDown=function(a){switch(this.mouseMoveTaget=a.target,this.lastMousePos=new j(a.x,a.y),this.mouseMoveTaget){case this.a_tittle_bg:this.lastPagePos=new j(this.left,this.top);break;case this.a_rigth_line:case this.a_bottom_line:this.lastPagePos=new j(this.pageRect.width,this.pageRect.height);break;case this.a_scroll_bar:this.lastPagePos=new j(0,this.a_scroll_bar.y);break;case this.c_scroll_bar:this.lastPagePos=new j(0,this.c_scroll_bar.y);break;default:console.log("nonono")}l.uiStage.addEventListener(c.Move,this.mouseOnTittleMove,this),l.uiStage.addEventListener(c.Up,this.tittleMouseUp,this)},e.prototype.tittleMouseUp=function(a){l.uiStage.removeEventListener(c.Move,this.mouseOnTittleMove,this),l.uiStage.removeEventListener(c.Up,this.tittleMouseUp,this)},e.prototype.mouseOnTittleMove=function(a){switch(this.mouseMoveTaget){case this.a_tittle_bg:this.left=this.lastPagePos.x+(a.x-this.lastMousePos.x),this.top=this.lastPagePos.y+(a.y-this.lastMousePos.y),this.pageRect.x=this.left,this.pageRect.y=this.top;break;case this.a_rigth_line:this.pageRect.width=this.lastPagePos.x+(a.x-this.lastMousePos.x);break;case this.a_bottom_line:this.pageRect.height=this.lastPagePos.y+(a.y-this.lastMousePos.y);break;case this.a_scroll_bar:this.a_scroll_bar.y=this.lastPagePos.y+(a.y-this.lastMousePos.y),this.a_scroll_bar.y=Math.max(this.a_scroll_bar.y,this._uiMask.y),this.a_scroll_bar.y=Math.min(this.a_scroll_bar.y,this._uiMask.y+this._uiMask.height-this.a_scroll_bar.height),this.changeScrollBar();break;case this.c_scroll_bar:this.c_scroll_bar.y=this.lastPagePos.y+(a.y-this.lastMousePos.y),this.c_scroll_bar.y=Math.max(this.c_scroll_bar.y,this._uiMask.y),this.c_scroll_bar.y=Math.min(this.c_scroll_bar.y,this._uiMask.y+this._uiMask.height-this.c_scroll_bar.height),this.changeScrollBar();break;default:console.log("nonono")}this.resize()},e.prototype.changeScrollBar=function(){this.c_scroll_bar.y=Math.max(this.c_scroll_bar.y,this._uiMask.y);var a=this._uiMask.height-this.c_scroll_bar.height,b=this.c_scroll_bar.y-this._uiMask.y;this.moveListTy=-(this.contentHeight-this._uiMask.height)*(b/a)},e.maskLevel=10,e}(f);a.BaseWindow=m;var n=function(a){function c(c,d,e){var f=a.call(this)||this;return f._uiItem=new Array,f._lostItem=new Array,f.width=h.designWidth,f.height=h.designHeight,f.mathSize(d,e),f._baseRender=new b,f.initData(c,d,e,f._baseRender),f.addRender(f._baseRender),f.panelInfo={},f.panelInfo.classVo=c,f.panelInfo.rect=d,f.panelInfo.num=e,f}return __extends(c,a),c.prototype.initData=function(a,b,c,f){this._voNum=Math.floor(c),this._voRect=b;var g=Math.pow(2,Math.ceil(Math.log(b.x*b.width)/Math.log(2))),h=Math.pow(2,Math.ceil(Math.log(b.x*b.width)/Math.log(2)));this._textureRect=new d(0,0,g,h),f.uiAtlas=new i;var j=f.uiAtlas;j.configData=new Array,j.ctx=e.getInstance().getContext2D(this._textureRect.width,this._textureRect.height,!1),j.textureRes=k.getInstance().getCanvasTexture(j.ctx),this.makeBaseUi(a,f)},c.prototype.mathSize=function(a,b){for(a.x=0,a.y=0;a.x*a.y<b;)a.x*a.width>a.y*a.height?a.y++:a.x++},c.prototype.makeBaseUi=function(a,b){for(var c=b.uiAtlas,d=0;d<this._voRect.x;d++)for(var e=0;e<this._voRect.y;e++){var f=new a;this._uiItem.push(f),f.parent=b,f.voRect=this._voRect,f.textureStr="id_"+d+"_"+e,c.configData.push(c.getObject(f.textureStr,d*this._voRect.width,e*this._voRect.height,this._voRect.width,this._voRect.height,this._textureRect.width,this._textureRect.height)),f.ui=b.creatBaseComponent(f.textureStr),f.ui.baseRec=this._voRect.clone()}},c.prototype.showTemp=function(a){this.clearLostItem();for(var b,c=0;c<this._uiItem.length;c++)if(null==this._uiItem[c].rightTabInfoVo&&this._uiItem[c].isEqualLastKey(a)){b=this._uiItem[c];break}if(!b)for(var d=0;d<this._uiItem.length;d++)if(null==this._uiItem[d].rightTabInfoVo){b=this._uiItem[d];break}if(b)b.rightTabInfoVo=a,this.addChild(b.ui);else{var e=this.makeOtherRender();this.initData(this.panelInfo.classVo,this.panelInfo.rect,this.panelInfo.num,e),this.addRender(e),b=this.showTemp(a)}return b},c.prototype.makeOtherRender=function(){var a=new b;return a},c.prototype.clearLostItem=function(){for(var a=this._lostItem.length-1;a>0;a--)this._lostItem[a].clear&&this._lostItem.splice(a,1)},c.prototype.playLost=function(){this._lostItem.length&&this.showTemp(this._lostItem.pop())},c.prototype.clearOneTemp=function(){for(var a=0;a<this._uiItem.length;a++)if(!this._uiItem[a].rightTabInfoVo)return;this._lostItem.length=0,this.clearTemp(this._uiItem[0].rightTabInfoVo)},c.prototype.clearTemp=function(a){for(var b=0;b<this._uiItem.length;b++)if(this._uiItem[b].rightTabInfoVo==a){this._uiItem[b].rightTabInfoVo=null,this.removeChild(this._uiItem[b].ui);break}this.playLost()},c.prototype.getVoByData=function(a){for(var b=0;b<this._uiItem.length;b++)if(this._uiItem[b].rightTabInfoVo==a)return this._uiItem[b]},c.prototype.getVoByUi=function(a){for(var b=0;b<this._uiItem.length;b++)if(this._uiItem[b].rightTabInfoVo&&this._uiItem[b].ui==a)return this._uiItem[b]},c.prototype.clearAll=function(){for(var a=0;a<this._uiItem.length;a++)this._uiItem[a].rightTabInfoVo&&this.clearTemp(this._uiItem[a].rightTabInfoVo)},c.prototype.update=function(a){for(var b=0;b<this._uiItem.length;b++)this._uiItem[b].rightTabInfoVo&&this._uiItem[b].update()},c.prototype.getUiItemLen=function(){for(var a=0,b=0;b<this._uiItem.length;b++)this._uiItem[b].rightTabInfoVo&&a++;return a},c}(a.BaseWindow);a.Dis2dBaseWindow=n}(win||(win={}));var pack;!function(a){var b=Pan3d.Scene_data,c=function(){function a(){}return a.prototype.meshStr=function(a){var b=a.split("/");this.name=b[b.length-2],this.path=a,this.isFolder=!0},a.meshObj=function(b){if(b.name.length-1!=b.name.lastIndexOf("/")){var c=new a,d=b.name,e=d.split("/");return c.name=e[e.length-1],c.path=d.replace("upfile/shadertree/",""),c.suffix=c.name.split(".")[1],c}return null},a.PREFAB="prefab",a.MATERIAL="material",a.JPG="jpg",a.PNG="png",a.TXT="txt",a.OBJS="objs",a.MAP="map",a.LYF="lyf",a.ZZW="zzw",a.SKILL="skill",a.MD5ANIM="md5anim",a.MD5MESH="md5mesh",a}();a.FileVo=c;var d=function(){function d(){}return d.oneByOne=function(){var a=this;if(this.waitItem.length>0){var b=this.waitItem[0].a,c=this.waitItem[0].b,d="";this.ossWrapper.list({delimiter:"/",prefix:b,"max-keys":100,marker:d}).then(function(b){a.waitItem.shift(),a.oneByOne(),c(b)})["catch"](function(b){console.log(b),console.log("网络异常。需要注意"),a.waitItem.shift(),a.oneByOne(),c(null)})}},d.saveDicfileGropFun=function(b,c,d){var e=new Pan3d.Pan3dByteArray;e.writeUTF(JSON.stringify(c));var f=new File([e.buffer],this.indexFileName),g=b;console.log(g+f.name),a.FileOssModel.upOssFile(f,g+f.name,function(){console.log("文件夹配置",g+f.name),d()})},d.getDicByUrl=function(a,d,e){var f=b.ossRoot+a+this.indexFileName;Pan3d.LoadManager.getInstance().load(f,Pan3d.LoadManager.BYTE_TYPE,function(a){for(var b=new Pan3d.Pan3dByteArray(a),e=JSON.parse(b.readUTF()),f=[],g=0;g<e.length;g++){var h=new c;h.name=e[g].name,h.path=e[g].path,e[g].isFolder&&(h.isFolder=e[g].isFolder),e[g].suffix&&(h.suffix=e[g].suffix),f.push(h)}d(f)},{errorFun:function(){e()}})},d.getPerentPath=function(a){var b=a.lastIndexOf("/");return a=-1!=b?a.substr(0,b+1):""},d.getDisByOss=function(a,b){var d=this;a=this.getPerentPath(a),this.getTempOss(a,function(e){for(var f=[],g=0;e.prefixes&&g<e.prefixes.length;g++){var h=new c;h.meshStr(e.prefixes[g]),f.push(h)}for(var i=0;e.objects&&i<e.objects.length;i++){var h=c.meshObj(e.objects[i]);h&&h.suffix!=d.indexFileName.split(".")[1]&&f.push(h)}console.log("oss获取文件目录",a),d.saveDicfileGropFun(a,f,function(){b(f)})})},d.getFolderArr=function(a,b){var c=this;this.isMustUseOssGetDic?this.getDisByOss(a,b):this.getDicByUrl(a,b,function(){c.getDisByOss(a,b)})},d.getTempOss=function(a,b){var c=this;this.waitItem||(this.waitItem=[]),this.waitItem.push({a:a,b:b}),1==this.waitItem.length&&(this.ossWrapper?this.oneByOne():this.makeOssWrapper(function(){c.oneByOne()}))},d.getWarpperByUrl=function(a){var b=this;this.WEB_SEVER_EVENT_AND_BACK("get_STS","id=99",function(c){c&&c.data&&c.data.info?(b.ossWrapper=new OSS.Wrapper({accessKeyId:c.data.info.AccessKeyId,accessKeySecret:c.data.info.AccessKeySecret,stsToken:c.data.info.SecurityToken,endpoint:"https://oss-cn-shanghai.aliyuncs.com",bucket:"webpan"}),a()):(console.log("链接错误，重试"),Pan3d.TimeUtil.addTimeOut(2e3,function(){b.getWarpperByUrl(a)}))})},d.makeOssWrapper=function(a){var b=this;this.waitOssWrapper?this.waitOssWrapper.push(a):(this.waitOssWrapper=[a],this.getWarpperByUrl(function(){for(;b.waitOssWrapper.length;)console.log("waitOssWrapper",b.waitOssWrapper),b.waitOssWrapper.pop()()}))},d.makeOssWrapperCopy=function(a){var b=this;this.waitOssWrapper?this.waitOssWrapper.push(a):(this.waitOssWrapper=[a],this.WEB_SEVER_EVENT_AND_BACK("get_STS","id=99",function(a){if(a&&a.data&&a.data.info)for(b.ossWrapper=new OSS.Wrapper({accessKeyId:a.data.info.AccessKeyId,accessKeySecret:a.data.info.AccessKeySecret,stsToken:a.data.info.SecurityToken,endpoint:"https://oss-cn-shanghai.aliyuncs.com",bucket:"webpan"});b.waitOssWrapper.length;)console.log("waitOssWrapper",b.waitOssWrapper),b.waitOssWrapper.pop()();else console.log("链接错误，重试")}))},d.deleFile=function(a,b){void 0===b&&(b=null),d.ossWrapper?d.ossWrapper["delete"](a).then(function(a){b&&b()})["catch"](function(a){console.log(a)}):this.makeOssWrapper(function(){d.ossWrapper["delete"](a).then(function(a){b&&b()})["catch"](function(a){console.log(a)})})},d.uploadFile=function(a,b,c){void 0===c&&(c=null),d.ossWrapper?d.ossWrapper.multipartUpload(b,a).then(function(a){c&&c()})["catch"](function(a){console.log(a)}):this.makeOssWrapper(function(){d.ossWrapper.multipartUpload(b,a).then(function(a){c&&c()})["catch"](function(a){console.log(a)})}),console.log("上传文件==>",b)},d.copyFile=function(a,b,c){void 0===c&&(c=null),b=encodeURI(b),a=decodeURI(a),d.ossWrapper?(console.log(d.ossWrapper.copy),d.ossWrapper.copy(a,b).then(function(a){console.log(a),c&&c()})["catch"](function(a){console.log(a)})):this.makeOssWrapper(function(){d.ossWrapper.copy(a,b).then(function(a){console.log(a),c&&c()})["catch"](function(a){console.log(a)})})},d.WEB_SEVER_EVENT_AND_BACK=function(a,b,c){void 0===c&&(c=null),a=a.replace(/\s+/g,"");var d=new Object;d.webname=a,d.postStr=b.replace(/\s+/g,""),d.fun=c,this.isPostWeboffwx(a,b,c)},d.isPostWeboffwx=function(a,b,c){void 0===c&&(c=null);var d=new XMLHttpRequest,e=this.webseverurl+a,f=String(Pan3d.TimeUtil.getTimer()),g="ABC";d.open("post",e,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.setRequestHeader("timestamp",f),d.setRequestHeader("sign",g),d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c?c({data:JSON.parse(d.responseText)}):null:(console.log("HTTP请求错误！错误码："+d.status),c?c(null):null))},d.send(b)},d.upOssFile=function(a,b,c){var e=this;void 0===c&&(c=null),this.waitItemUpFile.push({a:a,b:b,c:c}),1==this.waitItemUpFile.length&&(d.ossWrapper?this.oneByOneUpFile():d.makeOssWrapper(function(){e.oneByOneUpFile()}))},d.oneByOneUpFile=function(){var a=this;this.waitItemUpFile.length>0&&d.uploadFile(this.waitItemUpFile[0].a,this.waitItemUpFile[0].b,function(){var b=a.waitItemUpFile[0].c;a.waitItemUpFile.shift(),b&&b(),a.oneByOneUpFile()})},d.upTempFileToOss=function(a){function b(b){for(var d=0;c&&d<c.files.length&&1>d;d++){var e=c.files[d];c=null,a(e)}}var c=document.createElement("input");c.setAttribute("id","_ef"),c.setAttribute("type","file"),c.setAttribute("style","visibility:hidden"),c.click(),c.value,c.addEventListener("change",function(a){b(a)})},d.indexFileName="index.hidegroup",d.isMustUseOssGetDic=!1,d.webseverurl="http://api.h5key.com/api/",d.waitItemUpFile=[],d.version=1,d}();a.FileOssModel=d}(pack||(pack={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),win;!function(a){var b=Pan3d.UIRenderComponent,c=Pan3d.InteractiveEvent,d=Pan3d.Rectangle,e=Pan3d.UIConatiner,f=Pan3d.UIAtlas,g=Pan3d.Scene_data,h=function(a){function e(){var c=a.call(this)||this;return c.left=0,c._pageRect=new d(0,0,300,300),c._bottomRender=new b,c.addRender(c._bottomRender),c._topRender=new b,c.addRender(c._topRender),c._bottomRender.uiAtlas=new f,c._bottomRender.uiAtlas.setInfo("ui/basewin/basewin.txt","ui/basewin/basewin.png",function(){c.loadConfigCom()}),c}return __extends(e,a),e.prototype.mouseDown=function(a){this.mouseIsDown=!0,g.uiStage.addEventListener(c.Move,this.stageMouseMove,this)},e.prototype.stageMouseMove=function(a){this.mouseIsDown=!1},e.prototype.mouseUp=function(a){g.uiStage.removeEventListener(c.Move,this.stageMouseMove,this)},e.prototype.loadConfigCom=function(){this._topRender.uiAtlas=this._bottomRender.uiAtlas,this.a_win_tittle=this.addEvntBut("a_win_tittle",this._topRender),this.a_bg=this.addEvntBut("a_bg",this._bottomRender),this.a_left_line=this.addChild(this._topRender.getComponent("a_rigth_line")),this.a_rigth_line=this.addChild(this._topRender.getComponent("a_rigth_line")),this.a_bottom_line=this.addChild(this._topRender.getComponent("a_bottom_line")),this.a_right_bottom=this.addChild(this._topRender.getComponent("a_right_bottom")),this.loadFinish=!0,this.refrishSize()},e.prototype.butClik=function(a){console.log(a.target)},Object.defineProperty(e.prototype,"pageRect",{get:function(){return this._pageRect},set:function(a){this._pageRect=a,this.loadFinish&&this.refrishSize()},enumerable:!0,configurable:!0}),e.prototype.refrishSize=function(){this.left=this._pageRect.x,this.top=this._pageRect.y,this._pageRect.width=Math.max(100,this._pageRect.width),this._pageRect.height=Math.max(100,this._pageRect.height),this.a_win_tittle.x=0,this.a_win_tittle.y=0,this.a_win_tittle.width=this._pageRect.width,this.a_bg.x=0,this.a_bg.y=0,this.a_bg.width=this._pageRect.width,this.a_bg.height=this._pageRect.height,this.a_left_line.x=0,this.a_left_line.y=this.a_win_tittle.height,this.a_left_line.height=this._pageRect.height-this.a_win_tittle.height-this.a_right_bottom.height,this.a_rigth_line.x=this._pageRect.width-this.a_rigth_line.width,this.a_rigth_line.y=this.a_win_tittle.height,this.a_rigth_line.height=this._pageRect.height-this.a_win_tittle.height-this.a_right_bottom.height,this.a_bottom_line.x=0,this.a_bottom_line.y=this._pageRect.height-this.a_bottom_line.height,this.a_bottom_line.width=this._pageRect.width-this.a_right_bottom.width,this.a_right_bottom.x=this._pageRect.width-this.a_right_bottom.width,this.a_right_bottom.y=this._pageRect.height-this.a_right_bottom.height,this.resize()},e}(e);a.LayBaseTab=h}(win||(win={}));var win;!function(a){var b=Pan3d.Scene_data,c=Pan3d.UIManager,d=Pan3d.InteractiveEvent,e=Pan3d.MouseType,f=Pan3d.Vector2D,g=Pan3d.MathClass,h=function(){function a(){this.lastTime=0,this._uiList=[],this._containerList=[]}return Object.defineProperty(a.prototype,"uiList",{get:function(){return this._uiList},enumerable:!0,configurable:!0}),a.prototype.addUI=function(a){for(var b=0,c=this._uiList.length-1;c>=0;c--)if(this._uiList[c].sortnum<=a.sortnum){b=c+1;break}this._uiList.splice(b,0,a),a.rendering=!0},a.prototype.removeUI=function(a){var b=this._uiList.indexOf(a);
a.rendering=!1,-1!=b&&this._uiList.splice(b,1)},a.prototype.addUIContainer=function(a){if(!a.hasStage){a.perent=this,this._containerList.push(a),a.resize();for(var b=0;b<a.renderList.length;b++)this.addUI(a.renderList[b]);a.hasStage=!0}},a.prototype.removeAll=function(){for(;this._containerList.length;)this.removeUIContainer(this._containerList[this._containerList.length-1])},a.prototype.removeUIContainer=function(a){if(a.hasStage){var b=this._containerList.indexOf(a);a.hasStage=!1,a.perent=null,-1!=b&&this._containerList.splice(b,1);for(var c=0;c<a.renderList.length;c++)this.removeUI(a.renderList[c])}},a.prototype.hasWindowUI=function(){return!1},a.prototype.removeNoInterfaceUI=function(){for(var a=this._containerList.length-1;a>=0;a--)this._containerList[a].interfaceUI||this.removeUIContainer(this._containerList[a])},a.prototype.resize=function(){if(this._uiList){for(var a=0;a<this._uiList.length;a++)this._uiList[a].resize();for(var a=0;a<this._containerList.length;a++)this._containerList[a].resize()}},a.prototype.upBgGroundZero=function(){for(var a=0;a<this._uiList.length;a++)(-1==this._uiList[a].container.layer||-1==this._uiList[a].sortnum)&&this._uiList[a].update()},a.prototype.update=function(){for(var a=0;a<this._uiList.length;a++)this._uiList[a].container.layer>=0&&-1!=this._uiList[a].sortnum&&this._uiList[a].update()},a.prototype.regEvent=function(a){},a.prototype.onTouch=function(a){this.interactiveEvent(a)},a.prototype.onMouse=function(a){this.interactiveEvent(a)},a.prototype.interactiveEvent=function(a){var b,c=new f;if(a instanceof MouseEvent)a.type==e.MouseDown?b=new d(d.Down):a.type==e.MouseUp?b=new d(d.Up):a.type==e.MouseMove?b=new d(d.Move):a.type==e.MouseClick,c.x=a.pageX,c.y=a.pageY;else if(a.type==e.TouchStart?(b=new d(d.Down),a.touches.length>1?(c.x=a.touches[a.touches.length-1].pageX,c.y=a.touches[a.touches.length-1].pageY):(c.x=a.pageX,c.y=a.pageY)):a.type==e.TouchEnd?(b=new d(d.Up),c.x=a.changedTouches[0].pageX,c.y=a.changedTouches[0].pageY):a.type==e.TouchMove&&(a.touches.length>1?(b=new d(d.Pinch),b.data=g.math_distance(a.touches[0].clientX,a.touches[0].clientY,a.touches[1].clientX,a.touches[1].clientY)/this.lastSwipeDis,b.roation=180*(Math.atan2(a.touches[1].clientY-a.touches[0].clientY,a.touches[1].clientX-a.touches[0].clientX)-this.lastSwipeRot)/Math.PI):b=new d(d.Move),c.x=a.pageX,c.y=a.pageY),a.touches.length)for(var h=0;h<a.touches.length;h++)c.x=a.touches[h].clientX,c.y=a.touches[h].clientY;this.mouseEvetData(b,c)},a.prototype.disMoveNnum=function(a,b){return f.distance(a,this.lastMousePos)<b},a.prototype.mouseEvetData=function(a,d){c.cando=!0,b.verticalScene?(a.x=d.y,a.y=b.stageHeight-d.x):(a.x=d.x,a.y=d.y);var e=!1;if(!e)for(var f=this._uiList.length-1;f>=0;f--)if(this._uiList[f]&&this._uiList[f]&&this._uiList[f].interactiveEvent(a)){e=!0;break}return e},a}();a.LayUIManager=h}(win||(win={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),win;!function(a){var b=Pan3d.Rectangle,c=function(a){function c(){var c=a.call(this)||this;return c.rect=new b(0,0,250,250),c.children=[],c}return __extends(c,a),Object.defineProperty(c.prototype,"rect",{get:function(){return this._rect},set:function(a){this._rect=a},enumerable:!0,configurable:!0}),c.prototype.onAdd=function(){},c.prototype.onRemove=function(){},c.prototype.addChild=function(a){a.perent=this,a.onAdd(),this.children.push(a)},c.prototype.removeChild=function(a){var b=this.children.indexOf(a);-1!=b&&(a.onRemove(),this.children.splice(b,1))},c.prototype.update=function(){a.prototype.update.call(this);for(var b=0;b<this.children.length;b++)this.children[b].update()},c.prototype.resize=function(){a.prototype.resize.call(this);for(var b=0;b<this.children.length;b++)this.children[b].resize()},Object.defineProperty(c.prototype,"x",{get:function(){return this.rect.x},set:function(a){this.rect.x=a,this.changeSize()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this.rect.y},set:function(a){this.rect.y=a,this.changeSize()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){return this.rect.width},set:function(a){this.rect.width=a,this.changeSize()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this.rect.height},set:function(a){this.rect.height=a,this.changeSize()},enumerable:!0,configurable:!0}),c.prototype.getObjectsUnderPoint=function(a){for(var b=this.children.length-1;b>=0;b--){var c=this.children[b].getObjectsUnderPoint(a);if(c)return c}for(var d=this.uiList.length-1;d>=0;d--)if(this.uiList[d]&&this.uiList[d]&&this.uiList[d].insetUi(a))return this.uiList[d].insetUi(a);return null},c.prototype.mouseEvetData=function(b,c){for(var d=this.children.length-1;d>=0;d--){var e=this.children[d].mouseEvetData(b,c);if(e)return e}return a.prototype.mouseEvetData.call(this,b,c)},c.prototype.changeSize=function(){},c}(a.LayUIManager);a.Sprite=c}(win||(win={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),win;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.loadConfigCom=function(){a.prototype.loadConfigCom.call(this),this.setUiListVisibleByItem([this.a_scroll_bar,this.a_scroll_bar_bg],!1),this.setUiListVisibleByItem([this.e_panel_1],!1)},b}(a.BaseWindow);a.LayoutbaseBg=b}(win||(win={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),win;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.layer=0,b}return __extends(b,a),b}(a.Sprite);a.Panel=b}(win||(win={}));var win;!function(a){var b=Pan3d.Scene_data,c=function(){function a(){}return a}();a.GameUIInstance=c;var d=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.initData=function(){this.children=[]},a.prototype.addPanel=function(a,b,c){if(void 0===c&&(c=!1),a.layer=b,c)for(var d=this.children.length-1;d>=0;d--)this.children[d].layer==b&&this.removePanel(this.children[d]);var e=this.children.indexOf(a);-1==e&&(this.children.push(a),this.children.sort(function(a,b){return a.layer-b.layer}))},a.prototype.removePanel=function(a){var b=this.children.indexOf(a);-1!=b&&this.children.splice(b,1)},a.prototype.update=function(){Pan3d.Scene_data.context3D.setDepthTest(!1);for(var a=0;this.children&&a<this.children.length;a++)this.children[a].update()},a.prototype.resize=function(){for(var a=0;this.children&&a<this.children.length;a++)this.children[a].resize()},a.prototype.getObjectsUnderPoint=function(a){for(var b=this.children.length-1;b>=0;b--){var c=this.children[b].getObjectsUnderPoint(a);if(c)return c}return null},a.prototype.mouseEvetData=function(c,d){if(!a.isHideMouseEvent){for(var e=!1,f=this.children.length-1;f>=0;f--)e||(e=this.children[f].mouseEvetData(c,d));var g=b.uiStage.interactiveEvent(c);return e?!0:(b.uiBlankStage.interactiveEvent(c),g)}},a}();a.LayerManager=d}(win||(win={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Object3D,c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._mouseDown=!1,b.last_mouse_x=0,b.last_mouse_y=0,b.oldPosx=0,b.oldPosy=0,b.oldPosz=0,b.old_rotation_x=0,b.old_rotation_y=0,b}return __extends(b,a),b}(b);a.MouseVO=c}(xyz||(xyz={}));var xyz;!function(a){var b=Pan3d.Matrix3D,c=function(){function a(){this.oldscale_x=1,this.oldscale_y=1,this.oldscale_z=1}return a.prototype.changeModelMatrix3d=function(){this.updateMatrix()},a.prototype.updateMatrix=function(){this.modeMatrx3D||(this.modeMatrx3D=new b),this.modeMatrx3D.identity(),this.modeMatrx3D.appendRotation(this.rotationX,Vector3D.X_AXIS),this.modeMatrx3D.appendRotation(this.rotationY,Vector3D.Y_AXIS),this.modeMatrx3D.appendRotation(this.rotationZ,Vector3D.Z_AXIS),this.modeMatrx3D.appendTranslation(this.x,this.y,this.z)},a.getTemapXyzPosData=function(b,c,d,e){var f=new a;return f.id=b,f.x=c,f.y=d,f.z=e,f.type=1,f},a.prototype.getEulerAngles=function(a){var b,c,d,e,f,g,h,i;return e=a[0],f=a[1],g=a[2],h=a[3],i=2*(h*f-e*g),-.99999>=i?(b=2*Math.atan2(e,h),c=-Math.PI/2,d=0):i>=.99999?(b=2*Math.atan2(e,h),c=Math.PI/2,d=0):(b=Math.atan2(2*(h*e+f*g),1-2*(e*e+f*f)),c=Math.asin(i),d=Math.atan2(2*(h*g+e*f),1-2*(f*f+g*g))),[b,c,d]},a.prototype.upRootMatrix3DToItem=function(){this.updateMatrix();for(var a=0;a<this.spriteItem.length;a++){this.spriteItem[a].scaleX=this.dataItem[a].scaleX*this.scaleX,this.spriteItem[a].scaleY=this.dataItem[a].scaleY*this.scaleY,this.spriteItem[a].scaleZ=this.dataItem[a].scaleZ*this.scaleZ;var b=this.modeMatrx3D.clone();this.spriteItem[a].x=b.position.x,this.spriteItem[a].y=b.position.y,this.spriteItem[a].z=b.position.z;var c=b.toEulerAngles();this.spriteItem[a].rotationX=c.x,this.spriteItem[a].rotationY=c.y,this.spriteItem[a].rotationZ=c.z,this.dataUpDate()}console.log("--------------")},a.getBase=function(b,c){void 0===c&&(c=!1);var d=new a;d.scaleX=1,d.scaleY=1,d.scaleZ=1,d.dataItem=[],d.spriteItem=[],d.x=b[0].x,d.y=b[0].y,d.z=b[0].z,d.scaleX=b[0].scaleX,d.scaleY=b[0].scaleY,d.scaleZ=b[0].scaleZ,d.rotationX=b[0].rotationX,d.rotationY=b[0].rotationY,d.rotationZ=b[0].rotationZ,d.updateMatrix(),d.baseMatrix3D=d.modeMatrx3D.clone();var e=d.modeMatrx3D.clone();e.invert();for(var f=0;f<b.length;f++){var g=new a;g.baseMatrix3D=b[f].posMatrix.clone(),g.scaleX=b[f].scaleX/d.scaleX,g.scaleY=b[f].scaleY/d.scaleY,g.scaleZ=b[f].scaleZ/d.scaleZ,g.x=b[f].x,g.y=b[f].y,g.z=b[f].z,g.rotationX=b[f].rotationX,g.rotationY=b[f].rotationY,g.rotationZ=b[f].rotationZ,d.dataItem.push(g),d.spriteItem.push(b[f])}return d},a}();a.TooXyzPosData=c}(xyz||(xyz={}));var xyz;!function(a){var b=Pan3d.Vector2D,c=Pan3d.Matrix3D,d=Pan3d.TestTriangle,e=Pan3d.Engine,f=function(){function a(){}return a.getViewMatrx3D=function(a){var b=new c;return b.perspectiveFieldOfViewLH(e.sceneCamScale,1,1,1e3),b.appendScale(1,a.cavanRect.width/a.cavanRect.height,1),b},a.testHitModel=function(b,c,e){if(!b||!b.objData)return 0;var f=b.objData,g=a.getCamFontDistent(c,e,100),h=c.cam3D.cameraMatrix.clone(),i=c.viewMatrx3D.clone();h.append(i);for(var j=0;j<f.indexs.length/3;j++){var k=f.indexs[3*j+0],l=f.indexs[3*j+1],m=f.indexs[3*j+2],n=new Vector3D(f.vertices[3*k+0],f.vertices[3*k+1],f.vertices[3*k+2]),o=new Vector3D(f.vertices[3*l+0],f.vertices[3*l+1],f.vertices[3*l+2]),p=new Vector3D(f.vertices[3*m+0],f.vertices[3*m+1],f.vertices[3*m+2]);if(n=b.posMatrix.transformVector(n),o=b.posMatrix.transformVector(o),p=b.posMatrix.transformVector(p),0!=Vector3D.distance(n,o)&&0!=Vector3D.distance(n,p)&&0!=Vector3D.distance(o,p)){if(d.baseTri.p1=this.math3DWorldtoDisplay2DPos(n,h,c.cam3D.cavanRect),d.baseTri.p2=this.math3DWorldtoDisplay2DPos(o,h,c.cam3D.cavanRect),d.baseTri.p3=this.math3DWorldtoDisplay2DPos(p,h,c.cam3D.cavanRect),d.baseTri.checkPointIn(e)){var q=new Vector3D(c.cam3D.x,c.cam3D.y,c.cam3D.z),r=Pan3d.MathUtil.getLinePlaneInterectPointByTri(q,g,[n,o,p]);if(n=c.cam3D.cameraMatrix.transformVector(n),o=c.cam3D.cameraMatrix.transformVector(o),p=c.cam3D.cameraMatrix.transformVector(p),n.z<0||o.z<0||p.z<0)continue;r=c.cam3D.cameraMatrix.transformVector(r);var s=r.z;if(s>0)return s}}else console.log("有为零的点")}return 0},a.getCamFontDistent=function(a,b,c){var d=a.cam3D.cameraMatrix.clone(),e=a.viewMatrx3D.clone();d.append(e);var f=this.mathDisplay2Dto3DWorldPos(b,a),g=new Vector3D(a.cam3D.x,a.cam3D.y,a.cam3D.z),h=f.subtract(g);return h.normalize(),h.scaleBy(c),g=g.add(h)},a.math3DWorldtoDisplay2DPos=function(a,c,d){var e=c.transformVector(a),f=new b;return f.x=(e.x/e.w+1)*(d.width/2),f.y=(-e.y/e.w+1)*(d.height/2),f},a.mathDisplay2Dto3DWorldPos=function(a,b){var c=b.cam3D.cameraMatrix.clone(),d=b.viewMatrx3D.clone();c.invert(),d.invert();var e=new Vector3D;return e.x=a.x,e.y=a.y,e.x=2*e.x/b.cam3D.cavanRect.width-1,e.y=1-2*e.y/b.cam3D.cavanRect.height,e.w=1,e.x=e.x*e.w,e.y=e.y*e.w,e=d.transformVector(e),e.z=1,e=c.transformVector(e)},a}();a.TooMathHitModel=f}(xyz||(xyz={}));var xyz;!function(a){var b=function(){function a(){}return a.MOVE_NULL=0,a.MOVE_XYZ=1,a.MOVE_SCALE=2,a.MOVE_ROUTATION=3,a}();a.TooMathMoveUint=b}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Object3D,c=function(a){function b(b,c,d){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0);var e=a.call(this,b,c,d)||this;return e.beginx=-10,e.beginy=-10,e.beginz=-10,e.endx=10,e.endy=10,e.endz=10,e}return __extends(b,a),b}(b);a.TooObjectHitBox=c}(xyz||(xyz={}));var xyz;!function(a){var b=function(){function a(){}return a}();a.TooXyzRotationMath=b}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Display3D,c=Pan3d.ProgrmaManager,d=Pan3d.Scene_data,e=Pan3d.Vector3D,f=Pan3d.LineDisplayShader,g=function(a){function b(){var b=a.call(this)||this;return b.baseColor=new e(1,0,1,1),b.objData=new ObjData,b.shader=c.getInstance().getProgram(f.LineShader),b.program=b.shader.program,b.makeLineMode(new e(0,0,0),new e(30,0,0),new e(1,0,1)),b.upToGpu(),b}return __extends(b,a),b.prototype.makeLineMode=function(a,b,c){void 0===c&&(c=null),this.lineVecPos&&this.lineIndex||this.clear(),c&&(this.baseColor=c),this.lineVecPos.push(a.x,a.y,a.z),this.lineVecPos.push(b.x,b.y,b.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineIndex.push(this.lineIndex.length+0,this.lineIndex.length+1)},b.prototype.clear=function(){this.lineVecPos=new Array,this.lineIndex=new Array,this.lineColor=new Array,this.objData.indexBuffer&&(this.objData.indexBuffer=null)},b.prototype.upToGpu=function(){this.lineIndex.length&&(this.objData.treNum=this.lineIndex.length,this.objData.vertexBuffer=d.context3D.uploadBuff3D(this.lineVecPos),this.objData.normalsBuffer=d.context3D.uploadBuff3D(this.lineColor),this.objData.indexBuffer=d.context3D.uploadIndexBuff3D(this.lineIndex))},b.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(d.context3D.setProgram(this.program),d.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",d.viewMatrx3D.m),d.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",d.cam3D.cameraMatrix.m),d.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),d.context3D.setVa(0,3,this.objData.vertexBuffer),d.context3D.setVa(1,3,this.objData.normalsBuffer),d.context3D.drawLine(this.objData.indexBuffer,this.objData.treNum))},b}(b);a.TooLineDisplaySprite=g}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Shader3D,c=Pan3d.Display3D,d=Pan3d.ProgrmaManager,e=Pan3d.Scene_data,f=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;uniform vec4 baseColorVect4;varying vec4 colorv4;\nvoid main(void){   colorv4 = baseColorVect4 ;   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nvarying vec4 colorv4;\nvoid main(void)\n{\ngl_FragColor =colorv4;\n}";return a},b.TooBoxDisplay3DShader="TooBoxDisplay3DShader",b}(b);a.TooBoxDisplay3DShader=f;var g=function(a){function b(){var b=a.call(this)||this;return b.initData(),b.colorVect=new Vector3D(1,1,1,1),b}return __extends(b,a),b.prototype.initData=function(){d.getInstance().registe(f.TooBoxDisplay3DShader,new f),this.shader=d.getInstance().getProgram(f.TooBoxDisplay3DShader),this.program=this.shader.program,this.objData=new ObjData,this.objData=this.makeBoxTampData(.1),this.upToGpu()},b.prototype.makeBoxTampData=function(a){void 0===a&&(a=1);var b=new ObjData,c=new Array,d=-10*a,e=-10*a,f=-10*a,g=10*a,h=10*a,i=10*a;c.push(new Vector3D(d,e,i)),c.push(new Vector3D(d,e,f)),c.push(new Vector3D(g,e,f)),c.push(new Vector3D(g,e,i)),c.push(new Vector3D(d,h,i)),c.push(new Vector3D(d,h,f)),c.push(new Vector3D(g,h,f)),c.push(new Vector3D(g,h,i));var j=new Array;j.push(0,1,2),j.push(0,2,3),j.push(4,6,5),j.push(4,7,6),j.push(5,2,1),j.push(5,6,2),j.push(6,3,2),j.push(6,7,3),j.push(4,1,0),j.push(4,5,1),j.push(4,0,3),j.push(4,3,7),b.vertices=new Array,b.indexs=new Array;for(var k=0;k<j.length;k++){var l=c[j[k]];b.vertices.push(l.x,l.y,l.z),b.indexs.push(k)}return b},b.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=e.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=e.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=e.context3D.uploadIndexBuff3D(this.objData.indexs))},b.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(e.context3D.cullFaceBack(!1),e.context3D.setProgram(this.program),e.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",e.viewMatrx3D.m),e.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",e.cam3D.cameraMatrix.m),e.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),e.context3D.setVc4fv(this.shader,"baseColorVect4",[this.colorVect.x,this.colorVect.y,this.colorVect.z,this.colorVect.w]),e.context3D.setVa(0,3,this.objData.vertexBuffer),e.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},b}(c);a.TooBoxDisplay3DSprite=g}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Shader3D,c=Pan3d.Display3D,d=Pan3d.ProgrmaManager,e=Pan3d.Matrix3D,f=Pan3d.Scene_data,g=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;uniform vec4 baseColorVect4;varying vec4 colorv4;\nvoid main(void){   colorv4 = baseColorVect4 ;   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nvarying vec4 colorv4;\nvoid main(void)\n{\ngl_FragColor =colorv4;\n}";return a},b.TooJianTouDisplay3DShader="TooJianTouDisplay3DShader",b}(b);a.TooJianTouDisplay3DShader=g;var h=function(a){function b(){var b=a.call(this)||this;return b.initData(),b.colorVect=new Vector3D(1,1,1,1),b}return __extends(b,a),b.prototype.initData=function(){d.getInstance().registe(g.TooJianTouDisplay3DShader,new g),this.shader=d.getInstance().getProgram(g.TooJianTouDisplay3DShader),this.program=this.shader.program,this.objData=new ObjData;var a=.2,b=2*a*2,c=5*a*2;this.makeObjData(this.objData,new Vector3D(+c,0,0),new Vector3D(-c,b,0),Vector3D.X_AXIS,12),this.upToGpu()},b.prototype.makeObjData=function(a,b,c,d,f){for(var g,h,i,j=new e,k=0;359>k;k++)j.identity(),j.appendRotation(k,d),g=j.transformVector(b),h=j.transformVector(c),a.vertices.push(g.x,g.y,g.z),a.vertices.push(h.x,h.y,h.z),a.uvs.push(f,f),a.uvs.push(f,f),0!=k&&(i=k-1,a.indexs.push(2*i+2,2*i+1,2*i+3))},b.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=f.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=f.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=f.context3D.uploadIndexBuff3D(this.objData.indexs))},b.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(f.context3D.setProgram(this.program),f.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",f.viewMatrx3D.m),f.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",f.cam3D.cameraMatrix.m),f.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),f.context3D.setVc4fv(this.shader,"baseColorVect4",[this.colorVect.x,this.colorVect.y,this.colorVect.z,this.colorVect.w]),f.context3D.setVa(0,3,this.objData.vertexBuffer),f.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},b}(c);a.TooJianTouDisplay3DSprite=h}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),cctv;!function(a){var b=Pan3d.Shader3D,c=Pan3d.Display3D,d=Pan3d.ProgrmaManager,e=Pan3d.Matrix3D,f=Pan3d.Scene_data,g=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;uniform vec4 baseColorVect4;varying vec4 colorv4;\nvoid main(void){   colorv4 = baseColorVect4 ;   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nvarying vec4 colorv4;\nvoid main(void)\n{\ngl_FragColor =colorv4;\n}";return a},b.TooJianTouDisplay3DShader="TooJianTouDisplay3DShader",b}(b);a.TooJianTouDisplay3DShader=g;var h=function(a){function b(){var b=a.call(this)||this;return b.initData(),b.colorVect=new Vector3D(1,1,1,1),b}return __extends(b,a),b.prototype.initData=function(){d.getInstance().registe(g.TooJianTouDisplay3DShader,new g),this.shader=d.getInstance().getProgram(g.TooJianTouDisplay3DShader),this.program=this.shader.program,this.objData=new ObjData;this.objData=this.mathRoundTri(2),this.upToGpu()},b.prototype.mathRoundTri=function(a){void 0===a&&(a=1);var b=new ObjData;b.vertices=[],b.uvs=[],b.indexs=[];for(var c,d,f,g=10,h=360,i=1*(g/50)*a,j=new Vector3D(+i,g,0),k=new Vector3D(-i,g,0),l=new e,m=0,n=0;h>n;n++)l.identity(),l.appendRotation(n,Vector3D.X_AXIS),c=l.transformVector(j),d=l.transformVector(k),b.vertices.push(c.x,c.y,c.z),b.vertices.push(d.x,d.y,d.z),b.uvs.push(0,0),b.uvs.push(0,0),0!=n&&(f=n-1,b.indexs.push(m+2*f+0,m+2*f+1,m+2*f+2),b.indexs.push(m+2*f+2,m+2*f+1,m+2*f+3));return b},b.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=f.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=f.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=f.context3D.uploadIndexBuff3D(this.objData.indexs))},b.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(f.context3D.setProgram(this.program),f.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",f.viewMatrx3D.m),f.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",f.cam3D.cameraMatrix.m),f.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),f.context3D.setVc4fv(this.shader,"baseColorVect4",[this.colorVect.x,this.colorVect.y,this.colorVect.z,this.colorVect.w]),f.context3D.setVa(0,3,this.objData.vertexBuffer),f.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},b}(c);a.TooRotationDisplay3DSprite=h}(cctv||(cctv={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Shader3D,c=Pan3d.Display3D,d=Pan3d.ProgrmaManager,e=Pan3d.Scene_data,f=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"nrmPosition")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec3 nrmPosition;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec3 v3_nrm;void main(void){   v3_nrm = nrmPosition;   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nvarying vec3 v3_nrm;void main(void)\n{\ngl_FragColor =vec4(v3_nrm,1.0);\n}";return a},b.TooLineTri3DShader="TooLineTri3DShader",b}(b);a.TooLineTri3DShader=f;var g=function(b){function c(){var a=b.call(this)||this;return a.initData(),a.updateMatrix,a}return __extends(c,b),c.prototype.initData=function(){d.getInstance().registe(f.TooLineTri3DShader,new f),this.shader=d.getInstance().getProgram(f.TooLineTri3DShader),this.program=this.shader.program,this.objData=new ObjData;var b=new a.TooObjectHitBox(0,0,0),c=.1;b.beginx=-0,b.beginy=-c,b.beginz=-c,b.endx=20,b.endy=c,b.endz=c,this.objData=this.makeBoxTampData(b,1),this.upToGpu()},c.prototype.makeBoxObjdata=function(a){this.objData.vertices=new Array,this.objData.vertices.push(0,0,0),this.objData.vertices.push(100,0,0),this.objData.vertices.push(100,0,100),this.objData.normals=new Array,this.objData.normals.push(a.x,a.y,a.z),this.objData.normals.push(a.x,a.y,a.z),this.objData.normals.push(a.x,a.y,a.z),this.objData.indexs=new Array,this.objData.indexs.push(0,1,2)},c.prototype.makeBoxTampData=function(a,b){void 0===b&&(b=1);var c=new ObjData,d=new Array,e=(Math.max(Math.abs(a.beginx),Math.abs(a.endx))*b,Math.max(Math.abs(a.beginz),Math.abs(a.endz))*b,-10),f=-10,g=-10,h=10,i=10,j=10;e=a.beginx,h=a.endx,f=a.beginy,i=a.endy,g=a.beginz,j=a.endz,d.push(new Vector3D(e,f,j)),d.push(new Vector3D(e,f,g)),d.push(new Vector3D(h,f,g)),d.push(new Vector3D(h,f,j)),d.push(new Vector3D(e,i,j)),d.push(new Vector3D(e,i,g)),d.push(new Vector3D(h,i,g)),d.push(new Vector3D(h,i,j));var k=new Array;k.push(0,1,2),k.push(0,2,3),k.push(4,5,6),k.push(4,6,7),k.push(5,1,2),k.push(5,2,6),k.push(6,2,3),k.push(6,3,7),k.push(4,0,1),k.push(4,1,5),k.push(4,3,0),k.push(4,7,3),c.vertices=new Array,c.normals=new Array,c.indexs=new Array;for(var l=0;l<k.length;l++){var m=d[k[l]];c.vertices.push(m.x,m.y,m.z),c.normals.push(1,1,0),c.indexs.push(l)}return c},c.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=e.context3D.uploadBuff3D(this.objData.vertices),this.objData.normalsBuffer=e.context3D.uploadBuff3D(this.objData.normals),this.objData.indexBuffer=e.context3D.uploadIndexBuff3D(this.objData.indexs))},c.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(e.context3D.setProgram(this.program),e.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",e.viewMatrx3D.m),e.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",e.cam3D.cameraMatrix.m),e.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),e.context3D.setVa(0,3,this.objData.vertexBuffer),e.context3D.setVa(1,3,this.objData.normalsBuffer),e.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},c}(c);a.TooLineTri3DSprite=g}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Display3D,c=function(b){function c(a){var c=b.call(this)||this;return c.parent=a,c}return __extends(c,b),c.prototype.isHit=function(a){},c.prototype.onMouseDown=function(a){},c.prototype.onMouseUp=function(a){},c.prototype.onMouseMove=function(a){},c.prototype.testHitTemp=function(b,c,d){var e=a.TooMathHitModel.testHitModel(b,this._scene,c);b.colorVect=e?d[0]:d[1]},c.prototype.update=function(){this.posMatrix.identity();var a=this.parent.lookLenToFocu/100;this.posMatrix.appendScale(a,a,a)},c}(b);a.TooBaseModelLevel=c}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Matrix3D,c=Pan3d.Scene_data,d=function(d){function e(b){var c=d.call(this,b)||this;return c._boxA=new a.TooJianTouDisplay3DSprite,c._boxB=new a.TooJianTouDisplay3DSprite,c._boxC=new a.TooJianTouDisplay3DSprite,c._lineA=new a.TooLineTri3DSprite,c._lineB=new a.TooLineTri3DSprite,c._lineC=new a.TooLineTri3DSprite,c._boxA.colorVect=new Vector3D(1,0,0),c._boxB.colorVect=new Vector3D(0,1,0),c._boxC.colorVect=new Vector3D(0,0,1),c}return __extends(e,d),e.prototype.isHit=function(a){this.testHitTemp(this._boxA,a,[new Vector3D(1,1,1),new Vector3D(1,0,0)]),this.testHitTemp(this._boxB,a,[new Vector3D(1,1,1),new Vector3D(0,1,0)]),this.testHitTemp(this._boxC,a,[new Vector3D(1,1,1),new Vector3D(0,0,1)])},e.prototype.onMouseDown=function(b){if(a.TooMathHitModel.testHitModel(this._boxA,this._scene,b)?this.selectId=1:a.TooMathHitModel.testHitModel(this._boxB,this._scene,b)?this.selectId=2:a.TooMathHitModel.testHitModel(this._boxC,this._scene,b)&&(this.selectId=3),
this.selectId>0){var c,d,e=new Vector3D(0,0,0);switch(this.selectId){case 1:c=new Vector3D(100,0,0),d=new Vector3D(0,0,100);break;case 2:c=new Vector3D(100,0,0),d=new Vector3D(0,100,0);break;case 3:c=new Vector3D(0,0,100),d=new Vector3D(0,100,0)}e=this.parent.xyzMoveData.modeMatrx3D.transformVector(e),c=this.parent.xyzMoveData.modeMatrx3D.transformVector(c),d=this.parent.xyzMoveData.modeMatrx3D.transformVector(d),this.pointItem=[e,c,d],this.lastMatrix3d=this.parent.xyzMoveData.modeMatrx3D.clone(),this.lastMousePosV3d=this.getMouseHitPanelPos(b)}},e.prototype.onMouseUp=function(a){this.lastMousePosV3d=null,this.selectId=0},e.prototype.getMouseHitPanelPos=function(b){var c=a.TooMathHitModel.getCamFontDistent(this._scene,b,100),d=new Vector3D(this._scene.cam3D.x,this._scene.cam3D.y,this._scene.cam3D.z),e=Pan3d.MathUtil.getLinePlaneInterectPointByTri(d,c,this.pointItem),f=this.lastMatrix3d.clone();return f.invert(),e=f.transformVector(e)},e.prototype.onMouseMove=function(a){var b;if(this.selectId>0&&this.lastMousePosV3d){var c=this.getMouseHitPanelPos(a),d=new Vector3D;switch(this.selectId){case 1:d.x=c.x-this.lastMousePosV3d.x,b=!0;break;case 2:d.y=c.y-this.lastMousePosV3d.y,b=!0;break;case 3:d.z=c.z-this.lastMousePosV3d.z,b=!0;break;default:b=!1}var e=this.lastMatrix3d.clone();e.prependTranslation(d.x,d.y,d.z);var c=e.position;this.parent.xyzMoveData.x=c.x,this.parent.xyzMoveData.y=c.y,this.parent.xyzMoveData.z=c.z}return b},e.prototype.getMouseHitPos=function(b){var c,d,e=a.TooMathHitModel.getCamFontDistent(this._scene,b,100),f=new Vector3D(0,0,0);switch(this.selectId){case 1:c=new Vector3D(1,0,0),d=new Vector3D(0,0,1);break;case 2:c=new Vector3D(0,1,0),d=new Vector3D(0,0,1);break;case 3:c=new Vector3D(0,0,1),d=new Vector3D(1,0,0)}return Vector3D.getPointPedalInPlane(e,f,c,d)},e.prototype.update=function(){d.prototype.update.call(this);var a=20;if(this.parent.xyzMoveData){this.posMatrix.identity();var e=this.parent.xyzMoveData.modeMatrx3D.clone();e=new b,e.appendRotation(this.parent.xyzMoveData.rotationX,Vector3D.X_AXIS),e.appendRotation(this.parent.xyzMoveData.rotationY,Vector3D.Y_AXIS),e.appendRotation(this.parent.xyzMoveData.rotationZ,Vector3D.Z_AXIS),e.appendTranslation(this.parent.xyzMoveData.x,this.parent.xyzMoveData.y,this.parent.xyzMoveData.z);var f=Vector3D.distance(e.position,this._scene.cam3D);f=this._scene.cam3D.cameraMatrix.transformVector(e.position).z,e.prependScale(f/80,f/80,f/80),this.posMatrix.append(e)}this._boxA.posMatrix=this.posMatrix.clone(),this._boxA.posMatrix.prependTranslation(a,0,0),this._boxB.posMatrix=this.posMatrix.clone(),this._boxB.posMatrix.prependTranslation(0,a,0),this._boxB.posMatrix.prependRotation(90,Vector3D.Z_AXIS),this._boxC.posMatrix=this.posMatrix.clone(),this._boxC.posMatrix.prependTranslation(0,0,a),this._boxC.posMatrix.prependRotation(-90,Vector3D.Y_AXIS),this._lineA.posMatrix=this.posMatrix.clone(),this._lineB.posMatrix=this.posMatrix.clone(),this._lineB.posMatrix.prependRotation(90,Vector3D.Z_AXIS),this._lineC.posMatrix=this.posMatrix.clone(),this._lineC.posMatrix.prependRotation(-90,Vector3D.Y_AXIS),c.context3D.cullFaceBack(!1),c.context3D.setWriteDepth(!0),c.context3D.setDepthTest(!0),this._boxA.update(),this._boxB.update(),this._boxC.update(),this._lineA.update(),this._lineB.update(),this._lineC.update()},e}(a.TooBaseModelLevel);a.TooMoveLevel=d}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Matrix3D,c=Pan3d.Scene_data,d=cctv.TooRotationDisplay3DSprite,e=function(e){function f(a){var b=e.call(this,a)||this;return b._roundA=new d,b._roundB=new d,b._roundC=new d,b._roundA.colorVect=new Vector3D(1,0,0),b._roundB.colorVect=new Vector3D(0,1,0),b._roundC.colorVect=new Vector3D(0,0,1),b}return __extends(f,e),f.prototype.isHit=function(a){this.testHitTemp(this._roundA,a,[new Vector3D(1,1,1),new Vector3D(1,0,0)]),this.testHitTemp(this._roundB,a,[new Vector3D(1,1,1),new Vector3D(0,1,0)]),this.testHitTemp(this._roundC,a,[new Vector3D(1,1,1),new Vector3D(0,0,1)])},f.prototype.onMouseDown=function(b){if(a.TooMathHitModel.testHitModel(this._roundA,this._scene,b)?this.selectId=1:a.TooMathHitModel.testHitModel(this._roundB,this._scene,b)?this.selectId=2:a.TooMathHitModel.testHitModel(this._roundC,this._scene,b)&&(this.selectId=3),this.selectId){var c,d,e;switch(this.selectId){case 1:c=new Vector3D(0,-100,50),d=new Vector3D(0,-100,-50),e=new Vector3D(0,100,50);break;case 2:c=new Vector3D(-100,0,50),d=new Vector3D(-100,0,-50),e=new Vector3D(100,0,50);break;case 3:c=new Vector3D(-100,50,0),d=new Vector3D(-100,-50,0),e=new Vector3D(100,50,0)}console.log("旋转轴",this.selectId),this.showYaix(c,d,e),this.lastDis=this.testInfo(this._linePosinA,this._linePosinB,b)}},f.prototype.showYaix=function(b,c,d){var e=this._scene,f=e.cam3D.cameraMatrix.clone(),g=e.viewMatrx3D.clone();f.append(g);var h=this.parent.xyzMoveData;b=h.modeMatrx3D.transformVector(b),c=h.modeMatrx3D.transformVector(c),d=h.modeMatrx3D.transformVector(d);var i=Vector3D.calTriNormal(b,c,d,!0),j=a.TooMathHitModel.math3DWorldtoDisplay2DPos(h.modeMatrx3D.position,f,e.cam3D.cavanRect),k=a.TooMathHitModel.math3DWorldtoDisplay2DPos(i.add(h.modeMatrx3D.position),f,e.cam3D.cavanRect);this._linePosinA=j,this._linePosinB=k},f.prototype.onMouseUp=function(a){this.selectId=0,this.lastDis=null},f.prototype.testInfo=function(a,c,d){var e=new Vector2D(0,0),f=new Vector2D(-1,1),g=new Vector2D(10,10);e=a,f=c,g=d;var h=Math.atan2(f.y-e.y,f.x-e.x),i=new b;i.appendRotation(90-180*h/Math.PI,Vector3D.Z_AXIS);var j=i.transformVector(new Vector3D(g.x,g.y,0));return j.x},f.prototype.onMouseMove=function(a){var c;if(this.selectId>0){var d=this.testInfo(this._linePosinA,this._linePosinB,a);if(isNaN(this.lastDis))console.log("开始");else{var e=d-this.lastDis,f=this.parent.xyzMoveData,g=new b;g.appendRotation(f.rotationX,Vector3D.X_AXIS),g.appendRotation(f.rotationY,Vector3D.Y_AXIS),g.appendRotation(f.rotationZ,Vector3D.Z_AXIS);var h=new b;switch(this.selectId){case 1:h.appendRotation(e,Vector3D.X_AXIS);break;case 2:h.appendRotation(-e,Vector3D.Y_AXIS);break;case 3:h.appendRotation(e,Vector3D.Z_AXIS)}g.prepend(h);var i=g.toEulerAngles();f.rotationX=i.x,f.rotationY=i.y,f.rotationZ=i.z,c=!0}this.lastDis=d}return c},f.prototype.update=function(){if(e.prototype.update.call(this),this.posMatrix.identity(),this.parent.xyzMoveData){var a=this.parent.xyzMoveData.modeMatrx3D.clone();a=new b,a.appendRotation(this.parent.xyzMoveData.rotationX,Vector3D.X_AXIS),a.appendRotation(this.parent.xyzMoveData.rotationY,Vector3D.Y_AXIS),a.appendRotation(this.parent.xyzMoveData.rotationZ,Vector3D.Z_AXIS),a.appendTranslation(this.parent.xyzMoveData.x,this.parent.xyzMoveData.y,this.parent.xyzMoveData.z);var d=Vector3D.distance(a.position,this._scene.cam3D);d=this._scene.cam3D.cameraMatrix.transformVector(a.position).z,a.prependScale(d/80,d/80,d/80),this.posMatrix.append(a)}this._roundA.posMatrix=this.posMatrix.clone(),this._roundB.posMatrix=this.posMatrix.clone(),this._roundB.posMatrix.prependRotation(90,Vector3D.Z_AXIS),this._roundC.posMatrix=this.posMatrix.clone(),this._roundC.posMatrix.prependRotation(-90,Vector3D.Y_AXIS),c.context3D.renderContext.enable(c.context3D.renderContext.CULL_FACE),c.context3D.renderContext.cullFace(c.context3D.renderContext.BACK),c.context3D.setWriteDepth(!0),c.context3D.setDepthTest(!0),this._roundA.update(),this._roundB.update(),this._roundC.update()},f}(a.TooBaseModelLevel);a.TooRotationLevel=e}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Matrix3D,c=Pan3d.Scene_data,d=function(d){function e(b){var c=d.call(this,b)||this;return c._boxA=new a.TooBoxDisplay3DSprite,c._boxB=new a.TooBoxDisplay3DSprite,c._boxC=new a.TooBoxDisplay3DSprite,c._lineA=new a.TooLineTri3DSprite,c._lineB=new a.TooLineTri3DSprite,c._lineC=new a.TooLineTri3DSprite,c._boxA.colorVect=new Vector3D(1,0,0),c._boxB.colorVect=new Vector3D(0,1,0),c._boxC.colorVect=new Vector3D(0,0,1),c}return __extends(e,d),e.prototype.isHit=function(a){this.testHitTemp(this._boxA,a,[new Vector3D(1,1,1),new Vector3D(1,0,0)]),this.testHitTemp(this._boxB,a,[new Vector3D(1,1,1),new Vector3D(0,1,0)]),this.testHitTemp(this._boxC,a,[new Vector3D(1,1,1),new Vector3D(0,0,1)])},e.prototype.onMouseDown=function(b){if(a.TooMathHitModel.testHitModel(this._boxA,this._scene,b)?this.selectId=1:a.TooMathHitModel.testHitModel(this._boxB,this._scene,b)?this.selectId=2:a.TooMathHitModel.testHitModel(this._boxC,this._scene,b)&&(this.selectId=3),this.selectId>0){var c,d,e=new Vector3D(0,0,0);switch(this.selectId){case 1:c=new Vector3D(100,0,0),d=new Vector3D(0,0,100);break;case 2:c=new Vector3D(100,0,0),d=new Vector3D(0,100,0);break;case 3:c=new Vector3D(0,0,100),d=new Vector3D(0,100,0)}e=this.parent.xyzMoveData.modeMatrx3D.transformVector(e),c=this.parent.xyzMoveData.modeMatrx3D.transformVector(c),d=this.parent.xyzMoveData.modeMatrx3D.transformVector(d),this.pointItem=[e,c,d],this.lastMatrix3d=this.parent.xyzMoveData.modeMatrx3D.clone(),this.lastMousePosV3d=this.getMouseHitPanelPos(b),this.lastScaleV3d=new Vector3D(this.parent.xyzMoveData.scaleX,this.parent.xyzMoveData.scaleY,this.parent.xyzMoveData.scaleZ)}},e.prototype.onMouseUp=function(a){this.lastMousePosV3d=null,this.selectId=0},e.prototype.getMouseHitPanelPos=function(b){var c=a.TooMathHitModel.getCamFontDistent(this._scene,b,100),d=new Vector3D(this._scene.cam3D.x,this._scene.cam3D.y,this._scene.cam3D.z),e=Pan3d.MathUtil.getLinePlaneInterectPointByTri(d,c,this.pointItem),f=this.lastMatrix3d.clone();return f.invert(),e=f.transformVector(e)},e.prototype.onMouseMove=function(a){var b;if(this.selectId>0&&this.lastMousePosV3d){var c=this.getMouseHitPanelPos(a),d=new Vector3D;switch(this.selectId){case 1:d.x=c.x-this.lastMousePosV3d.x,b=!0;break;case 2:d.y=c.y-this.lastMousePosV3d.y,b=!0;break;case 3:d.z=c.z-this.lastMousePosV3d.z,b=!0;break;default:b=!1}console.log(d),this.parent.xyzMoveData.scaleX=this.lastScaleV3d.x+d.x/10,this.parent.xyzMoveData.scaleY=this.lastScaleV3d.y+d.y/10,this.parent.xyzMoveData.scaleZ=this.lastScaleV3d.z+d.z/10}return b},e.prototype.getMouseHitPos=function(b){var c,d,e=a.TooMathHitModel.getCamFontDistent(this._scene,b,100),f=new Vector3D(0,0,0);switch(this.selectId){case 1:c=new Vector3D(1,0,0),d=new Vector3D(0,0,1);break;case 2:c=new Vector3D(0,1,0),d=new Vector3D(0,0,1);break;case 3:c=new Vector3D(0,0,1),d=new Vector3D(1,0,0)}return Vector3D.getPointPedalInPlane(e,f,c,d)},e.prototype.update=function(){d.prototype.update.call(this);var a=20;if(this.parent.xyzMoveData){this.posMatrix.identity();var e=this.parent.xyzMoveData.modeMatrx3D.clone();e=new b,e.appendRotation(this.parent.xyzMoveData.rotationX,Vector3D.X_AXIS),e.appendRotation(this.parent.xyzMoveData.rotationY,Vector3D.Y_AXIS),e.appendRotation(this.parent.xyzMoveData.rotationZ,Vector3D.Z_AXIS),e.appendTranslation(this.parent.xyzMoveData.x,this.parent.xyzMoveData.y,this.parent.xyzMoveData.z);var f=Vector3D.distance(e.position,this._scene.cam3D);f=this._scene.cam3D.cameraMatrix.transformVector(e.position).z,e.prependScale(f/80,f/80,f/80),this.posMatrix.append(e)}this._boxA.posMatrix=this.posMatrix.clone(),this._boxA.posMatrix.prependTranslation(a,0,0),this._boxB.posMatrix=this.posMatrix.clone(),this._boxB.posMatrix.prependTranslation(0,a,0),this._boxB.posMatrix.prependRotation(90,Vector3D.Z_AXIS),this._boxC.posMatrix=this.posMatrix.clone(),this._boxC.posMatrix.prependTranslation(0,0,a),this._boxC.posMatrix.prependRotation(-90,Vector3D.Y_AXIS),this._lineA.posMatrix=this.posMatrix.clone(),this._lineB.posMatrix=this.posMatrix.clone(),this._lineB.posMatrix.prependRotation(90,Vector3D.Z_AXIS),this._lineC.posMatrix=this.posMatrix.clone(),this._lineC.posMatrix.prependRotation(-90,Vector3D.Y_AXIS),c.context3D.cullFaceBack(!1),c.context3D.setWriteDepth(!0),c.context3D.setDepthTest(!0),this._boxA.update(),this._boxB.update(),this._boxC.update(),this._lineA.update(),this._lineB.update(),this._lineC.update()},e}(a.TooBaseModelLevel);a.TooScaleLevel=d}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.Display3D,c=Pan3d.Matrix3D,d=function(b){function d(){var c=b.call(this)||this;return c._statceType=a.TooMathMoveUint.MOVE_NULL,c._tooMoveLevel=new a.TooMoveLevel(c),c._tooRotationLevel=new a.TooRotationLevel(c),c._tooScaleLevel=new a.TooScaleLevel(c),c}return __extends(d,b),d.prototype.update=function(){new Vector3D;switch(this._xyzMoveData&&(this._xyzMoveData.modeMatrx3D.identity(),this._xyzMoveData.changeModelMatrix3d(),this.lookLenToFocu=Vector3D.distance(this._scene.cam3D,this._xyzMoveData)),this._statceType){case a.TooMathMoveUint.MOVE_XYZ:this._tooMoveLevel.update();break;case a.TooMathMoveUint.MOVE_ROUTATION:this._tooRotationLevel.update();break;case a.TooMathMoveUint.MOVE_SCALE:this._tooScaleLevel.update()}},d.prototype.addStage=function(){b.prototype.addStage.call(this),this._tooMoveLevel._scene=this._scene,this._tooRotationLevel._scene=this._scene,this._tooScaleLevel._scene=this._scene},d.prototype.dataUpDate=function(){},Object.defineProperty(d.prototype,"xyzMoveData",{get:function(){return this._xyzMoveData},set:function(b){return this._xyzMoveData=b,null==this._xyzMoveData?void(this._statceType=a.TooMathMoveUint.MOVE_NULL):(this._statceType=a.TooMathMoveUint.MOVE_XYZ,this._xyzMoveData.modeMatrx3D=new c,void this._xyzMoveData.changeModelMatrix3d())},enumerable:!0,configurable:!0}),d.prototype.onMouseMove=function(b){var c=new Vector2D(b.x-this._scene.cam3D.cavanRect.x,b.y-this._scene.cam3D.cavanRect.y);if(0==b.buttons)switch(this._statceType){case a.TooMathMoveUint.MOVE_XYZ:this._tooMoveLevel.isHit(c);break;case a.TooMathMoveUint.MOVE_ROUTATION:this._tooRotationLevel.isHit(c);break;case a.TooMathMoveUint.MOVE_SCALE:this._tooScaleLevel.isHit(c)}else if(1==b.buttons){var d=!1;switch(this._statceType){case a.TooMathMoveUint.MOVE_XYZ:d=this._tooMoveLevel.onMouseMove(c);break;case a.TooMathMoveUint.MOVE_ROUTATION:d=this._tooRotationLevel.onMouseMove(c);break;case a.TooMathMoveUint.MOVE_SCALE:d=this._tooScaleLevel.onMouseMove(c)}d&&this.upChange()}},d.prototype.upChange=function(){this.xyzMoveData&&(this.xyzMoveData.upRootMatrix3DToItem(),this.xyzMoveData.dataUpDate&&this.xyzMoveData.dataUpDate())},d.prototype.onMouseUp=function(b){var c=new Vector2D(b.x-this._scene.cam3D.cavanRect.x,b.y-this._scene.cam3D.cavanRect.y);switch(this._statceType){case a.TooMathMoveUint.MOVE_XYZ:this._tooMoveLevel.onMouseUp(c);break;case a.TooMathMoveUint.MOVE_ROUTATION:this._tooRotationLevel.onMouseUp(c);break;case a.TooMathMoveUint.MOVE_SCALE:this._tooScaleLevel.onMouseUp(c)}},d.prototype.onMouseDown=function(b){if(this._xyzMoveData){this._xyzMoveData.oldx=this._xyzMoveData.x,this._xyzMoveData.oldy=this._xyzMoveData.y,this._xyzMoveData.oldz=this._xyzMoveData.z,this._xyzMoveData.oldscale_x=this._xyzMoveData.scaleX,this._xyzMoveData.oldscale_y=this._xyzMoveData.scaleY,this._xyzMoveData.oldscale_z=this._xyzMoveData.scaleZ,this._xyzMoveData.oldangle_x=this._xyzMoveData.rotationX,this._xyzMoveData.oldangle_y=this._xyzMoveData.rotationY,this._xyzMoveData.oldangle_z=this._xyzMoveData.rotationZ;var c=new Vector2D(b.x-this._scene.cam3D.cavanRect.x,b.y-this._scene.cam3D.cavanRect.y);if(0==b.button)switch(this._statceType){case a.TooMathMoveUint.MOVE_XYZ:this._tooMoveLevel.onMouseDown(c);break;case a.TooMathMoveUint.MOVE_ROUTATION:this._tooRotationLevel.onMouseDown(c);break;case a.TooMathMoveUint.MOVE_SCALE:this._tooScaleLevel.onMouseDown(c)}}},d}(b);a.MoveScaleRotationLevel=d}(xyz||(xyz={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),xyz;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Vector3D,d=Pan3d.Module,e=Pan3d.BaseProcessor,f=Pan3d.MouseType,g=Pan3d.Matrix3D,h=Pan3d.MathUtil,i=Pan3d.Object3D,j=Pan3d.Quaternion,k=Pan3d.Display3D,l=Pan3d.KeyboardType,m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.INIT_MOVE_SCALE_ROTATION="INIT_MOVE_SCALE_ROTATION",b.INIT_UICONTAINER_TO_XYZ="INIT_UICONTAINER_TO_XYZ",b.MAKE_DTAT_ITEM_TO_CHANGE="MAKE_DTAT_ITEM_TO_CHANGE",b.CLEAR_XYZ_MOVE_DATA="CLEAR_XYZ_MOVE_DATA",b}(b);a.MoveScaleRotatioinEvent=m;var n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"MoveScaleRotatioinModule"},b.prototype.listProcessors=function(){return[new o]},b}(d);a.MoveScaleRotatioinModule=n;var o=function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;return c.mouseInfo=new a.MouseVO,c.A=new g,c.B=new g,c.C=new g,c.disMatrix3D=new g,c}return __extends(d,b),d.prototype.getName=function(){return"MoveScaleRotatioinProcessor"},d.prototype.receivedModuleEvent=function(b){if(b instanceof m)switch(b.type){case m.INIT_MOVE_SCALE_ROTATION:this.moveScaleRotationLevel=new a.MoveScaleRotationLevel,this.selectScene=b.data,this.selectScene.addDisplay(this.moveScaleRotationLevel),this.addEvents();break;case m.INIT_UICONTAINER_TO_XYZ:this.uiContainer=b.data;break;case m.MAKE_DTAT_ITEM_TO_CHANGE:this.moveScaleRotationLevel.xyzMoveData=b.data;break;case m.CLEAR_XYZ_MOVE_DATA:this.moveScaleRotationLevel.xyzMoveData=null}},d.prototype.makeBaseData=function(){var b=new k;return b.x=0,b.y=0,b.z=0,b.rotationX=0,b.rotationY=0,b.rotationZ=0,a.TooXyzPosData.getBase([b])},d.prototype.addEvents=function(){var a=this;this.onMouseWheelFun||(this.onMouseWheelFun=function(b){a.onMouseWheel(b)},this.onMouseDownFun=function(b){a.onMouseDown(b)},this.onMouseMoveFun=function(b){a.onMouseMove(b)},this.onMouseUpFun=function(b){a.onMouseUp(b)},this.onKeyDownFun=function(b){a.onKeyDown(b)},this.onKeyUpFun=function(b){a.onKeyUp(b)}),document.addEventListener(f.MouseWheel,this.onMouseWheelFun),document.addEventListener(f.MouseDown,this.onMouseDownFun),document.addEventListener(f.MouseMove,this.onMouseMoveFun),document.addEventListener(f.MouseUp,this.onMouseUpFun),document.addEventListener(f.KeyDown,this.onKeyDownFun),document.addEventListener(f.KeyUp,this.onKeyUpFun),document.addEventListener("contextmenu",function(a){a.preventDefault()})},d.prototype.removeEvents=function(){document.removeEventListener(f.MouseWheel,this.onMouseWheelFun),document.removeEventListener(f.MouseDown,this.onMouseDownFun),document.removeEventListener(f.MouseMove,this.onMouseMoveFun),document.removeEventListener(f.MouseUp,this.onMouseUpFun),document.removeEventListener(f.KeyDown,this.onKeyDownFun),document.removeEventListener(f.KeyUp,this.onKeyUpFun)},d.prototype.getCamData=function(a){var b=a.clone();b.invert();var c=new i;return c.x=-b.position.x,c.y=-b.position.y,c.z=-b.position.z,c},Object.defineProperty(d.prototype,"isCanToDo",{get:function(){return 1==AppData.sceneEidtType},enumerable:!0,configurable:!0}),d.prototype.onMouseMove=function(a){if(this.isCanToDo)if(this.moveScaleRotationLevel.onMouseMove(a),a.altKey)switch(a.buttons){case 4:if(this.baseCamData){var b=-(a.x-this.mouseInfo.last_mouse_x),d=-(a.y-this.mouseInfo.last_mouse_y),e=this.B.clone(),f=this.C.clone();f.invert(),e.appendRotation(b,c.Y_AXIS),e.append(this.C),e.appendRotation(d,c.X_AXIS),e.append(f),e.append(this.disMatrix3D);var g=this.getCamData(e);this.selectScene.cam3D.x=-g.x,this.selectScene.cam3D.y=-g.y,this.selectScene.cam3D.z=-g.z,this.selectScene.cam3D.rotationX=this.baseCamData.rotationX+d,this.selectScene.cam3D.rotationY=this.baseCamData.rotationY+b,h.MathCam(this.selectScene.cam3D)}}else switch(a.buttons){case 4:if(!this.cancalAltKey){var i=this.mouseHitInWorld3D(new Vector2D(a.x,a.y));this.selectScene.cam3D.x=this.mouseInfo.oldPosx+(this._middleMoveVe.x-i.x),this.selectScene.cam3D.y=this.mouseInfo.oldPosy+(this._middleMoveVe.y-i.y),this.selectScene.cam3D.z=this.mouseInfo.oldPosz+(this._middleMoveVe.z-i.z),h.MathCam(this.selectScene.cam3D)}break;case 2:this.selectScene.cam3D.rotationX=this.mouseInfo.old_rotation_x-(a.y-this.mouseInfo.last_mouse_y),this.selectScene.cam3D.rotationY=this.mouseInfo.old_rotation_y-(a.x-this.mouseInfo.last_mouse_x),h.MathCam(this.selectScene.cam3D)}},d.prototype.mouseHitInWorld3D=function(a){var b=this.selectScene.cam3D.cavanRect.width,d=this.selectScene.cam3D.cavanRect.height,e=new c;e.x=a.x-d/2,e.y=b/2-a.y,e.z=200;var f=new g;return f.appendRotation(-this.selectScene.cam3D.rotationX,c.X_AXIS),f.appendRotation(-this.selectScene.cam3D.rotationY,c.Y_AXIS),f.transformVector(e)},d.prototype.onMouseDown=function(a){if(this.isCanToDo)switch(this.moveScaleRotationLevel.onMouseDown(a),this.middleMovetType=1==a.button,this.mouseInfo.last_mouse_x=a.x,this.mouseInfo.last_mouse_y=a.y,this.mouseInfo.oldPosx=this.selectScene.cam3D.x,this.mouseInfo.oldPosy=this.selectScene.cam3D.y,this.mouseInfo.oldPosz=this.selectScene.cam3D.z,this.mouseInfo.old_rotation_x=this.selectScene.cam3D.rotationX,this.mouseInfo.old_rotation_y=this.selectScene.cam3D.rotationY,a.button){case 0:break;case 1:a.altKey?this.cancalAltKey=!0:this.cancalAltKey=!1,this._middleMoveVe=this.mouseHitInWorld3D(new Vector2D(a.x,a.y)),this.selectVec=new c(0,0,0),this.moveScaleRotationLevel.xyzMoveData&&(this.selectVec.x=this.moveScaleRotationLevel.xyzMoveData.x,this.selectVec.y=this.moveScaleRotationLevel.xyzMoveData.y,this.selectVec.z=this.moveScaleRotationLevel.xyzMoveData.z),this.baseCamData=this.getCamData(this.selectScene.cam3D.cameraMatrix),this.baseCamData.rotationX=this.selectScene.cam3D.rotationX,this.baseCamData.rotationY=this.selectScene.cam3D.rotationY,this.A.identity(),this.B.identity(),this.C.identity(),this.A=this.selectScene.cam3D.cameraMatrix.clone(),this.B.appendTranslation(-this.selectVec.x,-this.selectVec.y,-this.selectVec.z);var b=new j;b.fromMatrix(this.selectScene.cam3D.cameraMatrix),this.C=b.toMatrix3D(),this.disMatrix3D=this.A.clone();var d=this.B.clone();d.invert(),this.disMatrix3D.prepend(d)}},d.prototype.onMouseUp=function(a){this.isCanToDo&&this.moveScaleRotationLevel.onMouseUp(a)},d.prototype.onKeyDown=function(b){if(this.isCanToDo)switch(b.keyCode){case l.W:this.moveScaleRotationLevel._statceType=a.TooMathMoveUint.MOVE_XYZ;break;case l.E:this.moveScaleRotationLevel._statceType=a.TooMathMoveUint.MOVE_ROUTATION;break;case l.R:this.moveScaleRotationLevel._statceType=a.TooMathMoveUint.MOVE_SCALE;break;case l.Q:this.moveScaleRotationLevel.xyzMoveData=null}},d.prototype.onKeyUp=function(a){this.isCanToDo&&4==a.keyCode&&(this.cancalAltKey=!0)},d.prototype.onMouseWheel=function(a){if(this.isCanToDo&&a.x>AppData.centenPanel.x&&a.x<AppData.rightPanel.x){var b=win.LayerManager.getInstance().getObjectsUnderPoint(new Vector2D(a.x,a.y));if(!b){var c=this.getCamForntPos(.1*a.wheelDelta);this.selectScene.cam3D.x=c.x,this.selectScene.cam3D.y=c.y,this.selectScene.cam3D.z=c.z,h.MathCam(this.selectScene.cam3D)}}},d.prototype.getCamForntPos=function(a){var b=new c(0,0,a),d=new g;return d.appendRotation(-this.selectScene.cam3D.rotationX,c.X_AXIS),d.appendRotation(-this.selectScene.cam3D.rotationY,c.Y_AXIS),b=d.transformVector(b),b.x=this.selectScene.cam3D.x+b.x,b.y=this.selectScene.cam3D.y+b.y,b.z=this.selectScene.cam3D.z+b.z,b},d.prototype.listenModuleEvents=function(){return[new m(m.INIT_MOVE_SCALE_ROTATION),new m(m.INIT_UICONTAINER_TO_XYZ),new m(m.MAKE_DTAT_ITEM_TO_CHANGE),new m(m.CLEAR_XYZ_MOVE_DATA)]},d}(e);a.MoveScaleRotatioinProcessor=o}(xyz||(xyz={}));var ObjData=Pan3d.ObjData,Vector3D=Pan3d.Vector3D,Vector2D=Pan3d.Vector2D,TBNUtils=function(){function a(){}return a.processTBN=function(a,b){void 0===b&&(b=!1);for(var c=a.normals,d=a.vertices,e=a.uvs,f=a.indexs,g=a.vertices.length/3,h=new Array,i=new Array,j=new Array,k=new Array,l=0;g>l;l++)h.push(new Vector3D),i.push(0),j.push(new Vector3D),k.push(0);for(var m=new Array,n=b?4:3,o=0;o<c.length;o+=n){var p=new Vector3D(c[o],c[o+1],c[o+2]);m.push(p)}for(o=0;o<f.length;o+=3){var q=new Vector3D(d[3*f[o]],d[3*f[o]+1],d[3*f[o]+2]),r=new Vector3D(d[3*f[o+1]],d[3*f[o+1]+1],d[3*f[o+1]+2]),s=new Vector3D(d[3*f[o+2]],d[3*f[o+2]+1],d[3*f[o+2]+2]),t=new Vector2D(e[2*f[o]],e[2*f[o]+1]),u=new Vector2D(e[2*f[o+1]],e[2*f[o+1]+1]),v=new Vector2D(e[2*f[o+2]],e[2*f[o+2]+1]),w=r.subtract(q),x=s.subtract(q),y=u.subtract(t),z=v.subtract(t),A=1/(y.x*z.y-y.y*z.x),B=w.clone();B.scaleBy(z.y);var C=x.clone();C.scaleBy(y.y);var D=B.subtract(C);D.scaleBy(A),D.normalize(),B=w.clone(),B.scaleBy(z.x),C=x.clone(),C.scaleBy(y.x);var E=B.subtract(C);E.scaleBy(A),E.normalize(),h[f[o]]=h[f[o]].add(D),h[f[o+1]]=h[f[o+1]].add(D),h[f[o+2]]=h[f[o+2]].add(D),i[f[o]]+=1,i[f[o+1]]+=1,i[f[o+2]]+=1,j[f[o]]=j[f[o]].add(E),j[f[o+1]]=j[f[o+1]].add(E),j[f[o+2]]=j[f[o+1]].add(E),k[f[o]]+=1,k[f[o+1]]+=1,k[f[o+2]]+=1}for(o=0;g>o;o++)h[o].scaleBy(1/i[o]),j[o].scaleBy(1/k[o]);for(o=0;g>o;o++){p=m[o];var F=h[o],G=j[o],H=p.clone();H.scaleBy(H.dot(F)),F=F.subtract(H),F.normalize(),H=p.cross(F),H.dot(G)<0&&F.scaleBy(-1)}var I=new Array,J=new Array;for(o=0;g>o;o++)h[o].normalize(),j[o].normalize(),I.push(h[o].x),I.push(h[o].y),I.push(h[o].z),J.push(j[o].x),J.push(j[o].y),J.push(j[o].z),b&&(I.push(0),J.push(0));a.tangents=I,a.bitangents=J},a}(),__extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),left;!function(a){var b=md5list.Md5MoveSprite,c=md5list.Md5animAnalysis,d=md5list.Md5Analysis,e=md5list.MeshImportSort,f=md5list.MeshToObjUtils,g=function(a){function g(){var b=a.call(this)||this;return b.meshItem=new Array,b}return __extends(g,a),g.prototype.addLocalMeshByStr=function(a){this.md5MeshData=(new d).addMesh(a),(new e).processMesh(this.md5MeshData),this.md5objData=(new f).getObj(this.md5MeshData);var c=new b;c.md5MeshData=this.md5MeshData,c.md5objData=this.md5objData,this.meshItem.push(c)},g.prototype.addLocalAdimByStr=function(a){var b=(new c).addAnim(a);this.frameQuestArr=new Array;for(var d=0;d<b.length;d++){for(var e=b[d],f=0;f<e.length;f++)e[f].prepend(this.md5objData.invertAry[f]);this.frameQuestArr.push(this.makeDualQuatFloat32Array(b[d]))}},g.prototype.update=function(){if(this.md5objData&&this.frameQuestArr)for(var a=0;a<this.meshItem.length;a++)this.md5MeshData=this.meshItem[a].md5MeshData,this.md5objData=this.meshItem[a].md5objData,this.updateMaterialMeshCopy()},g.prototype.loadBodyMesh=function(){},g.prototype.loadAnimFrame=function(){},g}(b);a.LocalMd5MoveSprite=g}(left||(left={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),left;!function(a){var b=Pan3d.Display3DSprite,c=Pan3d.Scene_data,d=Pan3d.TexItem,e=Pan3d.ObjData,f=Pan3d.TimeUtil,g=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.setMaterialVc=function(a,b){void 0===b&&(b=null);var d=a;if(c.context3D.setBlendParticleFactors(d.blendMode),c.context3D.setDepthTest(d.zbuff),c.context3D.setWriteDepth(d.writeZbuffer),d.hasTime){var e=1e3*d.timeValue.x,g=(f.getTimer()-this.time)%e;g/=e,g*=d.timeValue.y,c.context3D.setuniform1f(a.shader,"time",g)}c.context3D.setuniform3f(a.shader,"cam3DPos",c.cam3D.x,c.cam3D.y,c.cam3D.z),a.update(g),b&&b.update(),c.context3D.setVc4fv(a.shader,"fc",a.fcData)},b.prototype.setMaterialTexture=function(a,b){void 0===b&&(b=null);for(var e=a.texList,f=0;f<e.length;f++)e[f].texture?e[f].type==d.CUBEMAP?c.context3D.setRenderTextureCube(a.shader.program,e[f].name,e[f].texture,e[f].id):c.context3D.setRenderTexture(a.shader,e[f].name,e[f].texture,e[f].id):console.log("还没加载好");if(b)for(f=0;f<b.dynamicTexList.length;f++)b.dynamicTexList[f].target&&b.dynamicTexList[f].texture&&c.context3D.setRenderTexture(a.shader,b.dynamicTexList[f].target.name,b.dynamicTexList[f].texture,b.dynamicTexList[f].target.id)},b.prototype.setMaterialVaIndependent=function(){c.context3D.setVa(0,3,this.objData.vertexBuffer),c.context3D.setVa(1,2,this.objData.uvBuffer);var a=2;this.material.useLightUv&&c.context3D.setVa(a++,2,this.objData.lightUvBuffer),this.material.useNormal&&(c.context3D.setVa(a++,3,this.objData.tangentBuffer),c.context3D.setVa(a++,3,this.objData.bitangentBuffer),c.context3D.setVa(a++,3,this.objData.normalsBuffer))},b.prototype.setBaseMaterialVc=function(a){var b=0;a.hasTime&&(b=(f.getTimer()-this.time)%1e5*.001),a.updateTime(b)},b.prototype.readTxtToModel=function(a){var b=JSON.parse(a),d=new e;d.vertices=b.vertices,d.normals=b.normals,d.uvs=b.uvs,d.lightuvs=b.lightuvs,d.indexs=b.indexs,d.treNum=d.indexs.length,TBNUtils.processTBN(d),d.vertexBuffer=c.context3D.uploadBuff3D(d.vertices),d.uvBuffer=c.context3D.uploadBuff3D(d.uvs),d.lightUvBuffer=c.context3D.uploadBuff3D(d.lightuvs),d.tangentBuffer=c.context3D.uploadBuff3D(d.tangents),d.bitangentBuffer=c.context3D.uploadBuff3D(d.bitangents),d.normalsBuffer=c.context3D.uploadBuff3D(d.normals),d.indexBuffer=c.context3D.uploadIndexBuff3D(d.indexs),this.objData=d},Object.defineProperty(b.prototype,"isTextureLoadFinish",{get:function(){if(this.material){if(this.material.texList){for(var a=0;a<this.material.texList.length;a++)if(!this.material.texList[a].texture)return!1;return!0}return!0}return!1},enumerable:!0,configurable:!0}),b.prototype.update=function(){if(this.isTextureLoadFinish&&this.sceneVisible){if(this.material){var b=this.material;b.shader=b.modelShader}a.prototype.update.call(this)}},b}(b);a.MaterialModelSprite=g}(left||(left={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),left;!function(a){var b=Pan3d.MaterialShader,c=function(a){function b(){var b=a.call(this)||this;return b.name="BuildMaterialShader",b}return __extends(b,a),b.prototype.buildParamAry=function(a){this.paramAry=[a.useUv,a.useNormal,a.useLightUv]},b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"v2CubeTexST");var b=(this.paramAry[0],this.paramAry[1]),c=this.paramAry[2],d=2;c&&a.bindAttribLocation(this.program,d++,"v2Lightuv"),b&&(a.bindAttribLocation(this.program,d++,"v3Tangent"),a.bindAttribLocation(this.program,d++,"v3Bitangent"),a.bindAttribLocation(this.program,d++,"v3Normal"))},b.prototype.getVertexShaderString=function(){var a=this.paramAry[0],b=this.paramAry[1],c=this.paramAry[2],d="attribute vec3 v3Position;\nattribute vec2 v2CubeTexST;\nvarying vec2 v0;\n";
return c&&(d+="attribute vec2 v2Lightuv;\n",d+="varying vec2 lightuv;\n"),a&&(d+="varying vec2 uvpos;\n"),b&&(d+="attribute vec3 v3Tangent;\nattribute vec3 v3Bitangent;\nattribute vec3 v3Normal;\nvarying vec3 T;\nvarying vec3 B;\nvarying vec3 N;\n"),d+="uniform mat4 vpMatrix3D;\nuniform mat4 posMatrix3D;\nuniform mat3 rotationMatrix3D;\n",d+="varying highp vec3 vPos;\n",d+="void main(void){\nv0 = vec2(v2CubeTexST.x, v2CubeTexST.y);\nvec4 vt0= vec4(v3Position, 1.0);\nvt0 = posMatrix3D * vt0;\n",a&&(d+="uvpos = v2CubeTexST;\n"),c&&(d+="lightuv = v2Lightuv;\n"),b&&(d+="T = v3Tangent;\nB = v3Bitangent;\nN = v3Normal;\n"),d+="vt0 = vpMatrix3D * vt0;\n",d+="gl_Position = vt0;\n",d+="vPos = v3Position;\n",d+="}"},b.BuildMaterialShader="BuildMaterialShader",b}(b);a.BuildMaterialShader=c}(left||(left={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),left;!function(a){var b=Pan3d.MaterialAnimShader,c=function(a){function c(){var b=a.call(this)||this;return b.name="RoleMaterialShader",b}return __extends(c,a),c.prototype.buildParamAry=function(a){this.paramAry=[a.usePbr,a.useNormal,a.hasFresnel,a.useDynamicIBL,a.lightProbe,a.directLight,a.noLight,a.fogMode]},c.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"pos"),a.bindAttribLocation(this.program,1,"v2Uv"),a.bindAttribLocation(this.program,2,"boneID"),a.bindAttribLocation(this.program,3,"boneWeight");var b=(this.paramAry[0],this.paramAry[1]);this.paramAry[4],this.paramAry[5];b&&(a.bindAttribLocation(this.program,4,"v3Tangent"),a.bindAttribLocation(this.program,5,"v3Bitangent"),a.bindAttribLocation(this.program,6,"v3Normal"))},c.getMd5M44Str=function(){var a="vec4 qdv(vec4 q,vec3 d, vec3 v ){\nvec3 t = 2.0 * cross(q.xyz, v);\nvec3 f = v + q.w * t + cross(q.xyz, t);\nreturn  vec4(f.x+d.x,f.y+d.y,f.z+d.z,1.0);\n }\nvec4 getQDdata(vec3 vdata){\nvec4 tempnum = qdv(boneQ[int(boneID.x)],boneD[int(boneID.x)],vdata) * boneWeight.x;\ntempnum += qdv(boneQ[int(boneID.y)],boneD[int(boneID.y)],vdata) * boneWeight.y;\ntempnum += qdv(boneQ[int(boneID.z)],boneD[int(boneID.z)],vdata)* boneWeight.z;\ntempnum += qdv(boneQ[int(boneID.w)],boneD[int(boneID.w)],vdata) * boneWeight.w;\ntempnum.x = tempnum.x*-1.0;\nreturn  tempnum;\n }\n";return a},c.getMd5M44NrmStr=function(){var a="vec4 qdvNrm(vec4 q, vec3 v ){\nvec3 t = 2.0 * cross(q.xyz, v);\nvec3 f = v + q.w * t + cross(q.xyz, t);\nreturn  vec4(f.x,f.y,f.z,1.0);\n }\nvec4 getQDdataNrm(vec3 vdata){\nvec4 tempnum = qdvNrm(boneQ[int(boneID.x)],vdata) * boneWeight.x;\ntempnum += qdvNrm(boneQ[int(boneID.y)],vdata) * boneWeight.y;\ntempnum += qdvNrm(boneQ[int(boneID.z)],vdata)* boneWeight.z;\ntempnum += qdvNrm(boneQ[int(boneID.w)],vdata) * boneWeight.w;\ntempnum.x = tempnum.x*-1.0;\ntempnum.xyz = normalize(tempnum.xyz);\nreturn  tempnum;\n }\n";return a},c.prototype.getVertexShaderString=function(){var a=this.paramAry[0],c=this.paramAry[1],d=(this.paramAry[2],this.paramAry[3],this.paramAry[4]),e=this.paramAry[5],f=this.paramAry[6],g="attribute vec3 pos;\nattribute vec2 v2Uv;\nattribute vec4 boneID;\nattribute vec4 boneWeight;\nvarying vec2 v0;\nuniform vec4 boneQ[54];\nuniform vec3 boneD[54];\nuniform mat4 vpMatrix3D;\nuniform mat4 posMatrix3D;\n";return g+="varying highp vec3 vPos;\n",f||(g+="varying vec2 v2;\n"),c&&(g+="attribute vec3 v3Tangent;\nattribute vec3 v3Bitangent;\nattribute vec3 v3Normal;\n",g+="varying vec3 T;\n",g+="varying vec3 B;\n",g+="varying vec3 N;\n"),g+=b.getMd5M44Str()+b.getMd5M44NrmStr()+"void main(void){\nv0 = v2Uv;\nvec4 vt0 = getQDdata(vec3(pos.x,pos.y,pos.z));\nvPos =vt0.xyz ;\nvt0.xyz = vt0.xyz*1.0;\nvt0 = posMatrix3D * vt0;\n",a&&(g+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),g+="vt0 = vpMatrix3D * vt0;\ngl_Position = vt0;\n",a?g+=c?"vec4 vt2 = getQDdataNrm(vec3(tangent.x,tangent.y,tangent.z));\nvt2 = rotationMatrix3D * vt2;\nvt2.xyz = normalize(vt2.xyz);\nvec4 vt1 = getQDdataNrm(vec3(bitangent.x,bitangent.y,bitangent.z));\nvt1 = rotationMatrix3D * vt1;\nvt1.xyz = normalize(vt1.xyz);\nvt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = mat3(vec3(vt2.x,vt2.y,vt2.z),vec3(vt1.x,vt1.y,vt1.z),vec3(vt0.x,vt0.y,vt0.z));\n":"vt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = vec3(vt0.x,vt0.y,vt0.z);\n":(d||e)&&(g+="vt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\n"),d?g+="vec3 lpb = sh[0] * 0.28209479177387814;\nlpb += sh[1] * (vt0.y * -0.4886025119029199);\nlpb += sh[2] * (vt0.z * 0.4886025119029199);\nlpb += sh[3] * (vt0.x * -0.4886025119029199);\nlpb += sh[4] * (vt0.x * vt0.y * 1.0925484305920792);\nlpb += sh[5] * (vt0.z * vt0.y * -1.0925484305920792);\nlpb += sh[6] * ((3.0 * vt0.z * vt0.z - 1.0) * 0.31539156525252005);\nlpb += sh[7] * (vt0.z * vt0.x * -1.0925484305920792);\nlpb += sh[8] * ((vt0.x * vt0.x - vt0.y * vt0.y) * 0.5462742152960396);\nv2 = lpb;\n":e?g+="float suncos = dot(vt0.xyz,sunDirect.xyz);\nsuncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;":f||(g+="v2 = v2Uv;\n"),c&&(g+="T =  getQDdataNrm(v3Tangent).xyz;\nB =  getQDdataNrm(v3Bitangent).xyz;\nN =  getQDdataNrm(v3Normal).xyz;\n"),g+="}"},c.prototype.getFragmentShaderString=function(){var a="uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return a},c.RoleMaterialShader="RoleMaterialShader",c}(b);a.RoleMaterialShader=c}(left||(left={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),left;!function(a){var b=Pan3d.Display3dMovie,c=Pan3d.MeshData,d=Pan3d.TexItem,e=Pan3d.AnimData,f=Pan3d.SkinMesh,g=Pan3d.BaseEvent,h=Pan3d.Scene_data,i=Pan3d.Dictionary,j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.update=function(){this.sceneVisible&&a.prototype.update.call(this)},Object.defineProperty(b.prototype,"skinMesh",{get:function(){return this._skinMesh},set:function(a){this._skinMesh=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"animDic",{get:function(){return this._animDic},set:function(a){this._animDic=a},enumerable:!0,configurable:!0}),b.prototype.updateFrame=function(a){this._actionTime+=a;var b;if(this.curentAction&&this._animDic[this.curentAction])b=this.curentAction;else{if(!this._animDic[this._defaultAction])return;b=this._defaultAction}for(var c,d=this._animDic[b],e=0;e<this._skinMesh.meshAry.length;e++)c=d.getBoneQPAryByMesh(this._skinMesh.meshAry[e])[0].length;this._curentFrame=float2int(this._actionTime/(2*h.frameTime)),this._curentFrame>=c&&(0==this._completeState?(this._actionTime=0,this._curentFrame=0):1==this._completeState?this._curentFrame=c-1:2==this._completeState?(this._curentFrame=0,this._completeState=0,this.changeAction(this.curentAction)):3==this._completeState)},b.prototype.setVcMatrix=function(b){h.context3D.setuniform3f(b.material.shader,"cam3DPos",h.cam3D.x,h.cam3D.y,h.cam3D.z),a.prototype.setVcMatrix.call(this,b)},b.prototype.updateMaterialMesh=function(b){if(b&&b.material){var c=b.material;c.shader=c.roleShader}a.prototype.updateMaterialMesh.call(this,b)},b.prototype.setMaterialTexture=function(a,b){void 0===b&&(b=null);for(var c=a.texList,e=0;e<c.length;e++)c[e].texture?c[e].type==d.CUBEMAP?h.context3D.setRenderTextureCube(a.shader.program,c[e].name,c[e].texture,c[e].id):h.context3D.setRenderTexture(a.shader,c[e].name,c[e].texture,c[e].id):console.log("还没加载好");if(b)for(e=0;e<b.dynamicTexList.length;e++)b.dynamicTexList[e].target&&b.dynamicTexList[e].texture&&h.context3D.setRenderTexture(a.shader,b.dynamicTexList[e].target.name,b.dynamicTexList[e].texture,b.dynamicTexList[e].target.id)},b.prototype.playSkill=function(a){var b=this._scene;this._walkPath=null,b.skillManager.playSkill(a),this.skillVo=a},b.prototype.setVaCompress=function(a){var b=h.context3D.pushVa(a.vertexBuffer);b||(h.context3D.setVaOffset(0,3,a.stride,0),h.context3D.setVaOffset(1,2,a.stride,a.uvsOffsets),h.context3D.setVaOffset(2,4,a.stride,a.boneIDOffsets),h.context3D.setVaOffset(3,4,a.stride,a.boneWeightOffsets),a.material.useNormal&&(h.context3D.setVaOffset(4,3,a.stride,a.tangentsOffsets),h.context3D.setVaOffset(5,3,a.stride,a.bitangentsOffsets),h.context3D.setVaOffset(6,3,a.stride,a.normalsOffsets)))},b.prototype.changeRoleWeb=function(a){var b=new f;b.meshAry=new Array;for(var d=0;1>d;d++){var g=new c;g.vertices=a.md5objData.vertices,g.uvs=a.md5objData.uvs,g.tangents=a.md5objData.vertices,g.bitangents=a.md5objData.vertices,g.normals=a.md5objData.vertices,g.boneIDAry=a.md5MeshData.boneIDAry,g.boneWeightAry=a.md5MeshData.boneWeightAry,g.indexs=a.md5objData.indexs,g.treNum=a.md5MeshData.treNum,g.uid=0,g.stride=64,g.uvsOffsets=12,g.tangentsOffsets=32,g.bitangentsOffsets=44,g.normalsOffsets=20,g.boneIDOffsets=20,g.boneWeightOffsets=36,pack.RoleChangeModel.getInstance().makeBufToRole(g),g.compressBuffer=!0,b.meshAry.push(g)}var h={},i=new e;i.meshBoneQPAryDic=this.getmeshBoneQPAryDic(a.frameQuestArr),h.stand=i,this.skinMesh=b,this.animDic=h},b.prototype.getmeshBoneQPAryDic=function(a){var b=new i([]),c=new Array;return c.push(a),b[0]=c,b},b.prototype.setRoleZwwUrl=function(a){var b=this;pack.PackRoleManager.getInstance().getRoleZzwByUrl(a,function(a){b.roleStaticMesh=a,b.skinMesh=b.roleStaticMesh.skinMesh,b.animDic=b.roleStaticMesh.animDic,b.material=b.roleStaticMesh.material,b.roleStaticMesh.addEventListener(g.COMPLETE,b.meshParamInfo,b),b.meshParamInfo()})},b.prototype.meshParamInfo=function(){for(var a=0;a<this.skinMesh.meshAry.length;a++)this.skinMesh.meshAry[a].material&&this.skinMesh.meshAry[a].paramInfo&&(this.skinMesh.meshAry[a].materialParam=new Pan3d.MaterialBaseParam,this.skinMesh.meshAry[a].materialParam.material=this.skinMesh.meshAry[a].material,pack.PackPrefabManager.getInstance().makeMaterialBaseParam(this.skinMesh.meshAry[a].materialParam,this.skinMesh.meshAry[a].paramInfo));this.play(this.roleStaticMesh.animPlayKey,0)},b}(b);a.MaterialRoleSprite=j}(left||(left={}));var left;!function(a){var b=Pan3d.Scene_data,c=Pan3d.FBO,d=Pan3d.MathClass,e=Pan3d.Engine,f=function(){function a(){this.fw=1024,this.fh=1024,this.viweLHnumber=1e3}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.getFBO=function(){this.fw=2048,this.fh=2048,this.renderContext=b.context3D.renderContext;var a=b.context3D.renderContext,d=new c;return d.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,d.texture),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.fw,this.fh,0,a.RGBA,a.UNSIGNED_BYTE,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),d.frameBuffer=a.createFramebuffer(),d.depthBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,d.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.fw,this.fh),d},a.prototype.updateDepthTexture=function(a){var c=b.context3D.renderContext;c.bindFramebuffer(c.FRAMEBUFFER,a.frameBuffer),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a.texture,0),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,a.depthBuffer)},a.prototype.resetViewMatrx3D=function(){b.viewMatrx3D.identity(),b.viewMatrx3D.perspectiveFieldOfViewLH(e.sceneCamScale,1,1,this.viweLHnumber)},a.prototype.renderToTexture=function(a){this.fbo||(this.fbo=this.getFBO()),this.updateDepthTexture(this.fbo),this.renderContext.viewport(0,0,this.fw,this.fh),this.renderContext.clearColor(20/255,20/255,20/255,1),this.renderContext.clearDepth(1),this.renderContext.clearStencil(0),this.renderContext.depthMask(!0),this.renderContext.frontFace(this.renderContext.CW),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT),this.resetViewMatrx3D(),d.getCamView(b.cam3D,b.focus3D);for(var c=0;c<a.length;c++)a[c].update();var f=b.context3D.renderContext;f.bindFramebuffer(f.FRAMEBUFFER,null),f.bindTexture(f.TEXTURE_2D,null),f.bindRenderbuffer(f.RENDERBUFFER,null),e.resetSize()},a}();a.SceneRenderToTextrue=f}(left||(left={}));var left;!function(a){var b=Pan3d.Scene_data,c=Pan3d.TimeUtil,d=Pan3d.MaterialShader,e=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.addBaseModel=function(){var d=this;b.cam3D.distance=150,this.modelSprite=new a.MaterialModelSprite,this.roleSprite=new a.MaterialRoleSprite,this.selectShowDisp=this.modelSprite,c.addFrameTick(function(a){d.update(a)}),this.makeMd5MoveSprite()},e.prototype.changeWebModel=function(){this.roleSprite.changeRoleWeb(this.webmd5Sprite)},e.prototype.makeMd5MoveSprite=function(){this.webmd5Sprite=new a.LocalMd5MoveSprite,this.webmd5Sprite.setMd5url("2/body.md5mesh","2/stand.md5anim","white.jpg")},e.prototype.update=function(c){this._bigPic&&this._bigPic.textureRes&&(this.selectShowDisp instanceof a.MaterialRoleSprite?(this.selectShowDisp.updateFrame(c),b.focus3D.y=20):b.focus3D.y=0,a.SceneRenderToTextrue.getInstance().renderToTexture([this.selectShowDisp,this.webmd5Sprite]),a.SceneRenderToTextrue.getInstance().fbo&&(this._bigPic.textureRes.texture=a.SceneRenderToTextrue.getInstance().fbo.texture))},e.prototype.readTxtToModelBy=function(c){this.modelSprite.readTxtToModel(c);for(var d=new Vector3D,e=0;e<this.modelSprite.objData.vertices.length/3;e++)d.x=Math.max(d.x,Math.abs(this.modelSprite.objData.vertices[3*e+0])),d.y=Math.max(d.y,Math.abs(this.modelSprite.objData.vertices[3*e+1])),d.z=Math.max(d.z,Math.abs(this.modelSprite.objData.vertices[3*e+2]));a.SceneRenderToTextrue.getInstance().viweLHnumber=4*Math.max(d.x,d.y,d.z),b.cam3D.distance=2*Math.max(d.x,d.y,d.z),this.selectShowDisp=this.modelSprite},e.prototype.changeRoleUrl=function(b){var c=new a.MaterialRoleSprite;c.setRoleUrl(b),this.selectShowDisp=c},e.prototype.makeRoleShader=function(b){var c=new a.RoleMaterialShader;c.buildParamAry(b),c.vertex=c.getVertexShaderString(),c.fragment=b.shaderStr,c.encode(),console.log("----------vertex------------"),console.log(c.vertex),console.log("----------fragment------------"),console.log(c.fragment),console.log("----------roleShader------------");var d=b.clone();d.roleShader=c,this.selectShowDisp.material=d},e.prototype.makeBuldShader=function(b){var c=new a.BuildMaterialShader;c.buildParamAry(b),b.shader.paramAry=c.paramAry,c.vertex=c.getVertexShaderString(),c.fragment=b.shaderStr,c.encode();var d=b.clone();d.modelShader=c,console.log("----------vertex------------"),console.log(c.vertex),console.log("----------fragment------------"),console.log(c.fragment),console.log("----------buildShader------------"),this.selectShowDisp.material=d},e.prototype.outShaderStr=function(b){this.selectShowDisp instanceof a.MaterialModelSprite&&this.makeBuldShader(b),this.selectShowDisp instanceof a.MaterialRoleSprite&&this.makeRoleShader(b)},e.prototype.getMaterialProgram=function(a,b,c,e,f){void 0===e&&(e=null),void 0===f&&(f=!1);var g=a+"_"+c.url;if(e){for(var h=0;h<e.length;h++)g+="_"+e[h];g+=f?"true_":"false_"}f&&(e=[c.usePbr,c.useNormal,c.hasFresnel,c.useDynamicIBL,c.lightProbe,c.directLight,c.noLight,c.fogMode]);var i=new d;i.paramAry=e,i.fragment=c.shaderStr;i.encode();return i.useNum++,i},e}();a.ModelShowModel=e}(left||(left={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),pack;!function(a){var b=Pan3d.RoleRes,c=Pan3d.SkinMesh,d=Pan3d.BaseRes,e=Pan3d.MeshData,f=Pan3d.AnimData,g=Pan3d.Dictionary,h=Pan3d.DualQuatFloat32Array,i=Pan3d.MeshDataManager,j=Pan3d.Scene_data,k=Pan3d.LoadManager,l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.readData=function(b,c,d,e){var f=a.prototype.readData.call(this,b,c,d,e);return f},b.prototype.readMesh2OneBuffer=function(a,b){for(var c=a.readInt(),e=new Array,f=0,g=0;5>g;g++){var h=a.readBoolean();e.push(h),h&&(f+=1==g?2:3)}f+=8,c*=4*f;var i,k=3,l=k+2,m=l+3,n=m+3;i=e[2]?e[4]?n+3:l+3:k+2;var o=i+4,p=new ArrayBuffer(c),q=new DataView(p);this.readBytes2ArrayBuffer(a,q,3,0,f),this.readBytes2ArrayBuffer(a,q,2,k,f),this.readBytes2ArrayBuffer(a,q,3,l,f),this.readBytes2ArrayBuffer(a,q,3,m,f),this.readBytes2ArrayBuffer(a,q,3,n,f),this.readBytes2ArrayBuffer(a,q,4,i,f,2),this.readBytes2ArrayBuffer(a,q,4,o,f,1),b.vertices=this.readChangeBuff(q,3,0,f),b.uvs=this.readChangeBuff(q,2,k,f),e[2]?b.normals=this.readChangeBuff(q,3,l,f):b.normals=b.vertices,e[3]?b.tangents=this.readChangeBuff(q,3,m,f):b.tangents=b.normals,e[4]?b.bitangents=this.readChangeBuff(q,3,n,f):b.bitangents=b.normals,b.boneIDAry=this.readChangeBuff(q,4,i,f),b.boneWeightAry=this.readChangeBuff(q,4,o,f),d.readIntForTwoByte(a,b.indexs),d.readIntForTwoByte(a,b.boneNewIDAry),b.compressBuffer=!0,b.uvsOffsets=4*k,b.normalsOffsets=4*l,b.tangentsOffsets=4*m,b.bitangentsOffsets=4*n,b.boneIDOffsets=4*i,b.boneWeightOffsets=4*o,b.stride=64,b.vertexBuffer=j.context3D.uploadBuff3DArrayBuffer(p),b.indexBuffer=j.context3D.uploadIndexBuff3D(b.indexs)},b.prototype.readChangeBuff=function(a,b,c,d){for(var e=new Array,f=a.byteLength/(4*d),g=0;f>g;g++)for(var h=d*g+c,i=0;b>i;i++){var j=4*(h+i),k=a.getFloat32(j,!0);a.setFloat32(j,k,!0),e.push(k)}return e},b.prototype.readBytes2ArrayBuffer=function(a,b,c,d,e,f){void 0===f&&(f=0);var g=a.readInt();if(!(0>=g)){var h;0==f&&(h=a.readFloat());for(var i=g/c,j=0;i>j;j++)for(var k=e*j+d,l=0;c>l;l++)0==f?b.setFloat32(4*(k+l),a.readFloatTwoByte(h),!0):1==f?b.setFloat32(4*(k+l),a.readFloatOneByte(),!0):2==f?b.setFloat32(4*(k+l),a.readByte(),!0):3==f?b.setFloat32(4*(k+l),(a.readByte()+128)/255,!0):4==f&&b.setFloat32(4*(k+l),a.readFloat(),!0)}},b}(i);a.MeshDataChangeManager=l;var m=function(a){function b(){var b=a.call(this)||this;return b.meshDataChangeManager=new l,b}return __extends(b,a),b.prototype.readNext=function(){this.read(),this.read()},b.prototype.readMesh=function(){this.roleUrl=this._byte.readUTF(),this.version>=16&&(this.ambientLightColor=new Vector3D,this.sunLigthColor=new Vector3D,this.nrmDircet=new Vector3D,this.ambientLightColor.x=this._byte.readFloat(),this.ambientLightColor.y=this._byte.readFloat(),this.ambientLightColor.z=this._byte.readFloat(),this.ambientLightIntensity=this._byte.readFloat(),this.ambientLightColor.scaleBy(this.ambientLightIntensity),this.sunLigthColor.x=this._byte.readFloat(),this.sunLigthColor.y=this._byte.readFloat(),this.sunLigthColor.z=this._byte.readFloat(),this.sunLigthIntensity=this._byte.readFloat(),this.sunLigthColor.scaleBy(this.sunLigthIntensity),this.nrmDircet.x=this._byte.readFloat(),this.nrmDircet.y=this._byte.readFloat(),this.nrmDircet.z=this._byte.readFloat()),this.meshDataChangeManager.readData(this._byte,this.meshBatchNum,this.roleUrl,this.version),this.readAction()},b}(b);a.RoleChangeRes=m;var n=function(){function b(){}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.changeRoleModel=function(a,b){this.materialRoleSprite=b,this.loadWebRole(a)},b.prototype.loadLocalFile=function(a,b){this.materialRoleSprite=b;var c=new m;c.loadComplete(a),this.makeMeshData(c),this.loatMaterialTree("base.material")},b.prototype.makeBufToRole=function(a){var b=a.vertices.length/3*a.stride,c=new ArrayBuffer(b),d=new DataView(c);this.pushToBuff(d,a.vertices,3,0,a.stride),this.pushToBuff(d,a.uvs,2,a.uvsOffsets,a.stride),this.pushToBuff(d,a.tangents,3,a.tangentsOffsets,a.stride),this.pushToBuff(d,a.bitangents,3,a.bitangentsOffsets,a.stride),this.pushToBuff(d,a.normals,3,a.normalsOffsets,a.stride),this.pushToBuff(d,a.boneIDAry,4,a.boneIDOffsets,a.stride),this.pushToBuff(d,a.boneWeightAry,4,a.boneWeightOffsets,a.stride),a.vertexBuffer=j.context3D.uploadBuff3DArrayBuffer(c),a.indexBuffer=j.context3D.uploadIndexBuff3D(a.indexs)},b.prototype.pushToBuff=function(a,b,c,d,e){for(var f=a.byteLength/e,g=0,h=0;f>h;h++)for(var i=h*e+d,j=0;c>j;j++){var k=b[g++];a.setFloat32(i+4*j,k,!0)}},b.prototype.makeMeshData=function(a){var b=a.meshDataChangeManager.getMeshDataByLocalUrl(a.roleUrl),c=a.roleUrl;b.setAction(a.actionAry,c),b.url=c,a.ambientLightColor&&(b.lightData=[[a.ambientLightColor.x,a.ambientLightColor.y,a.ambientLightColor.z],[a.nrmDircet.x,a.nrmDircet.y,a.nrmDircet.z],[a.sunLigthColor.x,a.sunLigthColor.y,a.sunLigthColor.z]]),b.ready=!0,this.meshAnimDic(b.animDic);for(var d=0;d<b.meshAry.length;d++){var f=new e;this.makeBufToRole(b.meshAry[d]),f.compressBuffer=!0,f.vertexBuffer=b.meshAry[d].vertexBuffer,f.indexBuffer=b.meshAry[d].indexBuffer,f.uid=b.meshAry[d].uid,f.stride=b.meshAry[d].stride,f.treNum=b.meshAry[d].treNum,f.uvsOffsets=b.meshAry[d].uvsOffsets,f.tangentsOffsets=b.meshAry[d].tangentsOffsets,f.bitangentsOffsets=b.meshAry[d].bitangentsOffsets,f.normalsOffsets=b.meshAry[d].normalsOffsets,f.boneIDOffsets=b.meshAry[d].boneIDOffsets,f.boneWeightOffsets=b.meshAry[d].boneWeightOffsets}this.materialRoleSprite.skinMesh=b},b.prototype.meshAnimDic=function(a){var b={};for(var c in a){var d=a[c],e=new f;e.meshBoneQPAryDic=d.meshBoneQPAryDic,b[c]=e}this.materialRoleSprite.animDic=b},b.prototype.getChangeRoleStr=function(){if(this.materialRoleSprite.skinMesh){var a={};a.meshAry=this.materialRoleSprite.skinMesh.meshAry,a.animDic=this.materialRoleSprite.animDic;for(var b=0;b<a.meshAry.length;b++)a.meshAry[b].materialUrl="assets/base/base.material";var c=JSON.stringify(a);return c}return null},b.prototype.getFloat32ArrayByArr=function(a){var b=new Array;for(var c in a)b.push(a[c]);for(var d=new Float32Array(b.length),e=0;e<b.length;e++)d[e]=b[e];return d},b.prototype.getmeshBoneQPAryDic=function(a){var b=new g([]);for(var c in a){for(var d=new Array,e=0;e<a[c].length;e++){for(var f=a[c][e],i=new Array,j=0;j<f.length;j++){var k=f[j],l=new h;l.quat=this.getFloat32ArrayByArr(k.quat),l.pos=this.getFloat32ArrayByArr(k.pos),i.push(l)}d.push(i)}b[c]=d}return b},b.prototype.loatMaterialTree=function(b){var c=this;a.PackMaterialManager.getInstance().getMaterialByUrl(b,function(a){a.shader=a.roleShader,c.materialRoleSprite.material=a})},b.prototype.loadWebRole=function(a){var b=this;k.getInstance().load(j.fileRoot+a,k.XML_TYPE,function(a){var d=JSON.parse(a);console.log(d);var g=new c;g.meshAry=new Array;for(var h=0;h<d.meshAry.length;h++){var i=new e;i.vertices=d.meshAry[h].vertices,i.uvs=d.meshAry[h].uvs,i.tangents=d.meshAry[h].tangents,i.bitangents=d.meshAry[h].bitangents,i.boneIDAry=d.meshAry[h].boneIDAry,i.boneWeightAry=d.meshAry[h].boneWeightAry,i.normals=d.meshAry[h].normals,i.indexs=d.meshAry[h].indexs,i.stride=d.meshAry[h].stride,i.uid=d.meshAry[h].uid,i.treNum=d.meshAry[h]._treNum,i.uvsOffsets=d.meshAry[h].uvsOffsets,i.tangentsOffsets=d.meshAry[h].tangentsOffsets,i.bitangentsOffsets=d.meshAry[h].bitangentsOffsets,i.normalsOffsets=d.meshAry[h].normalsOffsets,i.boneIDOffsets=d.meshAry[h].boneIDOffsets,i.boneWeightOffsets=d.meshAry[h].boneWeightOffsets,b.makeBufToRole(i),i.compressBuffer=!0,g.meshAry.push(i)}var j={};for(var k in d.animDic){var l=new f;l.meshBoneQPAryDic=b.getmeshBoneQPAryDic(d.animDic[k].meshBoneQPAryDic),j[k]=l}b.materialRoleSprite.skinMesh=g,b.materialRoleSprite.animDic=j,b.loatMaterialTree(d.textureurl)})},b}();a.RoleChangeModel=n}(pack||(pack={}));var editscene;!function(a){var b=Pan3d.UIManager,c=Pan3d.MouseType,d=function(){function a(){var a=this;this.onMouseDownFun=function(b){a.onMouseDown(b)},this.changFun=function(b){a.changeInputTxt(b)}}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},Object.defineProperty(a.prototype,"chatHtmlInput",{get:function(){return this._chatHtmlInput},set:function(a){console.log("value",a),this._chatHtmlInput=a},enumerable:!0,configurable:!0}),a.prototype.setInputTxtPos=function(){this.chatHtmlInput||(this.chatHtmlInput=document.createElement("input"),this.chatHtmlInput.style.position="absolute",this.chatHtmlInput.style["z-index"]=100,document.body.appendChild(this.chatHtmlInput),document.addEventListener(c.MouseDown,this.onMouseDownFun))},a.prototype.changeInputTxt=function(a){this.chatHtmlInput&&(this.changeBfun(this.chatHtmlInput.value),win.LayerManager.isHideMouseEvent=!1,document.removeEventListener(c.MouseDown,this.onMouseDownFun),this.chatHtmlInput.parentElement&&document.body.removeChild(this.chatHtmlInput),this.chatHtmlInput=null)},a.prototype.getTextMetrics=function(a,c){void 0===c&&(c=12);var d=b.getInstance().getContext2D(100,100,!1);return d.font=c+"px serif",d.measureText(a)},a.prototype.changeName=function(a,b,c){var d=this;this.changeBfun=c,this.setInputTxtPos(),win.LayerManager.isHideMouseEvent=!0,this.chatHtmlInput.style.left=a.x+"px",this.chatHtmlInput.style.top=a.y+"px",this.chatHtmlInput.style.fontSize=String(12)+"px",this.chatHtmlInput.style.width=String(a.width)+"px",this.chatHtmlInput.style.height=String(a.height)+"px",this.chatHtmlInput.value=b,setTimeout(function(){d.chatHtmlInput.focus()},1)},a.prototype.onMouseDown=function(a){a.target!=this.chatHtmlInput?this.changeInputTxt(null):console.log("还在")},a}();a.ChangeNameModel=d}(editscene||(editscene={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),editscene;!function(a){var b=Pan3d.UIRenderComponent,c=Pan3d.InteractiveEvent,d=Pan3d.TextAlign,e=Pan3d.ModuleEventManager,f=Pan3d.UIManager,g=Pan3d.LabelTextFont,h=Pan3d.Disp2DBaseText,i=Pan3d.TextureManager,j=Pan3d.Rectangle,k=Pan3d.UIAtlas,l=Pan3d.Pan3dByteArray,m=Pan3d.LoadManager,n=Pan3d.Scene_data,o=Pan3d.Dis2DUIContianerPanel,p=function(){function a(a,b){void 0===b&&(b=null),this.select=!1,this.label=a,this.key=b}return a}();a.MenuListData=p;var q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.uiScale=.5,b}return __extends(b,a),b.prototype.makeData=function(){if(this.rightTabInfoVo){this.ui.width=this.ui.baseRec.width*this.uiScale,this.ui.height=this.ui.baseRec.height*this.uiScale;var a=this.rightTabInfoVo,b=this.parent.uiAtlas.getRec(this.textureStr);this.parent.uiAtlas.ctx=f.getInstance().getContext2D(b.pixelWitdh,b.pixelHeight,!1),this.parent.uiAtlas.ctx.clearRect(0,1,b.pixelWitdh,b.pixelHeight);var c=a.select?"#6c6c6c":"#535353",e=a.select?"[ffffff]":"[9c9c9c]";switch(a.level){case 0:c=a.select?"#6c6c6c":"#535353",e=a.select?"[ffffff]":"[9c9c9c]";break;case 1:c=a.select?"#353535":"#535353",e=a.select?"[ffffff]":"[9c9c9c]";break;default:c=a.select?"#6c6c6c":"#535353",e=a.select?"[ffffff]":"[9c9c9c]"}this.parent.uiAtlas.ctx.fillStyle=c,this.parent.uiAtlas.ctx.fillRect(0,0,b.pixelWitdh,b.pixelHeight),g.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,e+a.label,24,0,10,d.CENTER),i.getInstance().updateTexture(this.parent.uiAtlas.texture,b.pixelX,b.pixelY,this.parent.uiAtlas.ctx)}},b}(h);a.LabelTxtVo=q;var r=function(a){function d(){var c=a.call(this,q,new j(0,0,140,48),50)||this;return c._bottomRender=new b,c._bottomRender.uiAtlas=new k,c._bottomRender.uiAtlas.setInfo("ui/window/window.txt","ui/window/window.png",function(){c.loadConfigCom()}),c.addRenderAt(c._bottomRender,0),AppData.topPanel.addUIContainer(c),c}return __extends(d,a),d.getInstance=function(){return this._instance||(this._instance=new d),this._instance},d.prototype.loadConfigCom=function(){this.winBg=this.addChild(this._bottomRender.getComponent("e_topmenu_bg")),this.uiLoadComplete=!0,this.resize()},d.prototype.resize=function(){a.prototype.resize.call(this),this.uiLoadComplete&&(this.winBg.x=0,this.winBg.y=0,this.winBg.width=n.stageWidth,this.winBg.height=29)},d.prototype.initMenuData=function(a){function b(a,c){for(var d=0;a&&d<a.length;d++)a[d].level=c,b(a[d].subMenu,c+1)}this.clearAll(),this.menuXmlItem=a.menuXmlItem,b(this.menuXmlItem,0)},d.prototype.getMenu0=function(){var a=new p("菜单","1");return a.subMenu=new Array,a.subMenu.push(new p("保存场景","11")),a.subMenu.push(new p("清理场景","12")),a},d.prototype.getMenu1=function(){var a=new p("窗口","2");return a.subMenu=new Array,a.subMenu.push(new p("场景属性","21")),a.subMenu.push(new p("测试导入场景","22")),a.subMenu.push(new p("文件列表","23")),a},d.prototype.getMenu2=function(){var a=new p("导入","3");return a.subMenu=new Array,a.subMenu.push(new p("导入场景","31")),a.subMenu.push(new p("导入模型","32")),a.subMenu.push(new p("导入特效","33")),a.subMenu.push(new p("临时修改","34")),a},d.prototype.makeSceneTopMenu=function(){var a=this,b={},c=new Array;c.push(this.getMenu0()),c.push(this.getMenu1()),c.push(this.getMenu2()),c.push(new p("系统","3")),b.menuXmlItem=c,this.bfun=function(b,c){a.menuBfun(b,c)},this.initMenuData(b),this.showMainUi()},d.prototype.makeTextureTopMenu=function(){var a=this,b={},c=new Array;c.push(new p("保存材质","1001")),c.push(new p("编译材质","1002")),c.push(new p("关闭材质窗口","1003")),c.push(new p("返回场景","1004")),b.menuXmlItem=c,this.bfun=function(b,c){a.menuBfun(b,c)},this.initMenuData(b),this.showMainUi()},d.prototype.menuBfun=function(a,b){var c=this;switch(console.log(a.key),a.key){case"11":e.dispatchEvent(new maineditor.MainEditorEvent(maineditor.MainEditorEvent.SAVE_SCENE_MAP_TO_SEVER));break;case"12":e.dispatchEvent(new maineditor.MainEditorEvent(maineditor.MainEditorEvent.CLEAR_SCENE_MAP_ALL));break;case"21":e.dispatchEvent(new maineditor.MainEditorEvent(maineditor.MainEditorEvent.SHOW_SCENE_POJECT_MESH_VIEW));break;case"22":break;case"23":break;case"31":pack.FileOssModel.upTempFileToOss(function(a){var b=AppData.mapOpenUrl.lastIndexOf(".");if(-1!=b){var c=AppData.mapOpenUrl.substring(0,b)+"/";inputres.ImputGameResModel.getInstance().inputSceneFile(a,c)}});break;case"32":pack.FileOssModel.upTempFileToOss(function(a){c.inputH5roleRes(a)});break;case"34":break;case"1001":e.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.SAVE_MATERIA_PANEL));break;case"1002":e.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL));break;case"1003":break;case"1004":e.dispatchEvent(new maineditor.MainEditorEvent(maineditor.MainEditorEvent.SHOW_MAIN_EDITOR_PANEL))}},d.prototype.isRoleFile=function(a){var b=new l(a);b.position=0;var c=(b.readInt(),b.readUTF());return-1!=c.indexOf("role/")?!0:!1},d.prototype.inputH5roleRes=function(a){var b=this,c=new FileReader;c.readAsArrayBuffer(a),c.onload=function(d){if(b.isRoleFile(c.result)){var e=new left.MaterialRoleSprite;maineditor.MainEditorProcessor.edItorSceneManager.addMovieDisplay(e),pack.RoleChangeModel.getInstance().loadLocalFile(c.result,e);var f=pack.RoleChangeModel.getInstance().getChangeRoleStr();if(f){var g=new File([f],"ossfile.txt");console.log(a.name);var h=AppData.getPerentPath(AppData.rootFilePath);console.log(h);var i=h+a.name.replace(".txt",".zzw");pack.FileOssModel.upOssFile(g,i,function(){console.log("上传成功",i)})}else console.log("没有可上传mesh数据")}else alert("不确定类型,需要角色文件role/")}},d.prototype.changeZZW=function(){var a="pefab/role_base.zzw";m.getInstance().load(n.fileRoot+a,m.XML_TYPE,function(b){
var c=JSON.parse(b);c.textureurl="base.material";var d=new File([JSON.stringify(c)],"ossfile.txt"),e=Pan3d.Scene_data.fileRoot+a,f=e.replace(Pan3d.Scene_data.ossRoot,"");pack.FileOssModel.upOssFile(d,f,function(){console.log("上传成功")})})},d.prototype.showMainUi=function(){this.clearAll(),Pan3d.Scene_data.uiBlankStage.addEventListener(c.Up,this.onStageMouseUp,this),this.showSon(this.menuXmlItem,20,0)},d.prototype.onStageMouseUp=function(a){this.removeOtherSonMenu(0)},d.prototype.showTempMenu=function(b,d,e,f){var g=a.prototype.showTemp.call(this,b);return 0==b.level?(g.ui.x=80*d,g.ui.y=3):(g.ui.x=e,g.ui.y=20*d+f+0),g.ui.addEventListener(c.Move,this.butMove,this),g.ui.addEventListener(c.Down,this.onMouseUp,this),g},d.prototype.clearTemp=function(b){var d=this.getVoByData(b);d.ui.removeEventListener(c.Move,this.butMove,this),d.ui.removeEventListener(c.Down,this.onMouseUp,this),a.prototype.clearTemp.call(this,b)},d.prototype.setColorByLevel=function(a){for(var b=0;b<this._uiItem.length;b++){var c=this._uiItem[b].rightTabInfoVo;c&&c.level==a&&(c.select=!1,this._uiItem[b].makeData())}},d.prototype.removeOtherSonMenu=function(a){for(var b=this._uiItem.length-1;b>=0;b--){var c=this._uiItem[b].rightTabInfoVo;c&&c.level>a&&this.clearTemp(c)}},d.prototype.butMove=function(a){var b=this.getVoByUi(a.target);if(b&&b.rightTabInfoVo){var c=b.rightTabInfoVo;this.setColorByLevel(c.level),this.removeOtherSonMenu(c.level),c.select=!0,b.makeData(),this.showSon(c.subMenu,b.ui.x,b.ui.y+b.ui.height)}},d.prototype.onMouseUp=function(a){var b=this.getVoByUi(a.target);b&&b.rightTabInfoVo&&(this.bfun(b.rightTabInfoVo,a),this.removeOtherSonMenu(0))},d.prototype.showSon=function(a,b,c){for(var d=0;a&&d<a.length;d++){var e=this.getVoByData(a[d]);e||this.showTempMenu(a[d],d,b,c)}},d}(o);a.EditTopMenuPanel=r}(editscene||(editscene={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),editscene;!function(a){var b=Pan3d.Rectangle,c=win.Sprite,d=Pan3d.InteractiveEvent,e=Pan3d.Vector2D,f=Pan3d.Scene_data,g=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;return a.hideItemDic={},a._leftSpeed=1,a._rightSpeed=1,a._bottomSpeed=1,a.leftWidthNum=300,a.rightWidthNum=300,a.bottomHeightNum=300,a.menuHeight=28,a}return __extends(g,c),g.prototype.loadConfigCom=function(){c.prototype.loadConfigCom.call(this),this.leftLine=this._baseTopRender.getComponent("a_empty"),this.rightLine=this._baseTopRender.getComponent("a_empty"),this.bottomLine=this._baseTopRender.getComponent("a_empty"),this.setUiListVisibleByItem([this.leftLine],!0),this.setUiListVisibleByItem([this.rightLine],!0),this.setUiListVisibleByItem([this.bottomLine],!0),this.leftLineMin=this._baseTopRender.getComponent("b_line_pixe_point"),this.rightLineMin=this._baseTopRender.getComponent("b_line_pixe_point"),this.bottomLineMin=this._baseTopRender.getComponent("b_line_pixe_point"),this.closeLeftBut=this.addEvntButUp("a_scroll_bar",this._baseTopRender),this.closeRightBut=this.addEvntButUp("a_scroll_bar",this._baseTopRender),this.closeBottomBut=this.addEvntButUp("a_scroll_bar",this._baseTopRender),this.closeLeftBut.width=10,this.closeLeftBut.height=60,this.closeRightBut.width=10,this.closeRightBut.height=60,this.closeBottomBut.width=60,this.closeBottomBut.height=10,this.setUiListVisibleByItem([this.leftLineMin],!0),this.setUiListVisibleByItem([this.rightLineMin],!0),this.setUiListVisibleByItem([this.bottomLineMin],!0),this.leftLine.addEventListener(d.Down,this.tittleMouseDown,this),this.rightLine.addEventListener(d.Down,this.tittleMouseDown,this),this.bottomLine.addEventListener(d.Down,this.tittleMouseDown,this),this.setRect(new b(0,0,f.stageWidth,f.stageHeight)),this.resize()},g.prototype.butClik=function(a){switch(a.target){case this.closeLeftBut:this.hideItemDic.left=!this.hideItemDic.left,this.leftSpeed=0,TweenLite.to(this,.2,{leftSpeed:1});break;case this.closeRightBut:this.hideItemDic.right=!this.hideItemDic.right,this.rightSpeed=0,TweenLite.to(this,.2,{rightSpeed:1});break;case this.closeBottomBut:this.hideItemDic.bottom=!this.hideItemDic.bottom,this.bottomSpeed=0,TweenLite.to(this,.2,{bottomSpeed:1})}},Object.defineProperty(g.prototype,"leftSpeed",{get:function(){return this._leftSpeed},set:function(a){this._leftSpeed=a,this.resize()},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"rightSpeed",{get:function(){return this._rightSpeed},set:function(a){this._rightSpeed=a,this.resize()},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"bottomSpeed",{get:function(){return this._bottomSpeed},set:function(a){this._bottomSpeed=a,this.resize()},enumerable:!0,configurable:!0}),g.prototype.resize=function(){if(c.prototype.resize.call(this),this.bottomLine){var d=this.leftWidthNum,e=this.rightWidthNum,g=this.bottomHeightNum;d=this.hideItemDic.left?(1-this._leftSpeed)*this.leftWidthNum:this._leftSpeed*this.leftWidthNum,e=this.hideItemDic.right?(1-this._rightSpeed)*this.rightWidthNum:this._rightSpeed*this.rightWidthNum,this.hideItemDic.bottom?(g=20,g=(1-this._bottomSpeed)*this.bottomHeightNum+20):g=this._bottomSpeed*this.bottomHeightNum,this.leftLine.x=d-5,this.leftLine.y=0,this.leftLine.width=10,this.leftLine.height=f.stageHeight-g,this.closeLeftBut.x=this.leftLine.x+5,this.closeLeftBut.y=this.leftLine.height/2-this.closeLeftBut.height,this.rightLine.x=f.stageWidth-e-5,this.rightLine.y=0,this.rightLine.width=10,this.rightLine.height=f.stageHeight,this.closeRightBut.x=this.rightLine.x-5,this.closeRightBut.y=this.closeLeftBut.y,this.bottomLine.x=0,this.bottomLine.y=f.stageHeight-g-5,this.bottomLine.width=f.stageWidth-e,this.bottomLine.height=10,this.closeBottomBut.x=d+(this.bottomLine.width-d)/2-this.closeBottomBut.width,this.closeBottomBut.y=this.bottomLine.y-5,this.leftLineMin.x=this.leftLine.x+5,this.leftLineMin.y=this.leftLine.y,this.leftLineMin.width=2,this.leftLineMin.height=this.leftLine.height,this.rightLineMin.x=this.rightLine.x+5,this.rightLineMin.y=this.rightLine.y,this.rightLineMin.width=2,this.rightLineMin.height=this.rightLine.height,this.bottomLineMin.x=this.bottomLine.x,this.bottomLineMin.y=this.bottomLine.y+5,this.bottomLineMin.width=this.bottomLine.width,this.bottomLineMin.height=2,a.EditLeftPanel.leftPanel.y=this.menuHeight,AppData.centenPanel.y=this.menuHeight,AppData.rightPanel.y=this.menuHeight,this.hideItemDic.left?a.EditLeftPanel.leftPanel.x=-this.leftWidthNum*this._leftSpeed:a.EditLeftPanel.leftPanel.x=this.leftWidthNum*(this._leftSpeed-1),a.EditLeftPanel.leftPanel.height=f.stageHeight-g-this.menuHeight,a.EditLeftPanel.leftPanel.width=this.leftWidthNum,a.EditLeftPanel.leftPanel.resize(),AppData.rightPanel.x=f.stageWidth-e,AppData.rightPanel.height=f.stageHeight-this.menuHeight,AppData.rightPanel.width=e,AppData.rightPanel.resize(),AppData.centenPanel.x=d,AppData.centenPanel.height=f.stageHeight-g-this.menuHeight,AppData.centenPanel.width=f.stageWidth-d-e,AppData.centenPanel.width=f.stageWidth-d-e,AppData.centenPanel.resize();var h=new b(0,f.stageHeight-g+2,f.stageWidth-e,g);Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.EDITSCENE_RESET_SIZE),h),Pan3d.ModuleEventManager.dispatchEvent(new a.EditSceneEvent(a.EditSceneEvent.EDITE_SCENE_RESIZE),h),prop.PropModel.getInstance().resize()}},g.prototype.tittleMouseDown=function(a){switch(this.mouseMoveTaget=a.target,this.lastMousePos=new e(a.x,a.y),this.mouseMoveTaget){case this.leftLine:case this.rightLine:case this.bottomLine:this.lastPagePos=new e(a.target.x,a.target.y),this.lastLaoutVec=new Vector3D(this.leftWidthNum,this.rightWidthNum,this.bottomHeightNum)}f.uiStage.addEventListener(d.Move,this.mouseOnTittleMove,this),f.uiStage.addEventListener(d.Up,this.tittleMouseUp,this)},g.prototype.mouseOnTittleMove=function(a){switch(this.mouseMoveTaget){case this.leftLine:this.leftWidthNum=this.lastLaoutVec.x+(a.x-this.lastMousePos.x),this.leftWidthNum=Math.min(f.stageWidth-this.rightWidthNum-100,this.leftWidthNum),this.leftWidthNum=Math.max(300,this.leftWidthNum);break;case this.rightLine:this.rightWidthNum=this.lastLaoutVec.y-(a.x-this.lastMousePos.x),this.rightWidthNum=Math.min(f.stageWidth-this.leftWidthNum-100,this.rightWidthNum),this.rightWidthNum=Math.max(100,this.rightWidthNum);break;case this.bottomLine:this.bottomHeightNum=this.lastLaoutVec.z-(a.y-this.lastMousePos.y),this.bottomHeightNum=Math.min(f.stageHeight-100,this.bottomHeightNum),this.bottomHeightNum=Math.max(100,this.bottomHeightNum);break;default:console.log("nonono")}this.resize()},g}(win.BaseWindow);a.TempSceneLine=g;var h=function(a){function b(b){void 0===b&&(b=!0);var c=a.call(this)||this;return c.winBg=new g,c.addUIContainer(c.winBg),c.changeSize(),c}return __extends(b,a),b}(c);a.EditSceneLine=h}(editscene||(editscene={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),editscene;!function(a){var b=win.Panel,c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.addUIContainer=function(b){b.only&&this.removeNeedRemove(),a.prototype.addUIContainer.call(this,b),b.propPanle&&this.addChild(b.propPanle)},b.prototype.removeNeedRemove=function(){for(var a=this._containerList.length-1;a>=0;a--)this._containerList[a].only&&this.removeUIContainer(this._containerList[a])},b.prototype.removeUIContainer=function(b){b.propPanle&&this.removeChild(b.propPanle),a.prototype.removeUIContainer.call(this,b)},b.prototype.resize=function(){a.prototype.resize.call(this);for(var b=0;b<this.children.length;b++)this.children[b].resize()},b}(b);a.EditLeftPanel=c}(editscene||(editscene={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),editscene;!function(a){var b=win.Panel,c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.addUIContainer=function(b){for(;this._containerList.length;)this.removeUIContainer(this._containerList[0]);b&&a.prototype.addUIContainer.call(this,b)},b}(b);a.CentenPanel=c;var d=function(d){function e(){var a=d.call(this)||this;return a.addCenten(),a.addRight(),a.addLeft(),a.addSceneLaoutLinePane(),a.addTop(),a.resize(),a}return __extends(e,d),e.prototype.addSceneLaoutLinePane=function(){this._sceneLaoutLinePane=new a.EditSceneLine,this._sceneLaoutLinePane.x=0,this._sceneLaoutLinePane.y=0,this.addChild(this._sceneLaoutLinePane)},e.prototype.addCenten=function(){var a=new c;a.x=600,a.y=0,a.width=450,a.height=10,this.addChild(a),AppData.centenPanel=a},e.prototype.addRight=function(){var b=new a.MainRightPanel(!0);b.x=1e3,b.y=0,b.width=450,b.height=500,this.addChild(b),AppData.rightPanel=b},e.prototype.addTop=function(){var a=new b;a.x=0,a.y=0,a.width=450,a.height=30,this.addChild(a),AppData.topPanel=a},e.prototype.addLeft=function(){var b=new a.EditLeftPanel;b.x=0,b.y=50,b.width=450,b.height=500,this.addChild(b),a.EditLeftPanel.leftPanel=b},e}(b);a.EditScenePanel=d}(editscene||(editscene={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),editscene;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Module,d=Pan3d.BaseProcessor,e=Pan3d.ModuleEventManager,f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.SHOW_EDITSCENE_PANEL="SHOW_EDITSCENE_PANEL",b.EDITE_SCENE_RESIZE="EDITE_SCENE_RESIZE",b.SHOW_HIDE_EDIT_TEMP_PANEL="SHOW_HIDE_EDIT_TEMP_PANEL",b.EDITE_SCENE_UI_LOAD_COMPLETE="EDITE_SCENE_UI_LOAD_COMPLETE",b}(b);a.EditSceneEvent=f;var g=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"EditSceneModule"},b.prototype.listProcessors=function(){return[new h]},b}(c);a.EditSceneModule=g;var h=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getName=function(){return"EditSceneProcessor"},c.prototype.receivedModuleEvent=function(b){if(b instanceof f){var c=b;c.type==f.SHOW_EDITSCENE_PANEL&&(this._editScenePanel=new a.EditScenePanel,this._editScenePanel.x=300,this._editScenePanel.y=300,this._editScenePanel.width=450,this._editScenePanel.height=500,win.LayerManager.getInstance().addPanel(this._editScenePanel,100)),c.type==f.EDITE_SCENE_UI_LOAD_COMPLETE&&this.initSceneData()}},c.prototype.initSceneData=function(){var a="scene.map";localStorage.getItem("mapurl")&&(a=localStorage.getItem("mapurl")),getUrlParam("mapurl")&&(a=getUrlParam("mapurl"),console.log(a)),e.dispatchEvent(new maineditor.MainEditorEvent(maineditor.MainEditorEvent.LOAD_SCENE_MAP),a)},c.prototype.listenModuleEvents=function(){return[new f(f.SHOW_EDITSCENE_PANEL),new f(f.SHOW_HIDE_EDIT_TEMP_PANEL),new f(f.EDITE_SCENE_UI_LOAD_COMPLETE)]},c}(d);a.EditSceneProcessor=h}(editscene||(editscene={}));var drag;!function(a){var b=function(){function a(){}return a}();a.DragSource=b}(drag||(drag={}));var drag;!function(a){var b=function(){function a(){}return a.prototype.doDrag=function(a,b,c){console.log(a,b,c)},a}();a.TempDrawManager=b;var c=function(){function b(){}return b.doDragdoDrag=function(b,c){this.dragSource=c,Pan3d.ModuleEventManager.dispatchEvent(new a.PanDragEvent(a.PanDragEvent.DRAG_SHOW))},b.NONE="none",b.COPY="copy",b.MOVE="move",b.LINK="link",b}();a.DragManager=c}(drag||(drag={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),drag;!function(a){var b=Pan3d.UIRenderComponent,c=Pan3d.UIManager,d=Pan3d.UIConatiner,e=Pan3d.UIAtlas,f=Pan3d.TextureManager,g=function(a){function d(d,g){var h=a.call(this)||this;h.tempUiName="tempui",h._bRender=new b,h.addRender(h._bRender),h._bRender.uiAtlas=new e;var i=h._bRender.uiAtlas;return i.configData=[],i.configData.push(i.getObject(h.tempUiName,0,0,d,g,d,g)),h.ui=h._bRender.creatBaseComponent(h.tempUiName),h.ui.width=d,h.ui.height=g,h.addChild(h.ui),h._bRender.uiAtlas.ctx=c.getInstance().getContext2D(d,g,!1),h._bRender.uiAtlas.textureRes=f.getInstance().getCanvasTexture(h._bRender.uiAtlas.ctx),h}return __extends(d,a),d.prototype.setData=function(a){a.icon&&this.ui.uiRender.uiAtlas.upDataPicToTexture(a.icon,this.ui.skinName)},d}(d);a.DragPanel=g}(drag||(drag={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),drag;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Module,d=Pan3d.BaseProcessor,e=Pan3d.Vector2D,f=Pan3d.InteractiveEvent,g=Pan3d.Scene_data,h=win.Panel,i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.DRAG_SHOW="DRAG_SHOW",b.DRAG_ENTER="DRAG_ENTER",b.DRAG_DROP="DRAG_DROP",b}(b);a.PanDragEvent=i;var j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"DragModule"},b.prototype.listProcessors=function(){return[new k]},b}(c);a.DragModule=j;var k=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getName=function(){return"DragProcessor"},c.prototype.receivedModuleEvent=function(b){b instanceof i&&b.type==i.DRAG_SHOW&&(this._dragPanel||(this._dragPanel=new a.DragPanel(64,64)),this.addUIContainer(this._dragPanel),this._dragPanel.setData(a.DragManager.dragSource),console.log("开始"))},c.prototype.addUIContainer=function(a){this.topDrag||(this.topDrag=new h,win.LayerManager.getInstance().addPanel(this.topDrag,200)),this.topDrag.addUIContainer(a),this.addStageMoveEvets()},c.prototype.addStageMoveEvets=function(){g.uiStage.addEventListener(f.Move,this.onMove,this),g.uiStage.addEventListener(f.Up,this.onUp,this)},c.prototype.onMove=function(a){var b=this.getObjectsUnderPoint(new e(a.x,a.y));b&&b.dispatchEvent(new i(i.DRAG_DROP)),this._dragPanel.left=a.x-32,this._dragPanel.top=a.y-32},c.prototype.getObjectsUnderPoint=function(a){for(var b=win.LayerManager.getInstance().children,c=b.length-1;c>=0;c--)if(b[c]!=this.topDrag){var d=b[c].getObjectsUnderPoint(a);if(d)return d}return null},c.prototype.onUp=function(a){g.uiStage.removeEventListener(f.Move,this.onMove,this),g.uiStage.removeEventListener(f.Up,this.onUp,this);var b=this.getObjectsUnderPoint(new e(a.x,a.y));if(b){var c=new i(i.DRAG_ENTER);c.data=a,b.dispatchEvent(c)}this._dragPanel.left=1e4,this._dragPanel.top=1e4},c.prototype.listenModuleEvents=function(){return[new i(i.DRAG_SHOW),new i(i.DRAG_DROP),new i(i.DRAG_ENTER)]},c}(d);a.DragProcessor=k}(drag||(drag={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),menutwo;!function(a){var b=Pan3d.InteractiveEvent,c=Pan3d.Rectangle,d=Pan3d.Dis2DUIContianerPanel,e=function(d){function e(){return d.call(this,a.LabelTxtVo,new c(0,0,70,20),20)||this}return __extends(e,d),e.prototype.showComboBoxList=function(b,c){this._comboxData=b,this._comBoxFun=c,this.clearAll();for(var d=0;d<this._comboxData.length;d++){var e=new a.MenuListData(String(this._comboxData[d].name),String(this._comboxData[d].type));this.showTempMenu(e,d)}},e.prototype.showTempMenu=function(a,c){var e=d.prototype.showTemp.call(this,a);return e.ui.x=0,e.ui.y=20*c,e.ui.addEventListener(b.Move,this.butMove,this),e.ui.addEventListener(b.Up,this.onMouseUp,this),e},e.prototype.butMove=function(a){var b=this.getVoByUi(a.target);if(b&&b.rightTabInfoVo){var c=b.rightTabInfoVo;this.setColorByLevel(c.level),c.select=!0,b.makeData()}},e.prototype.setColorByLevel=function(a){for(var b=0;b<this._uiItem.length;b++){var c=this._uiItem[b].rightTabInfoVo;c&&c.level==a&&(c.select=!1,this._uiItem[b].makeData())}},e.prototype.clearAll=function(){for(var a=0;a<this._uiItem.length;a++)this._uiItem[a].rightTabInfoVo&&this.clearTemp(this._uiItem[a].rightTabInfoVo)},e.prototype.clearTemp=function(a){var c=this.getVoByData(a);c.ui.removeEventListener(b.Move,this.butMove,this),c.ui.removeEventListener(b.Up,this.onMouseUp,this),d.prototype.clearTemp.call(this,a)},e.prototype.onMouseUp=function(a){var b=this.getVoByUi(a.target);b&&b.rightTabInfoVo&&(this._comBoxFun(Number(b.rightTabInfoVo.key)),this.clearAll())},e}(d);a.ComboTwoBoxMenu=e}(menutwo||(menutwo={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),menutwo;!function(a){var b=Pan3d.InteractiveEvent,c=Pan3d.TextAlign,d=Pan3d.UIManager,e=Pan3d.LabelTextFont,f=Pan3d.Disp2DBaseText,g=Pan3d.TextureManager,h=Pan3d.Rectangle,i=Pan3d.Dis2DUIContianerPanel,j=function(){function a(a,b){void 0===b&&(b=null),this.select=!1,this.label=a,this.key=b}return a}();a.MenuListData=j;var k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.makeData=function(){if(this.rightTabInfoVo){var a=this.rightTabInfoVo,b=this.parent.uiAtlas.getRec(this.textureStr);this.parent.uiAtlas.ctx=d.getInstance().getContext2D(b.pixelWitdh,b.pixelHeight,!1),this.parent.uiAtlas.ctx.clearRect(0,1,b.pixelWitdh,b.pixelHeight);var f=a.select?"#6c6c6c":"#555555",h=a.select?"[ffffff]":"[9c9c9c]";this.parent.uiAtlas.ctx.fillStyle=f,this.parent.uiAtlas.ctx.fillRect(0,0,b.pixelWitdh,b.pixelHeight),e.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,h+a.label,12,5,5,c.LEFT),g.getInstance().updateTexture(this.parent.uiAtlas.texture,b.pixelX,b.pixelY,this.parent.uiAtlas.ctx)}},b}(f);a.LabelTxtVo=k;var l=function(a){function c(){var b=a.call(this,k,new h(0,0,70,20),50)||this;return b.skipNum=0,b}return __extends(c,a),c.prototype.initMenuData=function(a){function b(a,c){for(var d=0;a&&d<a.length;d++)a[d].level=c,b(a[d].subMenu,c+1)}for(var c in a.info)this[c]=a.info[c];this.menuXmlItem=a.menuXmlItem,b(this.menuXmlItem,0)},c.prototype.showMainUi=function(){this.clearAll(),Pan3d.Scene_data.uiBlankStage.addEventListener(b.Up,this.onStageMouseUp,this),this.showSon(this.menuXmlItem,0)},c.prototype.onStageMouseUp=function(a){this.clearAll()},c.prototype.showTempMenu=function(c,d,e){var f=a.prototype.showTemp.call(this,c);return f.ui.x=70*c.level,f.ui.y=20*d+e,f.ui.addEventListener(b.Move,this.butMove,this),f.ui.addEventListener(b.Down,this.onMouseUp,this),f},c.prototype.clearTemp=function(c){var d=this.getVoByData(c);d.ui.removeEventListener(b.Move,this.butMove,this),d.ui.removeEventListener(b.Down,this.onMouseUp,this),a.prototype.clearTemp.call(this,c)},c.prototype.setColorByLevel=function(a){for(var b=0;b<this._uiItem.length;b++){var c=this._uiItem[b].rightTabInfoVo;c&&c.level==a&&(c.select=!1,this._uiItem[b].makeData())}},c.prototype.removeOtherSonMenu=function(a){for(var b=this._uiItem.length-1;b>=0;b--){var c=this._uiItem[b].rightTabInfoVo;c&&c.level>a&&this.clearTemp(c)}},c.prototype.butMove=function(a){var b=this.getVoByUi(a.target);if(b&&b.rightTabInfoVo){var c=b.rightTabInfoVo;this.setColorByLevel(c.level),this.removeOtherSonMenu(c.level),c.select=!0,b.makeData(),this.showSon(c.subMenu,b.ui.y)}},c.prototype.onMouseUp=function(a){var b=this.getVoByUi(a.target);b&&b.rightTabInfoVo&&(this.bfun(b.rightTabInfoVo,a),this.clearAll())},c.prototype.showSon=function(a,b){for(var c=0;a&&c<a.length;c++){var d=this.getVoByData(a[c]);d||this.showTempMenu(a[c],c,b)}},c}(i);a.MenuTwoPanel=l}(menutwo||(menutwo={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),menutwo;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Module,d=Pan3d.BaseProcessor,e=Pan3d.UIData,f=Pan3d.InteractiveEvent,g=Pan3d.Scene_data,h=win.Panel,i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.SHOW_RIGHT_MENU="SHOW_RIGHT_MENU",b.SHOW_COMBOX_MENU="SHOW_COMBOX_MENU",b}(b);a.MenuTwoEvent=i;var j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"MenuTwoModule"},b.prototype.listProcessors=function(){return[new k]},b}(c);a.MenuTwoModule=j;var k=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getName=function(){return"MenuTwoProcessor"},c.prototype.receivedModuleEvent=function(a){if(a instanceof i){var b=a;b.type==i.SHOW_RIGHT_MENU&&this.showMenuPanel(b.data),b.type==i.SHOW_COMBOX_MENU&&(console.log("有键菜单"),this.showComboBoxMenuPanel(b))}},c.prototype.showComboBoxMenuPanel=function(b){this._comboBoxMenuPanel||(this._comboBoxMenuPanel=new a.ComboTwoBoxMenu);var c=b.posv2d;console.log("posv2d",c),this._comboBoxMenuPanel.left=c.x,this._comboBoxMenuPanel.top=c.y,this._comboBoxMenuPanel.showComboBoxList(b.comboxData,b.comboxFun),this.addUIContainer(this._comboBoxMenuPanel)},c.prototype.showMenuPanel=function(b){this._MenuTwoPanel||(this._MenuTwoPanel=new a.MenuTwoPanel);var c=b.mouse;this._MenuTwoPanel.left=c.x/e.Scale,this._MenuTwoPanel.top=c.y/e.Scale,this.addUIContainer(this._MenuTwoPanel),this._MenuTwoPanel.initMenuData(b),this._MenuTwoPanel.showMainUi(),g.uiStage.addEventListener(f.Down,this.onMouseDown,this)},c.prototype.addUIContainer=function(a){this.topMenuPanel||(this.topMenuPanel=new h,win.LayerManager.getInstance().addPanel(this.topMenuPanel,200)),this.topMenuPanel.addUIContainer(a)},c.prototype.removeUIContainer=function(a){this.topMenuPanel&&this.topMenuPanel.removeUIContainer(a)},c.prototype.onMouseDown=function(a){},c.prototype.listenModuleEvents=function(){return[new i(i.SHOW_RIGHT_MENU),new i(i.SHOW_COMBOX_MENU)]},c}(d);a.MenuTwoProcessor=k}(menutwo||(menutwo={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),colorview;!function(a){var b=Pan3d.UIRenderComponent,c=Pan3d.UIAtlas,d=Pan3d.InteractiveEvent,e=Pan3d.Scene_data,f=Pan3d.Vector3D,g=Pan3d.ColorType,h=Pan3d.UIManager,i=Pan3d.TextureManager,j=Pan3d.Vector2D,k=Pan3d.UIData,l=Pan3d.ModuleEventManager,m=win.UIPanel,n=function(m){function n(){var a=m.call(this)||this;return a.maincary=[16711680,16776960,65280,65535,255,16711935,16711680],a.layer=2e3,a.left=400,a.top=200,a.width=300,a.height=300,a._bottomRender=new b,a.addRender(a._bottomRender),a._midRender=new b,a.addRender(a._midRender),a._topRender=new b,a.addRender(a._topRender),a._topRender.uiAtlas=new c,a}return __extends(n,m),n.prototype.applyLoad=function(){var a=this;this._topRender.uiAtlas.setInfo("pan/marmoset/uilist/colorview/colorview.xml","pan/marmoset/uilist/colorview/colorview.png",function(){a.loadConfigCom()})},n.prototype.loadConfigCom=function(){this._bottomRender.uiAtlas=this._topRender.uiAtlas,this._midRender.uiAtlas=this._topRender.uiAtlas,this.c_tittle=this.addEvntBut("c_tittle",this._bottomRender),this.addChild(this._bottomRender.getComponent("c_bg")),this.c_color_txt_bg=this.addChild(this._midRender.getComponent("c_color_txt_bg")),this.c_main_color=this.addEvntBut("c_main_color",this._midRender),this.c_panel_color=this.addEvntBut("c_panel_color",this._midRender),this.c_close=this.addEvntBut("c_close",this._topRender),this.c_mainper=this.addChild(this._topRender.getComponent("c_mainper")),this.c_pickImg=this.addChild(this._topRender.getComponent("c_pickImg")),this.c_out_color=this.addChild(this._topRender.getComponent("c_out_color")),this.c_text_info=this.addChild(this._topRender.getComponent("c_text_info")),this.c_text_a=this.addChild(this._topRender.getComponent("c_text_a")),this.c_text_b=this.addChild(this._topRender.getComponent("c_text_b")),this.c_text_g=this.addChild(this._topRender.getComponent("c_text_g")),this.c_text_r=this.addChild(this._topRender.getComponent("c_text_r")),this.drawMainColor(),this.c_main_color.addEventListener(d.Move,this.onMainColorMove,this),this.c_panel_color.addEventListener(d.Move,this.onPanelColorMove,this),e.uiStage.addEventListener(d.Up,this.onUiStageUp,this),this.applyLoadComplete()},n.prototype.initColor=function(a,b){this.changeFun=b;var c=new f(random(255),random(255),random(255));a&&(c=a);var d=this.rgb2hsb(c);isNaN(d.x)&&(d.x=0),this._currentMainPer=d.x/360,this.changePanelColor(this._currentMainPer),this._perX=d.y,this._perY=1-d.z,this.showColor(this._perX,this._perY),this.showColorTxt(this._perX,this._perY)},n.prototype.showColor=function(a,b){this.c_pickImg.x=150*a+this.c_panel_color.x-10,this.c_pickImg.y=150*b+this.c_panel_color.y-10},n.prototype.showColorTxt=function(a,b){this._perX=a,this._perY=b;var c=(255*(1-a)+this.mainColor.x*a)*(1-b),d=(255*(1-a)+this.mainColor.y*a)*(1-b),e=(255*(1-a)+this.mainColor.z*a)*(1-b);this.drawStrToUi(this.c_text_r,String(Math.floor(c))),this.drawStrToUi(this.c_text_g,String(Math.floor(d))),this.drawStrToUi(this.c_text_b,String(Math.floor(e))),this.drawStrToUi(this.c_text_a,String(Math.floor(100))),this.drawStrToUi(this.c_text_info,"#ff99cc"),this.drawOutColor(new f(c,d,e))},n.prototype.getHtxColor=function(a){return""},n.prototype.drawStrToUi=function(a,b){this._topRender.uiAtlas.writeSingleLabel(a.skinName,g.Whiteffffff+b)},n.prototype.drawOutColor=function(a){void 0===a&&(a=null);for(var b=this._topRender.uiAtlas,c=b.getRec(this.c_out_color.skinName),d=h.getInstance().getContext2D(c.pixelWitdh,c.pixelHeight,!1),e=d.getImageData(0,0,c.pixelWitdh,c.pixelHeight),f=0;f<e.data.length/4;f++)e.data[4*f+0]=a.x,e.data[4*f+1]=a.y,e.data[4*f+2]=a.z,e.data[4*f+3]=255;d.putImageData(e,0,0),i.getInstance().updateTexture(b.texture,c.pixelX,c.pixelY,d),this._outColorVect=a},n.prototype.onUiStageUp=function(a){this.c_main_color.data=!1,this.c_panel_color.data=!1},n.prototype.onMainColorMove=function(a){if(this.c_main_color.data){var b=(a.x-this.left-this.c_main_color.x)/this.c_main_color.width;b=Math.max(Math.min(1,b),0),this.changePanelColor(b),this.showColorTxt(this._perX,this._perY),this.changeFun&&this.changeFun(this._outColorVect)}},n.prototype.onPanelColorMove=function(a){if(this.c_panel_color.data){var b=(a.x-this.left-this.c_panel_color.x)/this.c_panel_color.width,c=(a.y-this.top-this.c_panel_color.y)/this.c_panel_color.height;this._perX=b,this._perY=c,this.showColor(this._perX,this._perY),this.showColorTxt(this._perX,this._perY),this.changeFun&&this.changeFun(this._outColorVect)}},n.prototype.rgb2hsb=function(a){var b=Math.floor(a.x),c=Math.floor(a.y),d=Math.floor(a.z),e=[b,c,d];e.sort(function(a,b){return a-b});var g=e[2],h=e[0],i=g/255,j=0==g?0:(g-h)/g,k=0;return g==b&&c>=d?k=60*(c-d)/(g-h)+0:g==b&&d>c?k=60*(c-d)/(g-h)+360:g==c?k=60*(d-b)/(g-h)+120:g==d&&(k=60*(b-c)/(g-h)+240),new f(k,j,i)},n.prototype.changePanelColor=function(a){this.c_mainper.x=this.c_main_color.x+this.c_main_color.width*a-this.c_mainper.width/2,this.c_mainper.y=this.c_main_color.y-10;var b=6*a,c=Math.floor(b);b-=c;var d=hexToArgb(this.maincary[c],!1),e=hexToArgb(this.maincary[c+1],!1);d.scaleBy(1-b),e.scaleBy(b),d=d.add(e),this.mainColor=d;this.argbToHex16(d.x,d.y,d.z);this.drawPanelColor(d)},n.prototype.argbToHex16=function(a,b,c){var d=a<<16|b<<8|c;return d},n.prototype.drawPanelColor=function(a){void 0===a&&(a=null);var b=this._topRender.uiAtlas,c=b.getRec(this.c_panel_color.skinName),d=h.getInstance().getContext2D(c.pixelWitdh,c.pixelHeight,!1);d.clearRect(0,0,c.pixelWitdh,c.pixelHeight);var e=d.getImageData(0,0,c.pixelWitdh,c.pixelHeight),g=new f(255,255,255,255),j=new f(255,0,0,255);a&&(j=a);for(var k=new f(j.x-g.x,j.y-g.y,j.z-g.z),l=0;l<e.width;l++)for(var m=0;m<e.width;m++){var n=4*(l*e.width+m),o=m/e.width;e.data[n+0]=g.x+k.x*o,e.data[n+1]=g.x+k.y*o,e.data[n+2]=g.x+k.z*o,e.data[n+0]*=1-l/e.height,e.data[n+1]*=1-l/e.height,e.data[n+2]*=1-l/e.height,e.data[n+3]=255}d.putImageData(e,0,0),i.getInstance().updateTexture(b.texture,c.pixelX,c.pixelY,d)},n.prototype.drawMainColor=function(){for(var a=this._topRender.uiAtlas,b=a.getRec(this.c_main_color.skinName),c=h.getInstance().getContext2D(b.pixelWitdh,b.pixelHeight,!1),d=c.createLinearGradient(0,0,b.pixelWitdh,b.pixelHeight),e=0;e<this.maincary.length;e++){
var f=hexToArgb(this.maincary[e],!1);d.addColorStop(e/(this.maincary.length-1),"rgb("+f.x+","+f.y+", "+f.z+")")}c.fillStyle=d,c.rect(0,0,b.pixelWitdh,b.pixelHeight),c.fill(),i.getInstance().updateTexture(a.texture,b.pixelX,b.pixelY,c)},n.prototype.butClik=function(b){switch(b.target){case this.c_tittle:this.addStageMoveEvets(b);break;case this.c_main_color:this.c_main_color.data=!0;break;case this.c_panel_color:this.c_panel_color.data=!0;break;case this.c_close:l.dispatchEvent(new a.ColorEvent(a.ColorEvent.HIDE_COLOR_PANEL))}},n.prototype.addStageMoveEvets=function(a){this.lastPanelPos=new j(this.left,this.top),this.mouseXY=new j(a.x,a.y),e.uiStage.addEventListener(d.Move,this.onMove,this),e.uiStage.addEventListener(d.Up,this.onUp,this)},n.prototype.onMove=function(a){this.left=this.lastPanelPos.x+(a.x-this.mouseXY.x)/k.Scale,this.top=this.lastPanelPos.y+(a.y-this.mouseXY.y)/k.Scale,this.resize()},n.prototype.onUp=function(a){e.uiStage.removeEventListener(d.Move,this.onMove,this),e.uiStage.removeEventListener(d.Up,this.onUp,this)},n}(m);a.ColorPanel=n}(colorview||(colorview={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),colorview;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Module,d=Pan3d.BaseProcessor,e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.SHOW_COLOR_PANEL="SHOW_COLOR_PANEL",b.HIDE_COLOR_PANEL="HIDE_COLOR_PANEL",b}(b);a.ColorEvent=e;var f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"ColorModule"},b.prototype.listProcessors=function(){return[new g]},b}(c);a.ColorModule=f;var g=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getName=function(){return"ColorProcessor"},c.prototype.receivedModuleEvent=function(a){if(a instanceof e){var b=a;b.type==e.SHOW_COLOR_PANEL&&this.showColorPanel(b.v3dColor,b.bfun),b.type==e.HIDE_COLOR_PANEL&&this.hideColorPanel()}},c.prototype.hideColorPanel=function(){this.colorPanel&&(this.colorWinPanel.removeUIContainer(this.colorPanel),this.colorPanel=null)},c.prototype.showColorPanel=function(b,c){var d=this;this.colorWinPanel||(this.colorWinPanel=new win.Panel,win.LayerManager.getInstance().addPanel(this.colorWinPanel,500)),this.colorPanel||(this.colorPanel=new a.ColorPanel,this.colorPanel.load(function(){d.colorPanel.initColor(b,c)})),this.colorWinPanel.addUIContainer(this.colorPanel)},c.prototype.listenModuleEvents=function(){return[new e(e.SHOW_COLOR_PANEL),new e(e.HIDE_COLOR_PANEL)]},c}(d);a.ColorProcessor=g}(colorview||(colorview={}));var prop;!function(a){var b=Pan3d.TextureManager,c=Pan3d.UIManager,d=Pan3d.Scene_data,e=Pan3d.LoadManager,f=function(){function a(a){this._width=1,this._height=1,this._x=0,this._y=0,this.KeyStep=1,this.propPanle=a,this.width=100,this.height=100,this.initView()}return Object.defineProperty(a.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a},enumerable:!0,configurable:!0}),a.prototype.setTarget=function(a){this.target=a,this.refreshViewValue()},a.prototype.refreshViewValue=function(){},a.prototype.initView=function(){},a.prototype.destory=function(){},a.prototype.resize=function(){},a.prototype.drawOutColor=function(a,d){for(var e=a.uiRender.uiAtlas,f=a.skinName,g=e.getRec(f),h=c.getInstance().getContext2D(g.pixelWitdh,g.pixelHeight,!1),i=h.getImageData(0,0,g.pixelWitdh,g.pixelHeight),j=0;j<i.data.length/4;j++)i.data[4*j+0]=d.x,i.data[4*j+1]=d.y,i.data[4*j+2]=d.z,i.data[4*j+3]=255;h.putImageData(i,0,0),b.getInstance().updateTexture(e.texture,g.pixelX,g.pixelY,h)},a.prototype.drawUrlImgToUi=function(a,b){var c=this;e.getInstance().load(d.fileRoot+b,e.IMG_TYPE,function(b){c.drawImgToUi(a,b)})},a.prototype.drawImgToUi=function(a,d){var e=a.uiRender.uiAtlas,f=a.skinName,g=e.getRec(f),h=c.getInstance().getContext2D(g.pixelWitdh,g.pixelHeight,!1);h.drawImage(d,0,0,g.pixelWitdh,g.pixelHeight),b.getInstance().updateTexture(e.texture,g.pixelX,g.pixelY,h)},a}();a.BaseReflComponent=f}(prop||(prop={}));var prop;!function(a){var b=function(){function a(){}return a.Key_Type="Type",a.Key_GetFun="GetFun",a.Key_SetFun="SetFun",a.Key_GetView="GetView",a.Key_Data="Data",a.Key_Label="Label",a.Key_Category="Category",a.Key_Suffix="Suffix",a.Key_Step="Step",a.Key_MaxNum="MaxNum",a.Key_MinNum="MinNum",a.Key_Tip="Tip",a.Key_GetMaxNumFun="GetMaxNumFun",a.Key_GetMinNumFun="GetMinNumFun",a.Key_SelectIndex="SelectIndex",a.NumberInput="NumberInput",a.CaptureIdUi="CaptureIdUi",a.TEXT="Txt",a.Num="Number",a.Input="Input",a.ComboBox="ComboBox",a.ColorPick="ColorPick",a.CheckBox="CheckBox",a.Line="Line",a.Vec3="Vec3",a.Vec2="Vec2",a.Btn="Btn",a.Texturue2DUI="Texturue2DUI",a.MaterialPicUi="MaterialPicUi",a.RoleMesh2DUI="RoleMesh2DUI",a.RoleAnim2DUI="RoleAnim2DUI",a.MeshScene2DUI="MeshScene2DUI",a.MeshMaterialLeft2DUI="MeshMaterialLeft2DUI",a.AgalFunUI="AgalFunUI",a.Vec3Color="Vec3Color",a.Vec2Prama="Vec2Prama",a.UserView="userView",a.FunKey="FunKey",a.ClikEventKey="ClikEventKey",a.Number="Number",a}();a.ReflectionData=b}(prop||(prop={}));var prop;!function(a){var b=function(){function b(a){this.x=0,this.y=0,this._top=0,this._width=100,this._height=100,this.categoryKey={},this.hideCategoryKey={},this.propPanle=a,this.creat(this.getView())}return b.prototype.getMeshInfo=function(){var a={};return a["class"]=this,a.data=this.data,a},b.prototype.onAdd=function(){console.log("onRemove");for(var a=0;this.ui&&a<this.ui.length;a++)this.ui[a].visible=!0},b.prototype.onRemove=function(){console.log("onRemove");for(var a=0;this.ui&&a<this.ui.length;a++)this.ui[a].visible=!1},Object.defineProperty(b.prototype,"top",{get:function(){return this._top},set:function(a){this._top=a,this.resize()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a,this.resize()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this.resize()},enumerable:!0,configurable:!0}),b.prototype.replayUiList=function(){this.destory(),this.creat(this.getView())},b.prototype.getView=function(){var a=[];return a},Object.defineProperty(b.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.refreshViewValue()},enumerable:!0,configurable:!0}),b.prototype.creat=function(a){this.ui=new Array,this.categoryKey={};for(var b=0;b<a.length;b++){if(a[b].Category&&!this.categoryKey[a[b].Category]&&(this.hideCategory||(this.hideCategory=a[b].Category),this.hideCategory!=a[b].Category)){this.categoryKey[a[b].Category]=!0;var c=this.getCategoryUI(a[b].Category);c.data=this.hideCategoryKey[a[b].Category],this.ui.push(c)}if(!Boolean(this.hideCategoryKey[a[b].Category])){var d=this.creatComponent(a[b]);d.Category=a[b].Category,this.ui.push(d)}}this.resize()},b.prototype.categoryClikUp=function(a){if(this.hideCategoryKey[a]=!this.hideCategoryKey[a],this.hideCategoryKey[a])for(var b=this.ui.length-1;b>=0;b--){var c=this.ui[b];c.Category==a&&(c.destory(),this.ui.splice(b,1))}else for(var d=this.getView(),e=this.getUiIndxByCategory(a),b=0;b<d.length;b++)if(d[b].Category==a&&!Boolean(this.hideCategoryKey[d[b].Category])){var f=this.creatComponent(d[b]);f.Category=d[b].Category,this.ui.splice(e++,0,f),f.refreshViewValue()}this.resize(),this.categoryFun&&this.categoryFun()},b.prototype.getUiIndxByCategory=function(b){for(var c=0;c<this.ui.length;c++){var d=this.ui[c];if(d instanceof a.Category2DUI&&d.label==b)return c+1}console.log("必须找到标签，显示这行说明就错。不应该到这里")},b.prototype.resize=function(){for(var a=this._top,b=0;this.ui&&b<this.ui.length;b++)this.ui[b].y=a,this.ui[b].x=20,this.ui[b].width=this.width,this.ui[b].resize(),a+=this.ui[b].height;this._height=a-this._top},b.prototype.eventKey=function(a){},b.prototype.creatComponent=function(b){var c=b[a.ReflectionData.Key_Type];return c==a.ReflectionData.NumberInput?this.getNumComponent(b):c==a.ReflectionData.AgalFunUI?this.getAgalFunComponent(b):c==a.ReflectionData.Texturue2DUI?this.getTexturue2DUI(b):c==a.ReflectionData.MaterialPicUi?this.getMaterialPicUi(b):c==a.ReflectionData.RoleMesh2DUI?this.getRoleMesh2DUI(b):c==a.ReflectionData.RoleAnim2DUI?this.getRoleAnimi2DUI(b):c==a.ReflectionData.ComboBox?this.getComboBox(b):c==a.ReflectionData.CheckBox?this.getCheckBox(b):c==a.ReflectionData.Vec3Color?this.getVec3Color(b):c==a.ReflectionData.Vec3?this.getVec3(b):c==a.ReflectionData.Vec2?this.getVec2(b):c==a.ReflectionData.TEXT?this.getTextField2DUI(b):c==a.ReflectionData.MeshScene2DUI?this.getMeshScene2DUI(b):c==a.ReflectionData.MeshMaterialLeft2DUI?this.getMeshMaterialLeft2DUI(b):null},b.prototype.getMeshMaterialLeft2DUI=function(b){var c=new a.MeshMaterialLfetView2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.suffix=b[a.ReflectionData.Key_Suffix],c.target=this,c},b.prototype.getMeshScene2DUI=function(b){var c=new a.MeshSceneView2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.target=this,c},b.prototype.getCategoryUI=function(b){var c=this,d=new a.Category2DUI(this.propPanle);return d.label=b,d.changFun=function(a){c.categoryClikUp(a)},d},b.prototype.getTextField2DUI=function(b){var c=new a.TextField2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.clikEvent=b[a.ReflectionData.ClikEventKey],c.target=this,c},b.prototype.getVec3=function(b){var c=new a.Vec3dCtrlUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],b[a.ReflectionData.Key_Step]?c.KeyStep=b[a.ReflectionData.Key_Step]:c.KeyStep=1,c.target=this,c},b.prototype.getVec2=function(b){var c=new a.Vec2PrameCtrlUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],b[a.ReflectionData.Key_Step]?c.KeyStep=b[a.ReflectionData.Key_Step]:c.KeyStep=1,c.target=this,c},b.prototype.getVec3Color=function(b){var c=new a.Vec3ColorCtrlUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],b[a.ReflectionData.Key_Step]?c.KeyStep=b[a.ReflectionData.Key_Step]:c.KeyStep=.01,c.target=this,c},b.prototype.getComboBox=function(b){var c=new a.ComBoBoxCtrl2D(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.data=b[a.ReflectionData.Key_Data],c.target=this,c},b.prototype.getCheckBox=function(b){var c=new a.CheckBox2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.target=this,c},b.prototype.getTexturue2DUI=function(b){var c=new a.Texturue2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.suffix=b[a.ReflectionData.Key_Suffix],c.FunKey=b[a.ReflectionData.FunKey],c.target=this,c},b.prototype.getMaterialPicUi=function(b){var c=new a.Material2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.suffix=b[a.ReflectionData.Key_Suffix],c.FunKey=b[a.ReflectionData.FunKey],c.changFun=b.changFun,c.target=this,c},b.prototype.getRoleMesh2DUI=function(b){var c=new a.RoleMesh2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.changFun=b.changFun,c.target=this,c},b.prototype.getRoleAnimi2DUI=function(b){var c=new a.RoleAnimi2DUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.changFun=b.changFun,c.target=this,c},b.prototype.getNumComponent=function(b){var c=new a.TextCtrlInput(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.KeyStep=b[a.ReflectionData.Key_Step],c.target=this,c},b.prototype.getAgalFunComponent=function(b){var c=new a.AgalFunUI(this.propPanle);return c.label=b[a.ReflectionData.Key_Label],c.FunKey=b[a.ReflectionData.FunKey],c.KeyStep=b[a.ReflectionData.Key_Step],c.target=this,c},b.prototype.refreshViewValue=function(){for(var a=0;a<this.ui.length;a++)this.ui[a].refreshViewValue();this.resize()},b.prototype.destory=function(){for(;this.ui.length;){var a=this.ui.pop();a.destory()}},b}();a.MetaDataView=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.Vector2D,c=Pan3d.InteractiveEvent,d=Pan3d.ModuleEventManager,e=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),f.prototype.initView=function(){this.textLabelUI=new a.TextLabelUI,this.comboBoxUi=new a.ComboBoxUi,this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.comboBoxUi),this.comboBoxUi.addEventListener(c.Down,this.comboBoxUiDown,this),this.height=30},f.prototype.destory=function(){this.textLabelUI.destory(),this.comboBoxUi.destory()},Object.defineProperty(f.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.comboxListTxt=this._data},enumerable:!0,configurable:!0}),f.prototype.comboBoxUiDown=function(a){var c=this,e=new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_COMBOX_MENU);e.posv2d=new b(this.comboBoxUi.ui.absoluteX,this.comboBoxUi.ui.absoluteY+20),e.comboxData=this.data,e.comboxFun=function(a){c.selectFun(a)},d.dispatchEvent(e)},f.prototype.selectFun=function(a){this.target[this.FunKey]=a,this.refreshViewValue()},f.prototype.refreshViewValue=function(){if(this.FunKey){var a=this.target[this.FunKey];this.comboxListTxt[a]&&(this.comboBoxUi.text=this.comboxListTxt[a].name)}},Object.defineProperty(f.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+0,this.comboBoxUi.x=this._x+75},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y+4,this.comboBoxUi.y=this._y+6},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),f}(a.BaseReflComponent);a.ComBoBoxCtrl2D=e}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(a){function b(b){var c=a.call(this,b)||this;return c.list=[],c}return __extends(b,a),b.prototype.getMeshInfo=function(){var a={};a["class"]=this,a.data=[];for(var b=0;b<this.list.length;b++)a.data.push(this.list[b].getMeshInfo());return a},b.prototype.replayUiList=function(){this.destory();for(var a=0;this.list&&a<this.list.length;a++)this.list[a].replayUiList()},b.prototype.addView=function(a){var b=this;this.list.push(a),a.categoryFun=function(){b.refreshViewValue()}},b.prototype.refreshViewValue=function(){for(var b=this.top,c=0;c<this.list.length;c++)this.list[c].top=b,b+=this.list[c].height,this.list[c].refreshViewValue();a.prototype.refreshViewValue.call(this)},b.prototype.destory=function(){for(var a=0;a<this.list.length;a++)this.list[a].destory()},b.prototype.resize=function(){a.prototype.resize.call(this);for(var b=0;this.list&&b<this.list.length;b++)this.list[b].width=this.width,this.list[b].resize()},b}(a.MetaDataView);a.CombineReflectionView=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initView=function(){this.textLabelUI=new a.TextLabelUI,this.inputTextUi=new a.InputTextUi,this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.inputTextUi),this.inputTextUi.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.onChangeInput,this),this.height=20},c.prototype.destory=function(){this.textLabelUI.destory(),this.inputTextUi.destory()},Object.defineProperty(c.prototype,"visible",{set:function(a){this.inputTextUi.visible=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),c.prototype.onChangeInput=function(a){this.target[this.FunKey]=Number(a.data),this.changFun&&this.changFun(this),this.refreshViewValue()},c.prototype.refreshViewValue=function(){this.inputTextUi.text=this.getNumStr(this.target[this.FunKey])},c.prototype.getNumStr=function(a){return a.toString()},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+0,this.inputTextUi.x=this._x+75},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y,this.inputTextUi.y=this._y+5},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),c}(a.BaseReflComponent);a.TextCtrlInput=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initView=function(){this.height=100,this.uiItem=[]},c.prototype.setData=function(b){var c=this;this.destory();for(var d=function(a){c.changeDataEvtFun(a)},e=0;e<b.length;e++){var f;if(b[e].type==materialui.NodeTree.TEX){var g=new a.Texturue2DUI(this.propPanle);g.suffix="jpg|png",f=g}b[e].type==materialui.NodeTree.VEC3&&(f=new a.Vec3ColorCtrlUI(this.propPanle),f.KeyStep=.01,(isNaN(b[e].data.x)||isNaN(b[e].data.y)||isNaN(b[e].data.z))&&(b[e].data=new Vector3D)),b[e].type==materialui.NodeTree.VEC2&&(f=new a.Vec2PrameCtrlUI(this.propPanle),f.KeyStep=.01,(isNaN(b[e].data.x)||isNaN(b[e].data.y))&&(b[e].data=new Vector2D)),b[e].type==materialui.NodeTree.FLOAT&&(f=new a.TextCtrlInput(this.propPanle),isNaN(b[e].data)&&(b[e].data=1)),f&&(f.FunKey="data",f.target=b[e],f.label=b[e].paramName,f.changFun=d,this.uiItem.push(f))}this.refreshViewValue()},c.prototype.changeDataEvtFun=function(a){for(var b=[],c=0;c<this.uiItem.length;c++)b.push(this.uiItem[c].target);this.changFun(b)},c.prototype.refreshViewValue=function(){for(var a=0;a<this.uiItem.length;a++)this.uiItem[a].refreshViewValue()},c.prototype.destory=function(){for(var a=0;a<this.uiItem.length;a++)this.uiItem[a].destory();this.uiItem=[]},c.prototype.resize=function(){b.prototype.resize.call(this);for(var a=0;a<this.uiItem.length;a++)this.uiItem[a].resize()},Object.defineProperty(c.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(b){this._y=b;var c=10;this.height=50;for(var d=0;d<this.uiItem.length;d++)this.uiItem[d].y=this.y+c,this.uiItem[d]instanceof a.Vec3ColorCtrlUI&&(c+=50,this.uiItem[d].x=50,this.height+=50),this.uiItem[d]instanceof a.Vec2PrameCtrlUI&&(c+=50,this.uiItem[d].x=50,this.height+=50),this.uiItem[d]instanceof a.TextCtrlInput&&(c+=50,this.uiItem[d].x=50,this.height+=50),this.uiItem[d]instanceof a.Texturue2DUI&&(c+=100,this.uiItem[d].x=50,this.height+=100);this.height+=10},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a},enumerable:!0,configurable:!0}),c}(a.BaseReflComponent);a.MaterialParamUi=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.TextureManager,c=Pan3d.Scene_data,d=Pan3d.InteractiveEvent,e=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),f.prototype.initView=function(){this.textLabelUI=new a.TextLabelUI(64,16),this.textureUrlText=new a.TextLabelUI(200,16),this.texturePicUi=new a.TexturePicUi,this.searchIcon=new a.BaseMeshUi(20,20),this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.textureUrlText),this.propPanle.addBaseMeshUi(this.texturePicUi),this.propPanle.addBaseMeshUi(this.searchIcon),this.drawUrlImgToUi(this.searchIcon.ui,"icon/search.png"),this.texturePicUi.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.onChangePicurl,this),this.searchIcon.ui.addEventListener(d.Up,this.searchClik,this),this.height=100},f.prototype.searchClik=function(a){this.searchFileByPath(this.target[this.FunKey])},f.prototype.searchFileByPath=function(a){var b=Pan3d.Scene_data.fileRoot+a;Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_DIS_ALL_FILE),b.replace(Pan3d.Scene_data.ossRoot,""))},f.prototype.getPerentPath=function(a){var b=a.lastIndexOf("/");return a=-1!=b?a.substr(0,b+1):""},f.prototype.onChangePicurl=function(a){var b=this;a.data instanceof File?this.makeNewTextureByFile(a.data):-1!=this.texturePicUi.url.indexOf(".material")?(console.log("是材质"),pack.PackMaterialManager.getInstance().getMaterialByUrl(this.texturePicUi.url,function(a){console.log(a),b.target[b.FunKey]=a,b.changFun&&b.changFun(),b.refreshViewValue()})):(this.target[this.FunKey]=this.texturePicUi.url,this.changFun&&this.changFun(),this.refreshViewValue())},f.prototype.makeNewTextureByFile=function(a){var d=this,e=new FileReader;e.readAsDataURL(a),e.onload=function(){var f=makeImage();f.onload=function(){b.getInstance().addImgRes(c.fileRoot+a.name,f),d.target[d.FunKey]=a.name,d.refreshViewValue()},f.src=e.result}},f.prototype.destory=function(){this.textLabelUI.destory(),this.textureUrlText.destory(),this.texturePicUi.destory(),this.searchIcon.destory()},Object.defineProperty(f.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),f.prototype.refreshViewValue=function(){var a=String(this.target[this.FunKey]);this.texturePicUi.url=a;var b=a.split("/");this.textureUrlText.label=b[b.length-1]},Object.defineProperty(f.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+0,this.texturePicUi.x=this._x+60,this.textureUrlText.x=this._x+60,this.searchIcon.x=this._x+150},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y,this.texturePicUi.y=this._y,this.textureUrlText.y=this._y+75,this.searchIcon.y=this._y+10},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"suffix",{get:function(){return this._suffix},set:function(a){this._suffix=a,this.texturePicUi.suffix=a},enumerable:!0,configurable:!0}),f}(a.BaseReflComponent);a.Texturue2DUI=e}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initView=function(){b.prototype.initView.call(this),this.height=300},c.prototype.destory=function(){b.prototype.destory.call(this),this._materialTreeMc&&(this._materialTreeMc.destory(),this._materialTreeMc=null)},Object.defineProperty(c.prototype,"data",{set:function(a){this._data=a},enumerable:!0,configurable:!0}),c.prototype.refreshViewValue=function(){if(this.textureTree=this.target[this.FunKey],this.textureTree){this.texturePicUi.url=this.textureTree.url;var a=this.textureTree.url.split("/");this.textureUrlText.label=a[a.length-1],this.showMaterialParamUi()}else this.texturePicUi.url="icon/base.jpg",this.textureUrlText.label="无材质"},c.prototype.paramChange=function(a){this.changFun(a)},c.prototype.showMaterialParamUi=function(){var b=this;this._materialTreeMc||(this._materialTreeMc=new a.MaterialParamUi(a.PropModel.getInstance().propPanle),this._materialTreeMc.changFun=function(a){b.paramChange(a)}),this.textureTree=this.target[this.FunKey],this._materialTreeMc.setData(this.makeTempInfo(this.textureTree)),this._materialTreeMc.y=this._y+100,this.height=100+this._materialTreeMc.height},c.prototype.resize=function(){b.prototype.resize.call(this),this._materialTreeMc&&(this._materialTreeMc.resize(),this._materialTreeMc.y=this._y+100,this.height=100+this._materialTreeMc.height)},c.prototype.searchClik=function(a){console.log(this.textureTree.url),this.searchFileByPath(this.textureTree.url)},c.prototype.makeTempInfo=function(a){for(var b=[],c=0;c<a.data.length;c++)if(a.data[c].data.isDynamic){var d;if(a.data[c].type==materialui.NodeTree.TEX&&(d={},d.data=a.data[c].data.url),a.data[c].type==materialui.NodeTree.VEC3&&(d={},d.data=a.data[c].data.constValue),a.data[c].type==materialui.NodeTree.FLOAT&&(d={},d.data=a.data[c].data.constValue),d){d.type=a.data[c].type,d.paramName=a.data[c].data.paramName;var e=this.target.getParamItem(d.paramName);e&&(d.data=e),b.push(d)}}return b},c}(a.Texturue2DUI);a.Material2DUI=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.Scene_data,c=Pan3d.LoadManager,d=Pan3d.InteractiveEvent,e=Pan3d.ModuleEventManager,f=function(f){function g(){return null!==f&&f.apply(this,arguments)||this}return __extends(g,f),g.prototype.initView=function(){f.prototype.initView.call(this),this.textLabelUI=new a.TextLabelUI,this.comboBoxUi=new a.ComboBoxUi(80,20),this.deleIcon=new a.BaseMeshUi(16,16),this.md5animUrlText=new a.TextLabelUI(100,16),this.md5animPicUi=new a.TexturePicUi,this.md5animPicUi.suffix="md5anim",this.md5animPicUi.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.drawInAnimUrl,this),this.md5searchIcon=new a.BaseMeshUi(20,20),this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.comboBoxUi),this.propPanle.addBaseMeshUi(this.deleIcon),this.propPanle.addBaseMeshUi(this.md5animUrlText),this.propPanle.addBaseMeshUi(this.md5animPicUi),this.propPanle.addBaseMeshUi(this.md5searchIcon),this.drawUrlImgToUi(this.md5searchIcon.ui,"icon/search.png"),this.drawUrlImgToUi(this.deleIcon.ui,"icon/deleticon.png"),this.comboBoxUi.addEventListener(d.Down,this.comboBoxUiDown,this),this.deleIcon.ui.addEventListener(d.Down,this.deleIconDown,this),this.md5searchIcon.ui.addEventListener(d.Up,this.md5searchIconClik,this),this.height=150},g.prototype.md5searchIconClik=function(a){var b=this.target.data;console.log(b.animPlayKey)},g.prototype.drawInAnimUrl=function(){var a,d=this,e=this.target.data;if(e&&e.skinMesh&&e.skinMesh.meshAry&&e.skinMesh.meshAry.length)for(var f=0;f<e.skinMesh.meshAry.length;f++)a=e.skinMesh.meshAry[f].md5meshurl;a?c.getInstance().load(b.fileRoot+a,c.XML_TYPE,function(a){var f=new left.LocalMd5MoveSprite;f.addLocalMeshByStr(a),c.getInstance().load(b.fileRoot+d.md5animPicUi.url,c.XML_TYPE,function(a){f.addLocalAdimByStr(a);var b=AppData.getFileName(d.md5animPicUi.url);b=b.split(".")[0];var c=new left.MaterialRoleSprite;c.changeRoleWeb(f);for(var g in c.animDic)e.animDic[b]=c.animDic[g];e.animPlayKey=b,d.refreshViewValue(),d.changFun(),console.log("准备获取新的动作数据",e.animPlayKey)})}):alert("需要先有md5mesh文件")},g.prototype.deleIconDown=function(a){var b=this.target.data;if(this.getObjKeyLen(b.animDic)>1){if(b.animDic[b.animPlayKey]){var c=window.confirm("是否确定要删除动作"+b.animPlayKey);c&&(delete b.animDic[b.animPlayKey],b.animPlayKey=null,this.refreshViewValue())}}else alert("最后一个动作不可以删除")},g.prototype.getObjKeyLen=function(a){var b=0;for(var c in a)b++;return b},g.prototype.destory=function(){this.textLabelUI.destory(),this.comboBoxUi.destory(),this.deleIcon.destory(),this.md5animUrlText.destory(),this.md5animPicUi.destory(),this.md5searchIcon.destory(),f.prototype.destory.call(this)},Object.defineProperty(g.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+0,this.comboBoxUi.x=this._x+75,this.deleIcon.x=this._x+150,this.md5animUrlText.x=this._x+60,this.md5animPicUi.x=this._x+60,this.md5searchIcon.x=this._x+150},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y+4,this.comboBoxUi.y=this._y+6,this.deleIcon.y=this._y+6,this.md5animUrlText.y=this._y+100,this.md5animPicUi.y=this._y+35,this.md5searchIcon.y=this._y+40},enumerable:!0,configurable:!0}),g.prototype.comboBoxUiDown=function(a){var b=this,c=new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_COMBOX_MENU);c.posv2d=new Vector2D(this.comboBoxUi.ui.absoluteX,this.comboBoxUi.ui.absoluteY+20);var d=[];for(var f in this._animDic)d.push({name:f,type:d.length});c.comboxData=d,c.comboxFun=function(a){b.selectFun(a)},e.dispatchEvent(c)},g.prototype.selectFun=function(a){var b=0,c=this.target.data;for(var d in this._animDic){if(c.animPlayKey=d,b==a)break;b++}this.changFun(),
this.refreshViewValue()},g.prototype.refreshViewValue=function(){if(this.FunKey){this._animDic=this.target[this.FunKey];var a=this.target.data;if(!a.animPlayKey)for(var b in this._animDic){a.animPlayKey=b;break}this._animDic[a.animPlayKey]?(this._animDic[a.animPlayKey].url||(this._animDic[a.animPlayKey].url=a.animPlayKey+".md5anim"),this.textLabelUI.label="部分",this.comboBoxUi.text=a.animPlayKey,this.md5animPicUi.url="icon/txt_64x.png",this.md5animUrlText.label=this._animDic[a.animPlayKey].url):console.log("没有动作对象")}},g}(a.BaseReflComponent);a.RoleAnimi2DUI=f}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.Scene_data,c=Pan3d.LoadManager,d=Pan3d.InteractiveEvent,e=Pan3d.ModuleEventManager,f=function(f){function g(){var a=null!==f&&f.apply(this,arguments)||this;return a.selectMeshId=0,a}return __extends(g,f),g.prototype.initView=function(){f.prototype.initView.call(this),this.textLabelUI=new a.TextLabelUI,this.comboBoxUi=new a.ComboBoxUi,this.deleIcon=new a.BaseMeshUi(16,16),this.md5meshUrlText=new a.TextLabelUI(200,16),this.md5meshPicUi=new a.TexturePicUi,this.md5meshPicUi.suffix="md5mesh",this.md5meshPicUi.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.drawInMeshUrl,this),this.md5searchIcon=new a.BaseMeshUi(20,20),this.textureUrlText=new a.TextLabelUI(200,16),this.texturePicUi=new a.TexturePicUi,this.texturePicUi.suffix="material",this.texturePicUi.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.drawInTextureUrl,this),this.texturesearchIcon=new a.BaseMeshUi(20,20),this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.comboBoxUi),this.propPanle.addBaseMeshUi(this.deleIcon),this.propPanle.addBaseMeshUi(this.md5meshUrlText),this.propPanle.addBaseMeshUi(this.md5meshPicUi),this.propPanle.addBaseMeshUi(this.md5searchIcon),this.propPanle.addBaseMeshUi(this.textureUrlText),this.propPanle.addBaseMeshUi(this.texturePicUi),this.propPanle.addBaseMeshUi(this.texturesearchIcon),this.drawUrlImgToUi(this.md5searchIcon.ui,"icon/search.png"),this.drawUrlImgToUi(this.texturesearchIcon.ui,"icon/search.png"),this.drawUrlImgToUi(this.deleIcon.ui,"icon/deleticon.png"),this.comboBoxUi.addEventListener(d.Down,this.comboBoxUiDown,this),this.deleIcon.ui.addEventListener(d.Down,this.deleIconDown,this),this.height=200},g.prototype.deleIconDown=function(a){this._skinMesh.meshAry.splice(this.selectMeshId,1),this.changFun()},g.prototype.drawInTextureUrl=function(){var a=this._skinMesh.meshAry[this.selectMeshId];a&&(console.log(a),a.materialUrl=this.texturePicUi.url,this.refreshViewValue(),this.changFun())},g.prototype.drawInMeshUrl=function(){var a=this,d=this.md5meshPicUi.url;c.getInstance().load(b.fileRoot+d,c.XML_TYPE,function(b){var c=new left.LocalMd5MoveSprite;c.addLocalMeshByStr(b);var e=new left.MaterialRoleSprite;e.changeRoleWeb(c);var f=e.skinMesh.meshAry[0];f.materialUrl="base.material",f.md5meshurl=d,pack.PackMaterialManager.getInstance().getMaterialByUrl(f.materialUrl,function(b){b.shader=b.roleShader,f.material=b,a._skinMesh.meshAry.push(f),a.refreshViewValue()})})},g.prototype.destory=function(){this.textLabelUI.destory(),this.comboBoxUi.destory(),this.deleIcon.destory(),this.md5meshUrlText.destory(),this.md5meshPicUi.destory(),this.md5searchIcon.destory(),this.textureUrlText.destory(),this.texturePicUi.destory(),this.texturesearchIcon.destory(),this._materialTreeMc&&this._materialTreeMc.destory(),f.prototype.destory.call(this)},Object.defineProperty(g.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+0,this.comboBoxUi.x=this._x+75,this.deleIcon.x=this._x+150,this.md5meshUrlText.x=this._x+60,this.md5meshPicUi.x=this._x+60,this.md5searchIcon.x=this._x+150,this.texturePicUi.x=this._x+60,this.textureUrlText.x=this._x+60,this.texturesearchIcon.x=this._x+150},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y+4,this.comboBoxUi.y=this._y+6,this.deleIcon.y=this._y+6,this.md5meshUrlText.y=this._y+100,this.md5meshPicUi.y=this._y+35,this.md5searchIcon.y=this._y+40,this.texturePicUi.y=this._y+35+110,this.textureUrlText.y=this._y+105+110,this.texturesearchIcon.y=this._y+40+110},enumerable:!0,configurable:!0}),g.prototype.comboBoxUiDown=function(a){var b=this,c=new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_COMBOX_MENU);c.posv2d=new Vector2D(this.comboBoxUi.ui.absoluteX,this.comboBoxUi.ui.absoluteY+20);for(var d=[],f=0;f<this._skinMesh.meshAry.length;f++)d.push({name:"mesh_"+f,type:f});c.comboxData=d,c.comboxFun=function(a){b.selectFun(a)},e.dispatchEvent(c)},g.prototype.selectFun=function(a){this.selectMeshId=a,this.refreshViewValue()},Object.defineProperty(g.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),g.prototype.refreshViewValue=function(){if(this.FunKey){this._skinMesh=this.target[this.FunKey],this.textLabelUI.label="部分",this.comboBoxUi.text="mesh_"+this.selectMeshId,this.md5meshPicUi.url="icon/txt_64x.png";var a=this._skinMesh.meshAry[this.selectMeshId];a&&(this.md5meshUrlText.label=a.md5meshurl,this.texturePicUi.url=a.materialUrl,this.textureUrlText.label=a.materialUrl,this.textureTree=a.material,this.showMaterialParamUi())}},g.prototype.paramChange=function(a){var b=this._skinMesh.meshAry[this.selectMeshId];b&&(b.paramInfo=a),this.changFun(a)},g.prototype.showMaterialParamUi=function(){var b=this;this._materialTreeMc||(this._materialTreeMc=new a.MaterialParamUi(a.PropModel.getInstance().propPanle),this._materialTreeMc.changFun=function(a){b.paramChange(a)}),this._materialTreeMc.setData(this.makeTempInfo(this.textureTree)),this._materialTreeMc.y=this._y+240,this.height=240+this._materialTreeMc.height},g.prototype.getParamItem=function(a){var b=this._skinMesh.meshAry[this.selectMeshId];if(b)for(var c=0;b.paramInfo&&c<b.paramInfo.length;c++)if(b.paramInfo[c].paramName==a)return b.paramInfo[c].data;return null},g.prototype.makeTempInfo=function(a){for(var b=[],c=0;c<a.data.length;c++)if(a.data[c].data.isDynamic){var d;if(a.data[c].type==materialui.NodeTree.TEX&&(d={},d.data=a.data[c].data.url),a.data[c].type==materialui.NodeTree.VEC3&&(d={},d.data=a.data[c].data.constValue),a.data[c].type==materialui.NodeTree.FLOAT&&(d={},d.data=a.data[c].data.constValue),d){d.type=a.data[c].type,d.paramName=a.data[c].data.paramName;var e=this.getParamItem(d.paramName);e&&(d.data=e),b.push(d)}}return b},g}(a.BaseReflComponent);a.RoleMesh2DUI=f}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.InteractiveEvent,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.initView=function(){this.textLabelUI=new a.TextLabelUI(128,32),this.infoLabelUi=new a.TextLabelUI(256,32),this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.infoLabelUi),this.height=20},d.prototype.clikMouseUp=function(a){this.target.eventKey(this.clikEventInfo)},Object.defineProperty(d.prototype,"clikEvent",{set:function(a){a&&(this.clikEventInfo=a,this.infoLabelUi.ui.addEventListener(b.Up,this.clikMouseUp,this))},enumerable:!0,configurable:!0}),d.prototype.destory=function(){this.clikEventInfo&&this.infoLabelUi.ui.removeEventListener(b.Up,this.clikMouseUp,this),this.textLabelUI.destory(),this.infoLabelUi.destory()},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),d.prototype.refreshViewValue=function(){this.infoLabelUi.label=this.target[this.FunKey]},d.prototype.getNumStr=function(a){var b=Math.floor(100*a)/100;return b.toString()},Object.defineProperty(d.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+0,this.infoLabelUi.x=this._x+75},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y,this.infoLabelUi.y=this._y},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),d}(a.BaseReflComponent);a.TextField2DUI=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.InteractiveEvent,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.initView=function(){this.categoryBgUi=new a.BaseMeshUi,this.categoryIcon=new a.BaseMeshUi(16,16),this.categoryOpen=new a.BaseMeshUi(16,16),this.textLabelUI=new a.TextLabelUI,this.propPanle.addBaseMeshUi(this.categoryBgUi),this.propPanle.addBaseMeshUi(this.categoryIcon),this.propPanle.addBaseMeshUi(this.categoryOpen),this.propPanle.addBaseMeshUi(this.textLabelUI),this.height=25,this.categoryBgUi.ui.width=400,this.categoryBgUi.ui.height=this.height-2,this.drawOutColor(this.categoryBgUi.ui,new Vector3D(60,60,60)),this.drawUrlImgToUi(this.categoryIcon.ui,"icon/profeb_16.png"),this.categoryBgUi.ui.addEventListener(b.Up,this.clikMouseUp,this)},d.prototype.clikMouseUp=function(a){this.changFun(this.label),this.data=!this.data},d.prototype.resize=function(){this.categoryBgUi.ui.width=this.width},d.prototype.destory=function(){this.textLabelUI.destory(),this.categoryBgUi.destory(),this.categoryIcon.destory(),this.categoryOpen.destory()},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this._data?this.drawUrlImgToUi(this.categoryOpen.ui,"icon/icon_PanUp.png"):this.drawUrlImgToUi(this.categoryOpen.ui,"icon/icon_PanRight.png")},enumerable:!0,configurable:!0}),d.prototype.refreshViewValue=function(){},Object.defineProperty(d.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+50,this.categoryBgUi.x=0,this.categoryOpen.x=10,this.categoryIcon.x=40},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y+5,this.categoryBgUi.y=this._y,this.categoryIcon.y=this._y+5,this.categoryOpen.y=this._y+5},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),d}(a.BaseReflComponent);a.Category2DUI=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.InteractiveEvent,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.initView=function(){this.boxIcon=new a.BaseMeshUi(18,18),this.textLabelUI=new a.TextLabelUI,this.propPanle.addBaseMeshUi(this.boxIcon),this.propPanle.addBaseMeshUi(this.textLabelUI),this.height=25,this.boxIcon.ui.addEventListener(b.Up,this.clikMouseUp,this)},d.prototype.clikMouseUp=function(a){this.target[this.FunKey]=!this.target[this.FunKey],this.refreshViewValue()},d.prototype.destory=function(){this.boxIcon.ui.removeEventListener(b.Up,this.clikMouseUp,this),this.textLabelUI.destory(),this.boxIcon.destory()},d.prototype.refreshViewValue=function(){this.target[this.FunKey]?this.drawUrlImgToUi(this.boxIcon.ui,"icon/checkbox_down.png"):this.drawUrlImgToUi(this.boxIcon.ui,"icon/checkbox_up.png")},Object.defineProperty(d.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x,this.boxIcon.x=100},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y+5,this.boxIcon.y=this._y+2},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),d}(a.BaseReflComponent);a.CheckBox2DUI=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initView=function(){this.textLabelUI=new a.TextLabelUI,this.textX=new a.TextLabelUI(50,30),this.textY=new a.TextLabelUI(50,30),this.textX.label="X:",this.textY.label="Y:",this.inputTextUiX=new a.InputTextUi(100,30),this.inputTextUiY=new a.InputTextUi(100,30),this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.textX),this.propPanle.addBaseMeshUi(this.textY),this.propPanle.addBaseMeshUi(this.inputTextUiX),this.propPanle.addBaseMeshUi(this.inputTextUiY),this.inputTextUiX.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.inputTextUiXchange,this),this.inputTextUiY.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.inputTextUiYchange,this),this.height=30},c.prototype.destory=function(){this.textLabelUI.destory(),this.inputTextUiX.destory(),this.inputTextUiY.destory(),this.textX.destory(),this.textY.destory()},Object.defineProperty(c.prototype,"visible",{set:function(a){this.inputTextUiX.visible=a,this.inputTextUiY.visible=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this._v2d=this._data},enumerable:!0,configurable:!0}),c.prototype.inputTextUiXchange=function(a){this._v2d.x=Number(a.data),this.changeV3d()},c.prototype.inputTextUiYchange=function(a){this._v2d.y=Number(a.data),this.changeV3d()},c.prototype.changeV3d=function(){this.target[this.FunKey]=this._v2d,this.changFun&&this.changFun(this),this.refreshViewValue()},c.prototype.colorPickUIchange=function(a){var b=a.data;this.target[this.FunKey]=b,this.changFun&&this.changFun(this),this.refreshViewValue()},c.prototype.refreshViewValue=function(){this._v2d=this.target[this.FunKey],this.inputTextUiX.text=this.getNumStr(this._v2d.x),this.inputTextUiY.text=this.getNumStr(this._v2d.y)},c.prototype.getNumStr=function(a){var b=Math.floor(100*a)/100;return b.toString()},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x-0,this.textX.x=this._x+55,this.textY.x=this._x+125,this.inputTextUiX.x=this._x+85,this.inputTextUiY.x=this._x+155},enumerable:!0,configurable:!0}),c.prototype.resize=function(){b.prototype.resize.call(this),this.inputTextUiX.resize(),this.inputTextUiY.resize()},Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a+5,this.textLabelUI.y=this._y,this.textX.y=this._y,this.textY.y=this._y,this.inputTextUiX.y=this._y,this.inputTextUiY.y=this._y},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),c}(a.BaseReflComponent);a.Vec2PrameCtrlUI=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initView=function(){this.textLabelUI=new a.TextLabelUI,this.textX=new a.TextLabelUI(50,30),this.textY=new a.TextLabelUI(50,30),this.textZ=new a.TextLabelUI(50,30),this.textX.label="X:",this.textY.label="Y:",this.textZ.label="Z:",this.inputTextUiX=new a.InputTextUi(100,30),this.inputTextUiY=new a.InputTextUi(100,30),this.inputTextUiZ=new a.InputTextUi(100,30),this.propPanle.addBaseMeshUi(this.textLabelUI),this.propPanle.addBaseMeshUi(this.textX),this.propPanle.addBaseMeshUi(this.textY),this.propPanle.addBaseMeshUi(this.textZ),this.propPanle.addBaseMeshUi(this.inputTextUiX),this.propPanle.addBaseMeshUi(this.inputTextUiY),this.propPanle.addBaseMeshUi(this.inputTextUiZ),this.inputTextUiX.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.inputTextUiXchange,this),this.inputTextUiY.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.inputTextUiYchange,this),this.inputTextUiZ.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.inputTextUiZchange,this),this.height=30},c.prototype.destory=function(){this.textLabelUI.destory(),this.inputTextUiX.destory(),this.inputTextUiY.destory(),this.inputTextUiZ.destory(),this.textX.destory(),this.textY.destory(),this.textZ.destory()},Object.defineProperty(c.prototype,"visible",{set:function(a){this.inputTextUiX.visible=a,this.inputTextUiY.visible=a,this.inputTextUiZ.visible=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this._v3d=this._data},enumerable:!0,configurable:!0}),c.prototype.inputTextUiXchange=function(a){this._v3d.x=Number(a.data),this.changeV3d()},c.prototype.inputTextUiYchange=function(a){this._v3d.y=Number(a.data),this.changeV3d()},c.prototype.inputTextUiZchange=function(a){this._v3d.z=Number(a.data),this.changeV3d()},c.prototype.changeV3d=function(){this.target[this.FunKey]=this._v3d,this.changFun&&this.changFun(this),this.refreshViewValue()},c.prototype.colorPickUIchange=function(a){var b=a.data;this.target[this.FunKey]=b,this.changFun&&this.changFun(this),this.refreshViewValue()},c.prototype.refreshViewValue=function(){this._v3d=this.target[this.FunKey],this.inputTextUiX.text=this.getNumStr(this._v3d.x),this.inputTextUiY.text=this.getNumStr(this._v3d.y),this.inputTextUiZ.text=this.getNumStr(this._v3d.z)},c.prototype.getNumStr=function(a){var b=Math.floor(100*a)/100;return b.toString()},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x-0,this.textX.x=this._x+55,this.textY.x=this._x+125,this.textZ.x=this._x+195,this.inputTextUiX.x=this._x+85,this.inputTextUiY.x=this._x+155,this.inputTextUiZ.x=this._x+225},enumerable:!0,configurable:!0}),c.prototype.resize=function(){b.prototype.resize.call(this),this.inputTextUiX.resize(),this.inputTextUiY.resize(),this.inputTextUiZ.resize()},Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a+5,this.textLabelUI.y=this._y,this.textX.y=this._y,this.textY.y=this._y,this.textZ.y=this._y,this.inputTextUiX.y=this._y,this.inputTextUiY.y=this._y,this.inputTextUiZ.y=this._y},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),c}(a.BaseReflComponent);a.Vec3dCtrlUI=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),Object.defineProperty(c.prototype,"x",{set:function(a){this._x=a+10,this.textLabelUI.x=this._x-20,this.textX.x=this._x+55,this.textY.x=this._x+125,this.textZ.x=this._x+195,this.inputTextUiX.x=this._x+85,this.inputTextUiY.x=this._x+155,this.inputTextUiZ.x=this._x+225,this.colorPickUI.x=this._x+37},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{set:function(a){this._y=a+5,this.textLabelUI.y=this._y,this.textX.y=this._y,this.textY.y=this._y,this.textZ.y=this._y,this.inputTextUiX.y=this._y,this.inputTextUiY.y=this._y,this.inputTextUiZ.y=this._y,this.colorPickUI.y=this._y+2},enumerable:!0,configurable:!0}),c.prototype.refreshViewValue=function(){b.prototype.refreshViewValue.call(this),this.colorPickUI.vec3d=this._v3d},c.prototype.initView=function(){b.prototype.initView.call(this),this.colorPickUI=new a.ColorPickUI(12,12),this.colorPickUI.addEventListener(a.ReflectionEvet.CHANGE_DATA,this.colorPickUIchange,this),this.propPanle.addBaseMeshUi(this.colorPickUI)},c.prototype.destory=function(){b.prototype.destory.call(this),this.colorPickUI.destory()},c}(b);a.Vec3ColorCtrlUI=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.BaseEvent,c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.CHANGE_DATA="CHANGE_DATA",b}(b);a.ReflectionEvet=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.LabelTextFont,c=Pan3d.EventDispatcher,d=Pan3d.UIManager,e=Pan3d.TextAlign,f=Pan3d.UIRenderComponent,g=Pan3d.UIConatiner,h=Pan3d.UIAtlas,i=Pan3d.TextureManager,j=function(a){function b(b,c){var e=a.call(this)||this;e.tempUiName="tempui",e.uiViewScale=.5,b/=e.uiViewScale,c/=e.uiViewScale,e._bRender=new f,e.addRender(e._bRender),e._bRender.uiAtlas=new h;var g=e._bRender.uiAtlas;g.configData=[];var j=Math.pow(2,Math.ceil(Math.log(b)/Math.log(2))),k=Math.pow(2,Math.ceil(Math.log(c)/Math.log(2)));return e._bRender.uiAtlas.ctx=d.getInstance().getContext2D(j,k,!1),e._bRender.uiAtlas.textureRes=i.getInstance().getCanvasTexture(e._bRender.uiAtlas.ctx),g.configData.push(g.getObject(e.tempUiName,0,0,b,c,j,k)),e.ui=e._bRender.creatBaseComponent(e.tempUiName),e.ui.width=b*e.uiViewScale,e.ui.height=c*e.uiViewScale,e.addChild(e.ui),e}return __extends(b,a),b}(g);a.TextureContext=j;var k=function(a){function b(b,c){void 0===b&&(b=64),void 0===c&&(c=64);var d=a.call(this)||this;return d._x=0,d._y=0,d.textureContext=new j(b,c),d.ui=d.textureContext.ui,d}return __extends(b,a),Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0}),b.prototype.destory=function(){var a=this.textureContext.perent;a&&a.removeUIContainer(this.textureContext)},b.prototype.addEvets=function(){var a=this.ui;a.addEventListener(l.Down,this.butClik,this)},b.prototype.butClik=function(a){},b.prototype.resize=function(){this.ui.x=this._x,this.ui.y=this._y},Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.resize()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.resize()},enumerable:!0,configurable:!0}),b}(c);a.BaseMeshUi=k;var l=Pan3d.InteractiveEvent,m=function(a){function c(b,c){void 0===b&&(b=128),void 0===c&&(c=30);var d=a.call(this,b,c)||this;return d.initView(),d.resize(),d}return __extends(c,a),c.prototype.initView=function(){},Object.defineProperty(c.prototype,"label",{get:function(){return""},set:function(a){b.writeSingleLabel(this.ui.uiRender.uiAtlas,this.ui.skinName,a,26,e.LEFT,"#ffffff","#27262e",5)},enumerable:!0,configurable:!0}),c}(k);a.TextLabelUI=m}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.LabelTextFont,c=Pan3d.TextAlign,d=Pan3d.MouseType,e=function(e){function f(a,b){void 0===a&&(a=64),void 0===b&&(b=64);var c=e.call(this,a,b)||this;return c.onHtmlInputMouseDownFun=function(a){c.onHtmlInputMouseDown(a)},c}return __extends(f,e),f.prototype.onHtmlInputMouseDown=function(a){a.target!=this.chatHtmlInput&&(this.chatHtmlInput&&(this.chatHtmlInput.hidden=!0),document.removeEventListener(d.MouseDown,this.onHtmlInputMouseDownFun))},f.prototype.initView=function(){this.setInputTxtPos(),this.addEvets()},f.prototype.destory=function(){this.chatHtmlInput&&(document.body.removeChild(this.chatHtmlInput),this.chatHtmlInput=null),e.prototype.destory.call(this)},f.prototype.setInputTxtPos=function(){var a=this;this.chatHtmlInput||(this.chatHtmlInput=document.createElement("input"),this.chatHtmlInput.style.position="absolute",this.chatHtmlInput.style["z-index"]=100,this.chatHtmlInput.style.color="#000000",document.body.appendChild(this.chatHtmlInput),this.chatHtmlInput.addEventListener("change",function(b){a.changeInputTxt(b)})),this.chatHtmlInput.style.left="0px",this.chatHtmlInput.style.top="0px";var b=40,c=20;this.chatHtmlInput.style.fontSize=String(12)+"px",this.chatHtmlInput.style.width=String(b)+"px",this.chatHtmlInput.style.height=String(c)+"px",this.chatHtmlInput.value="99.99",this.chatHtmlInput.hidden=!0},f.prototype.changeInputTxt=function(b){var c=this.chatHtmlInput.value,d=new a.ReflectionEvet(a.ReflectionEvet.CHANGE_DATA);d.data=c,this.dispatchEvent(d)},f.prototype.resize=function(){e.prototype.resize.call(this),this.chatHtmlInput.style.left=this.textureContext.left+this.x-10+"px",this.chatHtmlInput.style.top=this.textureContext.top+this.y-5+"px"},Object.defineProperty(f.prototype,"visible",{set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"text",{set:function(a){b.writeSingleLabel(this.ui.uiRender.uiAtlas,this.ui.skinName,a,26,c.LEFT,"#ffffff","#27262e"),this.chatHtmlInput.value=a},enumerable:!0,configurable:!0}),f.prototype.butClik=function(a){var b=this;this.chatHtmlInput.hidden&&(this.chatHtmlInput.hidden=!1,setTimeout(function(){b.chatHtmlInput.focus()},1),document.addEventListener(d.MouseDown,this.onHtmlInputMouseDownFun))},f}(a.TextLabelUI);a.InputTextUi=e}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.TextureManager,c=Pan3d.TimeUtil,d=Pan3d.UIManager,e=Pan3d.Scene_data,f=function(f){function g(a,b){void 0===a&&(a=64),void 0===b&&(b=64);var c=f.call(this,a,b)||this;return c.$dulbelClikTm=0,c.haveDoubleCilk=!0,c.initView(),c.resize(),c}return __extends(g,f),g.prototype.initView=function(){this.addEvets()},g.prototype.addEvets=function(){f.prototype.addEvets.call(this);var a=this.ui;a.addEventListener(drag.PanDragEvent.DRAG_DROP,this.dragDrop,this),a.addEventListener(drag.PanDragEvent.DRAG_ENTER,this.dragEnter,this)},g.prototype.dragDrop=function(a){this.testSuffix(drag.DragManager.dragSource.url)?console.log("可以拖动"):console.log("不可以")},g.prototype.dragEnter=function(b){this.testSuffix(drag.DragManager.dragSource.url)&&(this.url=drag.DragManager.dragSource.url,this.dispatchEvent(new a.ReflectionEvet(a.ReflectionEvet.CHANGE_DATA)))},g.prototype.butClik=function(a){if(c.getTimer()<this.$dulbelClikTm)if(-1!=this._url.indexOf(".material")){var b=this._url;Pan3d.ModuleEventManager.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.SHOW_MATERIA_PANEL),b)}else this.haveDoubleCilk?(console.log("选文件"),this.doubleClick()):console.log("关闭了选取事件");this.$dulbelClikTm=c.getTimer()+1e3},g.prototype.doubleClick=function(){var a=this;this._inputHtmlSprite=document.createElement("input"),this._inputHtmlSprite.setAttribute("id","_ef"),this._inputHtmlSprite.setAttribute("type","file"),this._inputHtmlSprite.setAttribute("style","visibility:hidden"),this._inputHtmlSprite.click(),this._inputHtmlSprite.value,this._inputHtmlSprite.addEventListener("change",function(b){a.changeFile(b)})},g.prototype.testSuffix=function(a){if(this.suffix){for(var b=this.suffix.split("|"),c=0;c<b.length;c++)if(-1!=a.indexOf(b[c]))return!0;return!1}},g.prototype.changeFile=function(b){for(var c=0;c<this._inputHtmlSprite.files.length&&1>c;c++){var d=this._inputHtmlSprite.files[c];if(console.log(this.testSuffix(d.name)),this.testSuffix(d.name)){var e=new a.ReflectionEvet(a.ReflectionEvet.CHANGE_DATA);e.data=d,this.dispatchEvent(e)}else alert("请确保文件类型 "+this.suffix)}this._inputHtmlSprite=null},Object.defineProperty(g.prototype,"url",{get:function(){return this._url},set:function(a){this._url=a,this._url||(this._url="");var c=this._url;-1!=this._url.indexOf(".material")&&(c="icon/marterial_64x.png"),-1!=this._url.indexOf(".objs")&&(c="icon/objs_64x.png"),-1!=this._url.indexOf(".md5anim")&&(c="icon/txt_64x.png"),-1!=this._url.indexOf(".txt")&&(c="icon/txt_64x.png"),-1!=this._url.indexOf(".zzw")&&(c="icon/zzw_64x.png"),-1!=this._url.indexOf(".md5mesh")&&(c="icon/txt_64x.png");var f=b.getInstance().getImgResByurl(e.fileRoot+c),g=this.textureContext.ui.uiRender;if(f){var h=g.uiAtlas.getRec(this.textureContext.ui.skinName);g.uiAtlas.ctx=d.getInstance().getContext2D(h.pixelWitdh,h.pixelHeight,!1),g.uiAtlas.ctx.drawImage(f,0,0,h.pixelWitdh,h.pixelHeight),b.getInstance().updateTexture(g.uiAtlas.texture,h.pixelX,h.pixelY,g.uiAtlas.ctx)}else this.textureContext.ui.uiRender.uiAtlas.upDataPicToTexture(c,this.textureContext.ui.skinName)},enumerable:!0,configurable:!0}),g}(a.BaseMeshUi);a.TexturePicUi=f}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.InteractiveEvent,c=Pan3d.LabelTextFont,d=Pan3d.TextAlign,e=function(a){function e(b,c){return void 0===b&&(b=128),void 0===c&&(c=30),a.call(this,b,c)||this}return __extends(e,a),e.prototype.initView=function(){this.ui.addEventListener(b.Down,this.butClik,this)},e.prototype.destory=function(){this.ui.removeEventListener(b.Down,this.butClik,this),a.prototype.destory.call(this)},Object.defineProperty(e.prototype,"text",{set:function(a){c.writeSingleLabel(this.ui.uiRender.uiAtlas,this.ui.skinName,a,26,d.LEFT,"#ffffff","#27262e")},enumerable:!0,configurable:!0}),e.prototype.butClik=function(a){this.dispatchEvent(a)},e}(a.TextLabelUI);
a.ComboBoxUi=e}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.Vector3D,c=Pan3d.UIManager,d=Pan3d.TextureManager,e=Pan3d.ModuleEventManager,f=function(f){function g(a,b){return void 0===a&&(a=64),void 0===b&&(b=64),f.call(this,a,b)||this}return __extends(g,f),g.prototype.initView=function(){this.addEvets()},g.prototype.drawOutColor=function(){for(var a=new b(255*this._vec3d.x,255*this._vec3d.y,255*this._vec3d.z),e=this.ui.uiRender.uiAtlas,f=this.ui.skinName,g=e.getRec(f),h=c.getInstance().getContext2D(g.pixelWitdh,g.pixelHeight,!1),i=h.getImageData(0,0,g.pixelWitdh,g.pixelHeight),j=0;j<i.data.length/4;j++)i.data[4*j+0]=a.x,i.data[4*j+1]=a.y,i.data[4*j+2]=a.z,i.data[4*j+3]=255;h.putImageData(i,0,0),d.getInstance().updateTexture(e.texture,g.pixelX,g.pixelY,h)},Object.defineProperty(g.prototype,"vec3d",{get:function(){return this._vec3d},set:function(a){this._vec3d=a,this.drawOutColor()},enumerable:!0,configurable:!0}),g.prototype.butClik=function(a){var c=this,d=new colorview.ColorEvent(colorview.ColorEvent.SHOW_COLOR_PANEL);d.v3dColor=new b(255*this._vec3d.x,255*this._vec3d.y,255*this._vec3d.z),d.bfun=function(a){c.colorPickPanelFun(a)},e.dispatchEvent(d)},g.prototype.colorPickPanelFun=function(b){this._vec3d.x=b.x/255,this._vec3d.y=b.y/255,this._vec3d.z=b.z/255;var c=new a.ReflectionEvet(a.ReflectionEvet.CHANGE_DATA);c.data=this._vec3d,this.dispatchEvent(c),this.drawOutColor()},g}(a.TextLabelUI);a.ColorPickUI=f}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initView=function(){this.textLabelUI=new a.TextLabelUI,this.textFunNameUI=new a.TextLabelUI,this.height=20},c.prototype.destory=function(){this.textLabelUI.destory(),this.textFunNameUI.destory()},Object.defineProperty(c.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),c.prototype.onChangeInput=function(a){this.target[this.FunKey]=this.target[this.FunKey]+this.KeyStep*Number(a.data),this.refreshViewValue()},c.prototype.refreshViewValue=function(){var a=this.target[this.FunKey];this.textFunNameUI.label=a.nodeTree.funName},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.textLabelUI.x=this._x+0,this.textFunNameUI.x=this._x+75},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.textLabelUI.y=this._y,this.textFunNameUI.y=this._y},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"label",{get:function(){return this._label},set:function(a){this._label=a,this.textLabelUI.label=a},enumerable:!0,configurable:!0}),c}(a.BaseReflComponent);a.AgalFunUI=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.AgalFunUI,Label:"函数名:",FunKey:"constValue",target:this,Step:.01}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.mathFunNodeUI=this._data,this.refreshViewValue(),this.setInputTxtPos()},enumerable:!0,configurable:!0}),d.prototype.setInputTxtPos=function(){var a=this;this.chatHtmlInput||(this.chatHtmlInput=document.createElement("textarea"),this.chatHtmlInput.style.position="absolute",this.chatHtmlInput.style["z-index"]=100,this.chatHtmlInput.style.background="transparent",this.chatHtmlInput.style.color="#ffffff",document.body.appendChild(this.chatHtmlInput),this.chatHtmlInput.addEventListener("change",function(b){a.changeFile(b)})),this.chatHtmlInput.style.left="0px",this.chatHtmlInput.style.top="0px";var b=350,c=40;this.chatHtmlInput.style.fontSize=String(12)+"px",this.chatHtmlInput.style.width=String(b)+"px",this.chatHtmlInput.style.height=String(c)+"px",this.chatHtmlInput.value=this.mathFunNodeUI.nodeTree.funStr,this.resize()},d.prototype.changeFile=function(a){var b=this.chatHtmlInput.value;materialui.NodeTreeFun.isNeedChangePanel(b,this.mathFunNodeUI.nodeTree.funStr)?this.mathFunNodeUI.inPutFunStr(b):(this.mathFunNodeUI.nodeTree.funStr=b,this.changeData())},d.prototype.resize=function(){c.prototype.resize.call(this),this.chatHtmlInput&&(this.chatHtmlInput.style.top="0px")},d.prototype.destory=function(){var a=this;c.prototype.destory.call(this),this.chatHtmlInput&&(this.chatHtmlInput.removeEventListener("change",function(b){a.changeFile(b)}),document.body.removeChild(this.chatHtmlInput),this.chatHtmlInput=null)},Object.defineProperty(d.prototype,"constValue",{get:function(){return this.mathFunNodeUI},set:function(a){this.changeData()},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.MathFunMeshPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.NumberInput,Label:"值:",FunKey:"constValue",target:this,Step:.01,Category:"属性"}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.constFloatNodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"constValue",{get:function(){return this.constFloatNodeUI.constValue},set:function(a){this.constFloatNodeUI.constValue=a,this.changeData()},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.FloatPropMeshPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.Vec2,Label:"xy:",FunKey:"vec2data",target:this,Step:.1,Category:"属性"}];return b},Object.defineProperty(d.prototype,"vec2data",{get:function(){return this.constVec2NodeUI.constValue},set:function(a){this.constVec2NodeUI.constValue=a,this.changeData(),this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.constVec2NodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.Vec2PropMeshPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.Vec3Color,Label:"Vec3d:",FunKey:"constValue",target:this,Step:.1,Category:"属性"}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.constVec3NodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"constValue",{get:function(){return this.constVec3NodeUI.constValue},set:function(a){this.constVec3NodeUI.constValue=a,this.changeData()},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.Vec3PropMeshPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.NumberInput,Label:"时间间隔:",FunKey:"timeInterval",target:this,Step:.01,Category:"属性"},{Type:a.ReflectionData.NumberInput,Label:"数值比例:",FunKey:"numScale",target:this,Step:.01,Category:"属性"}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.timeNodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"timeInterval",{get:function(){return this.timeNodeUI.timeValue.x},set:function(a){this.timeNodeUI.timeValue.x=a,this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"numScale",{get:function(){return this.timeNodeUI.timeValue.y},set:function(a){this.timeNodeUI.timeValue.y=a,this.changeData()},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.NodeTimePropPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.NumberInput,Label:"coord_x:",FunKey:"coordinateX",target:this,Step:.01},{Type:a.ReflectionData.NumberInput,Label:"coord_y:",FunKey:"coordinateY",target:this,Step:.01},{Type:a.ReflectionData.NumberInput,Label:"speed_x:",FunKey:"speedX",target:this,Step:.01},{Type:a.ReflectionData.NumberInput,Label:"speed_y:",FunKey:"speedY",target:this,Step:.01}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.pannerNodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"coordinateX",{get:function(){return this.pannerNodeUI.coordinate.x},set:function(a){this.pannerNodeUI.coordinate.x=a,this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"coordinateY",{get:function(){return this.pannerNodeUI.coordinate.y},set:function(a){this.pannerNodeUI.coordinate.y=a,this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"speedX",{get:function(){return this.pannerNodeUI.speed.x},set:function(a){this.pannerNodeUI.speed.x=a,this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"speedY",{get:function(){return this.pannerNodeUI.speed.y},set:function(a){this.pannerNodeUI.speed.y=a,this.changeData()},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.PannerPropPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.Texturue2DUI,Label:"纹理:",FunKey:"picurl",target:this,Suffix:"jpg|png",Category:"属性"},{Type:a.ReflectionData.ComboBox,Label:"Wrap:",FunKey:"wrapValue",target:this,Data:[{name:"repeat",type:0},{name:"clamp",type:1}]},{Type:a.ReflectionData.ComboBox,Label:"Mipmap:",FunKey:"mipmapValue",target:this,Data:[{name:"no",type:0},{name:"mipnearest",type:1},{name:"miplinear",type:2}]},{Type:a.ReflectionData.ComboBox,Label:"filter:",FunKey:"filterValue",target:this,Data:[{name:"linear",type:0},{name:"nearest",type:1}]},{Type:a.ReflectionData.ComboBox,Label:"预乘:",FunKey:"permulValue",target:this,Data:[{name:"false",type:0},{name:"true",type:1}]}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.textureSampleNodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"picurl",{get:function(){return this.textureSampleNodeUI.nodeTree.url},set:function(a){this.textureSampleNodeUI.nodeTree.url=a,this.textureSampleNodeUI.drawPicBmp(),this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"constValue",{get:function(){return 1},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"wrapValue",{get:function(){return this.textureSampleNodeUI.nodeTree.wrap},set:function(a){this.textureSampleNodeUI.nodeTree.wrap=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"mipmapValue",{get:function(){return this.textureSampleNodeUI.nodeTree.mipmap},set:function(a){this.textureSampleNodeUI.nodeTree.mipmap=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"filterValue",{get:function(){return this.textureSampleNodeUI.nodeTree.filter},set:function(a){this.textureSampleNodeUI.nodeTree.filter=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"permulValue",{get:function(){return this.textureSampleNodeUI.nodeTree.permul?1:0},set:function(a){this.textureSampleNodeUI.nodeTree.permul=Boolean(a)},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.TexturePropMeshPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.Texturue2DUI,Label:"纹理:",FunKey:"picurl",target:this,Category:"属性"},{Type:a.ReflectionData.ComboBox,Label:"Wrap:",FunKey:"wrapValue",target:this,Data:[{name:"repeat",type:0},{name:"clamp",type:1}]},{Type:a.ReflectionData.ComboBox,Label:"Mipmap:",FunKey:"mipmapValue",target:this,Data:[{name:"no",type:0},{name:"mipnearest",type:1},{name:"miplinear",type:2}]},{Type:a.ReflectionData.ComboBox,Label:"filter:",FunKey:"filterValue",target:this,Data:[{name:"linear",type:0},{name:"nearest",type:1}]},{Type:a.ReflectionData.ComboBox,Label:"预乘:",FunKey:"permulValue",target:this,Data:[{name:"false",type:0},{name:"true",type:1}]}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.textureSampleNodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"picurl",{get:function(){return this.textureSampleNodeUI.nodeTree.url},set:function(a){this.textureSampleNodeUI.nodeTree.url=a,this.textureSampleNodeUI.drawPicBmp(),this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"constValue",{get:function(){return 1},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"wrapValue",{get:function(){return this.textureSampleNodeUI.nodeTree.wrap},set:function(a){this.textureSampleNodeUI.nodeTree.wrap=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"mipmapValue",{get:function(){return this.textureSampleNodeUI.nodeTree.mipmap},set:function(a){this.textureSampleNodeUI.nodeTree.mipmap=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"filterValue",{get:function(){return this.textureSampleNodeUI.nodeTree.filter},set:function(a){this.textureSampleNodeUI.nodeTree.filter=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"permulValue",{get:function(){return this.textureSampleNodeUI.nodeTree.permul?1:0},set:function(a){this.textureSampleNodeUI.nodeTree.permul=Boolean(a)},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.Texture3DMeshPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.ModuleEventManager,c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.getView=function(){var b=[{Type:a.ReflectionData.Texturue2DUI,Label:"纹理:",FunKey:"picurl",target:this,Category:"属性"},{Type:a.ReflectionData.ComboBox,Label:"Wrap:",FunKey:"wrapValue",target:this,Data:[{name:"repeat",type:0},{name:"clamp",type:1}]},{Type:a.ReflectionData.ComboBox,Label:"Mipmap:",FunKey:"mipmapValue",target:this,Data:[{name:"no",type:0},{name:"mipnearest",type:1},{name:"miplinear",type:2}]},{Type:a.ReflectionData.ComboBox,Label:"filter:",FunKey:"filterValue",target:this,Data:[{name:"linear",type:0},{name:"nearest",type:1}]},{Type:a.ReflectionData.ComboBox,Label:"预乘:",FunKey:"permulValue",target:this,Data:[{name:"false",type:0},{name:"true",type:1}]}];return b},Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.textureSampleNodeUI=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"picurl",{get:function(){return this.textureSampleNodeUI.nodeTree.url},set:function(a){this.textureSampleNodeUI.nodeTree.url=a,this.textureSampleNodeUI.drawPicBmp(),this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"constValue",{get:function(){return 1},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"wrapValue",{get:function(){return this.textureSampleNodeUI.nodeTree.wrap},set:function(a){this.textureSampleNodeUI.nodeTree.wrap=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"mipmapValue",{get:function(){return this.textureSampleNodeUI.nodeTree.mipmap},set:function(a){this.textureSampleNodeUI.nodeTree.mipmap=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"filterValue",{get:function(){return this.textureSampleNodeUI.nodeTree.filter},set:function(a){this.textureSampleNodeUI.nodeTree.filter=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"permulValue",{get:function(){return this.textureSampleNodeUI.nodeTree.permul?1:0},set:function(a){this.textureSampleNodeUI.nodeTree.permul=Boolean(a)},enumerable:!0,configurable:!0}),d.prototype.changeData=function(){b.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d}(a.MetaDataView);a.TextureCubeMeshPanel=c}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.InteractiveEvent,c=Pan3d.Scene_data,d=function(a){function d(){var b=a.call(this)||this;return b.layaPanel=new win.Panel,win.LayerManager.getInstance().addPanel(b.layaPanel,501),b.setRect(new Pan3d.Rectangle(100,100,500,400)),b}return __extends(d,a),d.prototype.loadConfigCom=function(){a.prototype.loadConfigCom.call(this),this.setUiListVisibleByItem([this.c_tittle_bg],!0),this.setUiListVisibleByItem([this.c_left_line],!0),this.setUiListVisibleByItem([this.c_right_line],!0),this.setUiListVisibleByItem([this.c_bottom_line],!0),this.setUiListVisibleByItem([this.c_win_bg],!1),this.setUiListVisibleByItem([this.b_win_close],!0),this.c_tittle_bg.addEventListener(b.Down,this.tittleMouseDown,this)},d.prototype.tittleMouseDown=function(a){switch(this.mouseMoveTaget=a.target,this.lastMousePos=new Vector2D(a.x,a.y),this.mouseMoveTaget){case this.c_tittle_bg:this.lastPagePos=new Vector2D(this.left,this.top);break;default:console.log("nonono")}c.uiStage.addEventListener(b.Move,this.mouseOnTittleMove,this),c.uiStage.addEventListener(b.Up,this.tittleMouseUp,this)},d.prototype.mouseOnTittleMove=function(a){switch(this.mouseMoveTaget){case this.c_tittle_bg:this.left=this.lastPagePos.x+(a.x-this.lastMousePos.x),this.top=this.lastPagePos.y+(a.y-this.lastMousePos.y),this.pageRect.x=this.left,this.pageRect.y=this.top}this.resize()},d.prototype.setInputTxtPos=function(){var a=this;this.chatHtmlInput||(this.chatHtmlInput=document.createElement("textarea"),this.chatHtmlInput.style.position="absolute",this.chatHtmlInput.style["z-index"]=100,this.chatHtmlInput.style.background="transparent",this.chatHtmlInput.style.color="#ffffff",document.body.appendChild(this.chatHtmlInput),this.chatHtmlInput.addEventListener("change",function(b){a.changeFile(b)}),this.chatHtmlInput.style.resize="none"),this.chatHtmlInput.style.left="0px",this.chatHtmlInput.style.top="0px";var b=350,c=40;this.chatHtmlInput.style.fontSize=String(12)+"px",this.chatHtmlInput.style.width=String(b)+"px",this.chatHtmlInput.style.height=String(c)+"px",this.chatHtmlInput.value=this.mathFunNodeUI.nodeTree.funStr,this.resize()},d.prototype.butClik=function(a){a.target==this.b_win_close&&this.hidePanel()},d.prototype.resize=function(){a.prototype.resize.call(this),this.chatHtmlInput&&(this.chatHtmlInput.style.left=this.left+5+"px",this.chatHtmlInput.style.top=this.top+25+"px",this.chatHtmlInput.style.width=this.pageRect.width-8+"px",this.chatHtmlInput.style.height=this.pageRect.height-30+"px")},d.prototype.changeInputResize=function(a){console.log(a)},d.prototype.changeFile=function(a){var b=this.chatHtmlInput.value;materialui.NodeTreeFun.isNeedChangePanel(b,this.mathFunNodeUI.nodeTree.funStr)?this.mathFunNodeUI.inPutFunStr(b):(this.mathFunNodeUI.nodeTree.funStr=b,this.changeData())},d.prototype.changeData=function(){Pan3d.ModuleEventManager.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},d.getInstance=function(){return this._instance||(this._instance=new d),this._instance},d.prototype.showPanel=function(a){this.mathFunNodeUI=a,this.layaPanel.addUIContainer(this),this.setInputTxtPos()},d.prototype.hidePanel=function(){var a=this;this.chatHtmlInput&&(this.chatHtmlInput.removeEventListener("change",function(b){a.changeFile(b)}),document.body.removeChild(this.chatHtmlInput),this.chatHtmlInput=null),this.layaPanel.removeUIContainer(this)},d}(win.BaseWindow);a.TextureFunPanel=d}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.Scene_data,c=Pan3d.Vector3D,d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.getView=function(){var b=[{Type:a.ReflectionData.Vec3Color,Label:"环境颜色:",FunKey:"sunDirect",target:this,Step:.1},{Type:a.ReflectionData.Vec3Color,Label:"sun颜色:",FunKey:"sunColor",target:this,Step:.1},{Type:a.ReflectionData.Vec3Color,Label:"基本颜色:",FunKey:"ambientColor",target:this,Step:.1}];return b},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sunDirect",{get:function(){return new c(b.light.sunDirect[0],b.light.sunDirect[1],b.light.sunDirect[2])},set:function(a){b.light.sunDirect[0]=a.x,b.light.sunDirect[1]=a.y,b.light.sunDirect[2]=a.z},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sunColor",{get:function(){return new c(b.light.sunColor[0],b.light.sunColor[1],b.light.sunColor[2])},set:function(a){b.light.sunColor[0]=a.x,b.light.sunColor[1]=a.y,b.light.sunColor[2]=a.z},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambientColor",{get:function(){return new c(b.light.ambientColor[0],b.light.ambientColor[1],b.light.ambientColor[2])},set:function(a){b.light.ambientColor[0]=a.x,b.light.ambientColor[1]=a.y,b.light.ambientColor[2]=a.z},enumerable:!0,configurable:!0}),e}(a.MetaDataView);a.SciencePropMeshPanel=d}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=Pan3d.Scene_data,c=Pan3d.Vector3D,d=Pan3d.ModuleEventManager,e=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),f.prototype.getView=function(){var b=[{Type:a.ReflectionData.ComboBox,Label:"直接光照:",FunKey:"directLight",target:this,Data:[{name:"false",type:0},{name:"true",type:1}]},{Type:a.ReflectionData.Vec3Color,Label:"环境颜色:",FunKey:"sunDirect",target:this,Step:.1},{Type:a.ReflectionData.Vec3Color,Label:"sun颜色:",FunKey:"sunColor",target:this,Step:.1},{Type:a.ReflectionData.Vec3Color,Label:"基本颜色:",FunKey:"ambientColor",target:this,Step:.1}];return b},Object.defineProperty(f.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.resultNodeUI=a,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"directLight",{get:function(){return console.log("this.resultNodeUI.directLight",this.resultNodeUI.directLight),this.resultNodeUI.directLight?1:0},set:function(a){this.resultNodeUI.directLight=1==a?!0:!1,this.changeData()},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"sunDirect",{get:function(){return new c(b.light.sunDirect[0],b.light.sunDirect[1],b.light.sunDirect[2])},set:function(a){b.light.sunDirect[0]=a.x,b.light.sunDirect[1]=a.y,b.light.sunDirect[2]=a.z},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"sunColor",{get:function(){return new c(b.light.sunColor[0],b.light.sunColor[1],b.light.sunColor[2])},set:function(a){b.light.sunColor[0]=a.x,b.light.sunColor[1]=a.y,b.light.sunColor[2]=a.z},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"ambientColor",{get:function(){return new c(b.light.ambientColor[0],b.light.ambientColor[1],b.light.ambientColor[2])},set:function(a){b.light.ambientColor[0]=a.x,b.light.ambientColor[1]=a.y,b.light.ambientColor[2]=a.z},enumerable:!0,configurable:!0}),f.prototype.changeData=function(){d.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.COMPILE_MATERIAL))},f}(a.MetaDataView);a.OpPropMeshPanel=e}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),prop;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.metaViewItem=[],b}return __extends(b,a),b.prototype.resize=function(){a.prototype.resize.call(this),this.perent&&(this.rect=this.perent.rect);for(var b=0;b<this._containerList.length;b++)this._containerList[b].left=this.rect.x+2,this._containerList[b].top=this.rect.y+12;for(var b=0;b<this.metaViewItem.length;b++)this.metaViewItem[b].top=this.rect.y+this.metaViewItem[b].y,this.metaViewItem[b].width=this.rect.width-5,this.metaViewItem[b].resize()},b.prototype.onAdd=function(){for(var a=0;a<this.metaViewItem.length;a++)this.metaViewItem[a].onAdd()},b.prototype.onRemove=function(){for(var a=0;a<this.metaViewItem.length;a++)this.metaViewItem[a].onRemove()},b.prototype.addBaseMeshUi=function(a){this.addUIContainer(a.textureContext),this.resize()},b.prototype.addMeshView=function(a){this.metaViewItem.push(a)},b}(win.Sprite);a.UiMeshSprite=b}(prop||(prop={}));var prop;!function(a){var b=function(){function b(){this.propPanle=new a.UiMeshSprite,this.propPanle.x=500,this.propPanle.y=100,AppData.rightPanel.addChild(this.propPanle)}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.resize=function(){this.metaDataView&&(this.metaDataView.width=Pan3d.Scene_data.stageWidth-this.propPanle.x)},b.prototype.hidePanel=function(){this.metaDataView&&(this.metaDataView.destory(),this.metaDataView=null),this.lastNodel=null},b.prototype.showPanel=function(b){if(this.lastNodel!=b){this.clearOladMeshView();var c=a.PropModel.getInstance().propPanle;b instanceof materialui.ConstVec3NodeUI?this.metaDataView=new a.Vec3PropMeshPanel(c):b instanceof materialui.ConstVec2NodeUI?this.metaDataView=new a.Vec2PropMeshPanel(c):b instanceof materialui.ConstFloatNodeUI?this.metaDataView=new a.FloatPropMeshPanel(c):b instanceof materialui.TimeNodeUI?this.metaDataView=new a.NodeTimePropPanel(c):b instanceof materialui.PannerNodeUI?this.metaDataView=new a.PannerPropPanel(c):b instanceof materialui.TextureSampleNodeUI?this.metaDataView=new a.TexturePropMeshPanel(c):b instanceof materialui.Texture3DNodeUI?this.metaDataView=new a.Texture3DMeshPanel(c):b instanceof materialui.TextureCubeNodeUI?this.metaDataView=new a.TextureCubeMeshPanel(c):b instanceof materialui.ResultNodeUI?this.metaDataView=new a.OpPropMeshPanel(c):b instanceof materialui.MathFunNodeUI?this.metaDataView=new a.MathFunMeshPanel(c):this.showSciencePropPanel(),
this.lastNodel=b,this.metaDataView.data=b,this.metaDataView.top=25,this.resize()}},b.prototype.clearOladMeshView=function(){this.metaDataView&&(this.metaDataView.destory(),this.metaDataView=null,this.lastNodel=null)},b.prototype.showOtherMeshView=function(a){this.metaDataView!=a&&this.clearOladMeshView(),this.metaDataView=a,this.metaDataView.top=25,this.metaDataView.refreshViewValue(),this.resize();var b=AppData.rightPanel;b.mainRightBaseWin.pushViewToTab(a)},b.prototype.showSciencePropPanel=function(){this.showOtherMeshView(new a.SciencePropMeshPanel(a.PropModel.getInstance().propPanle))},b}();a.PropModel=b}(prop||(prop={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),filelist;!function(a){var b=prop.MetaDataView,c=prop.ReflectionData,d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getView=function(){var a=this,b=[{Type:c.TEXT,Label:"名字:",FunKey:"prebaburl",target:this,Category:"模型",ClikEventKey:"clikFilePrefab"},{Type:c.MeshScene2DUI,Label:"窗口:",FunKey:"prebaburl",target:this,Category:"模型"},{Type:c.Texturue2DUI,Label:"Objs:",FunKey:"objsurl",target:this,Suffix:"objs",Category:"网格"},{Type:c.MaterialPicUi,Label:"纹理:",FunKey:"texture",changFun:function(b){a.textureChangeInfo(b)},target:this,Suffix:"material",Category:"材质"}];return b},b.prototype.eventKey=function(a){switch(a){case"clikFilePrefab":var b=Pan3d.Scene_data.fileRoot+this.prefabStaticMesh.url;Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_DIS_ALL_FILE),b.replace(Pan3d.Scene_data.ossRoot,""));break;default:console.log("没有对象",a)}},b.prototype.textureChangeInfo=function(a){this.prefabStaticMesh.paramInfo=a,this.saveToSever(),this.chuangeData()},b.prototype.chuangeData=function(){this.prefabStaticMesh.dispatchEvent(new Pan3d.BaseEvent(Pan3d.BaseEvent.COMPLETE))},b.prototype.getParamItem=function(a){for(var b=0;this.prefabStaticMesh.paramInfo&&b<this.prefabStaticMesh.paramInfo.length;b++)if(this.prefabStaticMesh.paramInfo[b].paramName==a)return this.prefabStaticMesh.paramInfo[b].data;return null},Object.defineProperty(b.prototype,"prebaburl",{get:function(){return this.prefabStaticMesh.url},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"texture",{get:function(){return this.prefabStaticMesh.material},set:function(a){this.prefabStaticMesh.material=a,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"objsurl",{get:function(){return this.prefabStaticMesh.objsurl},set:function(a){this.prefabStaticMesh.objsurl=a,this.saveToSever(),this.chuangeData()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.prefabStaticMesh=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),b.prototype.saveToSever=function(){var a=this;if(this.lastTm=Pan3d.TimeUtil.getTimer(),this.isSaveNow)console.log("正在处理保存");else{this.isSaveNow=!0,this.saveTm=this.lastTm;var b=new Pan3d.Pan3dByteArray,c=Pan3d.Scene_data.fileRoot+this.prefabStaticMesh.url;console.log(this.prefabStaticMesh.material),this.prefabStaticMesh.textureurl=this.prefabStaticMesh.material.url;var d=this.prefabStaticMesh.getObject();d.version=pack.FileOssModel.version,b.writeUTF(JSON.stringify(d));var e=new File([b.buffer],"cc.prefab"),f=c.replace(Pan3d.Scene_data.ossRoot,"");pack.FileOssModel.upOssFile(e,f,function(){a.lastTm!=a.saveTm?(console.log("不是最后一次，所以需要再存一次"),Pan3d.TimeUtil.addTimeOut(1e3,function(){a.isSaveNow=!1,a.saveToSever()})):(a.isSaveNow=!1,console.log("更新Prafab完成",f+e.name))})}},b}(b);a.PrefabMeshView=d}(filelist||(filelist={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),filelist;!function(a){var b=prop.MetaDataView,c=prop.ReflectionData,d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getView=function(){var a=this,b=[{Type:c.TEXT,Label:"名字:",FunKey:"roleurl",target:this,Category:"角色",ClikEventKey:"clikFileRole"},{Type:c.MeshScene2DUI,Label:"窗口:",FunKey:"roleurl",target:this,Category:"角色"},{Type:c.RoleAnim2DUI,Label:"动作:",FunKey:"animDic",changFun:function(){a.animChange()},target:this,Suffix:"md5mesh",Category:"action"},{Type:c.RoleMesh2DUI,Label:"mesh:",FunKey:"skinMesh",changFun:function(b){a.textureChangeInfo(b)},target:this,Suffix:"md5mesh",Category:"mesh"}];return b},b.prototype.eventKey=function(a){switch(a){case"clikFileRole":var b=Pan3d.Scene_data.fileRoot+this._roleStaticMesh.url;Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_DIS_ALL_FILE),b.replace(Pan3d.Scene_data.ossRoot,""));break;default:console.log("没有对象",a)}},b.prototype.animChange=function(){this.saveToSever(),this.chuangeData()},Object.defineProperty(b.prototype,"animDic",{get:function(){return this._roleStaticMesh.animDic},set:function(a){this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"skinMesh",{get:function(){return this._roleStaticMesh.skinMesh},set:function(a){this.refreshViewValue()},enumerable:!0,configurable:!0}),b.prototype.textureChangeInfo=function(a){this.saveToSever(),this.chuangeData()},b.prototype.chuangeData=function(){this._roleStaticMesh.dispatchEvent(new Pan3d.BaseEvent(Pan3d.BaseEvent.COMPLETE))},Object.defineProperty(b.prototype,"roleurl",{get:function(){return this._roleStaticMesh?this._roleStaticMesh.url:null},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"texture",{get:function(){return this._roleStaticMesh.material},set:function(a){this._roleStaticMesh.material=a,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this._roleStaticMesh=this._data,this.refreshViewValue()},enumerable:!0,configurable:!0}),b.prototype.getChangeRoleStr=function(){if(this._roleStaticMesh.skinMesh){var a=this._roleStaticMesh.getObject();a.version=pack.FileOssModel.version;var b=JSON.stringify(a);return b}return null},b.prototype.saveToSever=function(){var a=this;if(this.lastTm=Pan3d.TimeUtil.getTimer(),this.isSaveNow)console.log("正在处理保存");else{this.isSaveNow=!0,this.saveTm=this.lastTm;var b=this.getChangeRoleStr(),c=new File([b],"ossfile.txt"),d=Pan3d.Scene_data.fileRoot+this._roleStaticMesh.url,e=d.replace(Pan3d.Scene_data.ossRoot,"");console.log("提交上传ing...",e),pack.FileOssModel.upOssFile(c,e,function(){a.lastTm!=a.saveTm?(console.log("不是最后一次，所以需要再存一次"),Pan3d.TimeUtil.addTimeOut(1e3,function(){a.isSaveNow=!1,a.saveToSever()})):(a.isSaveNow=!1,console.log("更新角色完成",e+c.name))})}},b}(b);a.RoleMeshView=d}(filelist||(filelist={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),filelist;!function(a){var b=Pan3d.Scene_data,c=prop.MetaDataView,d=prop.ReflectionData,e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.getView=function(){var a=[{Type:d.TEXT,Label:"名字:",FunKey:"filename",target:this,Category:"角色",ClikEventKey:"clikFileSkill"},{Type:d.MeshScene2DUI,Label:"窗口:",FunKey:"skillmeshUrl",target:this,Category:"角色"},{Type:d.Texturue2DUI,Label:"角色:",FunKey:"roleurl",Suffix:"zzw",target:this,Category:"属性"},{Type:d.Texturue2DUI,Label:"技能:",FunKey:"skillurl",Suffix:"txt",target:this,Category:"属性"},{Type:d.ComboBox,Label:"播放名字:",FunKey:"actionname",target:this,Data:[],Category:"属性"},{Type:d.NumberInput,Label:"播放间隔:",FunKey:"intervalTm",target:this,Category:"属性"}];return a},Object.defineProperty(c.prototype,"skillmeshUrl",{get:function(){return this._skillStaticMesh.url},set:function(a){},enumerable:!0,configurable:!0}),c.prototype.eventKey=function(a){switch(a){case"clikFileSkill":var b=Pan3d.Scene_data.fileRoot+this.skillmeshUrl;Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_DIS_ALL_FILE),b.replace(Pan3d.Scene_data.ossRoot,""));break;default:console.log("没有对象",a)}},Object.defineProperty(c.prototype,"intervalTm",{get:function(){return this._skillStaticMesh.interval},set:function(a){this._skillStaticMesh.interval=a,this.saveToSever(),this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actionname",{get:function(){return this._skillStaticMesh.actionnum},set:function(a){this._skillStaticMesh.actionnum=a,this.saveToSever(),this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"filename",{get:function(){return this._skillStaticMesh.url},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"roleurl",{get:function(){return this._skillStaticMesh.roleUrl},set:function(a){this._skillStaticMesh.roleUrl=a,this.saveToSever(),this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skillurl",{get:function(){return this._skillStaticMesh.skillUrl},set:function(a){this._skillStaticMesh.skillUrl=a,this.saveToSever(),this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this._skillStaticMesh=a,this.refreshViewValue(),this.mashSkillActionInfo()},enumerable:!0,configurable:!0}),c.prototype.mashSkillActionInfo=function(){var a=this;Pan3d.ResManager.getInstance().loadSkillRes(b.fileRoot+this._skillStaticMesh.skillUrl,function(b){for(var c=0;c<a.ui.length;c++){var d=a.ui[c];if(d instanceof prop.ComBoBoxCtrl2D){var e=[];for(var f in b.data)e.push({name:f,type:e.length});e.push({name:"循环播放",type:e.length}),d.data=e,d.refreshViewValue()}}})},c.prototype.categoryClikUp=function(b){a.prototype.categoryClikUp.call(this,b),this.mashSkillActionInfo()},c.prototype.saveToSever=function(){var a=this;if(this.lastTm=Pan3d.TimeUtil.getTimer(),this.isSaveNow)console.log("正在处理保存");else{this.isSaveNow=!0,this.saveTm=this.lastTm;var b=this._skillStaticMesh.getObject();b.version=pack.FileOssModel.version;var c=JSON.stringify(b),d=new File([c],"ossfile.txt"),e=Pan3d.Scene_data.fileRoot+this._skillStaticMesh.url,f=e.replace(Pan3d.Scene_data.ossRoot,"");console.log("提交上传ing...",f),pack.FileOssModel.upOssFile(d,f,function(){a.lastTm!=a.saveTm?(console.log("不是最后一次，所以需要再存一次"),Pan3d.TimeUtil.addTimeOut(1e3,function(){a.isSaveNow=!1,a.saveToSever()})):(a.isSaveNow=!1,console.log("更新角色完成",f+d.name))})}},c}(c);a.SkillMeshView=e}(filelist||(filelist={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),basefolderwin;!function(a){var b=Pan3d.InteractiveEvent,c=Pan3d.Vector2D,d=Pan3d.Scene_data,e=function(a){function e(){var b=a.call(this)||this;return b.percentNum=.2,b}return __extends(e,a),e.prototype.setRect=function(a){this.pageRect=a,this.setLinePos(),this.resize(),this.refrishWinSize()},e.prototype.resize=function(){a.prototype.resize.call(this),this.uiLoadComplete&&this.pathUrlBg&&(this.pathUrlBg.x=this.pageRect.width*this.percentNum+3,this.pathUrlBg.y=11,this.pathUrlBg.height=28,this.pathUrlBg.width=this.pageRect.width-this.pathUrlBg.x,this._baseMidRender.applyObjData())},e.prototype.getPageRect=function(){return this.pageRect},e.prototype.setLinePos=function(){this.moveLine&&(this.moveLine.x=this.pageRect.width*this.percentNum,this.moveLine.y=13,this.moveLine.width=5,this.moveLine.height=this.pageRect.height)},e.prototype.loadConfigCom=function(){a.prototype.loadConfigCom.call(this),this.setUiListVisibleByItem([this.c_tittle_bg,this.c_win_bg],!1),this.setUiListVisibleByItem([this.e_panel_1],!0),this.pathUrlBg=this.addChild(this._baseMidRender.getComponent("e_file_list_path_bg")),this.moveLine=this.addChild(this._baseMidRender.getComponent("e_line_vertical")),this.moveLine.addEventListener(b.Down,this.tittleMouseDown,this),this.setLinePos(),this.resize()},e.prototype.tittleMouseDown=function(a){switch(this.mouseMoveTaget=a.target,this.lastMousePos=new c(a.x,a.y),this.mouseMoveTaget){case this.moveLine:this.lastPagePos=new c(this.moveLine.x,this.moveLine.y);break;default:console.log("nonono")}d.uiStage.addEventListener(b.Move,this.mouseOnTittleMove,this),d.uiStage.addEventListener(b.Up,this.tittleMouseUp,this)},e.prototype.refrishWinSize=function(){Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.RESET_FOLDE_WIN_SIZE))},e.prototype.mouseOnTittleMove=function(a){switch(this.mouseMoveTaget){case this.moveLine:this.moveLine.x=this.lastPagePos.x+(a.x-this.lastMousePos.x),this.moveLine.x=Math.min(this.moveLine.x,.6*this.pageRect.width),this.moveLine.x=Math.max(this.moveLine.x,.2*this.pageRect.width),this.percentNum=this.moveLine.x/this.pageRect.width,this.refrishWinSize();default:console.log("nonono")}this.resize()},e}(win.BaseWindow);a.BaseFolderWindow=e}(basefolderwin||(basefolderwin={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ossfolder;!function(a){var b=Pan3d.UIRenderComponent,c=Pan3d.InteractiveEvent,d=Pan3d.TextAlign,e=Pan3d.Rectangle,f=Pan3d.UIManager,g=Pan3d.LabelTextFont,h=Pan3d.Disp2DBaseText,i=Pan3d.MouseType,j=Pan3d.Vector3D,k=Pan3d.Scene_data,l=Pan3d.TextureManager,m=function(){function a(){}return a}();a.OssListFile=m;var n=function(a){function b(){return a.call(this)||this}return __extends(b,a),Object.defineProperty(b.prototype,"name",{set:function(a){this.needDraw=!0},enumerable:!0,configurable:!0}),b.prototype.destory=function(){this.pos=null,this.needDraw=null,this.clear=!0},b}(Pan3d.baseMeshVo);a.FolderMeshVo=n;var o=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.makeData=function(){if(this.folderMeshVo=this.rightTabInfoVo,this.folderMeshVo){var a=this.parent.uiAtlas.getRec(this.textureStr);this.parent.uiAtlas.ctx=f.getInstance().getContext2D(a.pixelWitdh,a.pixelHeight,!1),this.parent.uiAtlas.ctx.clearRect(0,1,a.pixelWitdh,a.pixelHeight),g.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,"[9c9c9c]"+this.folderMeshVo.ossListFile.baseFile.name,18,50,5,d.LEFT),this.folderMeshVo.ossListFile.isOpen?(this.parent.uiAtlas.ctx.drawImage(p.imgBaseDic.icon_PanRight,2,7,14,14),this.parent.uiAtlas.ctx.drawImage(p.imgBaseDic.icon_FolderOpen_dark,20,2,25.2,22.4)):(this.parent.uiAtlas.ctx.drawImage(p.imgBaseDic.icon_PanUp,3,7,14,14),this.parent.uiAtlas.ctx.drawImage(p.imgBaseDic.icon_FolderClosed_dark,20,2,25.2,22.4)),l.getInstance().updateTexture(this.parent.uiAtlas.texture,a.pixelX,a.pixelY,this.parent.uiAtlas.ctx)}},b.prototype.update=function(){this.folderMeshVo=this.rightTabInfoVo,this.folderMeshVo&&(this.folderMeshVo.needDraw&&(this.makeData(),this.folderMeshVo.needDraw=!1),this.folderMeshVo.pos&&(this.ui.x=this.folderMeshVo.pos.x,this.ui.y=this.folderMeshVo.pos.y,this.ui.width=this.ui.baseRec.width*this.folderMeshVo.uiScale,this.ui.height=this.ui.baseRec.height*this.folderMeshVo.uiScale),this.folderMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null))},b}(h);a.FolderName=o;var p=function(a){function d(){var b=a.call(this,o,new e(0,0,256,22),5)||this;return b.folderCellHeight=20,b.left=0,b.pageRect=new e(0,0,200,200),b}return __extends(d,a),d.prototype.loadConfigCom=function(){var b=this;a.prototype.loadConfigCom.call(this),this._baseRender.mask=this._uiMask,this.loadAssetImg(function(){b.makeItemUiList(),Pan3d.TimeUtil.addFrameTick(function(a){b.update(a)})}),this.onMouseWheelFun||(this.onMouseWheelFun=function(a){b.onMouseWheel(a)}),document.addEventListener(i.MouseWheel,this.onMouseWheelFun)},d.prototype.loadAssetImg=function(a){d.imgBaseDic={};var b=[];b.push("icon_FolderClosed_dark"),b.push("icon_FolderOpen_dark"),b.push("icon_PanRight"),b.push("icon_PanUp");for(var c=0,e=0;e<b.length;e++)this.loadTempOne(b[e],function(){c++,c>=b.length&&a()})},d.prototype.resize=function(){if(a.prototype.resize.call(this),this.uiLoadComplete){var b=this.contentHeight>this._uiMask.height;this.setUiListVisibleByItem([this.c_scroll_bar_bg],b),b&&(this._uiMask.width-=this.c_scroll_bar_bg.width)}},d.prototype.loadTempOne=function(a,b){var c=makeImage();d.imgBaseDic[a]=c,c.onload=function(){b()},c.url=k.fileuiRoot+"ui/folder/pic/"+a+".png",c.src=k.fileuiRoot+"ui/folder/pic/"+a+".png"},d.prototype.update=function(b){a.prototype.update.call(this,b)},d.prototype.fileOssFolderDic=function(a){this.fileAndOpenDicByUrl(a,this.fileItem)},d.prototype.fileAndOpenDicByUrl=function(a,b){for(var c=this,d=0;b&&d<b.length;d++){var e=b[d];-1!=a.indexOf(e.ossListFile.baseFile.path)&&(console.log("找到文件目录",e.ossListFile.baseFile.path),e.ossListFile.isOpen?this.fileAndOpenDicByUrl(a,e.childItem):(e.ossListFile.isOpen=!0,e.childItem?(this.resetHideDic(e.childItem),this.refrishFolder(),this.fileAndOpenDicByUrl(a,e.childItem)):this.pushChidrenDic(e,function(){c.refrishFolder(),c.fileAndOpenDicByUrl(a,e.childItem)})))}},d.prototype.itemMouseUp=function(a){if(this.c_scroll_bar_bg.parent&&a.x>this.c_scroll_bar_bg.x)return void console.log("在外面---");for(var b=0;b<this._uiItem.length;b++){var c=this._uiItem[b];c.ui==a.target&&(a.x-this.left-c.ui.x<20?(c.folderMeshVo.ossListFile.isOpen=!c.folderMeshVo.ossListFile.isOpen,c.folderMeshVo.ossListFile.isOpen?this.pushChidrenDic(c.folderMeshVo):this.clearChildern(c.folderMeshVo)):(c.folderMeshVo.ossListFile.isOpen||this.pushChidrenDic(c.folderMeshVo),c.folderMeshVo.ossListFile.isOpen=!0,Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_DIS_ALL_FILE),c.folderMeshVo.ossListFile.baseFile.path)),c.folderMeshVo.needDraw=!0)}this.refrishFolder()},d.prototype.resetHideDic=function(a){for(var b=0;a&&b<a.length;b++)a[b].clear=!1,a[b].pos=new j,this.showTemp(a[b]),this.resetHideDic(a[b].childItem)},d.prototype.pushChidrenDic=function(a,b){var c=this;if(a.childItem)console.log("已经有了，直接显示就行"),this.resetHideDic(a.childItem);else{var d=a.ossListFile.baseFile.path;pack.FileOssModel.getFolderArr(d,function(d){if(a.childItem)console.log("已获取过，注意可能是网络问题");else{a.childItem=[];for(var e=0;d&&e<d.length;e++)if(d[e].isFolder){var f=c.getCharNameMeshVo(d[e]);f.pos=new j(0,15*e,0),a.childItem.push(f)}c.refrishFolder(),b&&b()}})}},d.prototype.clearChildern=function(a){if(a.childItem)for(var b=0;b<a.childItem.length;b++){var c=a.childItem[b];c.destory(),this.clearChildern(c)}},d.prototype.makeItemUiList=function(){var a=this;this.fileItem=[];for(var b=0;b<this._uiItem.length;b++);var c=Pan3d.Scene_data.fileRoot.replace(Pan3d.Scene_data.ossRoot,"");pack.FileOssModel.getFolderArr(c,function(b){for(var c=0;c<b.length;c++)if(b[c].isFolder){var d=a.getCharNameMeshVo(b[c]);d.pos=new j(0,15*c,0),a.fileItem.push(d)}a.refrishFolder()})},d.prototype.getCharNameMeshVo=function(a){var b=new n;b.ossListFile=new m,b.ossListFile.baseFile=a;var d=this.showTemp(b);return d.ui.removeEventListener(c.Up,this.itemMouseUp,this),d.ui.addEventListener(c.Up,this.itemMouseUp,this),b},d.prototype.makeOtherRender=function(){var a=new b;return console.log("添加新对象"),a.mask=this._uiMask,a},d.prototype.refrishFolder=function(){d.listTy=this.moveListTy;var a=d.listTy;this.disChiendren(this.fileItem,10);var b=0;this.moveAllTy(this.fileItem,b),this.contentHeight=d.listTy-a,this.resize()},Object.defineProperty(d.prototype,"isCanToDo",{get:function(){return this&&this.hasStage?!0:!1},enumerable:!0,configurable:!0}),d.prototype.onMouseWheel=function(a){this.isCanToDo&&this.pageRect.isHitByPoint(a.x,a.y)&&this.contentHeight>this._uiMask.height&&(this.c_scroll_bar.y+=a.deltaY/30,this.changeScrollBar(),this.resize())},d.prototype.changeScrollBar=function(){a.prototype.changeScrollBar.call(this),this.refrishFolder()},d.prototype.moveAllTy=function(a,b){void 0===b&&(b=0);for(var c=0;a&&c<a.length;c++)a[c].pos.y+=b,a[c].ossListFile.isOpen&&this.moveAllTy(a[c].childItem,b)},d.prototype.disChiendren=function(a,b){void 0===b&&(b=0);for(var c=0;a&&c<a.length;c++)a[c].pos.x=b,a[c].pos.y=d.listTy,a[c].uiScale=.7,d.listTy+=20,a[c].ossListFile.isOpen&&this.disChiendren(a[c].childItem,b+20)},d.listTy=0,d}(win.Dis2dBaseWindow);a.OssFolderPanel=p}(ossfolder||(ossfolder={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),filelist;!function(a){var b=Pan3d.InteractiveEvent,c=Pan3d.TextAlign,d=Pan3d.ModuleEventManager,e=Pan3d.UIManager,f=Pan3d.LabelTextFont,g=Pan3d.Disp2DBaseText,h=Pan3d.UIData,i=Pan3d.Vector2D,j=Pan3d.Vector3D,k=Pan3d.Rectangle,l=Pan3d.Scene_data,m=Pan3d.LoadManager,n=Pan3d.TextureManager,o=Pan3d.MouseType,p=drag.DragSource,q=drag.DragManager,r=pack.FileVo,s=menutwo.MenuListData,t=function(){function a(){}return a}();a.SampleFileVo=t;var u=function(a){function b(){var b=a.call(this)||this;return b.cellHeightNum=1,b}return __extends(b,a),Object.defineProperty(b.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a,this.needDraw=!0},enumerable:!0,configurable:!0}),b.prototype.destory=function(){this.pos=null,this._name=null,this.needDraw=null,this.clear=!0},b}(Pan3d.baseMeshVo);a.FileListMeshVo=u;var v=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.lastSelect=!0,b}return __extends(b,a),b.prototype.makeData=function(){var a=this;if(this.fileListMeshVo=this.rightTabInfoVo,this.fileListMeshVo){if(this.lastSelect==this.fileListMeshVo.fileXmlVo.data.select&&this.lastName==this.fileListMeshVo.fileXmlVo.data.name)return;this.lastSelect=this.fileListMeshVo.fileXmlVo.data.select,this.lastName=this.fileListMeshVo.fileXmlVo.data.name;var b="[9c9c9c]";this.fileListMeshVo.fileXmlVo.data.select&&(b="[ffffff]");var c=this.fileListMeshVo.fileXmlVo.data;switch(this.parent.uiAtlas.clearCtxTextureBySkilname(this.textureStr),c.suffix){case r.JPG:case r.PNG:m.getInstance().load(l.ossRoot+c.path,m.IMG_TYPE,function(d){a.drawFileIconName(d,c.name,b)});break;case r.PREFAB:this.drawFileIconName(y.imgBaseDic.profeb_64x,c.name,b);break;case r.MATERIAL:this.drawFileIconName(y.imgBaseDic.marterial_64x,c.name,b);break;case r.TXT:this.drawFileIconName(y.imgBaseDic.txt_64x,c.name,b);break;case r.OBJS:this.drawFileIconName(y.imgBaseDic.objs_64x,c.name,b);break;case r.MAP:this.drawFileIconName(y.imgBaseDic.map_64x,c.name,b);break;case r.LYF:this.drawFileIconName(y.imgBaseDic.lyf_64x,c.name,b);break;case r.ZZW:this.drawFileIconName(y.imgBaseDic.zzw_64x,c.name,b);break;case r.MD5ANIM:this.drawFileIconName(y.imgBaseDic.md5anim_64x,c.name,b);break;case r.MD5MESH:this.drawFileIconName(y.imgBaseDic.md5mesh_64x,c.name,b);break;case r.SKILL:this.drawFileIconName(y.imgBaseDic.skill_64x,c.name,b);break;default:this.drawFileIconName(y.imgBaseDic.icon_Folder_64x,c.name,b)}}},b.prototype.tempDown=function(a,b,c){var d=this,e=new inputres.SceneRes;e.bfun=function(){var a="working/scene007/scene007_hide/lightuv/build2.jpg",e=n.getInstance().getImgResByurl(l.fileRoot+a);e&&(console.log(e),d.drawFileIconName(e,b,c))},Pan3d.LoadManager.getInstance().load(l.fileRoot+"pan/expmapinfo.txt",m.BYTE_TYPE,function(a){e.loadComplete(a)})},b.prototype.drawFileIconName=function(a,b,d){var g=this.parent.uiAtlas.getRec(this.textureStr);this.parent.uiAtlas.ctx=e.getInstance().getContext2D(g.pixelWitdh,g.pixelHeight,!1),this.parent.uiAtlas.ctx.clearRect(0,1,g.pixelWitdh,g.pixelHeight);var h=b.split(".")[0],i=editscene.ChangeNameModel.getInstance().getTextMetrics(h,14),j=!1;i.width>70&&(j=!0),this.fileListMeshVo.fileXmlVo.data.select&&(this.parent.uiAtlas.ctx.fillStyle="rgba(255,255,255,0.1)",j?this.parent.uiAtlas.ctx.fillRect(0,1,g.pixelWitdh,g.pixelHeight-3):this.parent.uiAtlas.ctx.fillRect(0,1,g.pixelWitdh,g.pixelHeight-10));var l=new k(18,1,64,64),m=l.width,o=l.height;if(a.width&&(m=Math.max(1.5*a.width,20),o=Math.max(1.5*a.heigh,20),m=Math.min(1.5*a.width,l.width),o=Math.min(1.5*a.height,l.height)),this.parent.uiAtlas.ctx.drawImage(a,l.x+(l.width-m)/2,l.y+(l.height-o)/2,m,o),j){var p=Math.floor(.4*h.length);f.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,d+h.substr(0,p),15,-2,60,c.CENTER),f.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,d+h.substring(p,h.length),15,-2,78,c.CENTER)}else f.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,d+h,18,0,65,c.CENTER);n.getInstance().updateTexture(this.parent.uiAtlas.texture,g.pixelX,g.pixelY,this.parent.uiAtlas.ctx)},b.prototype.update=function(){this.fileListMeshVo=this.rightTabInfoVo,this.fileListMeshVo&&(this.fileListMeshVo.needDraw&&(this.makeData(),this.fileListMeshVo.needDraw=!1),this.fileListMeshVo.pos&&(this.ui.x=this.fileListMeshVo.pos.x,this.ui.y=this.fileListMeshVo.pos.y,this.ui.width=this.ui.baseRec.width*this.fileListMeshVo.uiScale,this.ui.height=this.ui.baseRec.height*this.fileListMeshVo.uiScale),this.fileListMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null))},b}(g);a.FileListName=v;var w=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(k);a.PathurlRect=w;var x=function(a){function d(){var c=a.call(this,512,22)||this;return c.label="目录/文件夹",c.ui.addEventListener(b.Down,c.pathurlLabelDown,c),c.ui.addEventListener(b.Move,c.pathurlLabelMove,c),c}return __extends(d,a),d.prototype.pathurlLabelMove=function(a){},d.prototype.pathurlLabelDown=function(a){var b=new i(a.x-this.textureContext.left,a.y-this.textureContext.top);b.x/=this.textureContext.uiViewScale,b.y/=this.textureContext.uiViewScale;for(var c=0;c<this.areaRectItem.length;c++){var d=this.areaRectItem[c];if(d.isHitByPoint(b.x,b.y)){var e=d.pathurl.replace(Pan3d.Scene_data.ossRoot,"");Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_DIS_ALL_FILE),e),Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_OSS_FOLDER_FILE),e)}}},Object.defineProperty(d.prototype,"label",{set:function(a){f.writeSingleLabel(this.ui.uiRender.uiAtlas,this.ui.skinName,a,26,c.LEFT,"#ffffff","#27262e",5)},enumerable:!0,configurable:!0}),d.prototype.setPath=function(a){this.areaRectItem=[];var b=this.ui.uiRender.uiAtlas,c=b.getRec(this.ui.skinName),d=e.getInstance().getContext2D(c.pixelWitdh,c.pixelHeight,!1);d.fillStyle="#ffffff",d.font="26px "+h.font,d.strokeStyle="#27262e",d.lineWidth=4;for(var f=a.split("/"),g=20,i="",j=0;j<f.length;j++){var k=f[j];if(k&&k.length){d.fillText(k,g,0),i+=k+"/";var l=new w(g,0,d.measureText(k).width,22);l.pathurl=i,this.areaRectItem.push(l),g+=d.measureText(k).width,d.fillText(" / ",g,0),g+=30}}b.updateCtx(d,c.pixelX,c.pixelY)},d}(prop.TextLabelUI);a.PathurlLabel=x;var y=function(c){function e(){return c.call(this,v,new k(0,0,100,100),48)||this}return __extends(e,c),e.prototype.loadConfigCom=function(){var a=this;c.prototype.loadConfigCom.call(this),this._baseRender.mask=this._uiMask,this.pathlistBg=this.addChild(this._baseTopRender.getComponent("a_round_line")),this.pathlistBg.x=0,this.pathlistBg.y=-20,this.pathlistBg.width=100,this.pathlistBg.height=20,this.pathurlLabel=new x,this.addRender(this.pathurlLabel.ui.uiRender),this.setUiListVisibleByItem([this.c_scroll_bar_bg],!0),this.a_tittle_bg.removeEventListener(b.Down,this.tittleMouseDown,this),this.loadAssetImg(function(){a.makeItemUiList(),Pan3d.TimeUtil.addFrameTick(function(b){a.update(b)})}),this.onMouseWheelFun||(this.onMouseWheelFun=function(b){a.onMouseWheel(b)}),document.addEventListener(o.MouseWheel,this.onMouseWheelFun),this.resize()},e.prototype.onMouseWheel=function(a){this.isCanToDo&&this.pageRect.isHitByPoint(a.x,a.y)&&this.contentHeight>this._uiMask.height&&(this.c_scroll_bar.y+=a.deltaY/30,this.changeScrollBar(),this.resize())},Object.defineProperty(e.prototype,"isCanToDo",{get:function(){return this&&this.hasStage?!0:!1},enumerable:!0,configurable:!0}),e.prototype.resize=function(){this.resetSampleFilePos(),this.uiLoadComplete&&(this.contentHeight=this.getcontentHeight(),this.pathlistBg&&(this.pathlistBg.width=this.pageRect.width),this.pathurlLabel&&(this.pathurlLabel.textureContext.resize(),this.pathurlLabel.textureContext.left=this.left+20,this.pathurlLabel.textureContext.top=this.top-22)),c.prototype.resize.call(this)},e.prototype.loadAssetImg=function(a){e.imgBaseDic={};var b=[];b.push("icon_Folder_64x"),b.push("profeb_64x"),b.push("marterial_64x"),b.push("txt_64x"),b.push("objs_64x"),b.push("lyf_64x"),b.push("zzw_64x"),b.push("map_64x"),b.push("skill_64x"),b.push("md5anim_64x"),b.push("md5mesh_64x");for(var c=0,d=0;d<b.length;d++)this.loadTempOne(b[d],function(){c++,c>=b.length&&a()})},e.prototype.loadTempOne=function(a,b){var c=makeImage();e.imgBaseDic[a]=c,c.onload=function(){b()},c.url=l.fileuiRoot+"ui/icon/"+a+".png",c.src=l.fileuiRoot+"ui/icon/"+a+".png"},e.prototype.update=function(a){c.prototype.update.call(this,a)},Object.defineProperty(e.prototype,"lastfileDonwInfo",{get:function(){return this._lastfileDonwInfo},set:function(a){this._lastfileDonwInfo=a},enumerable:!0,configurable:!0}),e.prototype.fileMouseDown=function(a){if(l.uiStage.addEventListener(b.Move,this.stageMouseMove,this),console.log(this.lastfileDonwInfo),this.lastfileDonwInfo&&this.lastfileDonwInfo.target==a.target){if(console.log("是同一个对象",this.lastfileDonwInfo.tm>Pan3d.TimeUtil.getTimer()),this.lastfileDonwInfo.tm>Pan3d.TimeUtil.getTimer()-1e3)return void this.fileDuboclik(a);this.lastfileDonwInfo.tm=Pan3d.TimeUtil.getTimer()}else this.lastfileDonwInfo={target:a.target,tm:Pan3d.TimeUtil.getTimer()};console.log(this.lastfileDonwInfo),this.makeDragData(a)},e.prototype.makeDragData=function(a){var c=(new MouseEvent(b.Down,{clientX:a.x,clientY:a.y}),this.getItemVoByUi(a.target));if(c){var d=Pan3d.Scene_data.ossRoot+c.fileListMeshVo.fileXmlVo.data.path;d=d.replace(Pan3d.Scene_data.fileRoot,"");var e=new p;if(c.fileListMeshVo.fileXmlVo.data.isFolder)e.icon="icon/icon_Folder_64x.png";else switch(c.fileListMeshVo.fileXmlVo.data.suffix){case r.MATERIAL:e.icon="icon/marterial_64x.png";break;case"jpg":case"png":e.icon="icon/profeb_64x.png";break;case"objs":e.icon="icon/objs_64x.png";break;default:e.icon="icon/objs_64x.png"}e.url=d,e.type="file",q.doDragdoDrag(this,e)}},e.prototype.stageMouseMove=function(a){this.lastfileDonwInfo=null},e.prototype.fileDuboclik=function(a){var b=this.getItemVoByUi(a.target);if(b)if(b.fileListMeshVo.fileXmlVo.data.isFolder)this.refrishPath(b.fileListMeshVo.fileXmlVo.data.path);else{var c=Pan3d.Scene_data.ossRoot+b.fileListMeshVo.fileXmlVo.data.path;switch(c=c.replace(Pan3d.Scene_data.fileRoot,""),b.fileListMeshVo.fileXmlVo.data.suffix){case r.MATERIAL:Pan3d.ModuleEventManager.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.SHOW_MATERIA_PANEL),c);
break;case r.MAP:Pan3d.ModuleEventManager.dispatchEvent(new maineditor.MainEditorEvent(maineditor.MainEditorEvent.LOAD_SCENE_MAP),c)}}},e.prototype.selectFileClik=function(b){var c=this.getItemVoByUi(b.target);if(c)if(c.fileListMeshVo.fileXmlVo.data.isFolder);else{var d=Pan3d.Scene_data.ossRoot+c.fileListMeshVo.fileXmlVo.data.path;switch(d=d.replace(Pan3d.Scene_data.fileRoot,""),c.fileListMeshVo.fileXmlVo.data.suffix){case r.PREFAB:pack.PackPrefabManager.getInstance().getPrefabByUrl(d,function(b){var c=new a.PrefabMeshView(prop.PropModel.getInstance().propPanle);c.data=b,prop.PropModel.getInstance().showOtherMeshView(c)});break;case r.ZZW:pack.PackRoleManager.getInstance().getRoleZzwByUrl(d,function(b){var c=new a.RoleMeshView(prop.PropModel.getInstance().propPanle);c.data=b,prop.PropModel.getInstance().showOtherMeshView(c)});break;case r.SKILL:pack.PackSkillManager.getInstance().getPrefabByUrl(d,function(b){var c=new a.SkillMeshView(prop.PropModel.getInstance().propPanle);c.data=b,prop.PropModel.getInstance().showOtherMeshView(c)});break;case r.LYF:var e=new a.FileMeshView(prop.PropModel.getInstance().propPanle);e.data=d,prop.PropModel.getInstance().showOtherMeshView(e);break;case r.LYF:case r.OBJS:var e=new a.FileMeshView(prop.PropModel.getInstance().propPanle);e.data=d,prop.PropModel.getInstance().showOtherMeshView(e);break;default:console.log("还没有的类型",c.fileListMeshVo.fileXmlVo.data.path)}}},e.prototype.fileMouseUp=function(a){l.uiStage.removeEventListener(b.Move,this.stageMouseMove,this),this.selectFileIcon(a)},e.prototype.selectFileIcon=function(a){for(var b=0;b<this._uiItem.length;b++){var c=this._uiItem[b];c.fileListMeshVo&&c.ui&&(c.ui==a.target?c.fileListMeshVo.fileXmlVo.data.select=!0:c.fileListMeshVo.fileXmlVo.data.select=!1,c.fileListMeshVo.needDraw=!0)}this.selectFileClik(a)},e.prototype.clearListAll=function(){for(;this.fileItem.length;){var a=this.fileItem.pop();a.destory()}},e.prototype.refrishPath=function(a){var b=this;console.log("刷新目录",a),this.pathurlLabel.setPath(a),AppData.rootFilePath=AppData.getPerentPath(a),this.moveListTy=0,this.clearListAll(),pack.FileOssModel.getFolderArr(AppData.rootFilePath,function(c){for(var d=0;d<c.length;d++){var e=new t;e.id=d,e.data=c[d],e.data.path==a&&(e.data.select=!0);var f=b.getCharNameMeshVo(e);f.pos=new j(64*d,40,0),b.fileItem.push(f)}b.resize()})},e.prototype.addRender=function(a){c.prototype.addRender.call(this,a);for(var d=0;this._uiItem&&d<this._uiItem.length;d++)this._uiItem[d].ui.addEventListener(b.Down,this.fileMouseDown,this),this._uiItem[d].ui.addEventListener(b.Up,this.fileMouseUp,this)},e.prototype.getItemVoByUi=function(a){for(var b=0;b<this._uiItem.length;b++){var c=this._uiItem[b];if(c.ui==a)return c}return null},e.prototype.makeItemUiList=function(){var a=this;this.fileItem=[];for(var c=0;c<this._uiItem.length;c++)this._uiItem[c].ui.addEventListener(b.Down,this.fileMouseDown,this),this._uiItem[c].ui.addEventListener(b.Up,this.fileMouseUp,this);var d=Pan3d.Scene_data.fileRoot.replace(Pan3d.Scene_data.ossRoot,"");this.refrishPath(d),this.onRightMenuFun||(this.onRightMenuFun=function(b){a.onRightMenu(b)}),document.addEventListener("contextmenu",this.onRightMenuFun)},e.prototype.onRightMenu=function(a){a.preventDefault();var b=win.LayerManager.getInstance().getObjectsUnderPoint(new i(a.x,a.y));if(b&&b.parent instanceof e){var c=this.getItemVoByUi(b);if(c)return void this.makeFileFloadMenu(a)}this.pageRect.isHitByPoint(a.x,a.y)&&this.makeFileListMenu(a)},e.prototype.makeFileFloadMenu=function(a){var b=this,c=(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),{});c.mouse=new i(a.clientX,a.clientY);var e=new Array;e.push(new s("删除文件","21")),e.push(new s("重命名","22")),e.push(new s("下载文件","23")),c.menuXmlItem=e,c.info={},c.info.bfun=function(a,c){b.menuBfun(a,c)},d.dispatchEvent(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),c)},e.prototype.makeFileListMenu=function(a){var b=this,c=(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),{}),e=new Array;e.push(new s("上传文件","1")),e.push(new s("创建文件夹","2")),e.push(new s("创建Texture","3")),e.push(new s("创建prefab","4")),e.push(new s("刷新","5")),c.mouse=new i(a.clientX,Math.min(a.clientY,l.stageHeight-20*e.length)),c.menuXmlItem=e,c.info={},c.info.bfun=function(a,c){b.menuBfun(a,c)},d.dispatchEvent(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),c)},e.prototype.menuBfun=function(a,b){switch(a.key){case"1":this.upTempFileToOss();break;case"3":this.creatTexture();break;case"4":this.creatPefab();break;case"5":this.refrishIndexGroup(AppData.rootFilePath);break;case"21":this.deleFile();break;case"22":this.changeFileName();break;case"23":this.downFile();break;default:console.log("没处理对象",a.key)}},e.prototype.downFile=function(){for(var a=0;a<this._uiItem.length;a++){var b=this._uiItem[a];if(b.fileListMeshVo&&b.ui&&b.fileListMeshVo.fileXmlVo.data.select){var c=b.fileListMeshVo.fileXmlVo.data.path;window.open(l.ossRoot+c)}}},e.prototype.changeFileName=function(){for(var a=this,b=0;b<this._uiItem.length;b++){var c=this._uiItem[b];if(c.fileListMeshVo&&c.ui&&c.fileListMeshVo.fileXmlVo.data.select){var d=new k;d.x=c.ui.x+this.left,d.y=c.ui.y+this.top,d.x+=5,d.y+=45,d.width=60,d.height=20;var e=c.fileListMeshVo.fileXmlVo.data.name,f=editscene.ChangeNameModel.getInstance().getTextMetrics(e,14);d.width=f.width+20;var g=c.fileListMeshVo.fileXmlVo.data.path;editscene.ChangeNameModel.getInstance().changeName(d,e,function(b){if(b.length){console.log("准备修改名字");var c=g.substr(0,g.lastIndexOf("/")+1);c+=b,console.log(g),console.log(c),pack.FileOssModel.copyFile(c,g,function(){pack.FileOssModel.deleFile(g,function(){a.refrishIndexGroup(AppData.rootFilePath)})})}})}}},e.prototype.creatTexture=function(){var a=this,b="baseedit/assets/base/base.material",c=AppData.rootFilePath.replace(Pan3d.Scene_data.ossRoot,"");pack.FileOssModel.copyFile(c+"base.material",b,function(){a.refrishIndexGroup(AppData.rootFilePath)})},e.prototype.refrishIndexGroup=function(a){var b=this;pack.FileOssModel.getDisByOss(a,function(c){b.refrishPath(a)})},e.prototype.creatPefab=function(){var a=this,b="baseedit/assets/base/base.prefab",c=AppData.rootFilePath.replace(Pan3d.Scene_data.ossRoot,"");pack.FileOssModel.copyFile(c+"base.prefab",b,function(){a.refrishIndexGroup(AppData.rootFilePath)})},e.prototype.deleFile=function(){for(var a=this,b=0;b<this._uiItem.length;b++){var c=this._uiItem[b];if(c.fileListMeshVo&&c.ui&&c.fileListMeshVo.fileXmlVo.data.select){var d=window.confirm("是否确定要删除选取的对象。");d&&pack.FileOssModel.deleFile(c.fileListMeshVo.fileXmlVo.data.path,function(){a.refrishIndexGroup(AppData.rootFilePath),console.log("删除成功")})}}},e.prototype.upTempFileToOss=function(){var a=this;this._inputHtmlSprite=document.createElement("input"),this._inputHtmlSprite.setAttribute("id","_ef"),this._inputHtmlSprite.setAttribute("type","file"),this._inputHtmlSprite.setAttribute("style","visibility:hidden"),this._inputHtmlSprite.click(),this._inputHtmlSprite.value,this._inputHtmlSprite.addEventListener("change",function(b){a.changeFile(b)})},e.prototype.changeFile=function(a){for(var b=this,c=0;c<this._inputHtmlSprite.files.length&&1>c;c++){var d=this._inputHtmlSprite.files[c];console.log(d),console.log(AppData.rootFilePath);var e=AppData.rootFilePath.replace(Pan3d.Scene_data.ossRoot,"");console.log(e+d.name),pack.FileOssModel.upOssFile(d,e+d.name,function(){console.log("文件上传成功"),pack.FileOssModel.getDisByOss(e,function(){b.refrishPath(AppData.rootFilePath)})})}this._inputHtmlSprite=null},e.prototype.resetSampleFilePos=function(){for(var a=Math.round((this.pageRect.width-50)/100),b=this.moveListTy+10,c=0;this.fileItem&&c<this.fileItem.length;c++){var d=this.fileItem[c];d.uiScale=.7,d.pos.x=c%a*100+10,d.pos.y=70*Math.floor(c/a)+b}},e.prototype.getcontentHeight=function(){if(this.uiLoadComplete&&this.fileItem){var a=Math.round((this.pageRect.width-50)/100);return 70*Math.round(this.fileItem.length/a)}return 0},e.prototype.getCharNameMeshVo=function(a){var b=new u;return b.fileXmlVo=a,this.showTemp(b),b},e}(win.Dis2dBaseWindow);a.FileListPanel=y}(filelist||(filelist={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),folder;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Module,d=Pan3d.BaseProcessor,e=win.Panel,f=filelist.FileListPanel,g=basefolderwin.BaseFolderWindow,h=ossfolder.OssFolderPanel,i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.SHOW_FOLDER_PANEL="SHOW_FOLDER_PANEL",b.EDITSCENE_RESET_SIZE="EDITSCENE_RESET_SIZE",b.RESET_FOLDE_WIN_SIZE="RESET_FOLDE_WIND_SIZE",b.LIST_DIS_ALL_FILE="LIST_DIS_ALL_FILE",b.LIST_OSS_FOLDER_FILE="LIST_OSS_FOLDER_FILE",b}(b);a.FolderEvent=i;var j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"FolderModule"},b.prototype.listProcessors=function(){return[new k]},b}(c);a.FolderModule=j;var k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getName=function(){return"FolderProcessor"},b.prototype.receivedModuleEvent=function(a){if(a instanceof i){var b=a;b.type==i.SHOW_FOLDER_PANEL&&(this._baseFolderWindow||(this._baseFolderWindow=new g),this.addUIContainer(this._baseFolderWindow),this._folderPanel||(this._folderPanel=new h),this.addUIContainer(this._folderPanel),this._fileListPanel||(this._fileListPanel=new f),this.addUIContainer(this._fileListPanel),this.fristRect&&this._baseFolderWindow.setRect(this.fristRect)),b.type==i.EDITSCENE_RESET_SIZE&&(this._baseFolderWindow?this._baseFolderWindow.setRect(b.data):this.fristRect=b.data),b.type==i.LIST_DIS_ALL_FILE&&this._fileListPanel.refrishPath(String(b.data)),b.type==i.LIST_OSS_FOLDER_FILE&&this._folderPanel.fileOssFolderDic(String(b.data)),b.type==i.RESET_FOLDE_WIN_SIZE&&this.resetFolderWinSize()}},b.prototype.resetFolderWinSize=function(){var a=this._baseFolderWindow.getPageRect().clone(),b=a.clone();b.x=0,b.y+=13,b.width=a.width*this._baseFolderWindow.percentNum+5,b.height-=18,this._folderPanel.setRect(b);var c=a.clone();c.x=a.width*this._baseFolderWindow.percentNum,c.y=a.y+40,c.width=a.width*(1-this._baseFolderWindow.percentNum),c.height-=43,this._fileListPanel.setRect(c)},b.prototype.addOtherPanel=function(){win.LayerManager.getInstance().addPanel(new e,200)},b.prototype.addUIContainer=function(a){this.folderPanel||(this.folderPanel=new e,this.folderPanel.x=0,this.folderPanel.y=0,this.folderPanel.width=450,this.folderPanel.height=250,win.LayerManager.getInstance().addPanel(this.folderPanel,200)),this.folderPanel.addUIContainer(a)},b.prototype.listenModuleEvents=function(){return[new i(i.SHOW_FOLDER_PANEL),new i(i.RESET_FOLDE_WIN_SIZE),new i(i.EDITSCENE_RESET_SIZE),new i(i.LIST_DIS_ALL_FILE),new i(i.LIST_OSS_FOLDER_FILE)]},b}(d);a.FolderProcessor=k}(folder||(folder={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.BaseEvent,c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.MEVENT_MATERIAL_CONNECT_STARTDRAG="MEvent_Material_Connect_startDrag",b.MEVENT_MATERIAL_CONNECT_STOPDRAG="MEvent_Material_Connect_stopDrag",b.MEVENT_MATERIAL_CONNECT_REMOVELINE="MEvent_Material_Connect_removeLine",b.MEVENT_MATERIAL_CONNECT_DOUBLUELINE="MEvent_Material_Connect_doublueLine",b}(b);a.MEvent_Material_Connect=c}(materialui||(materialui={}));var materialui;!function(a){var b=function(){function a(){}return a.prototype.getObj=function(){var a=new Object;return a.inoutType=this.inoutType,a.id=this.id,a.type=this.type,a},a.prototype.otherNeedObj=function(){var a=new Object;return a.id=this.id,a.inoutType=this.inoutType,a.pid=this.node.id,a},a.IN="in",a.OUT="out",a}();a.NodeTreeItem=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),Object.defineProperty(b.prototype,"parentNodeItem",{get:function(){return this._parentNodeItem},set:function(a){this._parentNodeItem=a},enumerable:!0,configurable:!0}),b.prototype.getObj=function(){var b=a.prototype.getObj.call(this);return b.parentObj=this.parentNodeItem?this.parentNodeItem.otherNeedObj():null,b},b}(a.NodeTreeItem);a.NodeTreeInputItem=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.sunNodeItems=new Array,c.inoutType=a.NodeTreeItem.OUT,c}return __extends(c,b),c.prototype.pushSunNode=function(a){this.sunNodeItems.push(a)},c.prototype.removeSunNode=function(a){for(var b=0;b<this.sunNodeItems.length;b++)if(this.sunNodeItems[b]==a){this.sunNodeItems.splice(b,1);break}},c.prototype.getObj=function(){for(var a=b.prototype.getObj.call(this),c=new Array,d=0;d<this.sunNodeItems.length;d++)c.push(this.sunNodeItems[d].otherNeedObj());return a.sunObj=c,a},c}(a.NodeTreeItem);a.NodeTreeOutoutItem=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.EventDispatcher,c=Pan3d.BaseEvent,d=Pan3d.ModuleEventManager,e=Pan3d.Vector2D,f=function(b){function f(c,d,e){void 0===e&&(e=!0);var f=b.call(this)||this;return f.outLineList=new Array,f.titleLabeltext=c,f.inOut=e,f.inOut?f.nodeTreeItem=new a.NodeTreeInputItem:f.nodeTreeItem=new a.NodeTreeOutoutItem,f.nodeTreeItem.name=c,f.typets=d,f.drawSp(),f}return __extends(f,b),f.prototype.removeOut=function(a){for(var b=0;b<this.outLineList.length;b++)if(this.outLineList[b]==a){this.outLineList.splice(b,1);break}this.inOut||0!=this.outLineList.length||(this.hasConnet=!1,this.dispatchEvent(new c("DisConnect")))},f.prototype.removeIn=function(){this._inLine=null,this.inOut&&(this.hasConnet=!1,this.dispatchEvent(new c("DisConnect")))},f.prototype.setConnect=function(){this.hasConnet=!0,this.dispatchEvent(new c("Connect"))},f.prototype.removeAllLine=function(){for(var b,c=this.outLineList.length-1;c>=0;c--)b=new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_REMOVELINE),b.line=this.outLineList[c],d.dispatchEvent(b);this._inLine&&(b=new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_REMOVELINE),b.line=this._inLine,d.dispatchEvent(b))},Object.defineProperty(f.prototype,"typets",{get:function(){return this._type},set:function(a){this._type=a,this.nodeTreeItem.type=a},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.pointframe.x=this._x,this.inOut?this.labelframe.x=this._x+20:this.labelframe.x=this._x-80},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.pointframe.y=this._y,this.labelframe.y=this._y-2},enumerable:!0,configurable:!0}),f.prototype.getStagePoint=function(){return new e(this.pointframe.x+this.pointframe.parent.left+10,this.pointframe.y+this.pointframe.parent.top+10)},f.prototype.changeType=function(a){this.typets=a,this.drawSp()},f.prototype.drawSp=function(){this.pointframe&&(this._type==a.MaterialItemType.FLOAT?this.pointframe.goToAndStop(2):this._type==a.MaterialItemType.VEC2?this.pointframe.goToAndStop(3):this._type==a.MaterialItemType.VEC3?this.pointframe.goToAndStop(0):this._type==a.MaterialItemType.VEC4?this.pointframe.goToAndStop(1):this._type==a.MaterialItemType.UNDEFINE&&this.pointframe.goToAndStop(4))},Object.defineProperty(f.prototype,"inLine",{get:function(){return this._inLine},set:function(a){this._inLine=a},enumerable:!0,configurable:!0}),f.prototype.drawLine=function(){for(var a=0;a<this.outLineList.length;a++)this.outLineList[a].draw();this._inLine&&this._inLine.draw()},f}(b);a.ItemMaterialUI=f}(materialui||(materialui={}));var materialui;!function(a){var b=function(){function b(){this.priority=-1,this.id=-1,this.inputVec=new Array,this.outputVec=new Array}return b.prototype.addInput=function(a){var b=a;if(!b)throw new Error("转换失败");this.inputVec.push(b),b.node=this,this.refreshID()},b.prototype.removeInput=function(a){for(var b=0;b<this.inputVec.length;b++)if(this.inputVec[b]==a){this.inputVec.splice(b,1);break}this.refreshID()},b.prototype.addOutput=function(a){var b=a;if(!b)throw new Error("转换失败");this.outputVec.push(b),b.node=this,this.refreshID()},b.prototype.removeOutput=function(a){for(var b=0;b<this.outputVec.length;b++)if(this.outputVec[b]==a){this.outputVec.splice(b,1);break}this.refreshID()},b.getID=function(a){return b.jsMode?"["+a+"]":String(a)},b.prototype.refreshID=function(){for(var a=0;a<this.inputVec.length;a++)this.inputVec[a].id=a;for(a=0;a<this.outputVec.length;a++)this.outputVec[a].id=a},b.prototype.getObj=function(){var a=new Object;a.id=this.id,a.type=this.type,a.data=this.ui.getData();for(var b=new Array,c=0;c<this.inputVec.length;c++)b.push(this.inputVec[c].getObj());a.inAry=b;var d=new Array;for(c=0;c<this.outputVec.length;c++)d.push(this.outputVec[c].getObj());return a.outAry=d,a},Object.defineProperty(b.prototype,"isDynamic",{get:function(){return this._isDynamic},set:function(a){this._isDynamic=a},enumerable:!0,configurable:!0}),b.prototype.checkInput=function(){for(var a=0;a<this.inputVec.length;a++)if(!this.inputVec[a].parentNodeItem)return!1;return!0},b.prototype.getComponentID=function(b){return 0==b?a.CompileTwo.FT+this.regResultTemp.id+".xyz":1==b?a.CompileTwo.FT+this.regResultTemp.id+".x":2==b?a.CompileTwo.FT+this.regResultTemp.id+".y":3==b?a.CompileTwo.FT+this.regResultTemp.id+".z":4==b?a.CompileTwo.FT+this.regResultTemp.id+".w":a.CompileTwo.FT+this.regResultTemp.id},b.prototype.releaseUse=function(){for(var a=!0,b=0;b<this.outputVec.length;b++){for(var c=this.outputVec[b].sunNodeItems,d=!1,e=0;e<c.length;e++)if(!c[e].hasCompiled){a=!1,d=!0;break}if(d)break}a&&this.regResultTemp&&(this.regResultTemp.inUse=!1)},b.TEX="tex",b.TEX3D="tex3d",b.TEXCUBE="texCube",b.OP="op",b.ADD="add",b.SUB="sub",b.MUL="mul",b.FUN="fun",b.DIV="div",b.RCP="rcp",b.MIN="min",b.MAX="max",b.FRC="frc",b.SQT="sqt",b.RSQ="rsq",b.POW="pow",b.LOG="log",b.EXP="exp",b.NRM="nrm",b.SIN="sin",b.COS="cos",b.CRS="crs",b.DP3="dp3",b.DP4="dp4",b.ABS="abs",b.NEG="neg",b.SAT="sat",b.LERP="lerp",b.VEC3="vec3",b.VEC2="vec2",b.FLOAT="float",b.NORMAL="normal",b.TIME="time",b.TEXCOORD="texcoord",b.TEXCOORDLIGHT="texlightuv",b.DYNVEC3="dynvec3",b.PTCOLOR="ptColor",b.VERCOLOR="verColor",b.HEIGHTINFO="heightinfo",b.FRESNEL="fresnel",b.REFRACTION="refraction",b.PANNER="panner",b.jsMode=!1,b}();a.NodeTree=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.getComponentID=function(b){var c=this.outputVec[0];if(0==b){if(c.type==a.MaterialItemType.VEC4)return a.CompileTwo.FT+this.regResultTemp.id;if(c.type==a.MaterialItemType.VEC3)return a.CompileTwo.FT+this.regResultTemp.id+".xyz";if(c.type==a.MaterialItemType.VEC2)return a.CompileTwo.FT+this.regResultTemp.id+".xy";if(c.type==a.MaterialItemType.FLOAT)return a.CompileTwo.FT+this.regResultTemp.id+".x"}else{if(1==b)return a.CompileTwo.FT+this.regResultTemp.id+".x";if(2==b)return a.CompileTwo.FT+this.regResultTemp.id+".y";if(3==b)return a.CompileTwo.FT+this.regResultTemp.id+".z";if(4==b)return a.CompileTwo.FT+this.regResultTemp.id+".xy";if(5==b)return a.CompileTwo.FT+this.regResultTemp.id+".xyz";if(6==b)return a.CompileTwo.FT+this.regResultTemp.id+".w"}return null},c}(a.NodeTree);a.NodeTreeDynamic=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return b.writeZbuffer=!0,b}return __extends(b,a),b.prototype.checkInput=function(){return!0},b}(a.NodeTree);a.NodeTreeOP=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.checkInput=function(){return!0},b}(a.NodeTree);a.NodeTreeTex=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(a.NodeTreeDynamic);a.NodeTreeAdd=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(a.NodeTree);a.NodeTreeSub=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(a.NodeTreeDynamic);a.NodeTreeMul=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(a.NodeTreeDynamic);a.NodeTreeDiv=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.getComponentID=function(b){if(0==b){var c=a.CompileTwo.FT+this.regResultTemp.id+".x";return c}return null},c}(a.NodeTree);a.NodeTreeSin=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.getComponentID=function(b){if(0==b){var c=a.CompileTwo.FT+this.regResultTemp.id+".x";return c}return null},c}(a.NodeTree);a.NodeTreeCos=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector3D,c=function(c){function d(){var a=c.call(this)||this;return a.constVec3=new b,a.canDynamic=!0,a}return __extends(d,c),d.prototype.getComponentID=function(b){return 0==b?a.CompileTwo.FC+a.NodeTree.getID(this.regResultConst.id)+".xyz":1==b?a.CompileTwo.FC+a.NodeTree.getID(this.regResultConst.id)+".w":2==b?a.CompileTwo.FC+a.NodeTree.getID(this.regResultConst.id):null},d}(a.NodeTree);a.NodeTreeVec3=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector2D,c=function(c){function d(){var a=c.call(this)||this;return a.constValue=new b,a.canDynamic=!0,a}return __extends(d,c),d.prototype.getComponentID=function(b){if(0==b){var c=a.CompileTwo.FC+a.NodeTree.getID(this.regResultConst.id);return 0==this.regConstIndex?c+=".xy":1==this.regConstIndex?c+=".yz":2==this.regConstIndex&&(c+=".zw"),c}return null},d}(a.NodeTree);a.NodeTreeVec2=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.canDynamic=!0,a}return __extends(c,b),c.prototype.getComponentID=function(b){if(0==b){var c=a.CompileTwo.FC+a.NodeTree.getID(this.regResultConst.id);return 0==this.regConstIndex?c+=".x":1==this.regConstIndex?c+=".y":2==this.regConstIndex?c+=".z":3==this.regConstIndex&&(c+=".w"),c}return null},c}(a.NodeTree);a.NodeTreeFloat=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){return b.call(this)||this}return __extends(c,b),c.prototype.getComponentID=function(b){if(0==b){var c=a.CompileTwo.FT+this.regResultTemp.id+".x";return c}return null},c}(a.NodeTree);a.NodeTreeFresnel=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector2D,c=function(a){function c(){var c=a.call(this)||this;return c.constValue=new b,c.canDynamic=!0,c}return __extends(c,a),c.prototype.getComponentID=function(a){return 0==a?"lightuv.xy":null},c}(a.NodeTree);a.NodeTreeLightuv=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector2D,c=function(a){function c(){var c=a.call(this)||this;return c.constValue=new b,c.canDynamic=!0,c}return __extends(c,a),c.prototype.getComponentID=function(a){return 0==a?"uvpos.xy":null},c}(a.NodeTree);a.NodeTreeTexCoord=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector2D,c=function(c){function d(){var a=c.call(this)||this;return a.coordinateValue=new b(1,1),a.speedValue=new b(0,0),a}return __extends(d,c),d.prototype.getComponentID=function(b){var c;return 0==b&&(c=a.CompileTwo.FT+this.regResultTemp.id+".xy"),c},d.prototype.checkInput=function(){return!0},d}(a.NodeTree);a.NodeTreePanner=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(a){function b(){var b=a.call(this)||this;return b.speed=1,b.timeValue=new Vector2D(1,1),b}return __extends(b,a),b.prototype.getComponentID=function(a){return 0==a?"time":null},b}(a.NodeTree);a.NodeTreeTime=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){
a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector3D,c=function(a){function c(){var c=a.call(this)||this;return c.constVec3=new b,c}return __extends(c,a),c.prototype.getComponentID=function(a){return"normalVec.xyz"},c}(a.NodeTree);a.NodeTreeNormal=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(){function a(a,b){this.name=a,this.type=b}return a}();a.DataMathFunNode=b;var c=function(c){function d(){return c.call(this)||this}return __extends(d,c),d.isNeedChangePanel=function(b,c){var d=b.split(a.CompileTwo.LN)[0].indexOf(c.split(a.CompileTwo.LN)[0]);return-1==d},d.getMathFunName=function(b){var c=b.split(a.CompileTwo.LN)[0],d=c.split(a.CompileTwo.SPACE)[1].split(a.CompileTwo.LEFT_PARENTH)[0];return d},d.getMathFunReturnType=function(b){var c=b.split(a.CompileTwo.LN)[0],d=c.split(a.CompileTwo.SPACE)[0];return d},d.getDataMathFunArr=function(c){for(var d=c.split(a.CompileTwo.LN)[0],e=d.indexOf(a.CompileTwo.LEFT_PARENTH),f=d.indexOf(a.CompileTwo.RIGHT_PARENTH),g=d.substring(e+1,f).split(a.CompileTwo.COMMA),h=new Array,i=0;i<g.length;i++)if(2!=g[i].split(a.CompileTwo.LN).length){var j=g[i].split(a.CompileTwo.SPACE)[0],k=g[i].split(a.CompileTwo.SPACE)[1];h.push(new b(k,j))}else console.log("有错");return h},d}(a.NodeTreeDynamic);a.NodeTreeFun=c}(materialui||(materialui={}));var materialui;!function(a){var b=Pan3d.Vector3D,c=function(){function a(){this.baseColor=new b,this.roughness=0,this.specular=0,this.metallic=0,this.usePbr=!1}return a.prototype.setData=function(a){a&&(this.baseColorUrl=a.baseColorUrl,a.baseColor&&(this.baseColor=new b(a.baseColor.x,a.baseColor.y,a.baseColor.z)),this.roughness=a.roughness,this.specular=a.specular,this.metallic=a.metallic,this.normalUrl=a.normalUrl,this.usePbr=a.usePbr,this.url=a.url)},a}();a.MaterialBaseData=c}(materialui||(materialui={}));var materialui;!function(a){var b=Pan3d.LabelTextFont,c=Pan3d.UIManager,d=Pan3d.TextAlign,e=function(){function e(a,b,c){this.panel=a,this.labelRender=b,this.uiRender=c,e.strItem||(e.strItem=new Array)}return e.prototype.removeChild=function(a){this.panel.removeChild(a.pointframe),this.panel.removeChild(a.labelframe),a.pointframe=null,a.labelframe=null,a.parent=null},e.prototype.addChild=function(a){a.pointframe||(a.pointframe=this.panel.addEvntBut("a_point_frame",this.uiRender),a.labelframe=this.panel.addEvntBut("a_label_txt",this.labelRender),a.labelframe.width=.5*a.labelframe.baseRec.width,a.labelframe.height=.5*a.labelframe.baseRec.height,a.pointframe.data=a);var b,c=a.titleLabeltext;a.inOut?(c+="_left",b=d.LEFT):(c+="_right",b=d.RIGHT);var f=e.strItem.indexOf(c);-1==f&&(e.strItem.push(c),f=e.strItem.indexOf(c),a.labelframe.goToAndStop(f),this.drawTextToName(a.labelframe,a.titleLabeltext,b)),a.labelframe.goToAndStop(f),a.drawSp()},e.prototype.drawTextToName=function(d,e,f){var g=d.getSkinCtxRect(),h=c.getInstance().getContext2D(g.width,g.height,!1);b.writeSingleLabelToCtx(h,e,24,0,5,f),d.drawToCtx(a.BaseMaterialNodeUI.baseUIAtlas,h)},e}();a.PanelContainer=e}(materialui||(materialui={}));var materialui;!function(a){var b=function(){function a(){}return a.FLOAT="float",a.VEC2="vec2",a.VEC3="vec3",a.VEC4="vec4",a.UNDEFINE="undefine",a}();a.MaterialItemType=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.UIManager,c=Pan3d.Vector2D,d=Pan3d.TextAlign,e=Pan3d.LabelTextFont,f=Pan3d.InteractiveEvent,g=Pan3d.UIRenderComponent,h=Pan3d.ModuleEventManager,i=Pan3d.Scene_data,j=win.UIPanel,k=function(j){function k(){var b=j.call(this)||this;return b.gap=20,b.layer=0,b.name="BaseMaterialNodeUI"+random(9999999),b.width=200,b.height=200,b._bottomRender=new g,b.addRender(b._bottomRender),b._midRender=new g,b.addRender(b._midRender),b._labelRender=new g,b.addRender(b._labelRender),b._topRender=new g,b.addRender(b._topRender),b._bottomRender.uiAtlas=k.baseUIAtlas,b._midRender.uiAtlas=k.baseUIAtlas,b._labelRender.uiAtlas=k.baseUIAtlas,b._topRender.uiAtlas=k.baseUIAtlas,b._container=new a.PanelContainer(b,b._labelRender,b._topRender),b.loadConfigCom(),b}return __extends(k,j),k.prototype.setInItemByData=function(a){},k.prototype.setOutItemByData=function(a){},k.prototype.setData=function(a){this.left=a.x+500,this.top=a.y+300,this.nodeTree.isDynamic=a.isDynamic,this.nodeTree.paramName=a.paramName},k.prototype.getData=function(){var a=new Object;return a.x=this.left-500,a.y=this.top-300,a.name=this.name,a.isDynamic=this.nodeTree.isDynamic,a.paramName=this.nodeTree.paramName,a},k.prototype.getObj=function(){return this.nodeTree.getObj()},k.prototype.resetBgSize=function(){this.a_cell_base_bg.height=this.height,this.a_select_line.x=0,this.a_select_line.y=0,this.a_select_line.width=this.width,this.a_select_line.height=this.height+25},k.prototype.loadConfigCom=function(){this.a_cell_base_bg=this._bottomRender.getComponent("a_cell_base_bg"),this.addChild(this.a_cell_base_bg),this.a_tittle_bg=this.addEvntBut("a_tittle_bg",this._bottomRender),this.a_select_line=this._topRender.getComponent("a_select_line"),this.a_panel_title_frame=this._topRender.getComponent("a_panel_title_frame"),this.a_panel_title_frame.goToAndStop(k.titleFrameId++),this.a_panel_title_frame.y=5,this.a_panel_title_frame.x=20,this.a_panel_title_frame.width=.6*this.a_panel_title_frame.baseRec.width,this.a_panel_title_frame.height=.6*this.a_panel_title_frame.baseRec.height,this.addChild(this.a_panel_title_frame),this.a_tittle_bg.x=0,this.a_tittle_bg.y=0,this.a_tittle_bg.goToAndStop(0),this.a_cell_base_bg.x=0,this.a_cell_base_bg.y=this.a_tittle_bg.height,this.inPutItemVec=new Array,this.outPutItemVec=new Array,this.resetBgSize(),this.drawTitleToFrame("材质")},k.prototype.drawTitleToFrame=function(a){this.tittleStr=a,this.drawTextToName(this.a_panel_title_frame,a),this.resetBgSize()},k.prototype.drawTextToName=function(a,c){var f=a.getSkinCtxRect(),g=b.getInstance().getContext2D(f.width,f.height,!1);e.writeSingleLabelToCtx(g,c,20,0,0,d.LEFT),a.drawToCtx(this._bottomRender.uiAtlas,g)},k.prototype.addItems=function(a){a.inOut?-1==this.inPutItemVec.indexOf(a)&&(this.inPutItemVec.push(a),this.nodeTree.addInput(a.nodeTreeItem)):-1==this.outPutItemVec.indexOf(a)&&(this.outPutItemVec.push(a),this.nodeTree.addOutput(a.nodeTreeItem)),a.parent=this,this._container.addChild(a),this.refreshNodePos()},k.prototype.removeItem=function(a){for(var b=0;b<this.inPutItemVec.length;b++)this.inPutItemVec[b]==a&&this.inPutItemVec.splice(b,1);for(this.nodeTree.removeInput(a.nodeTreeItem),b=0;b<this.outPutItemVec.length;b++)this.outPutItemVec[b]==a&&this.outPutItemVec.splice(b,1);this.nodeTree.removeOutput(a.nodeTreeItem),a.parent&&this._container.removeChild(a),this.refreshNodePos()},k.prototype.refreshNodePos=function(){for(var a=0;a<this.inPutItemVec.length;a++)this.inPutItemVec[a].y=this.gap*a+30,this.inPutItemVec[a].x=10;for(a=0;a<this.outPutItemVec.length;a++)this.outPutItemVec[a].y=this.gap*a+30,this.outPutItemVec[a].x=130},k.prototype.removeAllNodeLine=function(){for(var a=0;a<this.inPutItemVec.length;a++)this.inPutItemVec[a].removeAllLine();for(a=0;a<this.outPutItemVec.length;a++)this.outPutItemVec[a].removeAllLine()},k.prototype.butClik=function(b){switch(b.target){case this.a_tittle_bg:this.addStageMoveEvets(b);break;default:this.clikUiEvent(b)}h.dispatchEvent(new a.MaterialEvent(a.MaterialEvent.SELECT_MATERIAL_NODE_UI),this)},k.prototype.getInItem=function(a){return this.inPutItemVec[a]},k.prototype.getOutItem=function(a){return this.outPutItemVec[a]},k.prototype.clikUiEvent=function(b){var c=this.getPointFrameTagetFoItemVec(b.target);if(AppData.altKey)return void c.removeAllLine();if(c){var d=new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_STARTDRAG);d.itemNode=c,h.dispatchEvent(d)}},k.prototype.getPointFrameTagetFoItemVec=function(a){for(var b=0;b<this.inPutItemVec.length;b++)if(this.inPutItemVec[b].pointframe==a)return this.inPutItemVec[b];for(b=0;b<this.outPutItemVec.length;b++)if(this.outPutItemVec[b].pointframe==a)return this.outPutItemVec[b];return null},k.prototype.addStageMoveEvets=function(a){this.lastPanelPos=new c(this.left,this.top),this.mouseXY=new c(a.x,a.y),i.uiStage.addEventListener(f.Move,this.onMove,this),i.uiStage.addEventListener(f.Up,this.onUp,this)},k.prototype.onMove=function(b){this.left=this.lastPanelPos.x+(b.x-this.mouseXY.x)/a.MtlUiData.Scale,this.top=this.lastPanelPos.y+(b.y-this.mouseXY.y)/a.MtlUiData.Scale,this.resize(),this.drawLine()},k.prototype.drawLine=function(){for(var a=0;a<this.inPutItemVec.length;a++)this.inPutItemVec[a].drawLine();for(a=0;a<this.outPutItemVec.length;a++)this.outPutItemVec[a].drawLine()},k.prototype.onUp=function(a){i.uiStage.removeEventListener(f.Move,this.onMove,this),i.uiStage.removeEventListener(f.Up,this.onUp,this)},Object.defineProperty(k.prototype,"select",{get:function(){return this._select},set:function(b){this._select=b,this.setUiListVisibleByItem([this.a_select_line],this._select),this._select&&(this instanceof a.MathFunNodeUI?prop.TextureFunPanel.getInstance().showPanel(this):(prop.PropModel.getInstance().showPanel(this),prop.TextureFunPanel.getInstance().hidePanel()))},enumerable:!0,configurable:!0}),k.prototype.showDynamic=function(){},k.titleFrameId=0,k}(j);a.BaseMaterialNodeUI=k}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.TextureManager,c=Pan3d.Scene_data,d=Pan3d.LoadManager,e=Pan3d.UIManager,f=function(f){function g(){var b=f.call(this)||this;return b.name="TextureSampleNodeUI"+random(9999999),b.left=400,b.top=100,b._wrap=0,b._mipmap=0,b._filter=0,b.nodeTree=new a.NodeTreeTex,b.nodeTree.ui=b,b.nodeTree.type=a.NodeTree.TEX,b.width=162,b.height=140,b.initItem(),b.resetBgSize(),b.drawTitleToFrame("纹理采样"),b.a_texture_pic_frame=b.getTexturePicUi(),b.a_texture_pic_frame.x=20,b.a_texture_pic_frame.y=55,b}return __extends(g,f),g.prototype.drawTextureUrlToFrame=function(a,b){var c=a.getSkinCtxRect(),d=e.getInstance().getContext2D(c.width,c.height,!1);d.drawImage(b,0,0,c.width,c.height),a.drawToCtx(this._topRender.uiAtlas,d)},g.prototype.getTexturePicUi=function(){var a=this.addEvntBut("a_texture_pic_frame",this._topRender);return a.goToAndStop(g.texture_pic_frame_ID++),a},g.prototype.initItem=function(){this.uvItem=new a.ItemMaterialUI("UV",a.MaterialItemType.VEC2),this.rgbItem=new a.ItemMaterialUI("rgb",a.MaterialItemType.VEC3,!1),this.rItem=new a.ItemMaterialUI("r",a.MaterialItemType.FLOAT,!1),this.gItem=new a.ItemMaterialUI("g",a.MaterialItemType.FLOAT,!1),this.bItem=new a.ItemMaterialUI("b",a.MaterialItemType.FLOAT,!1),this.aItem=new a.ItemMaterialUI("a",a.MaterialItemType.FLOAT,!1),this.rgbaItem=new a.ItemMaterialUI("rgba",a.MaterialItemType.VEC4,!1),this.addItems(this.uvItem),this.addItems(this.rgbItem),this.addItems(this.rItem),this.addItems(this.gItem),this.addItems(this.bItem),this.addItems(this.aItem),this.addItems(this.rgbaItem)},g.prototype.creatBase=function(a){var b=this.nodeTree;b.url=a,b.wrap=this._wrap,b.mipmap=this._mipmap,b.filter=this._filter,b.permul=!1,this.drawPicBmp()},g.prototype.drawPicBmp=function(){var a=this,e=this.nodeTree.url,f=b.getInstance().getImgResByurl(c.fileRoot+e);f?this.drawTextureUrlToFrame(this.a_texture_pic_frame,f):d.getInstance().load(c.fileRoot+e,d.IMG_TYPE,function(b){a.drawTextureUrlToFrame(a.a_texture_pic_frame,b)})},g.prototype.setData=function(a){f.prototype.setData.call(this,a),a.url=String(a.url).replace(c.fileRoot,""),this.nodeTree.url=a.url,this.isMain=a.isMain,this.wrap=a.wrap,this.mipmap=a.mipmap,this.filter=a.filter,this.permul=a.permul,this.drawPicBmp(),this.showDynamic()},g.prototype.getData=function(){var a=f.prototype.getData.call(this);return a.url=this.nodeTree.url,a.isMain=this.isMain,a.wrap=this.wrap,a.mipmap=this.mipmap,a.filter=this.filter,a.permul=this.nodeTree.permul,a},Object.defineProperty(g.prototype,"wrap",{get:function(){return this._wrap},set:function(a){this._wrap=a,this.nodeTree.wrap=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"mipmap",{get:function(){return this._mipmap},set:function(a){this._mipmap=a,this.nodeTree.mipmap=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"filter",{get:function(){return this._filter},set:function(a){this._filter=a,this.nodeTree.filter=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"permul",{get:function(){return this.nodeTree.permul},set:function(a){this.nodeTree.permul=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"isMain",{set:function(a){this.nodeTree.isMain=a},enumerable:!0,configurable:!0}),g.prototype.showDynamic=function(){this.nodeTree.isDynamic?this.drawTitleToFrame("纹理采样<"+this.nodeTree.paramName+">"):this.drawTitleToFrame("纹理采样")},g.texture_pic_frame_ID=0,g}(a.BaseMaterialNodeUI);a.TextureSampleNodeUI=f}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.TextureManager,c=Pan3d.Scene_data,d=Pan3d.LoadManager,e=Pan3d.UIManager,f=function(f){function g(){var b=f.call(this)||this;return b.name="TextureSampleNodeUI"+random(9999999),b.left=400,b.top=100,b._wrap=0,b._mipmap=0,b._filter=0,b._permul=!1,b.nodeTree=new a.NodeTreeTex,b.nodeTree.ui=b,b.nodeTree.type=a.NodeTree.TEX3D,b.width=162,b.height=140,b.initItem(),b.resetBgSize(),b.drawTitleToFrame("3D纹理"),b.a_texture_pic_frame=b.getTexturePicUi(),b.a_texture_pic_frame.x=20,b.a_texture_pic_frame.y=55,b}return __extends(g,f),g.prototype.drawTextureUrlToFrame=function(a,b){var c=a.getSkinCtxRect(),d=e.getInstance().getContext2D(c.width,c.height,!1);d.drawImage(b,0,0,c.width,c.height),a.drawToCtx(this._topRender.uiAtlas,d)},g.prototype.getTexturePicUi=function(){var b=this.addEvntBut("a_texture_pic_frame",this._topRender);return b.goToAndStop(a.TextureSampleNodeUI.texture_pic_frame_ID++),b},g.prototype.initItem=function(){this.uvItem=new a.ItemMaterialUI("UV",a.MaterialItemType.VEC3),this.rgbItem=new a.ItemMaterialUI("rgb",a.MaterialItemType.VEC3,!1),this.addItems(this.uvItem),this.addItems(this.rgbItem)},g.prototype.creatBase=function(a){var b=this.nodeTree;b.url=a,b.wrap=this._wrap,b.mipmap=this._mipmap,b.filter=this._filter,b.permul=this._permul,this.drawPicBmp()},g.prototype.drawPicBmp=function(){var a=this,e=this.nodeTree.url,f=b.getInstance().getImgResByurl(c.fileRoot+e);f?this.drawTextureUrlToFrame(this.a_texture_pic_frame,f):d.getInstance().load(c.fileRoot+e,d.IMG_TYPE,function(b){a.drawTextureUrlToFrame(a.a_texture_pic_frame,b)})},g.prototype.setData=function(a){f.prototype.setData.call(this,a),a.url=String(a.url).replace(c.fileRoot,""),this.nodeTree.url=a.url,this.isMain=a.isMain,this.wrap=a.wrap,this.mipmap=a.mipmap,this.filter=a.filter,this.permul=a.permul,this.drawPicBmp(),this.showDynamic()},g.prototype.getData=function(){var a=f.prototype.getData.call(this);return a.url=this.nodeTree.url,a.isMain=this.isMain,a.wrap=this.wrap,a.mipmap=this.mipmap,a.filter=this.filter,a.permul=this.permul,a},Object.defineProperty(g.prototype,"wrap",{get:function(){return this._wrap},set:function(a){this._wrap=a,this.nodeTree.wrap=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"mipmap",{get:function(){return this._mipmap},set:function(a){this._mipmap=a,this.nodeTree.mipmap=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"filter",{get:function(){return this._filter},set:function(a){this._filter=a,this.nodeTree.filter=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"permul",{get:function(){return this._permul},set:function(a){this._permul=a,this.nodeTree.permul=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"isMain",{set:function(a){this.nodeTree.isMain=a},enumerable:!0,configurable:!0}),g.prototype.showDynamic=function(){this.nodeTree.isDynamic?this.drawTitleToFrame("3d采样<"+this.nodeTree.paramName+">"):this.drawTitleToFrame("3d采样")},g.texture_pic_frame_ID=0,g}(a.BaseMaterialNodeUI);a.Texture3DNodeUI=f}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.TextureManager,c=Pan3d.Scene_data,d=Pan3d.LoadManager,e=Pan3d.UIManager,f=function(f){function g(){var b=f.call(this)||this;return b.name="TextureCubeNodeUI"+random(9999999),b.left=400,b.top=100,b._wrap=0,b._mipmap=0,b._filter=0,b._permul=!1,b.nodeTree=new a.NodeTreeTex,b.nodeTree.ui=b,b.nodeTree.type=a.NodeTree.TEXCUBE,b.width=162,b.height=140,b.initItem(),b.resetBgSize(),b.drawTitleToFrame("天空盒"),b.a_texture_pic_frame=b.getTexturePicUi(),b.a_texture_pic_frame.x=20,b.a_texture_pic_frame.y=55,b}return __extends(g,f),g.prototype.drawTextureUrlToFrame=function(a,b){var c=a.getSkinCtxRect(),d=e.getInstance().getContext2D(c.width,c.height,!1);d.drawImage(b,0,0,c.width,c.height),a.drawToCtx(this._topRender.uiAtlas,d)},g.prototype.getTexturePicUi=function(){var b=this.addEvntBut("a_texture_pic_frame",this._topRender);return b.goToAndStop(a.TextureSampleNodeUI.texture_pic_frame_ID++),b},g.prototype.initItem=function(){this.rgbItem=new a.ItemMaterialUI("rgb",a.MaterialItemType.VEC3,!1),this.addItems(this.rgbItem)},g.prototype.creatBase=function(a){var b=this.nodeTree;b.url=a,b.wrap=this._wrap,b.mipmap=this._mipmap,b.filter=this._filter,b.permul=this._permul,this.drawPicBmp()},g.prototype.drawPicBmp=function(){var a=this,e=this.nodeTree.url,f=b.getInstance().getImgResByurl(c.fileRoot+e);f?this.drawTextureUrlToFrame(this.a_texture_pic_frame,f):d.getInstance().load(c.fileRoot+e,d.IMG_TYPE,function(b){a.drawTextureUrlToFrame(a.a_texture_pic_frame,b)})},g.prototype.setData=function(a){f.prototype.setData.call(this,a),a.url=String(a.url).replace(c.fileRoot,""),this.nodeTree.url=a.url,this.isMain=a.isMain,this.wrap=a.wrap,this.mipmap=a.mipmap,this.filter=a.filter,this.permul=a.permul,this.drawPicBmp(),this.showDynamic()},g.prototype.getData=function(){var a=f.prototype.getData.call(this);return a.url=this.nodeTree.url,a.isMain=this.isMain,a.wrap=this.wrap,a.mipmap=this.mipmap,a.filter=this.filter,a.permul=this.permul,a},Object.defineProperty(g.prototype,"wrap",{get:function(){return this._wrap},set:function(a){this._wrap=a,this.nodeTree.wrap=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"mipmap",{get:function(){return this._mipmap},set:function(a){this._mipmap=a,this.nodeTree.mipmap=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"filter",{get:function(){return this._filter},set:function(a){this._filter=a,this.nodeTree.filter=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"permul",{get:function(){return this._permul},set:function(a){this._permul=a,this.nodeTree.permul=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"isMain",{set:function(a){this.nodeTree.isMain=a},enumerable:!0,configurable:!0}),g.prototype.showDynamic=function(){this.nodeTree.isDynamic?this.drawTitleToFrame("天空盒<"+this.nodeTree.paramName+">"):this.drawTitleToFrame("天空盒")},g.texture_pic_frame_ID=0,g}(a.BaseMaterialNodeUI);a.TextureCubeNodeUI=f}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._blenderMode=0,c._killNum=0,c._backCull=!0,c._writeZbuffer=!0,c._useDynamicIBL=!1,c._normalScale=0,c._lightProbe=!1,c._directLight=!1,c._noLight=!1,c._fogMode=0,c._scaleLightMap=!1,c._hdr=!1,c.name="ResultNodeUI"+random(9999999),c.left=900,c.top=300,c.gap=30,c.width=162,c.height=180,c.nodeTree=new a.NodeTreeOP,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.OP,c.initItem(),c.resetBgSize(),c}return __extends(c,b),c.prototype.initItem=function(){this.diffuseItem=new a.ItemMaterialUI("漫反射",a.MaterialItemType.VEC3),this.normalItem=new a.ItemMaterialUI("法线",a.MaterialItemType.VEC3),this.reflectItem=new a.ItemMaterialUI("反射",a.MaterialItemType.VEC3),this.alphaItem=new a.ItemMaterialUI("透明度",a.MaterialItemType.FLOAT),this.killItem=new a.ItemMaterialUI("不透明蒙版",a.MaterialItemType.FLOAT),this.addItems(this.diffuseItem),this.addItems(this.normalItem),this.addItems(this.reflectItem),this.addItems(this.alphaItem),this.addItems(this.killItem)},Object.defineProperty(c.prototype,"blenderMode",{get:function(){return this._blenderMode},set:function(a){this._blenderMode=a,this.nodeTree.blendMode=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"normalScale",{get:function(){return this._normalScale},set:function(a){this._normalScale=a,this.nodeTree.normalScale=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lightProbe",{get:function(){return this._lightProbe},set:function(a){this._lightProbe=a,this.nodeTree.lightProbe=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"directLight",{get:function(){return this._directLight},set:function(a){this._directLight=a,this.nodeTree.directLight=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"noLight",{get:function(){return this._noLight},set:function(a){this._noLight=a,this.nodeTree.noLight=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fogMode",{get:function(){return this._fogMode},set:function(a){this._fogMode=a,this.nodeTree.fogMode=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleLightMap",{get:function(){return this._scaleLightMap},set:function(a){this._scaleLightMap=a,this.nodeTree.scaleLightMap=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"writeZbuffer",{get:function(){return this._writeZbuffer},set:function(a){this._writeZbuffer=a,this.nodeTree.writeZbuffer=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hdr",{get:function(){return this._hdr},set:function(a){this._hdr=a,this.nodeTree.hdr=a},enumerable:!0,configurable:!0}),c.prototype.getData=function(){var a=b.prototype.getData.call(this);return a.blenderMode=this.blenderMode,a.killNum=this._killNum,a.backCull=this._backCull,a.useDynamicIBL=this._useDynamicIBL,a.normalScale=this.normalScale,a.lightProbe=this.lightProbe,a.directLight=this.directLight,a.noLight=this.noLight,a.fogMode=this.fogMode,a.scaleLightMap=this.scaleLightMap,a.writeZbuffer=this.writeZbuffer,a.hdr=this.hdr,a},c.prototype.setData=function(a){b.prototype.setData.call(this,a),this.blenderMode=a.blenderMode,this._killNum=a.killNum,this._backCull=a.backCull,this._useDynamicIBL=a.useDynamicIBL,this._normalScale=a.normalScale,this._lightProbe=a.lightProbe,this._directLight=a.directLight,this._noLight=a.noLight,this._fogMode=a.fogMode,this._scaleLightMap=a.scaleLightMap,this.hdr=a.hdr,a.hasOwnProperty("writeZbuffer")&&(this._writeZbuffer=a.writeZbuffer),isNaN(this._killNum)&&(this._killNum=0),isNaN(this._normalScale)&&(this._normalScale=1),this.nodeTree.blendMode=this.blenderMode,this.nodeTree.killNum=this._killNum,this.nodeTree.backCull=this._backCull,this.nodeTree.useDynamicIBL=this._useDynamicIBL,this.nodeTree.normalScale=this._normalScale,this.nodeTree.lightProbe=this._lightProbe,this.nodeTree.directLight=this._directLight,this.nodeTree.noLight=this._noLight,this.nodeTree.fogMode=this._fogMode,this.nodeTree.scaleLightMap=this._scaleLightMap,this.nodeTree.writeZbuffer=this._writeZbuffer,this.nodeTree.hdr=this._hdr},c}(a.BaseMaterialNodeUI);a.ResultNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Scene_data,c=Pan3d.Shader3D,d=Pan3d.Vector2D,e=Pan3d.Vector3D,f=Pan3d.UICompenent,g=Pan3d.UIData,h=Pan3d.ProgrmaManager,i=Pan3d.Matrix3D,j=Pan3d.ObjData,k=Pan3d.InteractiveEvent,l=Pan3d.UIRenderComponent,m=Pan3d.ModuleEventManager,n=win.UIPanel,o=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v4Pos")},b.prototype.getVertexShaderString=function(){var a="attribute vec4 v4Pos;uniform vec4 posMove;uniform mat4 viewMatrix3D;void main(void){vec4 vt0= vec4(v4Pos.x+posMove.x,v4Pos.y+posMove.y,1.0,1.0);\nvt0=vt0*viewMatrix3D;\nvt0.x=vt0.x-1.0;\nvt0.y=vt0.y+1.0;\ngl_Position = vt0;\n}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nvoid main(void)\n{\ngl_FragColor = vec4(0.9,0.9,0.9, 0.9);\n}";return a},b.NodeLineLinkShader="NodeLineLinkShader",b}(c);a.NodeLineLinkShader=o;var p=function(a){function b(){var b=a.call(this)||this;return b.x=g.designWidth/2,b.y=g.designHeight/2,b.width=20,b.height=20,b}return __extends(b,a),b.prototype.applyRenderSize=function(){},b}(f);a.MapLineUi=p;var q=function(c){function f(){var a=c.call(this)||this;return h.getInstance().registe(o.NodeLineLinkShader,new o),a.shader=h.getInstance().getProgram(o.NodeLineLinkShader),a.program=a.shader.program,a}return __extends(f,c),f.prototype.makeLineUiItem=function(a){if(a&&a.length>1){this.mapLineUiList=new Array;for(var b=a[0],c=1,e=0;e<a.length;e++)for(;d.distance(b,a[e])>c;){b=this.nextPostForTow(b,a[e],c/2);var f=new d;f.x=b.x,f.y=b.y,this.mapLineUiList.push(f)}this.makeLineVetlineObjData()}else this.objData.treNum=0,console.log("路线清除")},f.prototype.nextPostForTow=function(a,b,c){var e=new d(b.x-a.x,b.y-a.y);return e.normalize(),e.x=e.x*c,e.y=e.y*c,e.x+=a.x,e.y+=a.y,e},f.prototype.makeLineVetlineObjData=function(){this.objData||(this.objData=new j),this.objData.vertices=new Array,this.objData.indexs=new Array,this.getUiDataForItem(),this.objData.vertexBuffer?(b.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),b.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=b.context3D.uploadBuff3D(this.objData.vertices),this.objData.indexBuffer=b.context3D.uploadIndexBuff3D(this.objData.indexs)),this.objData.treNum=this.objData.indexs.length},f.prototype.getUiDataForItem=function(){for(var a=(new Array,2),b=0;b<this.mapLineUiList.length;b++){var c=this.mapLineUiList[b];if(0==b)this.objData.vertices.push(c.x,c.y,1,1),this.objData.vertices.push(c.x,c.y,1,1);else{var d=this.mapLineUiList[b-1],f=Math.atan2(c.y-d.y,c.x-d.x),g=new i;g.appendRotation(180*f/Math.PI,e.Z_AXIS),g.appendTranslation(c.x,c.y,0);var h=g.transformVector(new e(0,+a,0)),j=g.transformVector(new e(0,-a,0));this.objData.vertices.push(h.x,h.y,1,1),this.objData.vertices.push(j.x,j.y,1,1);var k=b-1;this.objData.indexs.push(0+2*k,1+2*k,3+2*k),this.objData.indexs.push(0+2*k,3+2*k,2+2*k)}}},f.prototype.update=function(){if(this.objData&&this.objData.treNum>0){b.context3D.setProgram(this.program),b.context3D.setVa(0,4,this.objData.vertexBuffer);var c=new i;c.appendScale(2/b.stageWidth*a.MtlUiData.Scale,-2/b.stageHeight*a.MtlUiData.Scale,1),b.context3D.setVc4fv(this.shader,"posMove",[AppData.stagePos.x,AppData.stagePos.y,0,0]),b.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",c.m),b.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},f}(l);a.NodeLineLinkComponent=q;var r=function(c){function e(){var a=c.call(this)||this;return a.layer=1,a.width=200,a.height=200,a._lineList=new Array,a}return __extends(e,c),e.prototype.startLine=function(c){this._currentLine=new a.MaterialNodeLineUI,this._currentLine.parent=this,this.addRender(this._currentLine.lineRender),this._currentLine.setFromNode(c),b.uiStage.addEventListener(k.Up,this.onMouseUp,this)},e.prototype.removeLine=function(a){for(var b;b<this._lineList.length;b++)if(this._lineList[b]==a){this._lineList.splice(b,1);break}a.remove()},e.prototype.globalToLocal=function(a){var b=new d(a.x-AppData.stagePos.x,a.y-AppData.stagePos.y);return b},e.prototype.getMouse=function(b){var c=new d(b.x/a.MtlUiData.Scale-AppData.stagePos.x,b.y/a.MtlUiData.Scale-AppData.stagePos.y);return c},e.prototype.onMouseUp=function(c){var e=a.MaterialCtrl.getInstance().nodeUiPanel.getObjectsUnderPoint(new d(c.x,c.y));console.log(e);var f=new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_STOPDRAG);e&&"a_point_frame"==e.name&&(f.itemNode=e.data),m.dispatchEvent(f),b.uiStage.removeEventListener(k.Up,this.onMouseUp,this)},e.prototype.addConnentLine=function(b,c){this._currentLine=new a.MaterialNodeLineUI,this._currentLine.parent=this,this.addRender(this._currentLine.lineRender),this._currentLine.setFromNode(b),this._currentLine.setEndNode(c),this._lineList.push(this._currentLine)},e.prototype.stopLine=function(b){b?this._currentLine.needNodeType!=b.inOut||b.parent==this._currentLine.currentHasNode.parent||b.typets!=a.MaterialItemType.UNDEFINE&&b.typets!=this._currentLine.currentHasNode.typets?this._currentLine.removeStage():(b.typets==a.MaterialItemType.UNDEFINE&&b.changeType(this._currentLine.currentHasNode.typets),this._currentLine.setEndNode(b),this._lineList.push(this._currentLine)):this._currentLine.removeStage()},e}(n);a.MaterialLineContainer=r}(materialui||(materialui={}));var materialui;!function(a){var b=Pan3d.Vector2D,c=function(){function a(){}return a.drawbezier=function(a,c){for(var d=new Array,e=0;e<a.length;e++)d.push(new b(a[e].x,a[e].y));for(;d.length>1;){for(var f=0;f<d.length-1;f++)this.mathmidpoint(d[f],d[f+1],c);d.pop()}return d[0]},a.mathmidpoint=function(a,b,c){var d,e;d=a.x+(b.x-a.x)*c,e=a.y+(b.y-a.y)*c,a.x=d,a.y=e},a}();a.BezierClasszip=c;var d=Pan3d.InteractiveEvent,e=Pan3d.Scene_data,f=Pan3d.ModuleEventManager,g=function(){function g(){this.lineRender=new a.NodeLineLinkComponent}return g.prototype.setFromNode=function(a){a.inOut?this.endNode=a:this.fromNode=a,this.currentHasNode=a,this.needNodeType=!a.inOut,e.uiStage.addEventListener(d.Move,this.onMove,this)},g.prototype.onMove=function(a){this.mousePos=a,this.draw()},g.prototype.setEndNode=function(a){a.inOut?this.endNode=a:this.fromNode=a,
e.uiStage.removeEventListener(d.Move,this.onMove,this),this.draw(),this.setNodeLine()},g.prototype.setNodeLine=function(){if(this.endNode.inLine){var b=new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_REMOVELINE);b.line=this.endNode.inLine,f.dispatchEvent(b)}this.endNode.typets==a.MaterialItemType.UNDEFINE&&this.endNode.changeType(this.fromNode.typets),this.fromNode.outLineList.push(this),this.endNode.inLine=this,this.fromNode.setConnect(),this.endNode.setConnect(),this.endNode.nodeTreeItem.parentNodeItem=this.fromNode.nodeTreeItem,this.fromNode.nodeTreeItem.pushSunNode(this.endNode.nodeTreeItem)},g.prototype.removeStage=function(){this.parent&&(this.parent&&e.uiStage.removeEventListener(d.Move,this.onMove,this),this.parent.removeRender(this.lineRender),this.parent=null)},g.prototype.draw=function(){this.fromNode?this.startPoint=this.parent.globalToLocal(this.fromNode.getStagePoint()):this.startPoint=this.parent.getMouse(this.mousePos),this.endNode?this.endPoint=this.parent.globalToLocal(this.endNode.getStagePoint()):this.endPoint=this.parent.getMouse(this.mousePos);var a=new Array;a.push(this.startPoint),a.push(new b(this.startPoint.x+100,this.startPoint.y)),a.push(new b(this.endPoint.x-100,this.endPoint.y)),a.push(this.endPoint);for(var d=new Array,e=0;100>e;e++)d.push(c.drawbezier(a,e/100));this.lineRender.makeLineUiItem(d)},g.prototype.remove=function(){this.removeStage(),this.fromNode&&(this.fromNode.removeOut(this),this.fromNode.nodeTreeItem.removeSunNode(this.endNode.nodeTreeItem)),this.endNode&&(this.endNode.removeIn(),this.endNode.nodeTreeItem.parentNodeItem=null)},g}();a.MaterialNodeLineUI=g}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.TexItem,c=Pan3d.Material,d=Pan3d.ConstItem,e=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;return a.texList=new Array,a.constList=new Array,a.killNum=0,a.writeZbuffer=!0,a.fcIDAry=new Array,a}return __extends(e,c),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0}),e.prototype.setData=function(a){this.data=a.data,this.compileData=a.compileData},e.prototype.clone=function(){var a=new e,b=this;return a.data=b.data,a.constList=b.constList,a.fcNum=b.fcNum,a.fcData=b.fcData,a.texList=b.texList,a.useNormal=b.useNormal,a.useLightUv=b.useLightUv,a.hasTime=b.hasTime,a.timeSpeed=b.timeSpeed,a.timeValue=b.timeValue,a.useUv=b.useUv,a.blendMode=b.blendMode,a},Object.defineProperty(e.prototype,"compileData",{set:function(c){if(c){if(this._compileData=c,this.shaderStr=this._compileData.shaderStr,this.hasTime=this._compileData.hasTime,this.timeSpeed=this._compileData.timeSpeed,this.blendMode=this._compileData.blendMode,this.backCull=this._compileData.backCull,this.killNum=this._compileData.killNum,this.hasVertexColor=this._compileData.hasVertexColor,this.usePbr=this._compileData.usePbr,this.useNormal=this._compileData.useNormal,this.roughness=this._compileData.roughness,this.writeZbuffer=this._compileData.writeZbuffer,this.hasFresnel=this._compileData.hasFresnel,this.useDynamicIBL=this._compileData.useDynamicIBL,this.normalScale=this._compileData.normalScale,this.lightProbe=this._compileData.lightProbe,this.directLight=this._compileData.directLight,this.noLight=this._compileData.noLight,this.fogMode=this._compileData.fogMode,this.scaleLightMap=this._compileData.scaleLightMap,this.useKill=this._compileData.useKill,this.fcNum=this._compileData.fcNum,this.fcIDAry=this._compileData.fcIDAry,this.hasAlpha=this._compileData.hasAlpha,this.skyBoxTextId=this._compileData.skyBoxTextId,this.hasSkyBox=this._compileData.hasSkyBox,this.materialBaseData=new a.MaterialBaseData,this.materialBaseData.setData(this._compileData.materialBaseData),this._compileData.texList){var e=this._compileData.texList;this.texList=new Array;for(var f=0;f<e.length;f++){var g=new b;g.id=e[f].id,g.url=e[f].url,g.isDynamic=e[f].isDynamic,g.paramName=e[f].paramName,g.isMain=e[f].isMain,g.wrap=e[f].wrap,g.filter=e[f].filter,g.mipmap=e[f].mipmap,g.permul=e[f].permul,g.isParticleColor=e[f].isParticleColor,g.type=e[f].type,this.texList.push(g)}}if(this._compileData.constList)for(e=this._compileData.constList,this.constList=new Array,f=0;f<e.length;f++){var h=new d;h.setData(e[f]),this.constList.push(h)}}},enumerable:!0,configurable:!0}),e}(c);a.MaterialTree=e}(materialui||(materialui={}));var materialui;!function(a){var b=function(){function b(){this.initData()}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.initData=function(){this.nodeList=new Array,this.uiList=new Array,this._materialTree=new a.MaterialTree},b.prototype.addNodeUI=function(a){var b=a.nodeTree;-1==b.id&&(this.nodeList.length?b.id=this.nodeList[this.nodeList.length-1].id+1:b.id=0),this.nodeList.push(b),this.uiList.push(a),this.addUIContainer(a)},b.prototype.addUIContainer=function(a){this.nodeUiPanel.addUIContainer(a)},b.prototype.removeUI=function(a){for(var b=0;b<this.uiList.length;b++)if(this.uiList[b]==a){this.uiList.splice(b,1);break}},b.prototype.getObj=function(){for(var a=new Array,b=0;b<this.uiList.length;b++){var c=this.uiList[b];if(c){var d=c.getObj();a.push(d)}}return a},b}();a.MaterialCtrl=b}(materialui||(materialui={}));var materialui;!function(a){var b=Pan3d.LoadManager,c=Pan3d.Scene_data,d=function(){function d(){}return d.getInstance=function(){return this._instance||(this._instance=new d),this._instance},d.prototype.getMaterial=function(d,e){b.getInstance().load(c.fileRoot+d,b.XML_TYPE,function(b){var f=new a.MaterialTree;f.url=d.replace(c.fileRoot,"");var g=JSON.parse(b);f.setData(g),e&&e(f)})},d}();a.MaterialTreeManager=d}(materialui||(materialui={}));var materialui;!function(a){var b=Pan3d.ModuleEventManager,c=function(){function c(){}return c.getInstance=function(){return this._instance||(this._instance=new c),this._instance},c.prototype.setData=function(b){a.BaseMaterialNodeUI.titleFrameId=0,a.TextureSampleNodeUI.texture_pic_frame_ID=0,this._uiVec=new Array;var c;if(b){for(var d=0;d<b.length;d++)c=this.getUI(b[d].type),c.setData(b[d].data),c.setInItemByData(b[d].inAry),c.setOutItemByData(b[d].outAry),c.nodeTree.id=b[d].id,this.addFun(c),this._uiVec.push(c);this._dataAry=b,this.drawLine()}else;},c.prototype.drawLine=function(){for(var c=0;c<this._dataAry.length;c++)for(var d=this._dataAry[c].inAry,e=0;e<d.length;e++)if(d[e].parentObj){var f=this.getUIbyID(this._dataAry[c].id,d[e].id,!0),g=this.getUIbyID(d[e].parentObj.pid,d[e].parentObj.id,!1);f.typets==a.MaterialItemType.UNDEFINE&&f.changeType(g.typets);var h=new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_DOUBLUELINE);h.startNode=g,h.endNode=f,b.dispatchEvent(h)}},c.prototype.getUIbyID=function(a,b,c){var d=this.getNodeUI(a);return c?d.getInItem(b):d.getOutItem(b)},c.prototype.getNodeUI=function(a){for(var b=0;b<this._uiVec.length;b++)if(this._uiVec[b].nodeTree.id==a)return this._uiVec[b];return null},c.prototype.getUI=function(b){var c;switch(b){case a.NodeTree.OP:c=new a.ResultNodeUI;break;case a.NodeTree.TEX:c=new a.TextureSampleNodeUI;break;case a.NodeTree.TEX3D:c=new a.Texture3DNodeUI;break;case a.NodeTree.TEXCUBE:c=new a.TextureCubeNodeUI;break;case a.NodeTree.TEXCOORD:c=new a.TexCoordNodeUI;break;case a.NodeTree.TEXCOORDLIGHT:c=new a.TexLightUvNodeUI;break;case a.NodeTree.PANNER:c=new a.PannerNodeUI;break;case a.NodeTree.SUB:c=new a.MathAddNodeUI;break;case a.NodeTree.ADD:c=new a.MathAddNodeUI;break;case a.NodeTree.MUL:c=new a.MathMulNodeUI;break;case a.NodeTree.DIV:c=new a.MathDivNodeUI;break;case a.NodeTree.SIN:c=new a.MathSinNodeUI;break;case a.NodeTree.COS:c=new a.MathCosNodeUI;break;case a.NodeTree.VEC3:c=new a.ConstVec3NodeUI;break;case a.NodeTree.VEC2:c=new a.ConstVec2NodeUI;break;case a.NodeTree.FLOAT:c=new a.ConstFloatNodeUI;break;case a.NodeTree.FRESNEL:c=new a.FresnelNodeUI;break;case a.NodeTree.TIME:c=new a.TimeNodeUI;break;case a.NodeTree.NORMAL:c=new a.NormalNodeUI;break;case a.NodeTree.FUN:c=new a.MathFunNodeUI}return c},c}();a.MaterialViewBuildUtils=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.gap=20,a.width=162,a.height=60,a.resetBgSize(),a}return __extends(c,b),c.prototype.initItem=function(){this.intAItem=new a.ItemMaterialUI("a",a.MaterialItemType.UNDEFINE),this.intBItem=new a.ItemMaterialUI("b",a.MaterialItemType.UNDEFINE),this.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.UNDEFINE,!1),this.outRItem=new a.ItemMaterialUI("r",a.MaterialItemType.FLOAT,!1),this.outGItem=new a.ItemMaterialUI("g",a.MaterialItemType.FLOAT,!1),this.outBItem=new a.ItemMaterialUI("b",a.MaterialItemType.FLOAT,!1),this.outXYItem=new a.ItemMaterialUI("xy",a.MaterialItemType.VEC2,!1),this.outRGBItem=new a.ItemMaterialUI("rgb",a.MaterialItemType.VEC3,!1),this.outAItem=new a.ItemMaterialUI("a",a.MaterialItemType.FLOAT,!1),this.addItems(this.intAItem),this.addItems(this.intBItem),this.addItems(this.outItem),this.addEvents(this.intAItem),this.addEvents(this.intBItem),this.addEvents(this.outItem),this.addDisEvent(this.intAItem),this.addDisEvent(this.intBItem),this.addDisEvent(this.outItem),this.addDisEvent(this.outRItem),this.addDisEvent(this.outGItem),this.addDisEvent(this.outBItem),this.addDisEvent(this.outXYItem),this.addDisEvent(this.outRGBItem),this.addDisEvent(this.outAItem)},c.prototype.addEvents=function(a){a.addEventListener("Connect",this.onConnect,this)},c.prototype.addDisEvent=function(a){a.addEventListener("DisConnect",this.disConnect,this)},c.prototype.disConnect=function(a){this.checkItem()},c.prototype.onConnect=function(b){var c=b.target,d=c.typets;c.changeType(d),this.checkItem(),this.intAItem.typets!=a.MaterialItemType.UNDEFINE&&this.intBItem.typets!=a.MaterialItemType.UNDEFINE&&this.intAItem.typets!=a.MaterialItemType.FLOAT&&this.intBItem.typets!=a.MaterialItemType.FLOAT&&this.intAItem.typets!=this.intBItem.typets&&c.removeAllLine()},c.prototype.checkItem=function(){this.intAItem.hasConnet||this.intAItem.changeType(a.MaterialItemType.UNDEFINE),this.intBItem.hasConnet||this.intBItem.changeType(a.MaterialItemType.UNDEFINE),this.outItem.hasConnet||this.outItem.changeType(a.MaterialItemType.UNDEFINE),this.outItem.typets==a.MaterialItemType.VEC3?(this.intAItem.typets==a.MaterialItemType.FLOAT&&this.intBItem.typets==a.MaterialItemType.UNDEFINE&&this.intBItem.changeType(a.MaterialItemType.VEC3),this.intBItem.typets==a.MaterialItemType.FLOAT&&this.intAItem.typets==a.MaterialItemType.UNDEFINE&&this.intAItem.changeType(a.MaterialItemType.VEC3)):this.outItem.typets==a.MaterialItemType.VEC4?(this.intAItem.typets==a.MaterialItemType.FLOAT&&this.intBItem.typets==a.MaterialItemType.UNDEFINE&&this.intBItem.changeType(a.MaterialItemType.VEC4),this.intBItem.typets==a.MaterialItemType.FLOAT&&this.intAItem.typets==a.MaterialItemType.UNDEFINE&&this.intAItem.changeType(a.MaterialItemType.VEC4)):this.outItem.typets==a.MaterialItemType.VEC2?(this.intAItem.typets==a.MaterialItemType.FLOAT&&this.intBItem.typets==a.MaterialItemType.UNDEFINE&&this.intBItem.changeType(a.MaterialItemType.VEC2),this.intBItem.typets==a.MaterialItemType.FLOAT&&this.intAItem.typets==a.MaterialItemType.UNDEFINE&&this.intAItem.changeType(a.MaterialItemType.VEC2)):this.outItem.typets==a.MaterialItemType.FLOAT?(this.intAItem.typets==a.MaterialItemType.UNDEFINE&&this.intAItem.changeType(a.MaterialItemType.FLOAT),this.intBItem.typets==a.MaterialItemType.UNDEFINE&&this.intBItem.changeType(a.MaterialItemType.FLOAT)):this.outItem.typets==a.MaterialItemType.UNDEFINE&&(this.intAItem.typets==a.MaterialItemType.VEC4||this.intBItem.typets==a.MaterialItemType.VEC4?this.outItem.changeType(a.MaterialItemType.VEC4):this.intAItem.typets==a.MaterialItemType.VEC3||this.intBItem.typets==a.MaterialItemType.VEC3?this.outItem.changeType(a.MaterialItemType.VEC3):this.intAItem.typets==a.MaterialItemType.VEC2||this.intBItem.typets==a.MaterialItemType.VEC2?this.outItem.changeType(a.MaterialItemType.VEC2):this.intAItem.typets==a.MaterialItemType.FLOAT&&this.intBItem.typets==a.MaterialItemType.FLOAT&&this.outItem.changeType(a.MaterialItemType.FLOAT)),this.outItem.typets==a.MaterialItemType.VEC4?(this.addItems(this.outRItem),this.addItems(this.outGItem),this.addItems(this.outBItem),this.addItems(this.outXYItem),this.addItems(this.outRGBItem),this.addItems(this.outAItem),this.height=180):this.outItem.typets==a.MaterialItemType.VEC3?(this.addItems(this.outRItem),this.addItems(this.outGItem),this.addItems(this.outBItem),this.addItems(this.outXYItem),this.height=140,this.removeItem(this.outRGBItem),this.outRGBItem.removeAllLine(),this.removeItem(this.outAItem),this.outAItem.removeAllLine()):(this.removeItem(this.outRItem),this.outRItem.removeAllLine(),this.removeItem(this.outGItem),this.outGItem.removeAllLine(),this.removeItem(this.outBItem),this.outBItem.removeAllLine(),this.removeItem(this.outXYItem),this.outXYItem.removeAllLine(),this.removeItem(this.outRGBItem),this.outRGBItem.removeAllLine(),this.removeItem(this.outAItem),this.outAItem.removeAllLine(),this.height=80),this.resetBgSize()},c.prototype.setInItemByData=function(a){b.prototype.setInItemByData.call(this,a),this.intAItem.changeType(a[0].type),this.intBItem.changeType(a[1].type)},c.prototype.setOutItemByData=function(a){b.prototype.setOutItemByData.call(this,a),this.outItem.changeType(a[0].type),a.length>=2&&(this.addItems(this.outRItem),this.addItems(this.outGItem),this.addItems(this.outBItem),this.addItems(this.outXYItem)),a.length>=6&&(this.addItems(this.outRGBItem),this.addItems(this.outAItem))},c}(a.BaseMaterialNodeUI);a.MathDynamicNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.left=600,c.top=300,c.nodeTree=new a.NodeTreeAdd,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.ADD,c.initItem(),c.drawTitleToFrame("加法(Add+)"),c}return __extends(c,b),c}(a.MathDynamicNodeUI);a.MathAddNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.left=600,c.top=300,c.nodeTree=new a.NodeTreeSub,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.SUB,c.initItem(),c.drawTitleToFrame("减法(Sub-)"),c}return __extends(c,b),c}(a.MathDynamicNodeUI);a.MathSubNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.left=600,c.top=300,c.nodeTree=new a.NodeTreeMul,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.MUL,c.initItem(),c.drawTitleToFrame("乘法(Mul*)"),c}return __extends(c,b),c}(a.MathDynamicNodeUI);a.MathMulNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.left=600,c.top=300,c.nodeTree=new a.NodeTreeDiv,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.DIV,c.initItem(),c.drawTitleToFrame("除法(Div/)"),c}return __extends(c,b),c}(a.MathDynamicNodeUI);a.MathDivNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.left=600,a.top=300,a.gap=20,a.width=162,a.height=80,a.resetBgSize(),a}return __extends(c,b),c.prototype.initItem=function(){this.intItem=new a.ItemMaterialUI("in",a.MaterialItemType.FLOAT),this.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.FLOAT,!1),this.addItems(this.intItem),this.addItems(this.outItem)},c}(a.BaseMaterialNodeUI);a.MathStaticNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.left=600,c.top=300,c.nodeTree=new a.NodeTreeSin,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.SIN,c.initItem(),c.drawTitleToFrame("正弦(sin)"),c}return __extends(c,b),c}(a.MathStaticNodeUI);a.MathSinNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.left=600,c.top=300,c.nodeTree=new a.NodeTreeCos,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.COS,c.initItem(),c.drawTitleToFrame("余弦(cos)"),c}return __extends(c,b),c}(a.MathStaticNodeUI);a.MathCosNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector3D,c=function(c){function d(){var d=c.call(this)||this;return d._bastTitleStr="vec3",d.gap=20,d.width=162,d.height=95,d._constValue=new b,d.initNodeTree(),d.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.VEC3,!1),d.addItems(d.outItem),d.outAItem=new a.ItemMaterialUI("alpha",a.MaterialItemType.FLOAT,!1),d.addItems(d.outAItem),d.outRGBAItem=new a.ItemMaterialUI("rgba",a.MaterialItemType.VEC4,!1),d.addItems(d.outRGBAItem),d.drawTitleToFrame("vec3"),d}return __extends(d,c),d.prototype.getData=function(){var a=c.prototype.getData.call(this);return a.constValue=this._constValue,a},d.prototype.initNodeTree=function(){this.nodeTree=new a.NodeTreeVec3,this.nodeTree.ui=this,this.nodeTree.type=a.NodeTree.VEC3},d.prototype.setData=function(a){c.prototype.setData.call(this,a),this.constValue=new b(a.constValue.x,a.constValue.y,a.constValue.z,a.constValue.w),this.nodeTree.constVec3=this.constValue,this.showDynamic()},Object.defineProperty(d.prototype,"constValue",{get:function(){return this._constValue},set:function(a){this._constValue=a,this.nodeTree.constVec3=a,this.showDynamic()},enumerable:!0,configurable:!0}),d.prototype.showDynamic=function(){this.nodeTree.isDynamic?this.drawTitleToFrame("vec3<"+this.nodeTree.paramName+">("+this.getNumStr(this.constValue.x)+","+this.getNumStr(this.constValue.y)+","+this.getNumStr(this.constValue.z)+","+this.getNumStr(this.constValue.w)+")"):this.drawTitleToFrame("vec3("+this.getNumStr(this.constValue.x)+","+this.getNumStr(this.constValue.y)+","+this.getNumStr(this.constValue.z)+","+this.getNumStr(this.constValue.w)+")")},d.prototype.getNumStr=function(a){var b=Math.floor(100*a)/100;return b.toString()},d}(a.BaseMaterialNodeUI);a.ConstVec3NodeUI=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector2D,c=function(c){function d(){var b=c.call(this)||this;return b.gap=20,b.width=162,b.height=95,b.gap=20,b.width=162,b.height=65,b.nodeTree=new a.NodeTreeVec2,b.nodeTree.ui=b,b.nodeTree.type=a.NodeTree.VEC2,b.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.VEC2,!1),b.addItems(b.outItem),b.drawTitleToFrame("vec2"),b}return __extends(d,c),Object.defineProperty(d.prototype,"constValue",{get:function(){return this.nodeTree.constValue},set:function(a){this.nodeTree.constValue=a,this.showDynamic()},enumerable:!0,configurable:!0}),d.prototype.getData=function(){var a=c.prototype.getData.call(this);return a.constValue=this.constValue,a},d.prototype.setData=function(a){c.prototype.setData.call(this,a),this.constValue=new b(a.constValue.x,a.constValue.y),this.showDynamic()},d.prototype.showDynamic=function(){this.nodeTree.isDynamic?this.drawTitleToFrame("vec2<"+this.nodeTree.paramName+">("+this.getNumStr(this.constValue.x)+","+this.getNumStr(this.constValue.y)+")"):this.drawTitleToFrame("vec2("+this.getNumStr(this.constValue.x)+","+this.getNumStr(this.constValue.y)+")")},d.prototype.getNumStr=function(a){var b=Math.floor(100*a)/100;return b.toString()},d}(a.BaseMaterialNodeUI);a.ConstVec2NodeUI=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.gap=20,c.width=162,c.height=65,c._constValue=0,c.nodeTree=new a.NodeTreeFloat,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.FLOAT,c.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.FLOAT,!1),c.addItems(c.outItem),c.drawTitleToFrame("float"),c}return __extends(c,b),c.prototype.setData=function(a){b.prototype.setData.call(this,a),this.constValue=a.constValue,this.nodeTree.constValue=this.constValue,this.showDynamic()},c.prototype.getData=function(){var a=b.prototype.getData.call(this);return a.constValue=this._constValue,a},Object.defineProperty(c.prototype,"constValue",{get:function(){return this._constValue},set:function(a){this._constValue=a,this.nodeTree.constValue=a,this.showDynamic()},enumerable:!0,configurable:!0}),c.prototype.showDynamic=function(){this.nodeTree.isDynamic?this.drawTitleToFrame("float<"+this.nodeTree.paramName+">("+this.getNumStr(this._constValue)+")"):this.drawTitleToFrame("float("+this.getNumStr(this._constValue)+")")},c.prototype.getNumStr=function(a){var b=Math.floor(100*a)/100;return b.toString()},c}(a.BaseMaterialNodeUI);a.ConstFloatNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.gap=20,c.width=162,c.height=65,c.nodeTree=new a.NodeTreeFresnel,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.FRESNEL,c.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.FLOAT,!1),c.addItems(c.outItem),c.inAItem=new a.ItemMaterialUI("scale",a.MaterialItemType.FLOAT,!0),c.addItems(c.inAItem),c.inBItem=new a.ItemMaterialUI("add",a.MaterialItemType.FLOAT,!0),c.addItems(c.inBItem),c.drawTitleToFrame("Fresnel"),c}return __extends(c,b),c}(a.BaseMaterialNodeUI);a.FresnelNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.gap=20,c.width=162,c.height=65,c.nodeTree=new a.NodeTreeTexCoord,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.TEXCOORD,c.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.VEC2,!1),c.addItems(c.outItem),c.drawTitleToFrame("TexCoord"),c}return __extends(c,b),c}(a.BaseMaterialNodeUI);a.TexCoordNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.gap=20,c.width=162,c.height=65,c.nodeTree=new a.NodeTreeLightuv,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.TEXCOORDLIGHT,c.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.VEC2,!1),c.addItems(c.outItem),c.drawTitleToFrame("Lightuv"),c}return __extends(c,b),c}(a.BaseMaterialNodeUI);a.TexLightUvNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector2D,c=function(c){function d(){var d=c.call(this)||this;return d.gap=20,d.width=162,d.height=85,d._coordinate=new b,d._speed=new b,d.nodeTree=new a.NodeTreePanner,d.nodeTree.ui=d,d.nodeTree.type=a.NodeTree.PANNER,d.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.VEC2,!1),d.addItems(d.outItem),d.inItem=new a.ItemMaterialUI("coordinate",a.MaterialItemType.VEC2,!0),d.addItems(d.inItem),d.inSpeedItem=new a.ItemMaterialUI("speed",a.MaterialItemType.VEC2,!0),d.addItems(d.inSpeedItem),d.drawTitleToFrame("UV"),d}return __extends(d,c),Object.defineProperty(d.prototype,"speed",{get:function(){return this._speed},set:function(a){this._speed=a,this.nodeTree.speedValue=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"coordinate",{get:function(){return this._coordinate},set:function(a){this._coordinate=a,this.nodeTree.coordinateValue=a},enumerable:!0,configurable:!0}),d.prototype.setData=function(a){c.prototype.setData.call(this,a),this.coordinate=new b(a.coordinate.x,a.coordinate.y),this.speed=new b(a.speed.x,a.speed.y)},d}(a.BaseMaterialNodeUI);a.PannerNodeUI=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c._speed=1,c.gap=20,c.width=162,c.height=65,c.nodeTree=new a.NodeTreeTime,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.TIME,c.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.FLOAT,!1),c.addItems(c.outItem),c.drawTitleToFrame("Time"),c}return __extends(c,b),Object.defineProperty(c.prototype,"speed",{get:function(){return this._speed},set:function(a){this._speed=a,this.nodeTree.speed=this.speed},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"timeValue",{get:function(){return this.nodeTree.timeValue},set:function(a){this.nodeTree.timeValue=a},enumerable:!0,configurable:!0}),c.prototype.getData=function(){var a=b.prototype.getData.call(this);return a.speed=this._speed,this.timeValue||(this.timeValue=new Vector2D(1,1)),a.timeValue=this.timeValue,a},c.prototype.setData=function(a){b.prototype.setData.call(this,a),a.speed?this.speed=a.speed:this.speed=1,a.timeValue?this.timeValue=new Vector2D(a.timeValue.x,a.timeValue.y):this.timeValue=new Vector2D(1,1),this.nodeTree.speed=this.speed},c}(a.BaseMaterialNodeUI);a.TimeNodeUI=b}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Vector3D,c=function(c){function d(){var d=c.call(this)||this;return d._bastTitleStr="Normal",d.gap=20,d.width=162,d.height=60,d._constValue=new b,d.initNodeTree(),d.outItem=new a.ItemMaterialUI("out",a.MaterialItemType.VEC3,!1),d.addItems(d.outItem),d.drawTitleToFrame("Normal"),d}return __extends(d,c),d.prototype.getData=function(){var a=c.prototype.getData.call(this);return a.constValue=this._constValue,a},d.prototype.initNodeTree=function(){this.nodeTree=new a.NodeTreeNormal,this.nodeTree.ui=this,this.nodeTree.type=a.NodeTree.NORMAL},d.prototype.setData=function(a){c.prototype.setData.call(this,a),this.constValue=new b(a.constValue.x,a.constValue.y,a.constValue.z,a.constValue.w),this.nodeTree.constVec3=this.constValue},Object.defineProperty(d.prototype,"constValue",{get:function(){return this._constValue},set:function(a){this._constValue=a,this.nodeTree.constVec3=a},enumerable:!0,configurable:!0}),d}(a.BaseMaterialNodeUI);a.NormalNodeUI=c}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){
this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=function(b){function c(){var c=b.call(this)||this;return c.left=600,c.top=300,c.nodeTree=new a.NodeTreeFun,c.nodeTree.ui=c,c.nodeTree.type=a.NodeTree.FUN,c.drawTitleToFrame("函数(Fun*)"),c.gap=20,c.width=162,c.height=30,c.resetBgSize(),c.inPutFunStr(),c}return __extends(c,b),c.prototype.inPutFunStr=function(b){void 0===b&&(b=null);var c="vec3 die(vec3 lightuv,vec3 movePos){\nreturn vec3(1,0,1);\n}\n";b&&(c=b);var d=a.NodeTreeFun.getMathFunName(c),e=a.NodeTreeFun.getMathFunReturnType(c),f=a.NodeTreeFun.getDataMathFunArr(c);this.nodeTree.funStr=c,this.nodeTree.funName=d,this.clearNode();for(var g=0;g<f.length;g++){var h=new a.ItemMaterialUI(f[g].name,f[g].type);this.addItems(h),this.addEvents(h),this.addDisEvent(h)}this.outItem=new a.ItemMaterialUI("out",e,!1),this.addItems(this.outItem),this.addEvents(this.outItem),this.addDisEvent(this.outItem),this.resetBgSize(),this.drawTitleToFrame("函数("+d+")")},c.prototype.clearNode=function(){for(this.removeAllNodeLine();this.inPutItemVec.length;)this.removeItem(this.inPutItemVec.pop());for(;this.outPutItemVec.length;)this.removeItem(this.outPutItemVec.pop())},c.prototype.resetBgSize=function(){this.height=30*this.inPutItemVec.length,b.prototype.resetBgSize.call(this)},c.prototype.addEvents=function(a){a.addEventListener("Connect",this.onConnect,this)},c.prototype.addDisEvent=function(a){a.addEventListener("DisConnect",this.disConnect,this)},c.prototype.removeEvents=function(a){a.removeEventListener("Connect",this.onConnect,this)},c.prototype.removeDisEvent=function(a){a.removeEventListener("DisConnect",this.disConnect,this)},c.prototype.disConnect=function(a){this.checkItem()},c.prototype.onConnect=function(a){var b=a.target,c=b.typets;b.changeType(c),this.checkItem()},c.prototype.checkItem=function(){this.resetBgSize()},c.prototype.setData=function(a){b.prototype.setData.call(this,a),this.nodeTree.funStr=a.funStr,this.inPutFunStr(this.nodeTree.funStr)},c.prototype.getData=function(){var a=b.prototype.getData.call(this);return a.funStr=this.nodeTree.funStr,a},c.prototype.setInItemByData=function(a){b.prototype.setInItemByData.call(this,a)},c.prototype.setOutItemByData=function(a){b.prototype.setOutItemByData.call(this,a)},c}(a.BaseMaterialNodeUI);a.MathFunNodeUI=b}(materialui||(materialui={}));var materialui;!function(a){var b=function(){function b(a){this.id=a}return b.prototype.getUse=function(b){var c=b.type;if(c==a.NodeTree.VEC3){if(!this.xUse)return this.xUse=!0,this.yUse=!0,this.zUse=!0,b.regResultConst=this,b.regConstIndex=0,!0}else if(c==a.NodeTree.VEC2){if(!this.xUse)return this.xUse=!0,this.yUse=!0,b.regResultConst=this,b.regConstIndex=0,!0;if(!this.yUse)return this.yUse=!0,this.zUse=!0,b.regResultConst=this,b.regConstIndex=1,!0;if(!this.zUse)return this.zUse=!0,this.wUse=!0,b.regResultConst=this,b.regConstIndex=2,!0}else if(c==a.NodeTree.FLOAT){if(!this.xUse)return this.xUse=!0,b.regResultConst=this,b.regConstIndex=0,!0;if(!this.yUse)return this.yUse=!0,b.regResultConst=this,b.regConstIndex=1,!0;if(!this.zUse)return this.zUse=!0,b.regResultConst=this,b.regConstIndex=2,!0;if(!this.wUse)return this.wUse=!0,b.regResultConst=this,b.regConstIndex=3,!0}return!1},b}();a.RegisterItem=b}(materialui||(materialui={}));var materialui;!function(a){var b=Pan3d.Scene_data,c=Pan3d.MaterialBaseParam,d=Pan3d.TexItem,e=Pan3d.Vector3D,f=Pan3d.TextureCube,g=Pan3d.ConstItem,h=Pan3d.CubemapLoad,i=Pan3d.LoadManager,j=Pan3d.TextureManager,k=function(){function k(){this._timeID=0,this._fcBeginID=0,this.initReg(),new e,this.defaultUvReg=new a.RegisterItem(0)}return k.prototype.initReg=function(){this.fragmentTempList=new Array,this.fragmentTexList=new Array,this.fragmentConstList=new Array;for(var b=0;8>b;b++)this.fragmentTempList.push(new a.RegisterItem(b)),this.fragmentTexList.push(new a.RegisterItem(b));for(b=0;28>b;b++)this.fragmentConstList.push(new a.RegisterItem(b))},k.prototype.compile=function(b,d){a.NodeTree.jsMode=!0,this.priorityList=b,this.strVec=new Array,this.texVec=new Array,this.constVec=new Array,this.hasTime=!1,this.useNormal=!1,this.cubeTextItem=null,this.initBaseFc(),this.funNodeStr="",this.FunDic={};for(var e=this.priorityList.length-1;e>=0;e--)for(var f=this.priorityList[e],g=0;g<f.length;g++)this.processNode(f[g]);var h=this.getGLSLStr();d.shaderStr=h,d.constList=this.constVec,d.texList=this.texVec,d.cubeTextItem=this.cubeTextItem;var i=new c;return i.setData(d,[]),d.fcNum=this.getMaxFc(),d.fcData=this.makeFc(d.fcNum),d.hasTime=this.hasTime,d.timeSpeed=this.timeSpeed,d.timeValue=this.timeValue,d.useNormal=this.useNormal,d.useUv=this.useUv,d.useLightUv=this.useLightUv,d.roughness=0,h},k.prototype.getMaxFc=function(){var a=0;return this.constVec.length?a=this.constVec[this.constVec.length-1].id+1:this._fcBeginID>0&&(a=this._fcBeginID),a},k.prototype.makeFc=function(a){for(var b=new Float32Array(4*a),c=0;c<this.constVec.length;c++)this.constVec[c].creat(b);return b},k.prototype.getGLSLStr=function(){for(var a="",b=0;b<this.strVec.length;b++)a+=this.strVec[b]+"\n";var c="precision mediump float;\n",e="";for(b=0;b<this.texVec.length;b++)e+=this.texVec[b].type==d.CUBEMAP?"uniform samplerCube fs"+this.texVec[b].id+";\n":"uniform sampler2D fs"+this.texVec[b].id+";\n";this.cubeTextItem&&(e+="uniform samplerCube skyBoxCube; \n");var f="",g=0;this.constVec.length?g=this.constVec[this.constVec.length-1].id+1:this._fcBeginID>0&&(g=this._fcBeginID),this.fcNum=g,this.fcNum>0&&(f+="uniform vec4 fc["+this.fcNum+"];\n");var h="";h+="varying vec2 v0;\n",h+="varying highp vec3 vPos;\n",h+="uniform vec3 cam3DPos;\n",this.hasTime&&(h+="uniform float time;\n"),this.useUv&&(h+="varying vec2 uvpos;\n"),this.useLightUv&&(h+="varying vec2 lightuv;\n"),this.useNormal&&(h+="varying vec3 T;\n",h+="varying vec3 B;\n",h+="varying vec3 N;\n",h+="vec3 normalpic(vec3 n) { \nn=2.0*n-vec3(1.0);\nreturn normalize(T*n.x+B*n.y+N*n.z);\n}\n");var i="void main(void){\n";if(this.useNormal){var j=this.getInputNormal();i+=j.parentNodeItem?"vec3 normalVec = normalpic(texture2D(fs"+j.parentNodeItem.node.regResultTex.id+",v0).xyz)"+k.END+"\n":"vec3 normalVec = N.xyz"+k.END+"\n"}var l="\n}",m=c+e+f+h+this.funNodeStr+i+a+l;return console.log(m),m},k.prototype.getInputNormal=function(){for(var b=this.priorityList.length-1;b>=0;b--)for(var c=this.priorityList[b],d=0;d<c.length;d++)if(c[d].type==a.NodeTree.OP)return c[d].inputVec[1];return null},k.prototype.getFragmentTex=function(a){void 0===a&&(a=null);for(var b=0;b<this.fragmentTexList.length;b++)if(!this.fragmentTexList[b].inUse)return this.fragmentTexList[b].inUse=!0,this.fragmentTexList[b].url="",this.fragmentTexList[b];return null},k.prototype.getFragmentTemp=function(){for(var a=0;a<this.fragmentTempList.length;a++)if(!this.fragmentTempList[a].inUse)return this.fragmentTempList[a].inUse=!0,this.fragmentTempList[a];return null},k.prototype.processTexCubeNode=function(a){var c=new f;c.url=a.url,c.isDynamic=a.isDynamic,c.paramName=a.paramName,c.isMain=a.isMain,c.wrap=a.wrap,c.filter=a.filter,c.mipmap=a.mipmap,c.permul=a.permul,j.getInstance().getTexture(b.fileRoot+c.url,function(a){c.textureRes=a}),i.getInstance().load(b.fileRoot+c.url,i.IMG_TYPE,function(a,b){}),this.cubeTextItem=c},k.prototype.processTex3DNode=function(a){var c,e="",f=a.inputVec[0],g=this.getFragmentTex(a),j=this.getFragmentTemp();if(j.hasInit?c=k.FT+j.id:(c=k.VEC4+k.SPACE+k.FT+j.id,j.hasInit=!0),f.parentNodeItem){var l=f.parentNodeItem.node;e=c+k.SPACE+k.EQU+k.SPACE+"textureCube"+k.LEFT_PARENTH+k.FS+g.id+k.COMMA+l.getComponentID(f.parentNodeItem.id)+k.RIGHT_PARENTH+k.END}a.regResultTemp=j,a.regResultTex=g,a.shaderStr=e,this.strVec.push(e);var m=new d;m.id=g.id,m.url=a.url,m.isDynamic=a.isDynamic,m.paramName=a.paramName,m.isMain=a.isMain,m.wrap=a.wrap,m.filter=a.filter,m.mipmap=a.mipmap,m.permul=a.permul,m.type=d.CUBEMAP,i.getInstance().load(b.fileRoot+m.url,i.IMG_TYPE,function(a,b){m.textureRes=new Pan3d.TextureRes,m.textureRes.texture=h.makeTempCubeTextture(a)}),this.texVec.push(m),f.hasCompiled=!0,l&&l.releaseUse()},k.prototype.processTexNode=function(a){var c,e="",f=a.inputVec[0],g=this.getFragmentTex(a),h=this.getFragmentTemp();if(h.hasInit?c=k.FT+h.id:(c=k.VEC4+k.SPACE+k.FT+h.id,h.hasInit=!0),f.parentNodeItem){var i=f.parentNodeItem.node;e=c+k.SPACE+k.EQU+k.SPACE+k.texture2D+k.LEFT_PARENTH+k.FS+g.id+k.COMMA+i.getComponentID(f.parentNodeItem.id)+k.RIGHT_PARENTH+k.END}else e=c+k.SPACE+k.EQU+k.SPACE+k.texture2D+k.LEFT_PARENTH+k.FS+g.id+k.COMMA+k.VI+this.defaultUvReg.id+k.RIGHT_PARENTH+k.END;a.permul&&(e+=k.LN+k.FT+h.id+k.XYZ+k.SPACE+k.MUL_EQU_MATH+k.SPACE+k.FT+h.id+k.W+k.END),a.regResultTemp=h,a.regResultTex=g,a.shaderStr=e,this.strVec.push(e);var l=new d;l.id=g.id,l.url=a.url,l.isDynamic=a.isDynamic,l.paramName=a.paramName,l.isMain=a.isMain,l.wrap=a.wrap,l.filter=a.filter,l.mipmap=a.mipmap,l.permul=a.permul,j.getInstance().getTexture(b.fileRoot+l.url,function(a){l.textureRes=a}),this.texVec.push(l),f.hasCompiled=!0,i&&i.releaseUse()},k.prototype.processFunNode=function(b){var c=b,d="",e=(b.inputVec[0],b.outputVec[0]),f=this.getFragmentTemp(),g="";f.hasInit||(g=k.VEC4+k.SPACE+k.FT+f.id+k.SPACE+k.EQU+k.SPACE+k.DEFAULT_VEC4+k.END+k.LN,f.hasInit=!0),d=e.type==a.MaterialItemType.FLOAT?k.FT+f.id+k.X+k.SPACE+k.EQU+k.SPACE:e.type==a.MaterialItemType.VEC2?k.FT+f.id+k.XY+k.SPACE+k.EQU+k.SPACE:e.type==a.MaterialItemType.VEC3?k.FT+f.id+k.XYZ+k.SPACE+k.EQU+k.SPACE:k.FT+f.id+k.SPACE+k.EQU+k.SPACE,d=g+d;for(var h=c.funName+"(",i=0;i<b.inputVec.length;i++){var j=b.inputVec[i];j.hasCompiled=!0,j.parentNodeItem.node.releaseUse();var l=j.parentNodeItem.node.getComponentID(j.parentNodeItem.id);h+=l,i<b.inputVec.length-1&&(h+=",")}h+=")"+k.END,d+=h,b.regResultTemp=f,b.shaderStr=d,this.strVec.push(d),this.FunDic[c.funName]||(this.funNodeStr+=c.funStr,this.FunDic[c.funName]=c)},k.prototype.processDynamicNode=function(b,c){var d="",e=b.inputVec[0],f=b.inputVec[1],g=e.parentNodeItem.node,h=f.parentNodeItem.node,i=b.outputVec[0],j=this.getFragmentTemp(),l="";j.hasInit||e.type==a.MaterialItemType.VEC4||f.type==a.MaterialItemType.VEC4||(l=k.VEC4+k.SPACE+k.FT+j.id+k.SPACE+k.EQU+k.SPACE+k.DEFAULT_VEC4+k.END+k.LN,j.hasInit=!0),e.type==a.MaterialItemType.VEC4||f.type==a.MaterialItemType.VEC4?(j.hasInit||(l=k.VEC4+k.SPACE,j.hasInit=!0),d=k.FT+j.id+k.SPACE+k.EQU+k.SPACE):i.type==a.MaterialItemType.FLOAT?d=k.FT+j.id+k.X+k.SPACE+k.EQU+k.SPACE:i.type==a.MaterialItemType.VEC2?d=k.FT+j.id+k.XY+k.SPACE+k.EQU+k.SPACE:i.type==a.MaterialItemType.VEC3&&(d=k.FT+j.id+k.XYZ+k.SPACE+k.EQU+k.SPACE),d+=g.getComponentID(e.parentNodeItem.id),d+=k.SPACE+c+k.SPACE,d+=h.getComponentID(f.parentNodeItem.id),d=l+d+k.END,e.hasCompiled=!0,f.hasCompiled=!0,g.releaseUse(),h.releaseUse(),b.regResultTemp=j,b.shaderStr=d,this.strVec.push(d)},k.prototype.processNode=function(b){switch(b.type){case a.NodeTree.VEC3:case a.NodeTree.FLOAT:case a.NodeTree.VEC2:this.processVec3Node(b);break;case a.NodeTree.TEX:this.processTexNode(b);break;case a.NodeTree.TEX3D:this.processTex3DNode(b);break;case a.NodeTree.TEXCUBE:this.processTexCubeNode(b);break;case a.NodeTree.FUN:this.processFunNode(b);break;case a.NodeTree.MUL:this.processDynamicNode(b,"*");break;case a.NodeTree.ADD:this.processDynamicNode(b,"+");break;case a.NodeTree.SUB:this.processDynamicNode(b,"-");break;case a.NodeTree.DIV:this.processDynamicNode(b,"/");break;case a.NodeTree.OP:this.processOpNode(b);break;case a.NodeTree.SIN:this.processStaticNode(b,k.SIN);break;case a.NodeTree.COS:this.processStaticNode(b,k.COS);break;case a.NodeTree.NORMAL:this.useNormal=!0;break;case a.NodeTree.TEXCOORD:this.useUv=!0;break;case a.NodeTree.TEXCOORDLIGHT:this.useLightUv=!0;break;case a.NodeTree.TIME:this.hasTime=!0,this.timeSpeed=b.speed,this.timeValue=b.timeValue}},k.prototype.processTimeNode=function(b){var c="",d=this.getFragmentTemp(),e=new a.NodeTreeFloat;e.type=a.NodeTree.FLOAT,e.constValue=b.speed,this.processVec3Node(e),d.hasInit||(c=k.VEC4+k.SPACE+k.FT+d.id+k.SPACE+k.EQU+k.SPACE+k.DEFAULT_VEC4+k.END,d.hasInit=!0,this.strVec.push(c)),c=k.FT+d.id+k.X+k.SPACE+k.EQU+k.SPACE+this.timeStr+k.SPACE+k.MUL_MATH+k.SPACE+e.getComponentID(0)+k.END,this.strVec.push(c),b.regResultTemp=d,this.hasTime=!0},k.prototype.processStaticNode=function(a,b){var c="",d=a.inputVec[0],e=d.parentNodeItem.node,f=this.getFragmentTemp();f.hasInit||(c=k.VEC4+k.SPACE+k.FT+f.id+k.SPACE+k.EQU+k.SPACE+k.DEFAULT_VEC4+k.END+k.LN,f.hasInit=!0),c+=k.FT+f.id+k.X+k.SPACE+k.EQU+k.SPACE+b+k.LEFT_PARENTH+e.getComponentID(d.parentNodeItem.id)+k.RIGHT_PARENTH+k.END,d.hasCompiled=!0,e.releaseUse(),a.regResultTemp=f,a.shaderStr=c,this.strVec.push(c)},k.prototype.traceFt=function(){},Object.defineProperty(k.prototype,"timeStr",{get:function(){return"fc["+this._timeID+"].y"},enumerable:!0,configurable:!0}),k.prototype.processVec3Node=function(a){this.setFragmentConst(a),this.addConstItem(a)},k.prototype.addConstItem=function(b){b.isDynamic&&console.log(b.paramName);for(var c,d=b.regResultConst.id,e=0;e<this.constVec.length;e++)this.constVec[e].id==d&&(c=this.constVec[e]);if(c||(c=new g,c.id=b.regResultConst.id,this.constVec.push(c)),b.type==a.NodeTree.VEC3){if(0==b.regConstIndex){var f=b.constVec3;c.value.setTo(f.x,f.y,f.z),b.isDynamic&&(c.paramName0=b.paramName,c.param0Type=4,c.param0Index=0)}}else if(b.type==a.NodeTree.FLOAT){var h=b.constValue;0==b.regConstIndex?(c.value.x=h,b.isDynamic&&(c.paramName0=b.paramName,c.param0Type=1,c.param0Index=0)):1==b.regConstIndex?(c.value.y=h,b.isDynamic&&(c.paramName1=b.paramName,c.param1Type=1,c.param1Index=1)):2==b.regConstIndex?(c.value.z=h,b.isDynamic&&(c.paramName2=b.paramName,c.param2Type=1,c.param2Index=2)):3==b.regConstIndex&&(c.value.w=h,b.isDynamic&&(c.paramName3=b.paramName,c.param3Type=1,c.param3Index=3))}else if(b.type==a.NodeTree.VEC2){var i=b.constValue;0==b.regConstIndex?(c.value.x=i.x,c.value.y=i.y,b.isDynamic&&(c.paramName0=b.paramName,c.param0Type=2,c.param0Index=0)):1==b.regConstIndex?(c.value.y=i.x,c.value.z=i.y,b.isDynamic&&(c.paramName1=b.paramName,c.param1Type=2,c.param1Index=1)):2==b.regConstIndex&&(c.value.z=i.x,c.value.w=i.y,b.isDynamic&&(c.paramName2=b.paramName,c.param2Type=2,c.param2Index=2))}},k.prototype.setFragmentConst=function(a){for(var b=this._fcBeginID;b<this.fragmentConstList.length;b++){var c=this.fragmentConstList[b].getUse(a);if(c)break}},k.prototype.processOpNode=function(a){var b="",c=a.inputVec[0],d=a.inputVec[1],e=a.inputVec[3];d.parentNodeItem&&(this.useNormal=!0);var f;if(this.traceFt(),c.parentNodeItem){var g,h=c.parentNodeItem.node,i=this.getFragmentTemp();i.hasInit?g=k.FT+i.id:(g=k.VEC4+k.SPACE+k.FT+i.id,i.hasInit=!0),b=g+k.SPACE+k.EQU+k.SPACE+k.VEC4+k.LEFT_PARENTH+h.getComponentID(c.parentNodeItem.id)+k.COMMA+"1.0"+k.RIGHT_PARENTH+k.END,this.strVec.push(b),h.releaseUse(),f=this.getFragmentTemp(),f.hasInit||(b=k.VEC4+k.SPACE+k.FT+f.id+k.SPACE+k.EQU+k.SPACE+k.DEFAULT_VEC4+k.END,f.hasInit=!0,this.strVec.push(b)),b=k.FT+f.id+k.XYZ+k.SPACE+k.EQU+k.SPACE+k.FT+i.id+k.XYZ+k.END,c.hasCompiled=!0,this.strVec.push(b),i.inUse=!1}if(b="",e.parentNodeItem){var j=e.parentNodeItem.node;b+=k.FT+f.id+k.W+k.SPACE+k.EQU+k.SPACE+j.getComponentID(e.parentNodeItem.id)+k.END,j.releaseUse()}else b=k.FT+f.id+k.W+k.SPACE+k.EQU+k.SPACE+k.ONE_FLOAT+k.END;this.strVec.push(b),b="",b=k.FO+k.SPACE+k.EQU+k.SPACE+k.FT+f.id+k.END,this.strVec.push(b)},k.prototype.initBaseFc=function(){for(var b=0,c=!1,d=this.priorityList.length-1;d>=0;d--)for(var e=this.priorityList[d],f=0;f<e.length;f++){var g=e[f];g.type==a.NodeTree.OP||g.type==a.NodeTree.TIME&&(c=!0)}c&&b++,b=0,this._fcBeginID=b},k.SPACE=" ",k.COMMA=",",k.END=";",k.FC="fc",k.FT="ft",k.TEXTURE="texture",k.FS="fs",k.VI="v",k.OP="op",k.FO="gl_FragColor",k.XYZ=".xyz",k.XY=".xy",k.X=".x",k.Y=".y",k.Z=".z",k.W=".w",k.ZW=".zw",k.MOV="mov",k.ONE_FLOAT="1.0",k.ZERO="[0]",k.ONE="[1]",k.TWO="[2]",k.TWO_FLOAT="2.0",k.THREE="3",k.FOUR="4",k.LN="\n",k.texType="<2d,linear,repeat>",k.TEX_2D="2d",k.TEX_LINEAR="linear",k.TEX_NEAREST="nearest",k.TEX_WRAP_REPEAT="repeat",k.TEX_WRAP_CLAMP="clamp",k.LEFT_BRACKET="<",k.RIGHT_BRACKET=">",k.texCubeType="<cube,clamp,linear,mipnone>",k.TEX="tex",k.ADD="add",k.SUB="sub",k.MUL="mul",k.DIV="div",k.ADD_MATH="+",k.SUB_MATH="-",k.MUL_MATH="*",k.MUL_EQU_MATH="*=",k.DIV_MATH="/",k.RCP="rcp",k.MIN="min",k.MAX="max",k.FRC="frc",k.SQT="sqt",k.RSQ="rsq",k.POW="pow",k.LOG="log",k.EXP="exp",k.NRM="normalize",k.SIN="sin",k.COS="cos",k.CRS="crs",k.DP3="dp3",k.DOT="dot",k.DP4="dp4",k.ABS="abs",k.NEG="neg",k.SAT="sat",k.LERP="lerp",k.KIL="kil",k.M33="m33",k.VEC4="vec4",k.VEC3="vec3",k.VEC2="vec2",k.EQU="=",k.texture2D="texture2D",k.textureCube="textureCube",k.LEFT_PARENTH="(",k.RIGHT_PARENTH=")",k.DEFAULT_VEC4="vec4(0,0,0,1)",k.MIX="mix",k.REFLECT="reflect",k.IF="if",k.DISCARD="{discard;}",k.scalelight="scalelight",k}();a.CompileTwo=k}(materialui||(materialui={}));var materialui;!function(a){var b=function(){function b(){this.maxPriority=0}return b.getInstance=function(){return this._instance||(this._instance=new b),this._instance},b.prototype.compile=function(b,c){this._compileGlslServer=new a.CompileTwo,this.nodeList=b,this.resetCompile(b),this.resetPriority();var d=this.getOpNode();d.priority=0,this.setPriority(d),this.priorityList=new Array;for(var e=0;e<=this.maxPriority;e++)this.priorityList.push(new Array);for(e=0;e<this.nodeList.length;e++)if(!(this.nodeList[e].priority<0||this.nodeList[e].checkInput()))return console.log(this.nodeList[e]),void alert("不完整的输入"+this.nodeList[e].type);for(e=0;e<this.nodeList.length;e++)this.nodeList[e].priority<0||this.priorityList[this.nodeList[e].priority].push(this.nodeList[e]);this._compileGlslServer.compile(this.priorityList,c),left.ModelShowModel.getInstance().outShaderStr(c)},b.prototype.setPriority=function(a){for(var b=a.inputVec,c=0;c<b.length;c++){var d=b[c].parentNodeItem;if(d){var e=d.node;e.priority<a.priority+1&&(e.priority=a.priority+1),this.maxPriority=Math.max(this.maxPriority,e.priority),this.setPriority(e)}}},b.prototype.getOpNode=function(){for(var b=0;b<this.nodeList.length;b++)if(this.nodeList[b].type==a.NodeTree.OP)return this.nodeList[b];return null},b.prototype.resetCompile=function(a){for(var b=0;b<a.length;b++)for(var c=a[b].inputVec,d=0;d<c.length;d++)c[d].hasCompiled=!1},b.prototype.resetPriority=function(){for(var b=0;b<this.nodeList.length;b++)this.nodeList[b].type!=a.NodeTree.OP?this.nodeList[b].priority=-1:this.nodeList[b].priority=0},b}();a.MaterialCompile=b}(materialui||(materialui={}));var materialui;!function(a){var b=function(){function a(){}return a.Scale=1,a}();a.MtlUiData=b}(materialui||(materialui={}));var materialui;!function(a){var b=Pan3d.ModuleEventManager,c=Pan3d.Scene_data,d=Pan3d.LoadManager,e=win.Panel,f=Pan3d.TextureManager,g=menutwo.MenuListData,h=function(){function h(){}return h.getInstance=function(){return this._instance||(this._instance=new h),this._instance},h.prototype.makePanle=function(){a.MaterialCtrl.getInstance().bgwinPanel=new e,a.MaterialCtrl.getInstance().nodeUiPanel=new e,a.MaterialCtrl.getInstance().linePanel=new e,a.MaterialCtrl.getInstance().lineContainer=new a.MaterialLineContainer,a.MaterialCtrl.getInstance().linePanel.addUIContainer(a.MaterialCtrl.getInstance().lineContainer),a.MaterialCtrl.getInstance().bgwinPanel.addUIContainer(new a.MaterialCavasPanel)},h.prototype.selectMaterialUrl=function(c){pack.PackMaterialManager.getInstance().getMaterialByUrl(c,function(c){b.dispatchEvent(new a.MaterialEvent(a.MaterialEvent.INUPT_NEW_MATERIAL_FILE),c)})},h.prototype.getMenuXml=function(){var a=new Array;return a.push(this.getMathListData()),a.push(this.getV2CListData()),a.push(this.getTextureListData()),a.push(this.getOtherListData()),a},h.prototype.getMathListData=function(){var a=new g("Math","1");return a.subMenu=new Array,a.subMenu.push(new g("ADD","11")),a.subMenu.push(new g("SUB","12")),a.subMenu.push(new g("MUL","13")),a.subMenu.push(new g("DIV","14")),a.subMenu.push(new g("SIN","15")),a.subMenu.push(new g("COS","16")),a},h.prototype.getV2CListData=function(){var a=new g("常数","2");return a.subMenu=new Array,a.subMenu.push(new g("vec3","22")),a.subMenu.push(new g("vec2","23")),a.subMenu.push(new g("float","24")),a.subMenu.push(new g("Time","25")),a.subMenu.push(new g("Normal","26")),a},h.prototype.getTextureListData=function(){var a=new g("纹理","3");return a.subMenu=new Array,a.subMenu.push(new g("纹理贴图","31")),a.subMenu.push(new g("纹理坐标","32")),a.subMenu.push(new g("纹理滚动","33")),a.subMenu.push(new g("Cube纹理","34")),a.subMenu.push(new g("3D贴图","35")),a.subMenu.push(new g("LightUv","36")),a},h.prototype.getOtherListData=function(){var a=new g("其它","4");return a.subMenu=new Array,a.subMenu.push(new g("菲捏尔","41")),a.subMenu.push(new g("導入材質","42")),a.subMenu.push(new g("函数","43")),a.subMenu.push(new g("文件列表","44")),a},h.prototype.mekeMaterialRightMenu=function(a){var c=this,d=(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),{});d.mouse=new Vector2D(a.clientX,a.clientY),d.menuXmlItem=this.getMenuXml(),d.info={},d.info.bfun=function(a,b){c.menuBfun(a,b)},b.dispatchEvent(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),d)},h.prototype.menuBfun=function(b,c){switch(console.log("材质返回菜单",b),b.key){case"1":break;case"2":break;case"3":break;case"4":break;case"11":this.onTempNode(new a.MathAddNodeUI,c);break;case"12":this.onTempNode(new a.MathSubNodeUI,c);break;case"13":this.onTempNode(new a.MathMulNodeUI,c);break;case"14":this.onTempNode(new a.MathDivNodeUI,c);break;case"15":this.onTempNode(new a.MathSinNodeUI,c);break;case"16":this.onTempNode(new a.MathCosNodeUI,c);break;case"22":this.onTempNode(new a.ConstVec3NodeUI,c);break;case"23":this.onTempNode(new a.ConstVec2NodeUI,c);break;case"24":this.onTempNode(new a.ConstFloatNodeUI,c);break;case"25":this.onTempNode(new a.TimeNodeUI,c);break;case"26":this.onTempNode(new a.NormalNodeUI,c);break;case"31":var d=new a.TextureSampleNodeUI;this.onTempNode(d,c),d.creatBase("assets/white.jpg");break;case"32":this.onTempNode(new a.TexCoordNodeUI,c);break;case"36":this.onTempNode(new a.TexLightUvNodeUI,c);break;case"33":this.onTempNode(new a.PannerNodeUI,c);break;case"34":var e=new a.TextureCubeNodeUI;this.onTempNode(e,c),e.creatBase("assets/white.jpg");break;case"35":var f=new a.Texture3DNodeUI;this.onTempNode(f,c),f.creatBase("assets/white.jpg");break;case"41":this.onTempNode(new a.FresnelNodeUI,c);break;case"42":break;case"43":this.onTempNode(new a.MathFunNodeUI,c);break;case"44":Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.SHOW_FOLDER_PANEL))}},h.prototype.onTempNode=function(b,c){b.left=c.x/a.MtlUiData.Scale-150,b.top=c.y/a.MtlUiData.Scale-30,b.uiScale=a.MtlUiData.Scale,a.MaterialCtrl.getInstance().addNodeUI(b),win.LayerManager.getInstance().resize()},h.prototype.dataURLtoFile=function(a,b){for(var c=a.split(","),d=c[0].match(/:(.*?);/)[1],e=atob(c[1]),f=e.length,g=new Uint8Array(f);f--;)g[f]=e.charCodeAt(f);return new File([g],b,{type:d})},h.prototype.MakeTempWebMaterialTree=function(a,b){var c=new Pan3d.Pan3dByteArray;c.writeUTF(JSON.stringify({data:a.data,info:b})),pack.PackMaterialManager.getInstance().getMaterialByUrl(a.url,function(b){pack.PackMaterialManager.getInstance().makeMaterialShaderByByte(c,a.url,b)})},h.prototype.upMaterialTreeToWeb=function(b,d,e){for(var g=0;b.data&&g<b.data.length;g++){var h=b.data[g];if(h.type==a.NodeTree.TEX||h.type==a.NodeTree.TEX3D||h.type==a.NodeTree.TEXCUBE){var i=f.getInstance().getImgResByurl(c.fileRoot+h.data.url);i&&console.log("图片列表",i)}}var j=new Pan3d.Pan3dByteArray;j.writeUTF(JSON.stringify({data:b.data,info:d}));var k=new File([j.buffer],"ossfile.txt"),l=Pan3d.Scene_data.fileRoot+e,m=l.replace(Pan3d.Scene_data.ossRoot,"");console.log(l),pack.FileOssModel.upOssFile(k,m,function(){console.log("材质上传成功"),pack.PackMaterialManager.getInstance().replaceMaterialByUrl(e)})},h.prototype.selectFileById=function(e){var f="texturelist/"+e+".txt";d.getInstance().load(c.fileRoot+f,d.BYTE_TYPE,function(c){var d=new Pan3d.Pan3dByteArray(c);d.position=0;var e=JSON.parse(d.readUTF()),g=new a.MaterialTree;g=new a.MaterialTree,g.url=f,g.setData({data:e.data}),b.dispatchEvent(new a.MaterialEvent(a.MaterialEvent.INUPT_NEW_MATERIAL_FILE),g)})},h}();a.MaterialModel=h}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.Rectangle,c=Pan3d.Scene_data,d=Pan3d.UIRenderComponent,e=Pan3d.UIManager,f=Pan3d.UIConatiner,g=Pan3d.UIAtlas,h=Pan3d.Vector3D,i=Pan3d.TextureManager,j=function(a){function b(b,c){var f=a.call(this)||this;f.tempUiName="tempui",f.uiViewScale=.5,b/=f.uiViewScale,c/=f.uiViewScale,f._bRender=new d,f.addRender(f._bRender),f._bRender.uiAtlas=new g;var h=f._bRender.uiAtlas;h.configData=[];var j=Math.pow(2,Math.ceil(Math.log(b)/Math.log(2))),k=Math.pow(2,Math.ceil(Math.log(c)/Math.log(2)));return f._bRender.uiAtlas.ctx=e.getInstance().getContext2D(j,k,!1),f._bRender.uiAtlas.textureRes=i.getInstance().getCanvasTexture(f._bRender.uiAtlas.ctx),h.configData.push(h.getObject(f.tempUiName,0,0,b,c,j,k)),f.ui=f._bRender.creatBaseComponent(f.tempUiName),f.ui.width=b*f.uiViewScale,f.ui.height=c*f.uiViewScale,f.addChild(f.ui),f}return __extends(b,a),b}(f);a.TextureContext=j;var k=function(f){function g(){var a=f.call(this)||this;a.lineItemBigA=[],a.lineItemBigB=[],a.lineItemA=[],a.lineItemB=[],a.setRect(new b(0,0,c.stageWidth,c.stageHeight)),a.blakCavansRender=new d,a.addRender(a.blakCavansRender),a.blakCavansRender.uiAtlas=a.makeBaseUiatlas(64,64);for(var e=0;200>e;e++)a.lineItemA.push(a.getTempLineUi()),a.lineItemB.push(a.getTempLineUi());for(var g=0;30>g;g++)a.lineItemBigA.push(a.getTempBigLineUi()),a.lineItemBigB.push(a.getTempBigLineUi());return a}return __extends(g,f),g.prototype.getTempLineUi=function(){if(!this.linesSmailRender){this.linesSmailRender=new d,this.addRender(this.linesSmailRender),this.linesSmailRender.uiAtlas=this.makeBaseUiatlas(64,64);var a=this.linesSmailRender.creatBaseComponent("temp_ui");this.drawOutColor(a,new h(53,53,53))}if(this.linesSmailRender.uiListLen>=50){var b=new d;this.addRender(b),b.uiAtlas=this.linesSmailRender.uiAtlas,this.linesSmailRender=b}var c=this.addChild(this.linesSmailRender.creatBaseComponent("temp_ui"));return c},g.prototype.getTempBigLineUi=function(){if(!this.lineBigRender){this.lineBigRender=new d,this.addRender(this.lineBigRender),this.lineBigRender.uiAtlas=this.makeBaseUiatlas(64,64);var a=this.lineBigRender.creatBaseComponent("temp_ui");this.drawOutColor(a,new h(35,35,35))}if(this.lineBigRender.uiListLen>=50){var b=new d;this.addRender(b),b.uiAtlas=this.lineBigRender.uiAtlas,this.lineBigRender=b}var c=this.addChild(this.lineBigRender.creatBaseComponent("temp_ui"));return c},g.prototype.drawOutColor=function(a,b){for(var c=a.uiRender.uiAtlas,d=a.skinName,f=c.getRec(d),g=e.getInstance().getContext2D(f.pixelWitdh,f.pixelHeight,!1),h=g.getImageData(0,0,f.pixelWitdh,f.pixelHeight),j=0;j<h.data.length/4;j++)h.data[4*j+0]=b.x,h.data[4*j+1]=b.y,h.data[4*j+2]=b.z,h.data[4*j+3]=255;g.putImageData(h,0,0),i.getInstance().updateTexture(c.texture,f.pixelX,f.pixelY,g)},g.prototype.loadConfigCom=function(){f.prototype.loadConfigCom.call(this),this.tempListBg=this.blakCavansRender.creatBaseComponent("temp_ui"),this.addChild(this.tempListBg),this.drawOutColor(this.tempListBg,new h(42,42,42)),this.resize()},g.prototype.resize=function(){f.prototype.resize.call(this),this.tempListBg&&(this.moveLineA(),this.moveLineB(),this.movelineItemBigA(),this.movelineItemBigB(),this.tempListBg.x=0,this.tempListBg.y=0,this.tempListBg.width=c.stageWidth,this.tempListBg.height=c.stageHeight)},g.prototype.moveLineA=function(){for(var b=20*a.MtlUiData.Scale,d=0;d<this.lineItemA.length;d++){var e=this.lineItemA[d];e.x=0,e.y=d*b+AppData.stagePos.y*a.MtlUiData.Scale%b,e.width=c.stageWidth,e.height=1}},g.prototype.moveLineB=function(){for(var b=20*a.MtlUiData.Scale,d=0;d<this.lineItemB.length;d++){var e=this.lineItemB[d];e.x=d*b+AppData.stagePos.x*a.MtlUiData.Scale%b,e.y=0,e.width=1,e.height=c.stageHeight}},g.prototype.movelineItemBigA=function(){for(var b=20*a.MtlUiData.Scale*8,d=0;d<this.lineItemBigA.length;d++){var e=this.lineItemBigA[d];e.x=0,e.y=d*b+AppData.stagePos.y*a.MtlUiData.Scale%b,e.width=c.stageWidth,e.height=2}},g.prototype.movelineItemBigB=function(){for(var b=20*a.MtlUiData.Scale*8,d=0;d<this.lineItemBigB.length;d++){var e=this.lineItemBigB[d];e.x=d*b+AppData.stagePos.x*a.MtlUiData.Scale%b,e.y=0,e.width=1,e.height=c.stageHeight}},g}(win.BaseWindow);a.MaterialCavasPanel=k}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialui;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Vector2D,d=Pan3d.Module,e=Pan3d.BaseProcessor,f=Pan3d.UIManager,g=Pan3d.ModuleEventManager,h=Pan3d.KeyboardType,i=Pan3d.MouseType,j=Pan3d.Rectangle,k=Pan3d.UIAtlas,l=win.LayerManager,m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.INIT_MATERIA_PANEL="INIT_MATERIA_PANEL",b.SHOW_MATERIA_PANEL="SHOW_MATERIA_PANEL",b.SAVE_MATERIA_PANEL="SAVE_MATERIA_PANEL",b.SELECT_MATERIAL_NODE_UI="SELECT_MATERIAL_NODE_UI",b.COMPILE_MATERIAL="COMPILE_MATERIAL",b.INUPT_NEW_MATERIAL_FILE="CLEAR_MATERIAL_ALL_UI",b}(b);a.MaterialEvent=m;var n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"MaterialModule"},b.prototype.listProcessors=function(){return[new o]},b}(d);a.MaterialModule=n;var o=function(b){function d(){return b.call(this)||this}return __extends(d,b),d.prototype.getName=function(){return"MaterialProcessor"},d.prototype.receivedModuleEvent=function(b){var d=this;if(b instanceof m){var e=b;e.type==m.INIT_MATERIA_PANEL&&(a.MaterialModel.getInstance().makePanle(),AppData.stagePos=new c,a.BaseMaterialNodeUI.baseUIAtlas=new k,a.BaseMaterialNodeUI.baseUIAtlas.setInfo("pan/marmoset/uilist/baseui.txt","pan/marmoset/uilist/baseui.png",function(){d.loadConfigCom()})),e.type==m.SHOW_MATERIA_PANEL&&(this.lastMaterialUrl=e.data,l.getInstance().addPanel(a.MaterialCtrl.getInstance().bgwinPanel,1),l.getInstance().addPanel(a.MaterialCtrl.getInstance().nodeUiPanel,2),l.getInstance().addPanel(a.MaterialCtrl.getInstance().linePanel,3),editscene.EditTopMenuPanel.getInstance().makeTextureTopMenu(),g.dispatchEvent(new xyz.MoveScaleRotatioinEvent(xyz.MoveScaleRotatioinEvent.CLEAR_XYZ_MOVE_DATA)),g.dispatchEvent(new materialleft.MaterialLeftEvent(materialleft.MaterialLeftEvent.SHOW_MATERIAL_LEFT_PANEL)),a.MaterialModel.getInstance().selectMaterialUrl(this.lastMaterialUrl),this.addEvents()),e.type==m.SAVE_MATERIA_PANEL&&this.saveMateriaPanel(),e.type==m.SELECT_MATERIAL_NODE_UI&&this.selectNodeUi(e.data),e.type==m.COMPILE_MATERIAL&&(a.MaterialCompile.getInstance().compile(a.MaterialCtrl.getInstance().nodeList,this.baseMaterialTree),this.changeLeftMeshView()),e.type==m.INUPT_NEW_MATERIAL_FILE&&this.clearAllMaterialUi(e.data)}if(b instanceof a.MEvent_Material_Connect){var f=b;f.type==a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_STARTDRAG&&this.startDragLine(f.itemNode),f.type==a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_STOPDRAG&&this.stopDragLine(f.itemNode),f.type==a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_REMOVELINE&&this.removeLine(f.line),f.type==a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_DOUBLUELINE&&this.setConnetLine(f.startNode,f.endNode);
}},d.prototype.changeLeftMeshView=function(){this._materialTree=new a.MaterialTree,this._materialTree.data=a.MaterialCtrl.getInstance().getObj(),this._materialTree.url=this.lastMaterialUrl,a.MaterialModel.getInstance().MakeTempWebMaterialTree(this._materialTree,this.getMakeProgemePrame())},Object.defineProperty(d.prototype,"hasStage",{get:function(){return 2==AppData.sceneEidtType},enumerable:!0,configurable:!0}),d.prototype.addEvents=function(){var a=this;this.onMouseWheelFun||(this.onMouseWheelFun=function(b){a.onMouseWheel(b)},this.onMouseFun=function(b){a.onMouse(b)},this.onMouseMoveFun=function(b){a.onMouseMove(b)},this.onMouseUpFun=function(b){a.onMouseUp(b)},this.onKeyDownFun=function(b){a.onKeyDown(b)},this.onKeyUpFun=function(b){a.onKeyUp(b)},this.onRightMenuFun=function(b){a.onRightMenu(b)}),document.addEventListener(i.MouseWheel,this.onMouseWheelFun),document.addEventListener(i.MouseDown,this.onMouseFun),document.addEventListener(i.MouseMove,this.onMouseMoveFun),document.addEventListener(i.MouseUp,this.onMouseUpFun),document.addEventListener(i.KeyDown,this.onKeyDownFun),document.addEventListener(i.KeyUp,this.onKeyUpFun),document.addEventListener("contextmenu",this.onRightMenuFun)},d.prototype.onRightMenu=function(b){b.preventDefault(),this.hasStage&&AppData.centenPanel.rect.isHitByPoint(b.x,b.y)&&a.MaterialModel.getInstance().mekeMaterialRightMenu(b)},d.prototype.removeEvents=function(){document.removeEventListener(i.MouseWheel,this.onMouseWheelFun),document.removeEventListener(i.MouseDown,this.onMouseFun),document.removeEventListener(i.MouseMove,this.onMouseMoveFun),document.removeEventListener(i.MouseUp,this.onMouseUpFun),document.removeEventListener(i.KeyDown,this.onKeyDownFun),document.removeEventListener(i.KeyUp,this.onKeyUpFun)},d.prototype.clearAllMaterialUi=function(b){for(var d=a.MaterialCtrl.getInstance().nodeUiPanel._containerList,e=d.length,f=e-1;f>=0;f--){var g=d[f];g.name&&this.delUI(g)}this.stageMoveTx(new c(-AppData.stagePos.x,-AppData.stagePos.y)),a.MtlUiData.Scale=1,a.MaterialCtrl.getInstance().initData(),this.baseMaterialTree=b,a.MaterialViewBuildUtils.getInstance().setData(b.data),this.resetMaterialListUi(),left.ModelShowModel.getInstance().modelSprite.material=b},d.prototype.resetMaterialListUi=function(){for(var b,d=a.MaterialCtrl.getInstance().nodeUiPanel._containerList,e=d.length,f=0;e>f;f++){var g=d[f];if(g.name){var h=new j(g.x,g.y,g.x+g.width,g.y+g.height);b?(b.x=Math.min(b.x,h.x),b.y=Math.min(b.y,h.y),b.width=Math.max(b.width,h.x),b.height=Math.max(b.height,h.y)):b=new j(h.x,h.y,h.x,h.y)}}if(b){var i=new j;i.x=AppData.centenPanel.rect.x,i.y=AppData.centenPanel.rect.y+15,i.width=AppData.centenPanel.rect.width,i.height=AppData.centenPanel.rect.height-40,b.width=b.width-b.x+180,b.height=b.height-b.y+200;var k=Math.min(i.width/b.width,i.height/b.height);k=Math.min(k,.8),k=Math.max(k,.5),a.MtlUiData.Scale=k;var l=new c;l.x=-b.x+i.x/a.MtlUiData.Scale,l.y=-b.y+i.y/a.MtlUiData.Scale,l.x+=(i.width/a.MtlUiData.Scale-b.width)/2,l.y+=(i.height/a.MtlUiData.Scale-b.height)/2,this.stageMoveTx(l)}},d.prototype.saveMateriaPanel=function(){this._materialTree=new a.MaterialTree,this._materialTree.data=a.MaterialCtrl.getInstance().getObj(),console.log(this.baseMaterialTree),this.baseMaterialTree.shaderStr?a.MaterialModel.getInstance().upMaterialTreeToWeb(this._materialTree,this.getMakeProgemePrame(),this.lastMaterialUrl):alert("选编译才能保存上传")},d.prototype.getMakeProgemePrame=function(){var a={};return a.useNormal=this.baseMaterialTree.useNormal,a.hasTime=this.baseMaterialTree.hasTime,a.timeValue=this.baseMaterialTree.timeValue,a.writeZbuffer=this.baseMaterialTree.writeZbuffer,a.zbuff=this.baseMaterialTree.zbuff,a.blendMode=this.baseMaterialTree.blendMode,a.showurl=this.baseMaterialTree.showurl,a.backCull=this.baseMaterialTree.backCull,a.texList=this.baseMaterialTree.texList,a.constList=this.baseMaterialTree.constList,a.shaderStr=this.baseMaterialTree.shaderStr,a.fcData=this.baseMaterialTree.fcData.toString(),a.paramAry=this.baseMaterialTree.shader.paramAry,a},d.prototype.selectNodeUi=function(b){for(var c=a.MaterialCtrl.getInstance().nodeUiPanel._containerList,d=0;d<c.length;d++){var e=c[d];e&&(e.select=Boolean(b==e))}},d.prototype.setConnetLine=function(b,c){a.MaterialCtrl.getInstance().lineContainer.addConnentLine(b,c)},d.prototype.removeLine=function(b){a.MaterialCtrl.getInstance().lineContainer.removeLine(b)},d.prototype.startDragLine=function(b){a.MaterialCtrl.getInstance().lineContainer.startLine(b)},d.prototype.stopDragLine=function(b){a.MaterialCtrl.getInstance().lineContainer.stopLine(b)},d.prototype.openMaterialPanel=function(){},d.prototype.loadConfigCom=function(){this.readMaterialTree()},d.prototype.readMaterialTree=function(){a.MaterialViewBuildUtils.getInstance().addFun=function(b){a.MaterialCtrl.getInstance().addNodeUI(b)};Number(getUrlParam("id"))},d.prototype.onKeyDown=function(b){if(this.hasStage)switch(AppData.altKey=b.altKey,b.keyCode){case h.Delete:var c=this.getSelUI();c&&(c instanceof a.ResultNodeUI||this.delUI(c));break;case h.S:b.altKey;break;case h.C:if(b.altKey);else{var c=this.getSelUI();if(c)switch(c.nodeTree.paramName=this.getCanUseParamName(),c.nodeTree.type){case a.NodeTree.TEX:case a.NodeTree.TEX3D:case a.NodeTree.TEXCUBE:case a.NodeTree.VEC3:case a.NodeTree.VEC2:case a.NodeTree.FLOAT:c.nodeTree.type&&(c.nodeTree.isDynamic=!c.nodeTree.isDynamic,c.showDynamic());break;default:console.log("不可以设置为动态")}}break;case h.O:break;case h.Z:a.MtlUiData.Scale+=.1,f.getInstance().resize()}},d.prototype.delUI=function(b){a.MaterialCtrl.getInstance().removeUI(b),b.removeAllNodeLine(),a.MaterialCtrl.getInstance().nodeUiPanel.removeUIContainer(b)},d.prototype.getCanUseParamName=function(){for(var b=[],c=a.MaterialCtrl.getInstance().nodeUiPanel._containerList,d=0;d<c.length;d++){var e=c[d];e&&e.nodeTree.isDynamic&&b.push(e.nodeTree.paramName)}return"param"+b.length},d.prototype.getSelUI=function(){for(var b=a.MaterialCtrl.getInstance().nodeUiPanel._containerList,c=0;c<b.length;c++){var d=b[c];if(d&&d.select)return d}return null},d.prototype.onKeyUp=function(a){AppData.altKey=a.altKey},d.prototype.onMouse=function(a){this.hasStage&&a.type==i.MouseDown&&1==a.button&&(this._isMidelMouse=!0,this.mouseXY=new c(a.x,a.y))},d.prototype.onMouseMove=function(b){if(this.hasStage&&this._isMidelMouse){var d=new c(b.x-this.mouseXY.x,b.y-this.mouseXY.y);d.x/=a.MtlUiData.Scale,d.y/=a.MtlUiData.Scale,this.stageMoveTx(d),this.mouseXY=new c(b.x,b.y)}},d.prototype.onMouseUp=function(a){this.hasStage&&(this._isMidelMouse=!1)},d.prototype.onMouseWheel=function(b){if(this.hasStage&&b.x>AppData.centenPanel.x&&b.x<AppData.rightPanel.x){var d=win.LayerManager.getInstance().getObjectsUnderPoint(new c(b.x,b.y));(!d||d.parent instanceof a.BaseMaterialNodeUI||d.parent instanceof a.MaterialCavasPanel)&&this.changeScalePanle(b)}},d.prototype.changeScalePanle=function(b){var d=(new c(b.x-AppData.stagePos.x,b.y-AppData.stagePos.y),b.x/a.MtlUiData.Scale),e=b.y/a.MtlUiData.Scale,f=a.MtlUiData.Scale,g=b.wheelDelta>0?.1:-.1;a.MtlUiData.Scale+=g,a.MtlUiData.Scale=Math.max(.5,a.MtlUiData.Scale),a.MtlUiData.Scale=Math.min(a.MtlUiData.Scale,1.2);var h=a.MtlUiData.Scale-f;this.stageMoveTx(new c(-d*h/a.MtlUiData.Scale,-e*h/a.MtlUiData.Scale))},d.prototype.stageMoveTx=function(b){AppData.stagePos.x+=b.x,AppData.stagePos.y+=b.y;for(var c=a.MaterialCtrl.getInstance().nodeUiPanel._containerList,d=0;d<c.length;d++){var e=c[d];e instanceof a.BaseMaterialNodeUI&&(e.left+=b.x,e.top+=b.y,e.uiScale=a.MtlUiData.Scale)}win.LayerManager.getInstance().resize()},d.prototype.listenModuleEvents=function(){return[new m(m.INIT_MATERIA_PANEL),new m(m.SHOW_MATERIA_PANEL),new m(m.SELECT_MATERIAL_NODE_UI),new m(m.SAVE_MATERIA_PANEL),new m(m.COMPILE_MATERIAL),new m(m.INUPT_NEW_MATERIAL_FILE),new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_STARTDRAG),new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_STOPDRAG),new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_REMOVELINE),new a.MEvent_Material_Connect(a.MEvent_Material_Connect.MEVENT_MATERIAL_CONNECT_DOUBLUELINE)]},d}(e);a.MaterialProcessor=o}(materialui||(materialui={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialleft;!function(a){var b=Pan3d.Scene_data,c=Pan3d.Vector3D,d=prop.MetaDataView,e=prop.ReflectionData,f=function(a){function d(b){return a.call(this,b)||this}return __extends(d,a),d.prototype.resize=function(){this._top=0,a.prototype.resize.call(this)},d.prototype.getView=function(){var a=[{Type:e.MeshMaterialLeft2DUI,Label:"窗口:",FunKey:"materialTree",Suffix:"prefab|zzw|objs",target:this,Category:"模型"},{Type:e.ComboBox,Label:"渲染模式:",FunKey:"blendMode",target:this,Data:[{name:"普通模式",type:0},{name:"透明模式",type:1},{name:"叠加模式",type:2}],Category:"设置"},{Type:e.CheckBox,Label:"深度测试:",FunKey:"testzbuff",target:this,Category:"设置"},{Type:e.CheckBox,Label:"写入深度:",FunKey:"writeZbuffer",target:this,Category:"设置"},{Type:e.CheckBox,Label:"点灯光:",FunKey:"pointlight",target:this,Category:"设置"},{Type:e.Vec3Color,Label:"模型列表:",FunKey:"sunDirect",target:this,Step:.1,Category:"属性"},{Type:e.Vec3Color,Label:"sun颜色:",FunKey:"sunColor",target:this,Step:0,Category:"属性"},{Type:e.Vec3Color,Label:"基本颜色:",FunKey:"ambientColor",target:this,Step:.1,Category:"属性"}];return a},Object.defineProperty(d.prototype,"materialTree",{get:function(){return this._materialTree},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"blendMode",{get:function(){return this._materialTree.blendMode},set:function(a){this._materialTree.blendMode=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"testzbuff",{get:function(){return this._materialTree.zbuff},set:function(a){this._materialTree.zbuff=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"writeZbuffer",{get:function(){return this._materialTree.writeZbuffer},set:function(a){this._materialTree.writeZbuffer=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"pointlight",{get:function(){return this._materialTree.pointlight},set:function(a){this._materialTree.pointlight=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this._materialTree=a,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"sunDirect",{get:function(){return new c(b.light.sunDirect[0],b.light.sunDirect[1],b.light.sunDirect[2])},set:function(a){b.light.sunDirect[0]=a.x,b.light.sunDirect[1]=a.y,b.light.sunDirect[2]=a.z},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"sunColor",{get:function(){return new c(b.light.sunColor[0],b.light.sunColor[1],b.light.sunColor[2])},set:function(a){b.light.sunColor[0]=a.x,b.light.sunColor[1]=a.y,b.light.sunColor[2]=a.z},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"ambientColor",{get:function(){return new c(b.light.ambientColor[0],b.light.ambientColor[1],b.light.ambientColor[2])},set:function(a){b.light.ambientColor[0]=a.x,b.light.ambientColor[1]=a.y,b.light.ambientColor[2]=a.z},enumerable:!0,configurable:!0}),d}(d);a.MateriaMeshView=f}(materialleft||(materialleft={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialleft;!function(a){var b=Pan3d.Pan3dByteArray,c=left.ModelShowModel,d=function(d){function e(){var a=d.call(this)||this;return a.only=!0,a.addPojectView(),a.initView(),a}return __extends(e,d),e.prototype.addPojectView=function(){this.propPanle=new prop.UiMeshSprite,this.materiaMeshView=new a.MateriaMeshView(this.propPanle),this.propPanle.addMeshView(this.materiaMeshView)},Object.defineProperty(e.prototype,"materialTree",{set:function(a){this._materialTree=a,this.materiaMeshView.data=this._materialTree},enumerable:!0,configurable:!0}),e.prototype.loadConfigCom=function(){d.prototype.loadConfigCom.call(this),this.setUiListVisibleByItem([this.e_panel_1],!0)},e.prototype.butClik=function(a){a.target==this.b_win_close&&this.perent.removeUIContainer(this)},e.prototype.initView=function(){c.getInstance().addBaseModel(),this.resize()},e.prototype.resize=function(){var a=this.perent;a&&(this.pageRect.x=a.x,this.pageRect.y=a.y,this.pageRect.width=a.width,this.pageRect.height=a.height),d.prototype.resize.call(this),this.uiLoadComplete&&this.propPanle.resize()},e.prototype.selectInputDae=function(a){var b=this;this._inputHtmlSprite=document.createElement("input"),this._inputHtmlSprite.setAttribute("id","_ef"),this._inputHtmlSprite.setAttribute("type","file"),this._inputHtmlSprite.setAttribute("style","visibility:hidden"),this._inputHtmlSprite.click(),this._inputHtmlSprite.value,this._inputHtmlSprite.addEventListener("change",function(a){b.changeFile(a)})},e.prototype.changeFile=function(a){for(var b=this,d=0;d<this._inputHtmlSprite.files.length&&1>d;d++){var e=this._inputHtmlSprite.files[d];if(/image\/\w+/.test(e.type))alert("请确保文件类型为图像类型");else{var f=new FileReader;if(-1!=e.name.indexOf(".md5mesh"))return f.readAsText(e),void(f.onload=function(a){c.getInstance().webmd5Sprite.addLocalMeshByStr(f.result)});if(-1!=e.name.indexOf(".md5anim"))return f.readAsText(e),void(f.onload=function(a){c.getInstance().webmd5Sprite.addLocalAdimByStr(f.result),c.getInstance().changeWebModel()});-1!=e.name.indexOf("objs.txt")?(f.readAsText(e),f.onload=function(a){c.getInstance().readTxtToModelBy(f.result)}):(f.readAsArrayBuffer(e),f.onload=function(a){b.isRoleFile(f.result)?(console.log("是角色",e.name),pack.RoleChangeModel.getInstance().loadLocalFile(f.result,null),left.SceneRenderToTextrue.getInstance().viweLHnumber=1e3):alert("不确定类型")})}}this._inputHtmlSprite=null},e.prototype.isRoleFile=function(a){var c=new b(a);c.position=0;var d=(c.readInt(),c.readUTF());return-1!=d.indexOf("role/")?!0:!1},e}(win.BaseWindow);a.MaterialLeftPanel=d}(materialleft||(materialleft={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),materialleft;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Module,d=Pan3d.BaseProcessor,e=Pan3d.LoadManager,f=Pan3d.Scene_data,g=materialui.MaterialEvent,h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.SHOW_MATERIAL_LEFT_PANEL="SHOW_MATERIAL_LEFT_PANEL",b.HIDE_MATERIAL_LEFT_PANEL="HIDE_MATERIAL_LEFT_PANEL",b}(b);a.MaterialLeftEvent=h;var i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"MaterialLeftModule"},b.prototype.listProcessors=function(){return[new j]},b}(c);a.MaterialLeftModule=i;var j=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getName=function(){return"MaterialLeftProcessor"},c.prototype.receivedModuleEvent=function(a){if(a instanceof h){var b=a;b.type==h.SHOW_MATERIAL_LEFT_PANEL&&(this.showLeftPanel(),this.readBaseModel()),b.type==h.HIDE_MATERIAL_LEFT_PANEL&&this.hideLeftPanel()}if(a instanceof g){var c=a;c.type==g.INUPT_NEW_MATERIAL_FILE&&(this.materialLeftPanel.materialTree=c.data)}},c.prototype.readBaseModel=function(){e.getInstance().load(f.fileRoot+"objs/model_2.objs",e.XML_TYPE,function(a){left.ModelShowModel.getInstance().readTxtToModelBy(a)})},c.prototype.hideLeftPanel=function(){editscene.EditLeftPanel.leftPanel.removeUIContainer(this.materialLeftPanel)},c.prototype.showLeftPanel=function(){this.materialLeftPanel||(this.materialLeftPanel=new a.MaterialLeftPanel),this.materialLeftPanel.hasStage||editscene.EditLeftPanel.leftPanel.addUIContainer(this.materialLeftPanel)},c.prototype.listenModuleEvents=function(){return[new h(h.SHOW_MATERIAL_LEFT_PANEL),new h(h.HIDE_MATERIAL_LEFT_PANEL),new g(g.INUPT_NEW_MATERIAL_FILE)]},c}(d);a.MaterialLeftProcessor=j}(materialleft||(materialleft={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.EventDispatcher,c=function(a){function b(b){var c=a.call(this)||this;return c.meshObj(b),c}return __extends(b,a),b.prototype.meshObj=function(a){var b=this;for(var c in a)this[c]=a[c];this.textureurl&&pack.PackMaterialManager.getInstance().getMaterialByUrl(this.textureurl,function(a){b.material=a,b.materialParam=new Pan3d.MaterialBaseParam,b.materialParam.material=b.material,pack.PackPrefabManager.getInstance().makeMaterialBaseParam(b.materialParam,b.paramInfo)})},b.prototype.getSaveObj=function(){var a={};return this.material&&(this.textureurl=this.material.url),a.paramInfo=this.paramInfo,a.textureurl=this.textureurl,a.gildline=this.gildline,a},b}(b);a.SceneProjectVo=c}(maineditor||(maineditor={}));var maineditor;!function(a){var b=function(){function a(){}return a.FILE_NODE="fileNode",a}();a.FileNode=b}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.Display3DSprite,c=function(a){function b(){var b=a.call(this)||this;return b.waitLoadUrl=[],b.particleItem=[],b}return __extends(b,a),b.prototype.getSocket=function(a,b){b.identity(),b.append(this.posMatrix)},b.prototype.addLyfByUrl=function(a){this._scene?this.loadTempByUrl(a):this.waitLoadUrl.push(a)},b.prototype.removeStage=function(){for(var b=this._scene;b&&this.particleItem.length;)b.particleManager.removeParticle(this.particleItem.pop());a.prototype.removeStage.call(this)},b.prototype.addStage=function(){for(a.prototype.addStage.call(this);this.waitLoadUrl.length;)this.loadTempByUrl(this.waitLoadUrl.pop())},b.prototype.loadTempByUrl=function(a){var b=this,c=this._scene;c.groupDataManager.scene=c,c.groupDataManager.getGroupData(Pan3d.Scene_data.fileRoot+a,function(a){for(var d=0;d<a.dataAry.length;d++){var e=a.dataAry[d];if(e.types==Pan3d.BaseRes.SCENE_PARTICLE_TYPE){var f=c.particleManager.getParticleByte(Pan3d.Scene_data.fileRoot+e.particleUrl);c.particleManager.addParticle(f),f.bindTarget=b,b.particleItem.push(f)}else console.log("播放的不是单纯特效")}})},b}(b);a.LyfSpriteDisplay=c}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.Display3DSprite,c=function(a){function b(){var b=a.call(this)||this;return b.skipNum=0,b.waitLoadUrl=[],b.roleChar=new left.MaterialRoleSprite,b}return __extends(b,a),b.prototype.updateMatrix=function(){a.prototype.updateMatrix.call(this),this.roleChar.x=this.x,this.roleChar.y=this.y,this.roleChar.z=this.z,this.roleChar.rotationX=this.rotationX,this.roleChar.rotationY=this.rotationY,this.roleChar.rotationZ=this.rotationZ},b.prototype.addSkillByUrl=function(a){this._scene?this.loadTempByUrl(a):this.waitLoadUrl.push(a)},b.prototype.addStage=function(){for(a.prototype.addStage.call(this);this.waitLoadUrl.length;)this.loadTempByUrl(this.waitLoadUrl.pop())},b.prototype.playNextSkill=function(){var a=this,b=this._scene;if(this.skillActionItem&&this.skillActionItem.length){var c;c=this.skillStaticMesh.actionnum>=0&&this.skillStaticMesh.actionnum<this.skillActionItem.length?this.skillActionItem[this.skillStaticMesh.actionnum]:this.skillActionItem[this.skipNum%this.skillActionItem.length];var d=b.skillManager.getSkill(this.skillStaticMesh.skillUrl,c);d&&(d.reset(),d.isDeath=!1),d.configFixEffect(this.roleChar),b.skillManager.playSkill(d),this.skipNum++}(!this.skillStaticMesh.interval||this.skillStaticMesh.interval<=0)&&(this.skillStaticMesh.interval=1),Pan3d.TimeUtil.addTimeOut(1e3*this.skillStaticMesh.interval,function(){a.playNextSkill()})},b.prototype.loadTempByUrl=function(a){var b=this;pack.PackSkillManager.getInstance().getPrefabByUrl(a,function(a){b.skillStaticMesh=a;var c=b._scene;b.roleChar.setRoleZwwUrl(b.skillStaticMesh.roleUrl),c.addMovieDisplay(b.roleChar),b.roleChar.scale=.3,Pan3d.ResManager.getInstance().loadSkillRes(Pan3d.Scene_data.fileRoot+b.skillStaticMesh.skillUrl,function(a){b.skillActionItem=[];for(var c in a.data)b.skillActionItem.push(c)}),b.playNextSkill()})},b}(b);a.SkillSpriteDisplay=c}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=function(){function a(){}return a.Folder=0,a.Prefab=1,a.Light=2,a.Water=3,a.Grass=4,a.Capture=5,a.Build=6,a.Reflection=7,a.LightProbe=8,a.ParallelLight=9,a.Particle=11,a.Role=12,a.SKILL=13,a.Ground=14,a}();a.HierarchyNodeType=b;var c=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(a.FileNode);a.HierarchyFileNode=c}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.Rectangle,c=Pan3d.Vector2D,d=Pan3d.TextureManager,e=Pan3d.InteractiveEvent,f=Pan3d.TextAlign,g=Pan3d.ModuleEventManager,h=Pan3d.UIManager,i=Pan3d.LabelTextFont,j=Pan3d.Disp2DBaseText,k=Pan3d.UIData,l=Pan3d.MouseType,m=Pan3d.MathUtil,n=Pan3d.TextRegExp,o=drag.PanDragEvent,p=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b.prototype,"select",{get:function(){return this._select},set:function(a){this._select=a,this.makeData()},enumerable:!0,configurable:!0}),b.prototype.makeData=function(){if(this.tittlestr){var a=this.parent.uiAtlas.getRec(this.textureStr);this.parent.uiAtlas.ctx=h.getInstance().getContext2D(a.pixelWitdh,a.pixelHeight,!1),this.parent.uiAtlas.ctx.clearRect(0,1,a.pixelWitdh,a.pixelHeight);var b=this.tittlestr;b=this._select?"[ffffff]"+b:"[9c9c9c]"+b,i.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,b,24,1,1,f.LEFT),d.getInstance().updateTexture(this.parent.uiAtlas.texture,a.pixelX,a.pixelY,this.parent.uiAtlas.ctx)}},b}(j);a.SelectFileListText=p;var q=function(){function b(a,b){this.perent=a,this.topRender=b,this.tabItemArr=[]}return b.prototype.tabBgClik=function(b){var c=b.target.data,d=b.target;b.x-d.absoluteX<d.absoluteWidth-20?(this.selectTabStr=c.rightTabInfoVo,-1!=this.selectTabStr.indexOf(".map")&&(g.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.LOAD_SCENE_MAP),this.selectTabStr),g.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.SHOW_MAIN_EDITOR_PANEL))),-1!=this.selectTabStr.indexOf(".material")&&Pan3d.ModuleEventManager.dispatchEvent(new materialui.MaterialEvent(materialui.MaterialEvent.SHOW_MATERIA_PANEL),this.selectTabStr)):(console.log("关",c),this.removePathUrl(c.rightTabInfoVo)),this.refrishTabUiSelect()},b.prototype.removePathUrl=function(a){for(var b=0;b<this.tabItemArr.length;b++)if(this.tabItemArr[b].rightTabInfoVo==a){var c=this.tabItemArr[b];this.perent.removeChild(c.bgUi),c.bgUi.removeEventListener(e.Down,this.tabBgClik,this),this.perent.clearTemp(c.rightTabInfoVo),this.tabItemArr.splice(b,1)}},b.prototype.changeVoBg=function(a,b){var c="e_edit_select_bg_1";c=b?"e_edit_select_bg_2":"e_edit_select_bg_1";var d=this.perent.addChild(this.topRender.getComponent(c));a.bgUi&&(d.x=a.bgUi.x,d.y=a.bgUi.y,d.width=a.bgUi.width,d.height=a.bgUi.height,a.bgUi.removeEventListener(e.Down,this.tabBgClik,this),this.perent.removeChild(a.bgUi)),a.bgUi=d,a.bgUi.addEventListener(e.Down,this.tabBgClik,this),a.bgUi.data=a,a.select=b},b.prototype.refrishTabUiSelect=function(){for(var a=2,b=0;b<this.tabItemArr.length;b++){var c=this.tabItemArr[b];this.tabItemArr[b].rightTabInfoVo==this.selectTabStr?(this.tabItemArr[b].select=!0,this.changeVoBg(this.tabItemArr[b],!0)):(this.tabItemArr[b].select=!1,this.changeVoBg(this.tabItemArr[b],!1)),c.bgUi.x=a-1,c.bgUi.y=1,c.bgUi.width=Math.floor(c.textMetrics.width)+20+25,c.bgUi.height=22,c.bgUi.data=c,a+=c.bgUi.width,c.ui.x=c.bgUi.x+10,c.ui.y=c.bgUi.y+5,c.ui.width=256,c.ui.height=20}this.topRender.applyObjData()},b.prototype.pushPathUrl=function(a){this.selectTabStr=a;for(var b=!0,c=1,d=0;d<this.tabItemArr.length;d++)this.tabItemArr[d].rightTabInfoVo==a&&(b=!1),c=this.tabItemArr[d].bgUi.x+this.tabItemArr[d].bgUi.width-1;if(b){var e=a.split("/")[a.split("/").length-1],f=a,g=h.getInstance().getContext2D(100,100,!1);g.font="13px "+k.font;var i=this.perent.showTemp(f);i.textMetrics=n.getTextMetrics(g,e),i.tittlestr=e,this.changeVoBg(i,!1),i.select=!0,this.tabItemArr.push(i)}this.refrishTabUiSelect()},b}();a.EditorOpenList=q;var r=function(f){function h(){var c=f.call(this,p,new b(0,0,512,40),10)||this;return c.suffix="prefab|lyf|zzw|skill",c.pageRect=new b(0,0,500,500),c._sceneViewRender=new a.UiModelViewRender,c.addRender(c._sceneViewRender),c}return __extends(h,f),Object.defineProperty(h.prototype,"sceneProjectVo",{set:function(a){this._sceneViewRender.sceneProjectVo=a},enumerable:!0,configurable:!0}),h.prototype.loadConfigCom=function(){f.prototype.loadConfigCom.call(this),this.e_centen_panel=this.addChild(this._baseMidRender.getComponent("e_centen_panel")),this.editorOpenList=new q(this,this._baseTopRender),this.e_line_left=this.addChild(this._baseTopRender.getComponent("e_line_vertical")),this.e_line_right=this.addChild(this._baseTopRender.getComponent("e_line_vertical")),this.initView(),this.uiLoadComplete=!0,this.refrishSize(),this.showType=AppData.sceneEidtType},Object.defineProperty(h.prototype,"showType",{set:function(a){if(AppData.sceneEidtType=a,this.uiLoadComplete)switch(AppData.sceneEidtType){case 1:this.setUiListVisibleByItem([this.a_scene_view],!0);break;case 2:this.setUiListVisibleByItem([this.a_scene_view],!1)}},enumerable:!0,configurable:!0}),h.prototype.initView=function(){var a=this;this._sceneViewRender.uiAtlas=this._tRender.uiAtlas,this.a_scene_view=this.addChild(this._sceneViewRender.getComponent("a_scene_view")),d.getInstance().getTexture("res/white.jpg",function(b){a._sceneViewRender.textureRes=b,Pan3d.TimeUtil.addFrameTick(function(b){a.upFrame(b)})}),this.a_scene_view.addEventListener(o.DRAG_DROP,this.dragDrop,this),this.a_scene_view.addEventListener(o.DRAG_ENTER,this.dragEnter,this),this.a_scene_view.addEventListener(e.Down,this.butClik,this),document.addEventListener(l.MouseWheel,function(b){a.onPanellMouseWheel(b)})},h.prototype.butClik=function(b){switch(b.target){case this.a_scene_view:(b.mouseEvent.ctrlKey||b.mouseEvent.shiftKey)&&g.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.SCENE_SELECT_SPRITE_DOWN),b)}},h.prototype.onPanellMouseWheel=function(b){var d=win.LayerManager.getInstance().getObjectsUnderPoint(new c(b.x,b.y));if(d&&d.parent==this){var e=new Pan3d.Quaternion;e.fromMatrix(a.MainEditorProcessor.edItorSceneManager.cam3D.cameraMatrix);var f=e.toMatrix3D();f.invert();var g=f.transformVector(new Vector3D(0,0,b.wheelDelta/100));a.MainEditorProcessor.edItorSceneManager.cam3D.x+=g.x,a.MainEditorProcessor.edItorSceneManager.cam3D.y+=g.y,a.MainEditorProcessor.edItorSceneManager.cam3D.z+=g.z,m.MathCam(a.MainEditorProcessor.edItorSceneManager.cam3D)}},h.prototype.dragDrop=function(a){this.testSuffix(drag.DragManager.dragSource.url)?console.log("可以拖动"):console.log("不可以")},h.prototype.testSuffix=function(a){if(this.suffix){for(var b=this.suffix.split("|"),c=0;c<b.length;c++)if(-1!=a.indexOf(b[c]))return!0;return!1}},h.prototype.dragEnter=function(b){if(this.testSuffix(drag.DragManager.dragSource.url)){var d={};d.url=drag.DragManager.dragSource.url,d.name="新对象",d.pos=a.MainEditorProcessor.edItorSceneManager.getGroundPos(new c(b.data.x,b.data.y)),-1!=drag.DragManager.dragSource.url.indexOf(".lyf")&&g.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.INPUT_LYF_TO_SCENE),d),-1!=drag.DragManager.dragSource.url.indexOf(".skill")&&g.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.INPUT_SKILL_TO_SCENE),d),-1!=drag.DragManager.dragSource.url.indexOf(".prefab")&&g.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.INPUT_PREFAB_TO_SCENE),d),-1!=drag.DragManager.dragSource.url.indexOf(".zzw")&&g.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.INPUT_ZZW_TO_SCENE),d)}},h.prototype.upFrame=function(b){if(this.hasStage){a.MainEditorProcessor.edItorSceneManager.textureRes=this._sceneViewRender.textureRes;var c=a.MainEditorProcessor.edItorSceneManager.cam3D;c.cavanRect.x=this.a_scene_view.x+this.left,c.cavanRect.y=this.a_scene_view.y+this.top,c.cavanRect.width=this.a_scene_view.width,c.cavanRect.height=this.a_scene_view.height,a.MainEditorProcessor.edItorSceneManager.renderToTexture()}},h.prototype.resize=function(){f.prototype.resize.call(this)},h.prototype.panelEventChanger=function(a){this.setRect(a),this.refrishSize()},h.prototype.refrishSize=function(){if(this.uiLoadComplete){var a=1;this.a_scene_view.x=a,this.a_scene_view.y=a+22,this.a_scene_view.width=this.pageRect.width-2*a,this.a_scene_view.height=this.pageRect.height-2*a-20,this.e_centen_panel&&(this.e_centen_panel.x=0,this.e_centen_panel.y=0,this.e_centen_panel.width=this.pageRect.width,this._baseMidRender.applyObjData()),this.e_line_left.x=1,this.e_line_left.y=0,this.e_line_left.height=this.pageRect.height,this.e_line_right.x=this.pageRect.width-3,this.e_line_right.y=0,this.e_line_right.height=this.pageRect.height}this.resize()},h}(win.Dis2dBaseWindow);a.MainEditorPanel=r}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.Vector3D,c=prop.MetaDataView,d=prop.ReflectionData,e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.getView=function(){var a=[{Type:d.Vec3,Label:"坐标:",FunKey:"pos",target:this,Step:1,Category:"属性"},{Type:d.Vec3,Label:"比例:",FunKey:"scale",target:this,Step:.1,Category:"属性"},{Type:d.Vec3,Label:"角度:",FunKey:"rotation",target:this,Step:1,
Category:"属性"}];return a},c.prototype.resize=function(){for(var a=this._top,b=0;this.ui&&b<this.ui.length;b++)this.ui[b].y=a,this.ui[b].x=20,a+=this.ui[b].height,this.ui.length>1&&(a+=10),this.ui[b].width=this.width,this.ui[b].resize();this._height=a-this._top},Object.defineProperty(c.prototype,"data",{get:function(){return this._data},set:function(a){var b=this;this._data=a,this.xyzPosData=this.data,this.xyzPosData.dataUpDate=function(){b.refreshViewValue()}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pos",{get:function(){return new b(this.xyzPosData.x,this.xyzPosData.y,this.xyzPosData.z)},set:function(a){this.xyzPosData.x=a.x,this.xyzPosData.y=a.y,this.xyzPosData.z=a.z,this.xyzPosData.changeModelMatrix3d(),this.xyzPosData.upRootMatrix3DToItem()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotation",{get:function(){return new b(this.xyzPosData.rotationX,this.xyzPosData.rotationY,this.xyzPosData.rotationZ)},set:function(a){this.xyzPosData.rotationX=a.x,this.xyzPosData.rotationY=a.y,this.xyzPosData.rotationZ=a.z,this.xyzPosData.changeModelMatrix3d(),this.xyzPosData.upRootMatrix3DToItem()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{get:function(){return new b(this.xyzPosData.scaleX,this.xyzPosData.scaleY,this.xyzPosData.scaleZ)},set:function(a){this.xyzPosData.scaleX=a.x,this.xyzPosData.scaleY=a.y,this.xyzPosData.scaleZ=a.z,this.xyzPosData.changeModelMatrix3d(),this.xyzPosData.upRootMatrix3DToItem()},enumerable:!0,configurable:!0}),c}(c);a.PropertyMeshView=e}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.Vector3D,c=prop.MetaDataView,d=prop.ReflectionData,e=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;return a._bgcolor=new b(11,11,11),a}return __extends(e,c),e.prototype.getView=function(){var a=this,b=[{Type:d.TEXT,Label:"场景名字:",FunKey:"mapname",target:this,Category:"属性"},{Type:d.Vec3Color,Label:"背景颜色:",FunKey:"bgcolor",target:this,Step:.1,Category:"属性"},{Type:d.ComboBox,Label:"坐标网格:",FunKey:"gridline",target:this,Category:"属性",Data:[{name:"false",type:0},{name:"true",type:1}]},{Type:d.Vec3,Label:"坐标:",FunKey:"campos",target:this,Step:1,Category:"镜头"},{Type:d.Vec3,Label:"角度:",FunKey:"camrotation",target:this,Step:1,Category:"镜头"},{Type:d.MaterialPicUi,Label:"纹理:",FunKey:"texture",changFun:function(b){a.textureChangeInfo(b)},target:this,Suffix:"material",Category:"后期"}];return b},Object.defineProperty(e.prototype,"gridline",{get:function(){return e.gridLineSprite||(e.gridLineSprite=new Pan3d.GridLineSprite),this.sceneProjectVo.gildline?a.MainEditorProcessor.edItorSceneManager.addDisplay(e.gridLineSprite,0):a.MainEditorProcessor.edItorSceneManager.removeDisplay(e.gridLineSprite),this.sceneProjectVo.gildline?1:0},set:function(a){this.sceneProjectVo.gildline=1==a,this.refreshViewValue()},enumerable:!0,configurable:!0}),e.prototype.textureChangeInfo=function(a){this.sceneProjectVo.paramInfo=a,this.sceneProjectVo.materialParam=new Pan3d.MaterialBaseParam,this.sceneProjectVo.materialParam.material=this.sceneProjectVo.material,pack.PackPrefabManager.getInstance().makeMaterialBaseParam(this.sceneProjectVo.materialParam,this.sceneProjectVo.paramInfo)},e.prototype.getParamItem=function(a){for(var b=0;this.sceneProjectVo.paramInfo&&b<this.sceneProjectVo.paramInfo.length;b++)if(this.sceneProjectVo.paramInfo[b].paramName==a)return this.sceneProjectVo.paramInfo[b].data;return null},Object.defineProperty(e.prototype,"texture",{get:function(){var a=this;return this.sceneProjectVo.material?this.sceneProjectVo.material:(this.sceneProjectVo.textureurl&&pack.PackMaterialManager.getInstance().getMaterialByUrl(this.sceneProjectVo.textureurl,function(b){a.sceneProjectVo.material=b,a.refreshViewValue()}),null)},set:function(a){this.sceneProjectVo.material=a,this.sceneProjectVo.textureurl=this.sceneProjectVo.material.url,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapname",{get:function(){return AppData.mapOpenUrl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a,this.sceneProjectVo=a,this.refreshViewValue()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"campos",{get:function(){return new b},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bgcolor",{get:function(){return this._bgcolor},set:function(a){this._bgcolor=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camrotation",{get:function(){return new b},set:function(a){},enumerable:!0,configurable:!0}),e}(c);a.ScenePojectMeshView=e}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.Scene_data,c=Pan3d.UIRenderOnlyPicComponent,d=Pan3d.ProgrmaManager,e=Pan3d.Shader3D,f=Pan3d.TimeUtil,g=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Pos"),a.bindAttribLocation(this.program,1,"v2uv")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[50];uniform vec4 ui2[50];varying vec2 v0;void main(void){   vec4 data = ui2[int(v2uv.z)];   v0 = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D fs0;\nvarying vec2 v0;\nvoid main(void){\nvec4 ik=texture2D(fs0,v0);\ngl_FragColor=vec4(ik.x,ik.x,ik.x,1.0);\n}";return a},b.UiModelViewShder="UiModelViewShder",b}(e);a.UiModelViewShder=g;var h=function(a){function c(){var b=a.call(this)||this;return b.time=0,b}return __extends(c,a),c.prototype.initData=function(){this._uiList=new Array,this.objData=new ObjData,d.getInstance().registe(g.UiModelViewShder,new g),this.shader=d.getInstance().getProgram(g.UiModelViewShder),this.program=this.shader.program,this.uiProLocation=b.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=b.context3D.getLocation(this.program,"ui2")},c.prototype.makeRenderDataVc=function(b){a.prototype.makeRenderDataVc.call(this,b);for(var c=0;c<this.renderData2.length/4;c++)this.renderData2[4*c+0]=1,this.renderData2[4*c+1]=-1,this.renderData2[4*c+2]=0,this.renderData2[4*c+3]=0},Object.defineProperty(c.prototype,"sceneProjectVo",{set:function(a){a&&(this._sceneProjectVo&&this._sceneProjectVo.removeEventListener(Pan3d.BaseEvent.COMPLETE,this.sceneProjectUpData,this),this._sceneProjectVo=a,this._sceneProjectVo.addEventListener(Pan3d.BaseEvent.COMPLETE,this.sceneProjectUpData,this),this.sceneProjectUpData())},enumerable:!0,configurable:!0}),c.prototype.sceneProjectUpData=function(){var a=this;pack.PackMaterialManager.getInstance().getMaterialByUrl(this._sceneProjectVo.textureurl,function(c){a.materialTree=c;var d=new g;a.materialTree.shader=a.materialTree.modelShader,d.fragment=a.materialTree.shader.fragment,d.encode(),a.uiProLocation=b.context3D.getLocation(d.program,"ui"),a.ui2ProLocation=b.context3D.getLocation(d.program,"ui2"),a.shader=d,a.materialTree.shader=d})},c.prototype.setMaterialVc=function(a,c){if(void 0===c&&(c=null),!(a.fcNum<=0)){var d=0;a.hasTime&&(d=(f.getTimer()-this.time)%1e5*.001),a.update(d),c&&c.update(),b.context3D.setVc4fv(this.shader,"fc",a.fcData)}},c.prototype.update=function(){this.visible&&this._uiList.length&&(b.context3D.setBlendParticleFactors(this.blenderMode),b.context3D.setProgram(this.shader.program),b.context3D.setVc4fvLocation(this.uiProLocation,this.renderData),b.context3D.setVc4fvLocation(this.ui2ProLocation,this.renderData2),b.context3D.setVa(0,3,this.objData.vertexBuffer),b.context3D.setVa(1,3,this.objData.uvBuffer),b.context3D.setRenderTexture(this.shader,"fs0",this.texture,0),this.materialTree&&this.setMaterialVc(this.materialTree,this._sceneProjectVo.materialParam),b.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},c}(c);a.UiModelViewRender=h}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.InteractiveEvent,c=Pan3d.TextAlign,d=Pan3d.Rectangle,e=Pan3d.ModuleEventManager,f=Pan3d.UIManager,g=Pan3d.LabelTextFont,h=Pan3d.Disp2DBaseText,i=Pan3d.MouseType,j=Pan3d.Vector2D,k=Pan3d.Scene_data,l=Pan3d.TextureManager,m=Pan3d.LoadManager,n=Pan3d.KeyboardType,o=Pan3d.Shader3D,p=Pan3d.ProgrmaManager,q=Pan3d.BaseEvent,r=prop.CombineReflectionView,s=xyz.TooXyzPosData,t=menutwo.MenuListData,u=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"u2Texture")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 u2Texture;uniform mat4 vpMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(u2Texture.x, u2Texture.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = vpMatrix3D * vt0;   gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ngl_FragColor =infoUv;\n}";return a},b.TestDiplay3dShader="TestDiplay3dShader",b}(o);a.TestDiplay3dShader=u;var v=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.update=function(){var b=!1;b?this.drawBaseModel():a.prototype.update.call(this)},b.prototype.drawBaseModel=function(){if(this.objData){if(!this.baseModeShader){p.getInstance().registe(u.TestDiplay3dShader,new u),this.baseModeShader=p.getInstance().getProgram(u.TestDiplay3dShader);var a=f.getInstance().getContext2D(128,128,!1);a.fillStyle="rgb(255,255,255)",a.fillRect(0,0,128,128),this.baseTextureres=l.getInstance().getCanvasTexture(a)}k.context3D.setProgram(this.baseModeShader.program),k.context3D.setVpMatrix(this.baseModeShader,k.vpMatrix.m),k.context3D.setVcMatrix4fv(this.baseModeShader,"posMatrix3D",this.posMatrix.m),k.context3D.setRenderTexture(this.baseModeShader,"s_texture",this.baseTextureres.texture,0),k.context3D.setVa(0,3,this.objData.vertexBuffer),k.context3D.setVa(1,2,this.objData.uvBuffer),k.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},Object.defineProperty(b.prototype,"prefab",{get:function(){return this._prefab},set:function(a){this._prefab=a,this._prefab.addEventListener(q.COMPLETE,this.meshParamInfo,this),this.meshParamInfo()},enumerable:!0,configurable:!0}),b.prototype.meshParamInfo=function(){var a=this;this._prefab.objsurl&&pack.PackObjDataManager.getInstance().getObjDataByUrl(this._prefab.objsurl,function(b){a._prefab.objData=b,a.objData=b}),this._prefab.textureurl&&pack.PackMaterialManager.getInstance().getMaterialByUrl(this._prefab.textureurl,function(b){a._prefab.material=b,a.material=b}),this.material&&this._prefab.paramInfo&&(this.materialParam=new Pan3d.MaterialBaseParam,this.materialParam.material=this.material,pack.PackPrefabManager.getInstance().makeMaterialBaseParam(this.materialParam,this._prefab.paramInfo))},b.prototype.setPreFabUrl=function(a){var b=this;pack.PackPrefabManager.getInstance().getPrefabByUrl(a,function(a){b.prefab=a})},b}(left.MaterialModelSprite);a.ModelSprite=v;var w=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.HierarchyFileNode);a.OssListFile=w;var x=function(a){function b(){return a.call(this)||this}return __extends(b,a),Object.defineProperty(b.prototype,"name",{set:function(a){this.needDraw=!0},enumerable:!0,configurable:!0}),b.prototype.destory=function(){this.needDraw=null,this.clear=!0},b}(Pan3d.baseMeshVo);a.FolderMeshVo=x;var y=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return __extends(d,b),d.prototype.makeData=function(){if(this.folderMeshVo=this.rightTabInfoVo,this.folderMeshVo){var b=this.parent.uiAtlas.getRec(this.textureStr);this.parent.uiAtlas.ctx=f.getInstance().getContext2D(b.pixelWitdh,b.pixelHeight,!1),this.parent.uiAtlas.ctx.clearRect(0,1,b.pixelWitdh,b.pixelHeight),g.writeSingleLabelToCtx(this.parent.uiAtlas.ctx,"[9c9c9c]"+this.folderMeshVo.ossListFile.name,24,70,10,c.LEFT);switch((this.folderMeshVo.ossListFile.children||this.folderMeshVo.ossListFile.type==a.HierarchyNodeType.Folder)&&(this.folderMeshVo.ossListFile.isOpen?this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.icon_PanRight,2,5,20,20):this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.icon_PanUp,3,5,20,20)),this.folderMeshVo.ossListFile.type){case a.HierarchyNodeType.Prefab:this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.profeb_16,30,5,26,32);break;case a.HierarchyNodeType.Role:this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.zzw_16x,30,5,26,32);break;case a.HierarchyNodeType.SKILL:this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.skill_16x,30,5,26,32);break;case a.HierarchyNodeType.Light:this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.icon_point16,30,5,26,32);break;case a.HierarchyNodeType.Particle:this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.particle_16x,30,5,26,32);break;case a.HierarchyNodeType.Folder:this.folderMeshVo.ossListFile.isOpen?this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.icon_FolderOpen_dark,15,2,18,16):this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.icon_FolderClosed_dark,15,2,18,16);break;default:this.parent.uiAtlas.ctx.drawImage(z.imgBaseDic.water_plane16,15,2,18,16)}l.getInstance().updateTexture(this.parent.uiAtlas.texture,b.pixelX,b.pixelY,this.parent.uiAtlas.ctx)}},d.prototype.update=function(){this.folderMeshVo=this.rightTabInfoVo,this.folderMeshVo&&(this.folderMeshVo.needDraw&&(this.makeData(),this.folderMeshVo.needDraw=!1),this.folderMeshVo.cellPos&&(this.ui.x=this.folderMeshVo.cellPos.x,this.ui.y=this.folderMeshVo.cellPos.y,this.ui.width=this.ui.baseRec.width*this.folderMeshVo.uiScale,this.ui.height=this.ui.baseRec.height*this.folderMeshVo.uiScale),this.folderMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null))},d}(h);a.FolderName=y;var z=function(c){function f(){var b=c.call(this,y,new d(0,0,400,40),20)||this;return b.only=!0,b.cellBgItem=[],b.left=0,b.pageRect=new d(0,0,200,200),a.EditorModel.getInstance().hierarchyListPanel=b,b.maskRoundRect=new d(0,13,0,14),b}return __extends(f,c),f.prototype.loadConfigCom=function(){var a=this;c.prototype.loadConfigCom.call(this),this.setUiListVisibleByItem([this.c_scroll_bar_bg],!0),this.setUiListVisibleByItem([this.c_win_bg],!1),this.setUiListVisibleByItem([this.e_panel_1],!0),this.resize(),this.loadAssetImg(function(){a.makeItemUiList(),Pan3d.TimeUtil.addFrameTick(function(b){a.update(b)})})},Object.defineProperty(f.prototype,"isCanToDo",{get:function(){return this&&this.hasStage?!0:!1},enumerable:!0,configurable:!0}),f.prototype.onMouseWheel=function(a){this.isCanToDo&&this.pageRect.isHitByPoint(a.x,a.y)&&this.contentHeight>this._uiMask.height&&(this.c_scroll_bar.y+=a.deltaY/30,this.changeScrollBar(),this.resize())},f.prototype.loadAssetImg=function(a){f.imgBaseDic={};var b=[];b.push("icon_FolderClosed_dark"),b.push("icon_FolderOpen_dark"),b.push("icon_PanRight"),b.push("icon_PanUp"),b.push("profeb_16"),b.push("icon_point16"),b.push("water_plane16"),b.push("particle_16x"),b.push("zzw_16x"),b.push("skill_16x");for(var c=0,d=0;d<b.length;d++)this.loadTempOne(b[d],function(){c++,c>=b.length&&a()})},f.prototype.loadTempOne=function(a,b){var c=makeImage();f.imgBaseDic[a]=c,c.onload=function(){b()},c.url=k.fileuiRoot+"ui/folder/pic/"+a+".png",c.src=k.fileuiRoot+"ui/folder/pic/"+a+".png"},f.prototype.update=function(a){c.prototype.update.call(this,a)},f.prototype.changeFileName=function(a){if(a.folderMeshVo&&a.ui){var b=a.folderMeshVo.ossListFile.name,c=new d;c.x=a.ui.x+this.left,c.y=a.ui.y+this.top,c.x+=30,c.y+=0,c.width=8*b.length,c.height=20;var e=editscene.ChangeNameModel.getInstance().getTextMetrics(b,14);c.width=e.width+20,editscene.ChangeNameModel.getInstance().changeName(c,b,function(b){a.folderMeshVo.ossListFile.name=b,a.makeData(),console.log(a)})}},f.prototype.makeFileFloadMenu=function(a){var b=this,c=(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),{});c.mouse=new j(a.clientX,a.clientY);var d=new Array;d.push(new t("删除文件","1")),d.push(new t("重命名","2")),d.push(new t("查找文件","3")),c.menuXmlItem=d,c.info={},c.info.bfun=function(a,c){b.menuBfun(a,c)},e.dispatchEvent(new menutwo.MenuTwoEvent(menutwo.MenuTwoEvent.SHOW_RIGHT_MENU),c)},f.prototype.menuBfun=function(b,c){switch(b.key){case"1":this.selectFolderMeshVo&&(this.deleFile(a.EditorModel.getInstance().fileItem,this.selectFolderMeshVo.folderMeshVo),Pan3d.ModuleEventManager.dispatchEvent(new xyz.MoveScaleRotatioinEvent(xyz.MoveScaleRotatioinEvent.CLEAR_XYZ_MOVE_DATA)),this.refrishFolder());break;case"2":this.changeFileName(this.selectFolderMeshVo);break;case"3":var d=Pan3d.Scene_data.fileRoot+this.selectFolderMeshVo.folderMeshVo.ossListFile.url;Pan3d.ModuleEventManager.dispatchEvent(new folder.FolderEvent(folder.FolderEvent.LIST_DIS_ALL_FILE),d.replace(Pan3d.Scene_data.ossRoot,""))}},f.prototype.deleFile=function(b,c){var d=b.indexOf(c);if(-1==d)console.log("没找到需要到子目录找");else{switch(b.splice(d,1),c.ossListFile.type){case a.HierarchyNodeType.Prefab:a.MainEditorProcessor.edItorSceneManager.removeDisplay(c.dis);break;case a.HierarchyNodeType.Particle:a.MainEditorProcessor.edItorSceneManager.removeDisplay(c.dis);break;case a.HierarchyNodeType.Role:a.MainEditorProcessor.edItorSceneManager.removeMovieDisplay(c.dis)}this.clearTemp(c)}this.refrishFolder()},f.prototype.itemMouseUp=function(b){for(var c,d=0;d<this._uiItem.length;d++){var e=this._uiItem[d];e.ui==b.target&&(c=e,b.x-this.left-e.ui.x<20&&(e.folderMeshVo.ossListFile.isOpen=!e.folderMeshVo.ossListFile.isOpen,e.folderMeshVo.ossListFile.isOpen||this.clearChildern(e.folderMeshVo)),e.folderMeshVo.needDraw=!0)}c&&(this.hidefileItemBg(a.EditorModel.getInstance().fileItem),c.folderMeshVo.ossListFile.treeSelect=!0,a.EditorModel.getInstance().selectItem=[c.folderMeshVo],this.showXyzMove()),this.refrishFolder(),this.resize()},f.prototype.showMeshView=function(b,c){var d=prop.PropModel.getInstance().propPanle,e=new r(d),f=new a.PropertyMeshView(d);switch(f.data=b,e.addView(f),c.ossListFile.type){case a.HierarchyNodeType.Prefab:if(c.dis.prefab){var g=new filelist.PrefabMeshView(d);g.data=c.dis.prefab,e.addView(g)}else console.log("还没准备好");break;case a.HierarchyNodeType.Role:if(console.log(c.dis.roleStaticMesh),c.dis.roleStaticMesh){var h=new filelist.RoleMeshView(d);h.data=c.dis.roleStaticMesh,e.addView(h)}else console.log("还没准备好");break;case a.HierarchyNodeType.SKILL:if(c.dis.skillStaticMesh){var i=new filelist.SkillMeshView(d);i.data=c.dis.skillStaticMesh,e.addView(i)}else console.log("还没准备好");break;case a.HierarchyNodeType.Particle:if(c.dis){var j=new filelist.FileMeshView(d);j.data=c.ossListFile.url,e.addView(j)}else console.log("还没准备好")}prop.PropModel.getInstance().showOtherMeshView(e)},f.prototype.showXyzMove=function(){for(var b,c=[],d=0;d<a.EditorModel.getInstance().selectItem.length;d++){var e=a.EditorModel.getInstance().selectItem[d];e.ossListFile.treeSelect=!0,c.push(e.dis),b=e}var f=s.getBase(c);this.showMeshView(f,b),Pan3d.ModuleEventManager.dispatchEvent(new xyz.MoveScaleRotatioinEvent(xyz.MoveScaleRotatioinEvent.MAKE_DTAT_ITEM_TO_CHANGE),f)},f.prototype.hidefileItemBg=function(a){for(var b=0;a&&b<a.length;b++)a[b].ossListFile.treeSelect=!1,this.hidefileItemBg(a[b].childItem)},f.prototype.clearChildern=function(a){if(a.childItem)for(var b=0;b<a.childItem.length;b++){var c=a.childItem[b];c.cellPos.x=-1e3,this.clearChildern(c)}},f.prototype.makeItemUiList=function(){var a=this;this._baseRender.mask=this._uiMask,this.onRightMenuFun||(this.onRightMenuFun=function(b){a.onRightMenu(b)}),document.addEventListener("contextmenu",this.onRightMenuFun),this.onKeyDownFun||(this.onKeyDownFun=function(b){a.onKeyDown(b)}),document.addEventListener(i.KeyDown,this.onKeyDownFun),this.onMouseWheelFun||(this.onMouseWheelFun=function(b){a.onMouseWheel(b)}),document.addEventListener(i.MouseWheel,this.onMouseWheelFun),this.loadBaseSceneUrl()},f.prototype.onKeyDown=function(b){if(a.EditorModel.getInstance().selectItem&&1==a.EditorModel.getInstance().selectItem.length){var c=a.EditorModel.getInstance().selectItem[0],d=a.EditorModel.getInstance().fileItem.indexOf(c);if(b.ctrlKey)switch(b.keyCode){case n.Up:d>0&&(a.EditorModel.getInstance().fileItem.splice(d,1),a.EditorModel.getInstance().fileItem.splice(d-1,0,c)),console.log("向上");break;case n.Down:d<a.EditorModel.getInstance().fileItem.length-2&&(a.EditorModel.getInstance().fileItem.splice(d,1),a.EditorModel.getInstance().fileItem.splice(d+1,0,c)),console.log("向下")}this.refrishFolder()}},f.prototype.addRender=function(a){c.prototype.addRender.call(this,a);for(var d=0;this._uiItem&&d<this._uiItem.length;d++)this._uiItem[d].ui.addEventListener(b.Down,this.itemMouseUp,this)},f.prototype.loadBaseSceneUrl=function(){e.dispatchEvent(new editscene.EditSceneEvent(editscene.EditSceneEvent.EDITE_SCENE_UI_LOAD_COMPLETE))},f.prototype.onRightMenu=function(a){a.preventDefault();var b=win.LayerManager.getInstance().getObjectsUnderPoint(new j(a.x,a.y));if(b&&b.parent instanceof f){var c=this.getItemVoByUi(b);c&&(this.selectFolderMeshVo=c,this.makeFileFloadMenu(a))}},f.prototype.getItemVoByUi=function(a){for(var b=0;b<this._uiItem.length;b++)if(this._uiItem[b].ui==a)return this._uiItem[b];return null},f.prototype.wirteItem=function(b){for(var c=new Array,d=0;b&&d<b.length;d++){var e=new x;switch(e.ossListFile=new w,e.ossListFile.name=b[d].name,e.ossListFile.url=b[d].url,e.ossListFile.type=b[d].type,e.ossListFile.treeSelect=b[d].treeSelect,e.cellPos=new j,this.showTemp(e),e.ossListFile.type){case a.HierarchyNodeType.Prefab:var f=new v;f.setPreFabUrl(b[d].url),e.dis=f,a.MainEditorProcessor.edItorSceneManager.addDisplay(e.dis);break;case a.HierarchyNodeType.Particle:var g=new a.LyfSpriteDisplay;g.addLyfByUrl(b[d].url),e.dis=g,a.MainEditorProcessor.edItorSceneManager.addDisplay(e.dis);break;case a.HierarchyNodeType.Role:var h=new left.MaterialRoleSprite;h.setRoleZwwUrl(b[d].url),e.dis=h,a.MainEditorProcessor.edItorSceneManager.addMovieDisplay(h);break;case a.HierarchyNodeType.SKILL:var i=new a.SkillSpriteDisplay;i.addSkillByUrl(b[d].url),e.dis=i,a.MainEditorProcessor.edItorSceneManager.addDisplay(i)}e.dis.x=b[d].x,e.dis.y=b[d].y,e.dis.z=b[d].z,e.dis.scaleX=b[d].scaleX,e.dis.scaleY=b[d].scaleY,e.dis.scaleZ=b[d].scaleZ,e.dis.rotationX=b[d].rotationX,e.dis.rotationY=b[d].rotationY,e.dis.rotationZ=b[d].rotationZ,e.childItem=this.wirteItem(b[d].children),c.push(e)}return c},f.prototype.inputZzwToScene=function(b){var c=new left.MaterialRoleSprite;c.setRoleZwwUrl(b.url),a.MainEditorProcessor.edItorSceneManager.addMovieDisplay(c);var d=new x;d.ossListFile=new w,d.dis=c,d.ossListFile.name=b.name,d.ossListFile.url=b.url,d.ossListFile.type=a.HierarchyNodeType.Role,d.ossListFile.treeSelect=!1,d.cellPos=new j,this.showTemp(d),a.EditorModel.getInstance().fileItem.push(d),this.isCompelet=!0,this.refrishFolder(),this.resize()},f.prototype.inputLyfToScene=function(b){var c=new a.LyfSpriteDisplay;c.addLyfByUrl(b.url),a.MainEditorProcessor.edItorSceneManager.addDisplay(c);var d=new x;d.ossListFile=new w,d.dis=c,a.MainEditorProcessor.edItorSceneManager.addDisplay(d.dis),d.ossListFile.name=b.name,d.ossListFile.url=b.url,d.ossListFile.type=a.HierarchyNodeType.Particle,d.ossListFile.treeSelect=!1,d.cellPos=new j,this.showTemp(d),a.EditorModel.getInstance().fileItem.push(d),this.isCompelet=!0,this.refrishFolder(),this.resize()},f.prototype.inputSkillToScene=function(b){var c=new a.SkillSpriteDisplay;c.addSkillByUrl(b.url),a.MainEditorProcessor.edItorSceneManager.addDisplay(c);var d=new x;d.ossListFile=new w,d.dis=c,a.MainEditorProcessor.edItorSceneManager.addDisplay(d.dis),d.ossListFile.name=b.name,d.ossListFile.url=b.url,d.ossListFile.type=a.HierarchyNodeType.SKILL,d.ossListFile.treeSelect=!1,d.cellPos=new j,this.showTemp(d),a.EditorModel.getInstance().fileItem.push(d),this.isCompelet=!0,this.refrishFolder(),this.resize()},f.prototype.inputPrefabToScene=function(b){var c=b.url,d=new x;d.ossListFile=new w;var e=new v;e.setPreFabUrl(c),d.dis=e,b.scale&&(d.dis.x=b.pos.x,d.dis.y=b.pos.y,d.dis.z=b.pos.z),b.scale&&(d.dis.scaleX=b.scale.x,d.dis.scaleY=b.scale.y,d.dis.scaleZ=b.scale.z),b.rotation&&(d.dis.rotationX=b.rotation.x,d.dis.rotationY=b.rotation.y,d.dis.rotationZ=b.rotation.z),a.MainEditorProcessor.edItorSceneManager.addDisplay(d.dis),d.ossListFile.name=b.name,d.ossListFile.url=b.url,d.ossListFile.type=a.HierarchyNodeType.Prefab,d.ossListFile.treeSelect=!1,d.cellPos=new j,this.showTemp(d),a.EditorModel.getInstance().fileItem.push(d),this.isCompelet=!0,this.refrishFolder(),this.resize()},f.prototype.makeModelSprite=function(a,b){m.getInstance().load(k.fileRoot+b.objsurl,m.XML_TYPE,function(b){a.readTxtToModel(b)}),pack.PackMaterialManager.getInstance().getMaterialByUrl(b.textureurl,function(b){a.material=b})},f.prototype.clearSceneAll=function(){for(this.moveListTy=0;a.EditorModel.getInstance().fileItem.length;)this.deleFile(a.EditorModel.getInstance().fileItem,a.EditorModel.getInstance().fileItem[0])},f.prototype.readMapFile=function(b){var c=this;AppData.mapOpenUrl=b,localStorage.setItem("mapurl",b),this.clearSceneAll(),m.getInstance().load(k.fileRoot+b,m.BYTE_TYPE,function(b){var d=new Pan3d.Pan3dByteArray(b),f=JSON.parse(d.readUTF());c._sceneProjectVo=new a.SceneProjectVo(f);for(var g=c.wirteItem(f.list),h=0;h<g.length;h++)a.EditorModel.getInstance().fileItem.push(g[h]);c.isCompelet=!0,c.refrishFolder(),c.resize(),e.dispatchEvent(new a.MainEditorEvent(a.MainEditorEvent.SHOW_SCENE_POJECT_MESH_VIEW),c._sceneProjectVo)})},f.prototype.addBasrole=function(){var b=new md5list.Md5MoveSprite;b.setMd5url("2/body.md5mesh","2/stand.md5anim","white.jpg"),a.MainEditorProcessor.edItorSceneManager.addSpriteDisplay(b),console.log(b)},f.prototype.selectModelEvet=function(b,c){void 0===c&&(c=!1),b.length&&(this.hidefileItemBg(a.EditorModel.getInstance().fileItem),a.EditorModel.getInstance().addSelctItem(b,c),this.showXyzMove(),this.refrishFolder(),this.resize())},f.prototype.saveMap=function(){var b=this._sceneProjectVo.getSaveObj();b.list=this.getWillSaveItem(a.EditorModel.getInstance().fileItem),b.version=pack.FileOssModel.version;var c=new Pan3d.Pan3dByteArray,d=Pan3d.Scene_data.fileRoot+AppData.mapOpenUrl;c.writeUTF(JSON.stringify(b));var e=new File([c.buffer],"scene.map"),f=d.replace(Pan3d.Scene_data.ossRoot,"");pack.FileOssModel.upOssFile(e,f,function(){console.log("上传完成")})},f.prototype.getWillSaveItem=function(a){for(var b=[],c=0;c<a.length;c++){var d={};d.type=a[c].ossListFile.type,d.name=a[c].ossListFile.name,d.url=a[c].ossListFile.url,d.x=a[c].dis.x,d.y=a[c].dis.y,d.z=a[c].dis.z,d.scaleX=a[c].dis.scaleX,d.scaleY=a[c].dis.scaleY,d.scaleZ=a[c].dis.scaleZ,d.rotationX=a[c].dis.rotationX,d.rotationY=a[c].dis.rotationY,d.rotationZ=a[c].dis.rotationZ,d.data=a[c].ossListFile.name,a[c].childItem&&(d.childItem=this.getWillSaveItem(a[c].childItem)),b.push(d)}return b.length?b:null},f.prototype.changeScrollBar=function(){c.prototype.changeScrollBar.call(this),this.refrishFolder()},f.prototype.resize=function(){this.isCompelet&&(this.contentHeight=20*this.getItemDisNum(a.EditorModel.getInstance().fileItem)),c.prototype.resize.call(this);for(var b=0;b<this.cellBgItem.length;b++)this.cellBgItem[b].width=this.pageRect.width-20},f.prototype.refrishFolder=function(){if(this.isCompelet){this.listTy=0+this.moveListTy,this.disChiendren(a.EditorModel.getInstance().fileItem,10);var b=this._uiMask.y;for(this.moveAllTy(a.EditorModel.getInstance().fileItem,b);this.cellBgItem.length;)this.removeChild(this.cellBgItem.pop());this.showSelectBg(a.EditorModel.getInstance().fileItem)}},f.prototype.showSelectBg=function(a){for(var b=0;a&&b<a.length;b++)if(a[b].ossListFile.isOpen&&this.showSelectBg(a[b].childItem),a[b].ossListFile.treeSelect){var c=this.addChild(this._baseMidRender.getComponent("e_select_cell_bg"));c.y=a[b].cellPos.y,c.x=1,c.width=this.pageRect.width-2,c.height=20,this.cellBgItem.push(c)}},f.prototype.moveAllTy=function(a,b){void 0===b&&(b=0);for(var c=0;a&&c<a.length;c++)a[c].cellPos.y+=b,a[c].ossListFile.isOpen&&this.moveAllTy(a[c].childItem,b)},f.prototype.getItemDisNum=function(a){for(var b=0,c=0;a&&c<a.length;c++)b++,a[c].ossListFile.isOpen&&(b+=this.getItemDisNum(a[c].childItem));return b},f.prototype.disChiendren=function(a,b){void 0===b&&(b=0);for(var c=0;a&&c<a.length;c++)a[c].cellPos.x=b,a[c].cellPos.y=this.listTy,a[c].uiScale=.5,this.listTy+=20,a[c].ossListFile.isOpen&&this.disChiendren(a[c].childItem,b+20)},f}(win.Dis2dBaseWindow);a.HierarchyListPanel=z}(maineditor||(maineditor={}));var maineditor;!function(a){var b=function(){function a(){this.selectItem=[],this.fileItem=[]}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.addSelctItem=function(a,b){if(b)for(var c=0;c<a.length;c++)-1==this.selectItem.indexOf(a[c])&&this.selectItem.push(a[c]);else this.selectItem=a},a.prototype.keyDeleSelectItem=function(){if(this.selectItem.length){var a=window.confirm("是否确定要删除选取的对象。");a&&this.deleSelectItem()}},a.prototype.deleSelectItem=function(){for(;this.selectItem.length;){var a=this.selectItem.pop();this.hierarchyListPanel.deleFile(this.fileItem,a)}Pan3d.ModuleEventManager.dispatchEvent(new xyz.MoveScaleRotatioinEvent(xyz.MoveScaleRotatioinEvent.CLEAR_XYZ_MOVE_DATA))},a.prototype.mouseHitSprite=function(a,b,c){for(var d,e,f=0;f<a.length;f++){var g=xyz.TooMathHitModel.testHitModel(a[f].dis,a[f].dis._scene,b);0!=g&&(!d||d>g)&&(d=g,e=a[f])}e&&(console.log(d),c.push(e),console.log("-----------------------"))},a.prototype.selectModel=function(a){var b=[];return this.mouseHitSprite(this.fileItem,a,b),b},a}();a.EditorModel=b}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.Scene_data,c=Pan3d.TimeUtil,d=Pan3d.MathClass,e=Pan3d.FBO,f=Pan3d.GlReset,g=layapan_me.LayaOverride2dSceneManager,h=function(a){function g(){return a.call(this)||this}return __extends(g,a),g.prototype.updateDepthTexture=function(a){var c=b.context3D.renderContext;c.bindFramebuffer(c.FRAMEBUFFER,a.frameBuffer),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a.texture,0),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,a.depthBuffer),c.viewport(0,0,a.width,a.height),c.clearColor(a.color.x,a.color.y,a.color.z,a.color.w),
c.clearDepth(1),c.clearStencil(0),c.enable(c.DEPTH_TEST),c.depthMask(!0),c.enable(c.BLEND),c.frontFace(c.CW),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)},g.prototype.renderToTexture=function(a){if(void 0===a&&(a=null),f.saveBasePrarame(b.context3D.renderContext),this.fbo?this.fbo.resetSize(this.cam3D.cavanRect.width,this.cam3D.cavanRect.height):this.fbo=new e,a)this.viewMatrx3D=a;else{this.viewMatrx3D.identity(),this.viewMatrx3D.perspectiveFieldOfViewLH(.8,1,1,2e3),this.viewMatrx3D.appendScale(1,this.cam3D.cavanRect.width/this.cam3D.cavanRect.height,1);var c=400/this.cam3D.cavanRect.width;this.viewMatrx3D.appendScale(c,c,1)}this.updateDepthTexture(this.fbo),this.update();var d=b.context3D.renderContext;d.bindFramebuffer(d.FRAMEBUFFER,null),d.bindTexture(d.TEXTURE_2D,null),d.bindRenderbuffer(d.RENDERBUFFER,null),this.textureRes&&(this.textureRes.texture=this.fbo.texture),f.resetBasePrarame(b.context3D.renderContext)},g.prototype.update=function(){var a=b.cam3D,e=b.focus3D,f=b.viewMatrx3D.clone();b.cam3D=this.cam3D,b.focus3D=this.focus3D,b.viewMatrx3D=this.viewMatrx3D,d.updateVp(),isNaN(this._time)&&(this._time=c.getTimer()),b.context3D._contextSetTest.clear(),this.particleManager.updateTime(),this.skillManager.update(),this._ready&&(this.updateMovieFrame(),b.context3D.cullFaceBack(!0),b.context3D.setWriteDepth(!0),b.context3D.setDepthTest(!0),this.updateStaticDiplay(),this.updateSpriteDisplay(),this.updateMovieDisplay(),b.context3D.setWriteDepth(!0),b.context3D.setDepthTest(!0),b.context3D.setCullFaceModel(2),b.context3D.setBlendParticleFactors(1),this.particleManager.update()),b.cam3D=a,b.focus3D=e,b.viewMatrx3D=f},g.prototype.getGroundPos=function(a){var b=this,c=xyz.TooMathHitModel.mathDisplay2Dto3DWorldPos(new Vector2D(a.x-b.cam3D.cavanRect.x,a.y-b.cam3D.cavanRect.y),b),d=new Array;return d.push(new Vector3D(0,0,0)),d.push(new Vector3D(-100,0,100)),d.push(new Vector3D(100,0,100)),Pan3d.MathUtil.getLinePlaneInterectPointByTri(new Vector3D(b.cam3D.x,b.cam3D.y,b.cam3D.z),c,d)},g.prototype.playLyf=function(a,b,c){var d=this;void 0===c&&(c=0),this.groupDataManager.scene=this,this.groupDataManager.getGroupData(Pan3d.Scene_data.fileRoot+a,function(a){for(var e=0;e<a.dataAry.length;e++){var f=a.dataAry[e];if(f.types==Pan3d.BaseRes.SCENE_PARTICLE_TYPE){var g=d.particleManager.getParticleByte(Pan3d.Scene_data.fileRoot+f.particleUrl);g.x=b.x,g.y=b.y,g.z=b.z,g.rotationY=c,d.particleManager.addParticle(g)}else console.log("播放的不是单纯特效")}})},g}(g);a.EdItorSceneManager=h}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),inputres;!function(a){var b=Pan3d.Scene_data,c=Pan3d.Pan3dByteArray,d=Pan3d.Pan3dByteArray,e=Pan3d.ObjDataManager,f=Pan3d.ModuleEventManager,g=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;return b.needRefrishArr=[],b.fileRoot="ccav/",b.scale=.1,b}return __extends(d,a),d.prototype.readScene=function(){a.prototype.readScene.call(this),this.bfun()},d.prototype.saveImgToSever=function(a,c){var d=new Image;d.url=c.replace(b.fileRoot,""),d.src="data:image/png;base64,"+Pan3d.Base64.encode(a);var e=this.dataURLtoFile(d.src,d.url);this.upOssFile(e,c)},d.prototype.dataURLtoFile=function(a,b){for(var c=a.split(","),d=c[0].match(/:(.*?);/)[1],e=atob(c[1]),f=e.length,g=new Uint8Array(f);f--;)g[f]=e.charCodeAt(f);return new File([g],b,{type:d})},d.prototype.readChangeBuff=function(a,b,c,d){for(var e=new Array,f=a.byteLength/(4*d),g=0;f>g;g++)for(var h=d*g+c,i=0;b>i;i++){var j=4*(h+i),k=a.getFloat32(j,!0);a.setFloat32(j,k,!0),e.push(k)}return e},d.prototype.saveObjDataToSever=function(a,c){c=c.replace(".xml",".objs");var d=a.stride/4,e={};e.version=b.version,e.vertices=this.readChangeBuff(a.dataView,3,0,d),e.uvs=this.readChangeBuff(a.dataView,2,3,d),e.lightuvs=this.readChangeBuff(a.dataView,2,5,d),e.normals=e.vertices,e.indexs=a.indexs;for(var f=0;f<e.vertices.length;f++)e.vertices[f]*=this.scale;var g=new File([JSON.stringify(e)],"temp.objs");this.upOssFile(g,c)},d.prototype.getPerentPath=function(a){var b=a.lastIndexOf("/");return a=-1!=b?a.substr(0,b+1):""},d.prototype.addNeedReedRerishDic=function(a){a=this.getPerentPath(a),-1==this.needRefrishArr.indexOf(a)&&this.needRefrishArr.push(a)},d.prototype.reFrishArrByOney=function(){var a=this;if(this.needRefrishArr.length){var b=this.needRefrishArr.pop();pack.FileOssModel.getDisByOss(b,function(){console.log("刷新了文件夹目录",b),a.reFrishArrByOney()})}},d.prototype.upOssFile=function(a,c){var d=c.replace(b.fileRoot,"");d=b.fileRoot+this.fileRoot+d;var e=d.replace(b.ossRoot,"");this.addNeedReedRerishDic(e),pack.FileOssModel.upOssFile(a,e,function(){})},d.prototype.readObj=function(a){for(var d=a.readInt(),f=0;d>f;f++){var g=b.fileRoot+a.readUTF(),h=a.readInt(),i=new c;i.length=h,a.readBytes(i,0,h);var j=e.getInstance().loadObjCom(i.buffer,g);this.saveObjDataToSever(j,g)}this._imgFun&&this._imgFun()},d.prototype.readImg=function(){this.imgNum=this._byte.readInt(),this.imgLoadNum=0;for(var a=0;a<this.imgNum;a++){var c=b.fileRoot+this._byte.readUTF(),d=this._byte.readInt();if(-1!=c.search(".jpng"))this.readJpngImg(c),console.log("url");else{var e=this._byte.buffer.slice(this._byte.position,this._byte.position+d);this._byte.position+=d,this.saveImgToSever(e,c)}this.countImg()}},d}(Pan3d.SceneRes);a.SceneRes=g;var h=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.inputSceneFile=function(a,b){var c=this,d=new FileReader;d.readAsArrayBuffer(a),d.onload=function(a){if(c.isMapH5File(d.result)){var e=d.result;c.setMapByteMesh(e,b)}else alert("不确定类型")}},a.prototype.setMapByteMesh=function(a,c){var d=this;this.sceneRes=new g,this.sceneRes.fileRoot=c,this.sceneRes.scale=.1,this.sceneRes.bfun=function(){var a="baseedit/assets/base/baselight.material",c=b.fileRoot.replace(b.ossRoot,"")+d.sceneRes.fileRoot+"baselight.material";pack.FileOssModel.copyFile(c,a);for(var e=d.sceneRes.sceneData.buildItem,f=0;f<e.length;f++)if(1==e[f].type){var g=[],h=e[f].objsurl,i=e[f].lighturl,j=d.getMainPic(e[f].materialInfoArr),k=e[f].name;g.push({name:"param0",url:j}),g.push({name:"param1",url:i}),h&&(j||(j="assets/base/base.jpg"),i||(i="assets/base/white.jpg"),d.makePerfabToSever(k,h,g,e[f]))}d.sceneRes.reFrishArrByOney()},this.sceneRes.loadComplete(a)},a.prototype.isMapH5File=function(a){var b=new d(a);b.position=0;var c=(b.readInt(),b.readUTF());return-1!=c.indexOf("role/")?!0:!0},a.prototype.getMainPic=function(a){for(var b=0;a&&b<a.length;b++)if(0==a[b].type)return a[b].url;return null},a.prototype.getNameByPath=function(a){return a.substr(a.lastIndexOf("/")+1,a.length)},a.prototype.makePerfabToSever=function(a,b,c,d){var e=this,g=new Pan3d.Pan3dByteArray,h=new pack.PrefabStaticMesh;h.url=this.sceneRes.fileRoot+"prefab/"+a+".prefab",h.objsurl=this.sceneRes.fileRoot+b.replace(".xml",".objs"),h.textureurl=this.sceneRes.fileRoot+"baselight.material",h.paramInfo=[];for(var i=0;i<c.length;i++){var j={};j.id=i,j.type="tex",j.paramName=c[i].name,j.data=this.sceneRes.fileRoot+c[i].url,h.paramInfo.push(j)}var k=Pan3d.Scene_data.fileRoot+h.url,l=h.getObject();l.version=pack.FileOssModel.version,g.writeUTF(JSON.stringify(l));var m=new File([g.buffer],"temp.prefab"),n=k.replace(Pan3d.Scene_data.ossRoot,"");pack.FileOssModel.upOssFile(m,n,function(){var a={};a.name=e.getNameByPath(h.url),a.url=h.url;var b=e.sceneRes.scale;a.pos=new Vector3D(d.x*b,d.y*b,d.z*b),a.scale=new Vector3D(d.scaleX,d.scaleY,d.scaleZ),a.rotation=new Vector3D(d.rotationX,d.rotationY,d.rotationZ),f.dispatchEvent(new maineditor.MainEditorEvent(maineditor.MainEditorEvent.INPUT_PREFAB_TO_SCENE),a)})},a}();a.ImputGameResModel=h}(inputres||(inputres={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),maineditor;!function(a){var b=Pan3d.BaseEvent,c=Pan3d.Module,d=Pan3d.BaseProcessor,e=Pan3d.ModuleEventManager,f=Pan3d.Rectangle,g=Pan3d.MouseType,h=Pan3d.MathClass,i=Pan3d.KeyboardType,j=editscene.EditSceneEvent,k=editscene.EditLeftPanel,l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.LOAD_SCENE_MAP="LOAD_SCENE_MAP",b.INIT_MAIN_EDITOR_PANEL="INIT_MAIN_EDITOR_PANEL",b.SHOW_MAIN_EDITOR_PANEL="SHOW_MAIN_EDITOR_PANEL",b.INPUT_PREFAB_TO_SCENE="INPUT_PREFAB_TO_SCENE",b.INPUT_ZZW_TO_SCENE="INPUT_ZZW_TO_SCENE",b.INPUT_LYF_TO_SCENE="INPUT_LYF_TO_SCENE",b.INPUT_SKILL_TO_SCENE="INPUT_SKILL_TO_SCENE",b.SAVE_SCENE_MAP_TO_SEVER="SAVE_SCENE_MAP_TO_SEVER",b.CLEAR_SCENE_MAP_ALL="CLEAR_SCENE_MAP_ALL",b.SHOW_SCENE_POJECT_MESH_VIEW="SHOW_SCENE_POJECT_MESH_VIEW",b.SCENE_SELECT_SPRITE_DOWN="SCENE_SELECT_SPRITE_DOWN",b.CHANGE_LEFT_PANEL_SHOW="CHANGE_LEFT_PANEL_SHOW",b}(b);a.MainEditorEvent=l;var m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getModuleName=function(){return"MainEditorModule"},b.prototype.listProcessors=function(){return[new n]},b}(c);a.MainEditorModule=m;var n=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getName=function(){return"MainEditorProcessor"},c.prototype.initPanelConfig=function(){this._hierarchyListPanel||(this._hierarchyListPanel=new a.HierarchyListPanel),this._mainEditorPanel||(this._mainEditorPanel=new a.MainEditorPanel,AppData.centenPanel.addUIContainer(this._mainEditorPanel))},c.prototype.receivedModuleEvent=function(b){if(b instanceof materialui.MaterialEvent){var d=b;d.type==materialui.MaterialEvent.SHOW_MATERIA_PANEL&&(this._mainEditorPanel.showType=2,this._mainEditorPanel.editorOpenList.pushPathUrl(d.data))}if(b instanceof l){var e=b;if(e.type==l.INIT_MAIN_EDITOR_PANEL&&(this.maseSceneManager(),this.initPanelConfig(),this.addEvents()),e.type==l.SHOW_MAIN_EDITOR_PANEL&&(this._mainEditorPanel.showType=1,k.leftPanel.addUIContainer(this._hierarchyListPanel),Pan3d.ModuleEventManager.dispatchEvent(new xyz.MoveScaleRotatioinEvent(xyz.MoveScaleRotatioinEvent.INIT_UICONTAINER_TO_XYZ),this._mainEditorPanel),editscene.EditTopMenuPanel.getInstance().makeSceneTopMenu()),e.type==l.INPUT_PREFAB_TO_SCENE&&this._hierarchyListPanel.inputPrefabToScene(e.data),e.type==l.INPUT_LYF_TO_SCENE&&this._hierarchyListPanel.inputLyfToScene(e.data),e.type==l.INPUT_SKILL_TO_SCENE&&this._hierarchyListPanel.inputSkillToScene(e.data),e.type==l.INPUT_ZZW_TO_SCENE&&this._hierarchyListPanel.inputZzwToScene(e.data),e.type==l.SHOW_SCENE_POJECT_MESH_VIEW&&(this.showScnePojectView(e.data),this._mainEditorPanel.sceneProjectVo=e.data),e.type==l.LOAD_SCENE_MAP){this._hierarchyListPanel.readMapFile(e.data);var f="",g=window.location.pathname.split("/"),h=g[g.length-1]+"?mapurl="+e.data;console.log(h),this._mainEditorPanel.editorOpenList.pushPathUrl(e.data),history.pushState(null,f,h)}if(e.type==l.CHANGE_LEFT_PANEL_SHOW&&this._hierarchyListPanel&&(this._hierarchyListPanel.hasStage?k.leftPanel.removeUIContainer(this._hierarchyListPanel):k.leftPanel.addUIContainer(this._hierarchyListPanel)),e.type==l.SAVE_SCENE_MAP_TO_SEVER&&this._hierarchyListPanel.saveMap(),e.type==l.CLEAR_SCENE_MAP_ALL)for(;a.EditorModel.getInstance().fileItem.length;)a.EditorModel.getInstance().selectItem=[a.EditorModel.getInstance().fileItem[0]],a.EditorModel.getInstance().deleSelectItem();if(e.type==l.SCENE_SELECT_SPRITE_DOWN){var i=a.EditorModel.getInstance().selectModel(new Vector2D(b.data.x-c.edItorSceneManager.cam3D.cavanRect.x,b.data.y-c.edItorSceneManager.cam3D.cavanRect.y));this._hierarchyListPanel.selectModelEvet(i,b.data.mouseEvent.shiftKey)}this.changePageRect()}b instanceof j&&(b.type=j.EDITE_SCENE_RESIZE)&&this.changePageRect()},c.prototype.showScnePojectView=function(b){b&&(this.sceneProjectVo=b);var c=new a.ScenePojectMeshView(prop.PropModel.getInstance().propPanle);c.data=this.sceneProjectVo,prop.PropModel.getInstance().showOtherMeshView(c)},c.prototype.addEvents=function(){var a=this;this.onMouseWheelFun||(this.onMouseWheelFun=function(b){a.onMouseWheel(b)},this.onMouseDownFun=function(b){a.onMouseDown(b)},this.onMouseMoveFun=function(b){a.onMouseMove(b)},this.onMouseUpFun=function(b){a.onMouseUp(b)},this.onKeyDownFun=function(b){a.onKeyDown(b)},this.onKeyUpFun=function(b){a.onKeyUp(b)}),document.addEventListener(g.MouseWheel,this.onMouseWheelFun),document.addEventListener(g.MouseDown,this.onMouseDownFun),document.addEventListener(g.MouseMove,this.onMouseMoveFun),document.addEventListener(g.MouseUp,this.onMouseUpFun),document.addEventListener(g.KeyDown,this.onKeyDownFun),document.addEventListener(g.KeyUp,this.onKeyUpFun),document.addEventListener("contextmenu",function(a){a.preventDefault()})},c.prototype.removeEvents=function(){document.removeEventListener(g.MouseWheel,this.onMouseWheelFun),document.removeEventListener(g.MouseDown,this.onMouseDownFun),document.removeEventListener(g.MouseMove,this.onMouseMoveFun),document.removeEventListener(g.MouseUp,this.onMouseUpFun),document.removeEventListener(g.KeyDown,this.onKeyDownFun),document.removeEventListener(g.KeyUp,this.onKeyUpFun)},c.prototype.onMouseMove=function(a){},c.prototype.onMouseDown=function(a){this.isCanToDo},c.prototype.onMouseUp=function(a){},Object.defineProperty(c.prototype,"hasStage",{get:function(){return this._hierarchyListPanel.hasStage?!0:!1},enumerable:!0,configurable:!0}),c.prototype.onKeyDown=function(b){if(this.hasStage)switch(b.keyCode){case i.Delete:console.log("删除选取"),a.EditorModel.getInstance().keyDeleSelectItem();break;case i.S:}},c.prototype.onKeyUp=function(a){},Object.defineProperty(c.prototype,"isCanToDo",{get:function(){return 1==AppData.sceneEidtType?!0:!1},enumerable:!0,configurable:!0}),c.prototype.onMouseWheel=function(a){!this.isCanToDo},c.prototype.maseSceneManager=function(){c.edItorSceneManager=new a.EdItorSceneManager,Pan3d.ProgrmaManager.getInstance().registe(Pan3d.LineDisplayShader.LineShader,new Pan3d.LineDisplayShader),c.edItorSceneManager.ready=!0,c.edItorSceneManager.cam3D=new Pan3d.Camera3D,c.edItorSceneManager.cam3D.distance=100,c.edItorSceneManager.focus3D.rotationY=0,c.edItorSceneManager.focus3D.rotationX=-45,h.getCamView(c.edItorSceneManager.cam3D,c.edItorSceneManager.focus3D),e.dispatchEvent(new xyz.MoveScaleRotatioinEvent(xyz.MoveScaleRotatioinEvent.INIT_MOVE_SCALE_ROTATION),c.edItorSceneManager)},c.prototype.changePageRect=function(){if(this._hierarchyListPanel&&k.leftPanel){var a=new f(k.leftPanel.rect.x,k.leftPanel.rect.y,k.leftPanel.rect.width,k.leftPanel.rect.height);this._hierarchyListPanel.setRect(a)}if(this._mainEditorPanel&&AppData.centenPanel){var a=new f(AppData.centenPanel.rect.x,AppData.centenPanel.rect.y,AppData.centenPanel.rect.width,AppData.centenPanel.rect.height);this._mainEditorPanel.panelEventChanger(a)}},c.prototype.listenModuleEvents=function(){return[new l(l.INIT_MAIN_EDITOR_PANEL),new l(l.SHOW_MAIN_EDITOR_PANEL),new l(l.INPUT_PREFAB_TO_SCENE),new l(l.INPUT_ZZW_TO_SCENE),new l(l.INPUT_LYF_TO_SCENE),new l(l.INPUT_SKILL_TO_SCENE),new l(l.SAVE_SCENE_MAP_TO_SEVER),new l(l.SCENE_SELECT_SPRITE_DOWN),new l(l.CLEAR_SCENE_MAP_ALL),new l(l.SHOW_SCENE_POJECT_MESH_VIEW),new l(l.LOAD_SCENE_MAP),new l(l.CHANGE_LEFT_PANEL_SHOW),new j(j.EDITE_SCENE_RESIZE),new materialui.MaterialEvent(materialui.MaterialEvent.SHOW_MATERIA_PANEL)]},c}(d);a.MainEditorProcessor=n}(maineditor||(maineditor={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),LayaPan3D;!function(a){var b=Pan3d.LineDisplayShader,c=Pan3d.GridLineSprite,d=Pan3d.ProgrmaManager,e=Pan3d.BaseDiplay3dSprite,f=Pan3d.Camera3D,g=Pan3d.Rectangle,h=Pan3d.FBO,i=left.MaterialRoleSprite,j=maineditor.ModelSprite,k=maineditor.SkillSpriteDisplay,l=maineditor.LyfSpriteDisplay,m=maineditor.EdItorSceneManager,n=function(a){function n(b,c){void 0===c&&(c=null);var d=a.call(this)||this;return d.initScene(),Laya.loader.load(b,Laya.Handler.create(d,function(a){d.texture=a,d.texture.bitmap.enableMerageInAtlas=!1,d.texture.uv=[0,1,1,1,1,0,0,0],d.width=d.texture.width,d.height=d.texture.height,d.resizeRect(),c&&c()})),d.frameLoop(1,d,d.upData),d}return __extends(n,a),n.prototype.scale=function(b,c,d){void 0===d&&(d=null);var e=a.prototype.scale.call(this,b,c,d);return this.resizeRect(),e},n.prototype.resizeRect=function(){if(this.texture){var a=this.scaleX*this.width,b=this.scaleY*this.height;this.sceneManager.cam3D.cavanRect.width=a,this.sceneManager.cam3D.cavanRect.height=b}},n.prototype.initScene=function(){d.getInstance().registe(b.LineShader,new b),this.sceneManager=new m;var a=new c;this.sceneManager.addDisplay(a),this.sceneManager.addDisplay(new e),this.sceneManager.ready=!0,this.sceneManager.cam3D=new f,this.sceneManager.cam3D.cavanRect=new g(0,0,512,512),this.sceneManager.cam3D.distance=200,this.sceneManager.focus3D.rotationY=random(360),this.sceneManager.focus3D.rotationX=-45},Object.defineProperty(n.prototype,"bgColor",{set:function(a){this.sceneManager.fbo||(this.sceneManager.fbo=new h),this.sceneManager.fbo.color.x=a.x,this.sceneManager.fbo.color.y=a.y,this.sceneManager.fbo.color.z=a.z,this.sceneManager.fbo.color.w=a.w},enumerable:!0,configurable:!0}),n.prototype.addDisplay=function(){var a=new j;a.setPreFabUrl("pefab/模型/球/球.prefab"),a.scale=2,a.x=-100,this.sceneManager.addDisplay(a)},n.prototype.addRole=function(){var a=new i;a.setRoleZwwUrl("pefab/上杉谦信/ssqx.zzw"),a.scale=.5,a.x=50,this.sceneManager.addMovieDisplay(a)},n.prototype.addSkillRole=function(){var a=new k;a.addSkillByUrl("pefab/技能/上杉谦信技能.skill"),a.x=-30,this.sceneManager.addDisplay(a)},n.prototype.addLyfSprite=function(){var a=new l;a.addLyfByUrl("pan/model/denglong_lyf.lyf"),a.y=100,this.sceneManager.addDisplay(a)},n.prototype.upData=function(){this.sceneManager&&this.parent&&(this.sceneManager.fbo&&this.texture&&this.texture.bitmap&&(this.texture.bitmap._source=this.sceneManager.fbo.texture),this.renderToTexture(),Laya.BaseShader.activeShader=null,Laya.BaseShader.bindShader=null)},n.prototype.renderToTexture=function(){this.sceneManager.renderToTexture()},n}(Laya.Image);a.Laya3dSprite=n}(LayaPan3D||(LayaPan3D={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),LayaPan3D;!function(a){var b=Pan3d.Shader3D,c=Pan3d.ProgrmaManager,d=Pan3d.Matrix3D,e=Pan3d.Scene_data,f=Pan3d.TextureManager,g=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.binLocation=function(a){a.bindAttribLocation(this.program,0,"v3Position"),a.bindAttribLocation(this.program,1,"u2Texture")},b.prototype.getVertexShaderString=function(){var a="attribute vec3 v3Position;attribute vec2 u2Texture;uniform vec4 rectinfo;varying vec2 v_texCoord;void main(void){v_texCoord = vec2(u2Texture.x, u2Texture.y);vec4 vt0= vec4(v3Position, 1.0);vt0.x = vt0.x *rectinfo.z+rectinfo.x;vt0.y = vt0.y *rectinfo.w-rectinfo.y;gl_Position = vt0;}";return a},b.prototype.getFragmentShaderString=function(){var a="precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ngl_FragColor =infoUv;\n}";return a},b.LayaScene2dPicShader="LayaScene2dPicShader",b}(b);a.LayaScene2dPicShader=g;var h=function(a){function b(b){void 0===b&&(b=null);var c=a.call(this)||this;return c.imgRectInfo=[0,0,1,1],c.width=100,c.height=100,c.initData(),b&&c.loadTextureByUrl(b),c}return __extends(b,a),b.prototype.initData=function(){b.objdata2D||(c.getInstance().registe(g.LayaScene2dPicShader,new g),this.objData=new ObjData,this.objData.vertices=new Array,this.objData.vertices.push(0,0,.9),this.objData.vertices.push(1,0,.9),this.objData.vertices.push(1,-1,.9),this.objData.vertices.push(0,-1,.9),this.objData.uvs=new Array,this.objData.uvs.push(0,0),this.objData.uvs.push(1,0),this.objData.uvs.push(1,1),this.objData.uvs.push(0,1),this.objData.indexs=new Array,this.objData.indexs.push(0,2,1),this.objData.indexs.push(0,3,2),this.upToGpu(),b.objdata2D=this.objData),this.shader=c.getInstance().getProgram(g.LayaScene2dPicShader),this.objData=b.objdata2D},b.prototype.updateMatrix=function(){if(this.width&&this.height&&this._scene){var a=this._scene.cam3D.cavanRect.width,b=this._scene.cam3D.cavanRect.height,c=Math.abs(this._scene.focus3D.rotationX),d=this._scene.focus3D.x-a/this._scene.cam3D.scene2dScale;d=this._x-d*(this._scene.cam3D.scene2dScale/2);var e=this._scene.focus3D.z-b/this._scene.cam3D.scene2dScale/Math.sin(c*Math.PI/180)*-1;e*=Math.sin(c*Math.PI/180),e=this._y+e*(this._scene.cam3D.scene2dScale/2),this.imgRectInfo[0]=-1+d/a*2,this.imgRectInfo[1]=-1+e/b*2,this.imgRectInfo[2]=this.width/a*2,this.imgRectInfo[3]=this.height/b*2}},b.prototype.set2dPos=function(a,b){this.x=a,this.y=b},b.prototype.loadTextureByUrl=function(a){var b=this;f.getInstance().getTexture(e.fileRoot+a,function(a){b._uvTextureRes=a})},b.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=e.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=e.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=e.context3D.uploadIndexBuff3D(this.objData.indexs))},b.prototype.update=function(){this.objData&&this.objData.indexBuffer&&this._uvTextureRes&&(this.updateMatrix(),e.context3D.setProgram(this.shader.program),e.context3D.setVc4fv(this.shader,"rectinfo",this.imgRectInfo),e.context3D.setVa(0,3,this.objData.vertexBuffer),e.context3D.setVa(1,2,this.objData.uvBuffer),e.context3D.setRenderTexture(this.shader,"s_texture",this._uvTextureRes.texture,0),e.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},b}(Pan3d.Display3D);a.LayaScene2dPicSprit=h;var i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.set2dPos=function(a,b){this.posv2=new Vector2D(a,b);var c=1,d=45;this._scene?(c=2/this._scene.cam3D.scene2dScale,d=Math.abs(this._scene.focus3D.rotationX)):console.log("没有添加到场景算出来的坐标不确定是否正确");var e=a*c,f=b*c/Math.sin(d*Math.PI/180)*-1;this.x=e,this.z=f},b.prototype.addStage=function(){a.prototype.addStage.call(this),this.posv2&&this.set2dPos(this.posv2.x,this.posv2.y)},b}(layapan_me.LayaSceneChar);a.LayaScene2dSceneChar=i;var j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b.prototype,"scene2dScale",{get:function(){return this.sceneManager.cam3D.scene2dScale},enumerable:!0,configurable:!0}),b.prototype.initScene=function(){a.prototype.initScene.call(this),this.sceneManager.focus3D.rotationX=-30,this.sceneManager.focus3D.rotationY=0},b.prototype.upData=function(){if(this.sceneManager){var b=this.sceneManager.cam3D.cavanRect.width,c=this.sceneManager.cam3D.cavanRect.height;this.sceneManager.focus3D.x=b/this.scene2dScale;var d=Math.abs(this.sceneManager.focus3D.rotationX);this.sceneManager.focus3D.z=c/this.scene2dScale/Math.sin(d*Math.PI/180)*-1,this.rootpos&&(this.sceneManager.focus3D.x+=this.rootpos.x/this.scene2dScale*2,this.sceneManager.focus3D.z+=this.rootpos.y/this.scene2dScale*2/Math.sin(d*Math.PI/180)*-1),Pan3d.MathClass.getCamView(this.sceneManager.cam3D,this.sceneManager.focus3D),a.prototype.upData.call(this)}},b.prototype.getMousePos=function(a,b){var c=new Vector2D(a*this.scaleX,b*this.scaleY),d=Math.abs(this.sceneManager.focus3D.rotationX),e=c.x+this.rootpos.x,f=(c.y+this.rootpos.y)*Math.sin(d*Math.PI/180)*2;return new Vector2D(e,f)},b.prototype.getPos3dBy2D=function(a,b){var c=1,d=45;return this.sceneManager?(c=2/this.sceneManager.cam3D.scene2dScale,d=Math.abs(this.sceneManager.focus3D.rotationX)):console.log("没有添加到场景算出来的坐标不确定是否正确"),new Vector3D(a*c,0,b*c/Math.sin(d*Math.PI/180)*-1)},b.prototype.renderToTexture=function(){var a=new d,b=this.sceneManager.cam3D.cavanRect.width,c=this.sceneManager.cam3D.cavanRect.height;a.appendScale(1/b,1/c,5e-4),a.appendScale(this.scene2dScale,this.scene2dScale,1),this.sceneManager.renderToTexture(a)},b}(a.Laya3dSprite);a.LayaScene2D=j}(LayaPan3D||(LayaPan3D={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),LayaPan3D;!function(a){var b=Pan3d.Vector2D,c=Pan3d.Object3D,d=function(a){function d(b,c){void 0===c&&(c=null);var d=a.call(this,b,c)||this;return d.addEvents(),d.addSceneModel(),d.bgColor=new Vector3D(.2,.2,.2,1),d}return __extends(d,a),d.prototype.addEvents=function(){this.on(Pan3d.MouseType.MouseDown,this,this.onStartDrag),this.on(Pan3d.MouseType.MouseWheel,this,this.onMouseWheel),Laya.stage.on(Pan3d.MouseType.MouseUp,this,this.onMouseUp),Laya.stage.on(Pan3d.MouseType.MouseMove,this,this.onMouseMove)},d.prototype.addSceneModel=function(){this.addDisplay(),this.addSkillRole()},d.prototype.onMouseWheel=function(a){this.sceneManager.cam3D.distance+=a.delta},d.prototype.onStartDrag=function(a){this.mouseY<.2*this.height?this.startDrag(this.dragRegion,!0,.2*this.height):(this.lastMouseVec2d=new b(this.mouseX,this.mouseY),this.lastfocus3D=new c,this.lastfocus3D.rotationY=this.sceneManager.focus3D.rotationY,this.lastfocus3D.rotationX=this.sceneManager.focus3D.rotationX)},d.prototype.onMouseUp=function(a){this.lastMouseVec2d=null},d.prototype.onMouseMove=function(a){this.lastMouseVec2d&&(this.sceneManager.focus3D.rotationY=this.lastfocus3D.rotationY-(this.mouseX-this.lastMouseVec2d.x),this.sceneManager.focus3D.rotationX=this.lastfocus3D.rotationX-(this.mouseY-this.lastMouseVec2d.y)/10)},d.prototype.upData=function(){this.sceneManager&&(Pan3d.MathClass.getCamView(this.sceneManager.cam3D,this.sceneManager.focus3D),a.prototype.upData.call(this))},d}(a.Laya3dSprite);a.LayaScene3D=d}(LayaPan3D||(LayaPan3D={}));var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),LayaPan3D;!function(a){var b=Pan3d.Vector3D,c=Pan3d.Vector2D,d=Pan3d.Scene_data,e=function(e){function f(a,b){return void 0===b&&(b=null),e.call(this,a,b)||this}return __extends(f,e),f.prototype.initScene=function(){e.prototype.initScene.call(this),this.addEvents(),this.addSceneModel(),this.bgColor=new b(.1,.1,.1,1)},f.prototype.addSceneModel=function(){this.sceneManager.cam3D.scene2dScale=4;var b=new a.LayaScene2dSceneChar;b.setRoleUrl(getRoleUrl("5103")),this.sceneManager.addMovieDisplay(b),b.set2dPos(100,100),b.rotationY=180,this.mainChar=b;for(var c=new Pan3d.Rectangle(0,0,200,200),d=0;6>d;d++)for(var e=0;4>e;e++)d==e&&this.addGrouandPic("map/5/maps/"+e+"_"+d+".jpg",new Pan3d.Rectangle(d*c.width,e*c.height,c.width,c.height))},f.prototype.addFramePartice=function(a){var b="pan/atlas",c="10101_1",e={};e.timeLen=1e3,e.frameScale=.1,e.loop=!1,e.isShow=!0;var f=layapan_me.Frame3DAtlasParticle.getFrameParticle(d.fileRoot+b+"/",c,e);this.sceneManager.particleManager.addParticle(f);var g=this.getPos3dBy2D(a.x,a.y);f.x=g.x,f.y=0,f.z=g.z},f.prototype.addGrouandPic=function(b,c){var d=new a.LayaScene2dPicSprit(b);return d.set2dPos(c.x,c.y),d.width=c.width,d.height=c.height,this.sceneManager.addDisplay(d),d},f.prototype.addEvents=function(){this.on(Pan3d.MouseType.MouseDown,this,this.onStartDrag),this.on(Pan3d.MouseType.MouseWheel,this,this.onMouseWheel),this.rootpos=new c(-100,-100)},f.prototype.upData=function(){e.prototype.upData.call(this)},f.prototype.onMouseWheel=function(a){this.rootpos||(this.rootpos=new c),this.rootpos.x+=a.delta,this.rootpos.y+=a.delta,console.log(this.rootpos)},f.prototype.onStartDrag=function(a){if(this.mouseY<.2*this.height)this.startDrag(this.dragRegion,!0,.2*this.height);else{var b=this.getMousePos(this.mouseX,this.mouseY);this.addFramePartice(b),console.log("mouseX----",this.mouseX,"mouseY",this.mouseY,"mouseDown",b),this.mainChar.set2dPos(b.x,b.y)}},f}(a.LayaScene2D);a.LayaGame2dDemo=e}(LayaPan3D||(LayaPan3D={}));